{"version":3,"sources":["webpack://[name]/webpack/bootstrap","webpack://[name]/./node_modules/w2ui/w2ui-1.4.3.js"],"names":[],"mappings":";;QAAA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;;QAEA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;;;QAGA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA,0CAA0C,gCAAgC;QAC1E;QACA;;QAEA;QACA;QACA;QACA,wDAAwD,kBAAkB;QAC1E;QACA,iDAAiD,cAAc;QAC/D;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA,yCAAyC,iCAAiC;QAC1E,gHAAgH,mBAAmB,EAAE;QACrI;QACA;;QAEA;QACA;QACA;QACA,2BAA2B,0BAA0B,EAAE;QACvD,iCAAiC,eAAe;QAChD;QACA;QACA;;QAEA;QACA,sDAAsD,+DAA+D;;QAErH;QACA;;;QAGA;QACA;;;;;;;;;;;;AClFA;AACA;AACA,wBAAwB;;AAExB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oCAAoC;AACpC,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,gEAAgE,IAAI;AACpE;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,yEAAyE,SAAS;AAClF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wCAAwC,gBAAgB,cAAc,eAAe;AACrF,wCAAwC,gBAAgB,cAAc,eAAe;AACrF,wCAAwC,gBAAgB,cAAc,eAAe;AACrF,wCAAwC,gBAAgB,cAAc,eAAe;AACrF,wCAAwC,gBAAgB,cAAc,eAAe;AACrF,wCAAwC,gBAAgB,cAAc,eAAe;AACrF,wCAAwC,gBAAgB,cAAc,eAAe;AACrF,wCAAwC,gBAAgB,cAAc,eAAe;AACrF,wCAAwC,gBAAgB,cAAc,eAAe;AACrF,wCAAwC,gBAAgB,cAAc,gCAAgC;AACtG,wCAAwC,gBAAgB,cAAc,gCAAgC;AACtG,wCAAwC,gBAAgB,cAAc,gCAAgC;AACtG,wCAAwC,gBAAgB,cAAc,gCAAgC;AACtG,wCAAwC,gBAAgB,cAAc,gCAAgC;AACtG,wCAAwC,gBAAgB,cAAc,gCAAgC;AACtG,wCAAwC,gBAAgB,cAAc,gCAAgC;AACtG;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wCAAwC;AACxC;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BAA2B;AAC3B;AACA;AACA;AACA;AACA;AACA;AACA,8DAA8D,cAAc;AAC5E,4FAA4F,cAAc;AAC1G,mHAAmH,cAAc;AACjI,4GAA4G;AAC5G;AACA,4CAA4C,cAAc;AAC1D,kDAAkD,cAAc;;AAEhE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,mEAAmE;AACnE;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,0BAA0B,YAAY,cAAc;AACpD,SAAS;AACT;AACA;AACA,SAAS;AACT;AACA;AACA,SAAS;AACT;AACA;AACA,SAAS;AACT;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,mEAAmE;AACnE;;AAEA;AACA,8BAA8B;AAC9B;AACA,4CAA4C;;AAE5C;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,2CAA2C;AAC3C;AACA;AACA;AACA;;AAEA;AACA,mEAAmE;AACnE;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mDAAmD;AACnD;;AAEA,2CAA2C;AAC3C;AACA;AACA;AACA;;AAEA;AACA,oEAAoE;AACpE;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kDAAkD;AAClD;;AAEA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,wDAAwD,sBAAsB,sBAAsB,wBAAwB;AAC5H;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,sCAAsC,yCAAyC;AAC/E;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,2BAA2B,mBAAmB;AAC9C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA,6EAA6E,kBAAkB;AAC/F,mCAAmC,oBAAoB,eAAe;AACtE,mCAAmC,oBAAoB,eAAe;;AAEtE;AACA;AACA;AACA,2DAA2D;AAC3D,2DAA2D;AAC3D;AACA;AACA;AACA,8EAA8E;AAC9E,8EAA8E;AAC9E,iBAAiB;AACjB;;AAEA;AACA;AACA,2DAA2D;AAC3D,2DAA2D;AAC3D;AACA;AACA;AACA,8EAA8E;AAC9E,8EAA8E;AAC9E,iBAAiB;AACjB;;AAEA;AACA;AACA,2DAA2D,YAAY;AACvE,2DAA2D,YAAY;AACvE;AACA;AACA;AACA,8EAA8E;AAC9E,8EAA8E;AAC9E,iBAAiB;AACjB;;AAEA;AACA;AACA,2DAA2D;AAC3D,2DAA2D;AAC3D;AACA;AACA;AACA,8EAA8E;AAC9E,8EAA8E;AAC9E,iBAAiB;AACjB;;AAEA;AACA;AACA,2DAA2D;AAC3D,2DAA2D;AAC3D;AACA;AACA;AACA,8EAA8E;AAC9E,8EAA8E;AAC9E,iBAAiB;AACjB;;AAEA;AACA;AACA,2DAA2D;AAC3D,2DAA2D;AAC3D;AACA;AACA;AACA,8EAA8E;AAC9E,8EAA8E;AAC9E,iBAAiB;AACjB;;AAEA;AACA;AACA,2DAA2D;AAC3D,2DAA2D;AAC3D;AACA;AACA;AACA,8EAA8E;AAC9E,8EAA8E;AAC9E,iBAAiB;AACjB;;AAEA;AACA;AACA,2DAA2D;AAC3D,2DAA2D;AAC3D;AACA;AACA;AACA,8EAA8E;AAC9E,8EAA8E;AAC9E,iBAAiB;AACjB;;AAEA;AACA;AACA,2DAA2D;AAC3D,2DAA2D,sEAAsE,wCAAwC,YAAY;AACrL;AACA;AACA;AACA,8EAA8E,sCAAsC,YAAY;AAChI,8EAA8E;AAC9E,iBAAiB;AACjB;;AAEA;AACA;AACA,2DAA2D,qEAAqE,sCAAsC,YAAY;AAClL,2DAA2D,qEAAqE,YAAY;AAC5I;AACA;AACA;AACA,8EAA8E,YAAY;AAC1F,8EAA8E,wCAAwC,YAAY;AAClI,iBAAiB;AACjB;;AAEA;AACA;AACA,2DAA2D;AAC3D,2DAA2D,qEAAqE,YAAY;AAC5I;AACA;AACA;AACA,+EAA+E,YAAY;AAC3F;AACA,iBAAiB;AACjB;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA,SAAS;;AAET;AACA,4CAA4C;AAC5C;AACA,qBAAqB,4BAA4B,qCAAqC,kCAAkC;AACxH,iDAAiD,gCAAgC;AACjF;AACA;;AAEA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oCAAoC,qDAAqD;AACzF,sHAAsH;AACtH;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,2C;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,+CAA+C;AAC/C;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA,SAAS;AACT;;AAEA;AACA;AACA;AACA,kEAAkE,aAAa,cAAc,eAAe,oBAAoB;AAChI;AACA;AACA;AACA;AACA;AACA,yGAAyG;AACzG;AACA;;;AAGA,4CAA4C;AAC5C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,kEAAkE;AAClE;AACA,uBAAuB,kBAAkB;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,2BAA2B,mCAAmC;AAC9D;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA,sDAAsD;AACtD,8BAA8B,gEAAgE;;AAE9F,8BAA8B,4FAA4F,QAAQ;AAClI,uBAAuB,wGAAwG,QAAQ;AACvI;AACA,4BAA4B,qCAAqC;AACjE,KAAK;;AAEL;AACA,sDAAsD;AACtD,+BAA+B,GAAG,gEAAgE;;AAElG,8BAA8B,6FAA6F,QAAQ;AACnI,uBAAuB,gBAAgB;AACvC;AACA;AACA,mDAAmD,SAAS;AAC5D;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA,kCAAkC,4CAA4C;AAC9E;AACA,2CAA2C,yBAAyB,EAAE;AACtE,2CAA2C,yBAAyB;AACpE,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,4CAA4C,QAAQ;AACpD;AACA;AACA;AACA;AACA;AACA,uCAAuC;AACvC;AACA;AACA;AACA;AACA;AACA,yEAAyE;AACzE,iBAAiB;AACjB,uDAAuD;AACvD;AACA,8FAA8F;AAC9F;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4DAA4D;AAC5D,aAAa;AACb,0CAA0C;AAC1C;AACA,0FAA0F;AAC1F;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4DAA4D;AAC5D,aAAa;AACb,0CAA0C;AAC1C;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,CAAC,IAAI;;AAEL;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA,wCAAwC;AACxC;AACA,6GAA6G;AAC7G,aAAa;AACb,SAAS,OAAO;AAChB;AACA;AACA,6GAA6G;AAC7G;AACA;AACA;AACA;AACA,8CAA8C,gDAAgD,sBAAsB,sBAAsB;AAC1I,wEAAwE;AACxE;AACA;AACA,gDAAgD;AAChD;AACA;AACA,aAAa;AACb;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yBAAyB;AACzB;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB,kDAAkD,qBAAqB;AAC5F;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+B;AACA,aAAa;AACb,2BAA2B;AAC3B;AACA;AACA;AACA;AACA,6BAA6B;AAC7B;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;;AAEA;AACA;AACA;AACA,uDAAuD;AACvD;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB,4CAA4C,iDAAiD,EAAE;AAC/F;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB,4CAA4C,iDAAiD,EAAE;AAC/F;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yDAAyD;AACzD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6DAA6D,uBAAuB;AACpF;AACA;AACA;AACA;AACA,yDAAyD,eAAe,wCAAwC,EAAE;AAClH,wDAAwD,gBAAgB,wCAAwC,EAAE;AAClH;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA,6DAA6D,uBAAuB;AACpF;AACA;AACA,yDAAyD,gBAAgB,wCAAwC,EAAE;AACnH,wDAAwD,eAAe,wCAAwC,EAAE;AACjH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4CAA4C,UAAU,EAAE;AACxD;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA,SAAS;AACT,uDAAuD;AACvD;AACA,iCAAiC;AACjC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yBAAyB;AACzB,qBAAqB;AACrB;AACA;AACA,2CAA2C,qBAAqB,EAAE;AAClE;AACA;AACA;AACA;AACA,oDAAoD,UAAU,cAAc,WAAW,YAAY,iCAAiC,2BAA2B,kBAAkB;AACjL,sFAAsF,iBAAiB,kBAAkB,aAAa,sCAAsC;AAC5K,gFAAgF,eAAe,oBAAoB,mCAAmC;AACtJ;AACA,mCAAmC;AACnC;AACA;AACA;AACA,iEAAiE,yCAAyC,aAAa,aAAa,gBAAgB;AACpJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kDAAkD,yBAAyB,wBAAwB;AACnG,qBAAqB;AACrB;AACA;AACA,sE;AACA;AACA,aAAa;AACb;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sDAAsD;AACtD;AACA;AACA;AACA;AACA,uEAAuE,qDAAqD;AAC5H;AACA;AACA,aAAa;AACb;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2FAA2F;AAC3F,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,kGAAkG;AAClG,0EAA0E,cAAc,oBAAoB,UAAU;AACtH,+DAA+D,cAAc,aAAa;AAC1F;AACA;AACA;AACA;AACA;AACA,2BAA2B,0BAA0B;AACrD;AACA;AACA,6BAA6B;AAC7B,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+GAA+G,qCAAqC;AACpJ,sEAAsE;AACtE,4GAA4G;AAC5G,oFAAoF;AACpF,mFAAmF;AACnF;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA,8EAA8E,gEAAgE;AAC9I;AACA;AACA;AACA;AACA;AACA,2DAA2D,aAAa;AACxE;AACA;AACA;AACA;AACA;AACA,CAAC;;;AAGD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,iCAAiC;AACjC;AACA;AACA,+BAA+B;AAC/B,+BAA+B,WAAW;AAC1C,+BAA+B,WAAW;AAC1C,+BAA+B,WAAW;AAC1C,+BAA+B;AAC/B,+BAA+B,WAAW;AAC1C;AACA;AACA;AACA,+BAA+B,8BAA8B;;AAE7D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,mCAAmC;AACnC,mCAAmC,iBAAiB;AACpD;AACA;AACA,oCAAoC;AACpC;AACA;AACA;AACA;AACA;AACA;;AAEA,yBAAyB;AACzB;AACA,yBAAyB;AACzB;AACA;AACA;AACA,4BAA4B;AAC5B;AACA;;AAEA;AACA;AACA;AACA,uCAAuC;AACvC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uCAAuC;AACvC;AACA;AACA;AACA;AACA,uCAAuC;AACvC,uCAAuC;AACvC;AACA;AACA;AACA;AACA,uCAAuC;AACvC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8BAA8B,aAAa,qDAAqD,8CAA8C;AAC9I;AACA;AACA;AACA,mFAAmF;AACnF,mFAAmF;AACnF,mFAAmF;AACnF,mFAAmF;AACnF,mFAAmF;AACnF,+CAA+C;;AAE/C;AACA;AACA;AACA;AACA;AACA;AACA,qDAAqD;AACrD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8CAA8C,gBAAgB,oBAAoB;AAClF,kCAAkC,kEAAkE;AACpG;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,SAAS;AACT;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,0BAA0B,6GAA6G;AACvI,0BAA0B,qIAAqI;AAC/J,0BAA0B;AAC1B;AACA,8GAA8G,wBAAwB;AACtI,2BAA2B;AAC3B,0BAA0B,2HAA2H;AACrJ,0BAA0B,iIAAiI;AAC3J,0BAA0B,uJAAuJ;AACjL,0BAA0B,6JAA6J;AACvL,0BAA0B;AAC1B,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BAA2B;AAC3B;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BAA2B,yBAAyB;AACpD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET,kDAAkD;AAClD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4DAA4D;AAC5D;AACA;AACA,aAAa,OAAO;AACpB;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA,+DAA+D;AAC/D;AACA;AACA,SAAS;;AAET;AACA;AACA,2BAA2B,yBAAyB;AACpD;AACA,uDAAuD;AACvD;AACA;AACA;AACA,2BAA2B,yBAAyB;AACpD;AACA,uDAAuD;AACvD;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA,2BAA2B,sBAAsB;AACjD,mDAAmD,QAAQ;AAC3D,gEAAgE,2BAA2B,WAAW;AACtG;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA,2BAA2B,sBAAsB;AACjD,mDAAmD,QAAQ;AAC3D,gEAAgE,2BAA2B,WAAW;AACtG;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA,2BAA2B,yBAAyB;AACpD;AACA,uDAAuD;AACvD;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA,2BAA2B,sBAAsB;AACjD,mDAAmD,QAAQ;AAC3D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA,2BAA2B,sBAAsB;AACjD,mDAAmD,QAAQ;AAC3D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA,2BAA2B,sBAAsB;AACjD,mDAAmD,QAAQ;AAC3D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA,2BAA2B,sBAAsB;AACjD,oDAAoD,QAAQ;AAC5D,iEAAiE,4BAA4B,WAAW;AACxG;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA,2BAA2B,0BAA0B;AACrD;AACA,uDAAuD;AACvD;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA,2BAA2B,sBAAsB;AACjD,oDAAoD,QAAQ;AAC5D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA,2BAA2B,sBAAsB;AACjD,oDAAoD,QAAQ;AAC5D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA,2BAA2B,sBAAsB;AACjD,oDAAoD,QAAQ;AAC5D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0DAA0D;AAC1D;AACA;AACA;AACA;AACA,aAAa;AACb;AACA,yDAAyD,wFAAwF,EAAE;AACnJ;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sDAAsD;AACtD;AACA;AACA;AACA;AACA,6BAA6B;AAC7B;AACA;AACA;AACA;AACA;AACA;AACA,4EAA4E;AAC5E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iGAAiG;AACjG;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kEAAkE;AAClE;AACA;AACA,kEAAkE;AAClE;AACA;AACA;AACA,qHAAqH;AACrH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yDAAyD,uFAAuF,EAAE;AAClJ;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;;AAEA;AACA,+BAA+B;AAC/B,kCAAkC,WAAW;AAC7C;AACA;AACA;AACA;AACA,qBAAqB;AACrB,kCAAkC,mDAAmD;AACrF;AACA;AACA,aAAa,yBAAyB;AACtC;AACA,kCAAkC,WAAW;AAC7C;AACA;AACA;AACA,qBAAqB;AACrB,kCAAkC,mDAAmD;AACrF;AACA;AACA,aAAa;AACb,kCAAkC,WAAW;AAC7C;AACA;AACA,sCAAsC,WAAW;AACjD;AACA;AACA;AACA,yBAAyB;AACzB,oDAAoD,gDAAgD;AACpG;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA,+DAA+D;AAC/D;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA,iBAAiB,OAAO;AACxB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iCAAiC,2CAA2C,GAAG,yCAAyC;AACxH;AACA;AACA;AACA;AACA,2FAA2F,SAAS,OAAO;AAC3G;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA,2BAA2B,sBAAsB;AACjD;AACA;AACA,kDAAkD,QAAQ;AAC1D;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;;AAEA;AACA;AACA,kHAAkH,cAAc,EAAE,EAAE;;AAEpI,6BAA6B;;AAE7B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sCAAsC,6CAA6C,GAAG,mEAAmE;AACzJ,sCAAsC,6CAA6C,GAAG,mEAAmE;AACzJ;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8CAA8C;AAC9C,gCAAgC,qCAAqC,GAAG,+BAA+B;AACvG;AACA,6DAA6D,0DAA0D;AACvH;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA,yEAAyE,0CAA0C;AACnH,qBAAqB;AACrB;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iDAAiD,iBAAiB;AAClE;;AAEA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA,2BAA2B,sBAAsB;AACjD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kDAAkD,iFAAiF;AACnI;AACA;AACA;AACA,qDAAqD,aAAa;AAClE;AACA;AACA;AACA,iBAAiB;AACjB;AACA,8CAA8C;AAC9C;AACA,qDAAqD,sCAAsC,YAAY,oCAAoC,EAAE;AAC7I;AACA;AACA;AACA;AACA;AACA;AACA,kDAAkD,8FAA8F;AAChJ;AACA;AACA;AACA;AACA,yDAAyD,aAAa;AACtE;AACA;AACA,2CAA2C,aAAa,EAAE;AAC1D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kDAAkD,iBAAiB;AACnE;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA,2BAA2B,sBAAsB;AACjD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kDAAkD,mFAAmF;AACrI;AACA;AACA;AACA;AACA,uGAAuG;AACvG;AACA;AACA,iBAAiB;AACjB;AACA,8CAA8C;AAC9C;AACA,qDAAqD,sCAAsC,YAAY,oCAAoC,EAAE;AAC7I;AACA;AACA;AACA;AACA;AACA,kDAAkD,kFAAkF;AACpI;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kDAAkD,iBAAiB;AACnE;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA,0CAA0C,gEAAgE;AAC1G;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+BAA+B,gCAAgC;AAC/D;AACA,qGAAqG;AACrG;AACA,aAAa;AACb;AACA;AACA,+BAA+B,cAAc;AAC7C;AACA,gFAAgF;AAChF;AACA;AACA;AACA;AACA;AACA,kEAAkE;AAClE,oEAAoE;AACpE;AACA;AACA,8CAA8C,iBAAiB;AAC/D,SAAS;;AAET;AACA;AACA,0CAA0C,kEAAkE;AAC5G;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8CAA8C,iBAAiB;AAC/D,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA,uEAAuE;AACvE;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA,kCAAkC,8FAA8F;AAChI;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yBAAyB;AACzB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2CAA2C,0BAA0B;AACrE,yBAAyB;AACzB,2CAA2C,2BAA2B;AACtE,yBAAyB;AACzB,2CAA2C,2BAA2B;AACtE,yBAAyB;AACzB,2CAA2C,gBAAgB;AAC3D;AACA,mDAAmD,iBAAiB;AACpE;AACA;AACA;AACA,sDAAsD;AACtD,sDAAsD;AACtD;AACA;AACA,mDAAmD;AACnD;AACA,yBAAyB;;AAEzB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yBAAyB;AACzB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA,sDAAsD;AACtD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4BAA4B,mCAAmC,GAAG,mCAAmC;AACrG;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kDAAkD;AAClD;AACA,qDAAqD;AACrD;AACA;AACA;AACA,0CAA0C;AAC1C,oGAAoG;AACpG;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sBAAsB,kBAAkB;AACxC;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA,8CAA8C,iBAAiB;AAC/D,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA,mCAAmC,+BAA+B;AAClE;AACA,SAAS;;AAET;AACA;AACA;AACA,4BAA4B,0BAA0B;AACtD;AACA;AACA;AACA,8BAA8B;AAC9B,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uCAAuC,YAAY;AACnD,aAAa;AACb,SAAS;;AAET;AACA;AACA;AACA;AACA,0BAA0B;AAC1B;AACA;AACA,aAAa;AACb;AACA;AACA,0CAA0C,mBAAmB,iDAAiD;AAC9G;AACA;AACA;AACA;AACA;AACA;AACA,wC;AACA,+BAA+B;AAC/B,iBAAiB;AACjB;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA,0CAA0C,qEAAqE;AAC/G;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oBAAoB;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8CAA8C,iBAAiB;AAC/D,SAAS;;AAET;AACA,4CAA4C;AAC5C,4CAA4C;AAC5C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sBAAsB,kBAAkB;AACxC;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA,0CAA0C;AAC1C,SAAS;;AAET;AACA;AACA;AACA;AACA,8CAA8C;AAC9C,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA,6DAA6D,oBAAoB;AACjF;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8CAA8C,kFAAkF;AAChI,qDAAqD,8CAA8C,+CAA+C,EAAE,QAAQ;AAC5J,aAAa;AACb,iCAAiC;AACjC;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA,8EAA8E,cAAc;AAC5F,iBAAiB;AACjB;AACA;AACA;AACA,oCAAoC,uBAAuB,EAAE;AAC7D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mCAAmC,sBAAsB;AACzD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6EAA6E;AAC7E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA,oCAAoC;AACpC,kDAAkD,4DAA4D;AAC9G;AACA;AACA;AACA;AACA,6BAA6B,uCAAuC;AACpE;AACA,+CAA+C,yCAAyC,2BAA2B,GAAG;AACtH,+CAA+C,4CAA4C;AAC3F;AACA;AACA;AACA;AACA,sDAAsD,iBAAiB;AACvE,iBAAiB;AACjB;AACA;AACA,kDAAkD,iBAAiB;AACnE;AACA,SAAS;;AAET;AACA;AACA;AACA,oCAAoC,mIAAmI,EAAE;AACzK;AACA;;AAEA;AACA;AACA;AACA;AACA,0CAA0C,2FAA2F;AACrI;AACA,6DAA6D,+CAA+C;AAC5G;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA,yBAAyB;AACzB;AACA;AACA;AACA,iCAAiC,+BAA+B,EAAE,YAAY;AAC9E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6BAA6B;AAC7B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yCAAyC;AACzC;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8CAA8C,iBAAiB;AAC/D;AACA,0DAA0D;AAC1D;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA,0CAA0C,sEAAsE;AAChH;AACA,6DAA6D,+CAA+C;AAC5G;AACA;AACA;AACA;AACA,8CAA8C,iBAAiB;AAC/D,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA,iDAAiD,mBAAmB;AACpE;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA,+CAA+C;AAC/C,yBAAyB,0CAA0C,EAAE;AACrE;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;;AAEA;AACA;AACA;AACA;AACA,0CAA0C,uEAAuE;AACjH;AACA;AACA;AACA,8CAA8C,gCAAgC;AAC9E;AACA;AACA;AACA;AACA;AACA;AACA,yDAAyD,iBAAiB;AAC1E;AACA;AACA,aAAa;AACb;AACA;AACA,kDAAkD,iBAAiB;AACnE;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yCAAyC;AACzC,oDAAoD;AACpD;AACA;AACA;AACA;AACA,yBAAyB,+BAA+B;AACxD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4EAA4E;AAC5E;AACA,+CAA+C;AAC/C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gDAAgD;AAChD;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA,qBAAqB;AACrB,aAAa;AACb;AACA;AACA,qEAAqE,oBAAoB,eAAe;AACxG;AACA;AACA;AACA;AACA;AACA,4DAA4D,gBAAgB;AAC5E;AACA;AACA;AACA;AACA;AACA,mFAAmF,aAAa,cAAc,aAAa;AAC3H;AACA;AACA;AACA,qBAAqB;AACrB,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oDAAoD,oCAAoC;AACxF,qCAAqC;AACrC;AACA;AACA,iCAAiC;AACjC;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wDAAwD,iDAAiD;AACzG,yCAAyC;AACzC;AACA;AACA,qCAAqC;AACrC;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wDAAwD,iDAAiD;AACzG,yCAAyC;AACzC;AACA;AACA,qCAAqC;AACrC;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wDAAwD,iDAAiD;AACzG,yCAAyC;AACzC;AACA;AACA,qCAAqC;AACrC;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,wDAAwD,aAAa,+BAA+B,GAAG;AACvG;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;;AAEA,aAAa;AACb;AACA,6CAA6C,iBAAiB;AAC9D,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kEAAkE,kCAAkC;AACpG;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0DAA0D,iBAAiB;AAC3E;AACA,iBAAiB;AACjB;AACA,kEAAkE,mCAAmC;AACrG;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0DAA0D,iBAAiB;AAC3E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA,0CAA0C,mEAAmE;AAC7G;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+BAA+B,qBAAqB;AACpD;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8CAA8C,iBAAiB;AAC/D,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0CAA0C,wGAAwG;AAClJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA,oCAAoC,SAAS;AAC7C,iBAAiB;AACjB;AACA;AACA;AACA;AACA,kCAAkC,iBAAiB,aAAa,WAAW;AAC3E;AACA,mCAAmC,UAAU;AAC7C;AACA;AACA;AACA,qBAAqB;AACrB,oEAAoE,0DAA0D;AAC9H;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA,4DAA4D;AAC5D;AACA,uCAAuC,+BAA+B;AACtE,qBAAqB;AACrB,qCAAqC,+BAA+B;AACpE;AACA,iBAAiB;AACjB;AACA;AACA,uCAAuC,+BAA+B;AACtE,qBAAqB;AACrB,qCAAqC,+BAA+B;AACpE;AACA;AACA;AACA;AACA;AACA;AACA,8CAA8C,iBAAiB;AAC/D,SAAS;;AAET;AACA;AACA,0CAA0C,8FAA8F;AACxI;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8CAA8C,iBAAiB;AAC/D,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA,yCAAyC,2EAA2E;AACpH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BAA2B;AAC3B,6CAA6C,eAAe;AAC5D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,oCAAoC,6CAA6C;AACjF;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB,OAAO;AAC5B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+CAA+C,kBAAkB;AACjE;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wCAAwC,kBAAkB;AAC1D;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oDAAoD,yDAAyD;AAC7G;AACA,iCAAiC;AACjC;AACA;AACA,qDAAqD,oCAAoC;AACzF;AACA;AACA;AACA;AACA,6BAA6B;AAC7B;AACA,2CAA2C,6BAA6B;AACxE;AACA,yBAAyB;AACzB;AACA;AACA,6CAA6C,cAAc;AAC3D;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oDAAoD,0CAA0C;AAC9F;AACA,iCAAiC;AACjC;AACA;AACA,qDAAqD,oCAAoC;AACzF;AACA;AACA;AACA;AACA,6BAA6B;AAC7B,2CAA2C,6BAA6B;AACxE;AACA,yBAAyB;AACzB;AACA;AACA,6CAA6C,gBAAgB;AAC7D;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0DAA0D;AAC1D;AACA;AACA;AACA;AACA,iCAAiC;AACjC;AACA;AACA,6BAA6B;AAC7B;AACA;AACA;AACA,qEAAqE,qDAAqD;AAC1H;AACA,iCAAiC;AACjC;AACA,qEAAqE,qDAAqD;AAC1H;AACA;AACA;AACA,yBAAyB,OAAO;AAChC,oEAAoE;AACpE,uCAAuC,qDAAqD;AAC5F;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA,yCAAyC,cAAc;AACvD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0DAA0D;AAC1D;AACA;AACA;AACA;AACA,iCAAiC;AACjC;AACA;AACA,6BAA6B;AAC7B;AACA;AACA;AACA,qEAAqE,qDAAqD;AAC1H;AACA,iCAAiC;AACjC;AACA,qEAAqE,qDAAqD;AAC1H;AACA;AACA;AACA,yBAAyB,OAAO;AAChC,oEAAoE;AACpE,uCAAuC,qDAAqD;AAC5F;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA,yCAAyC,gBAAgB;AACzD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA,oDAAoD,yBAAyB,4CAA4C,EAAE,KAAK;AAChI;AACA,sDAAsD,aAAa,aAAa;AAChF;AACA;AACA;AACA,6C;AACA,sD;AACA,+D;AACA;AACA;;AAEA;AACA;AACA;AACA,gDAAgD,qBAAqB,EAAE;AACvE;AACA;AACA;AACA,qCAAqC;AACrC,0BAA0B,OAAO,kBAAkB;AACnD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yBAAyB;AACzB;AACA;AACA;AACA,6CAA6C,iBAAiB;;AAE9D;AACA;AACA;AACA,4BAA4B,0CAA0C;AACtE;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gEAAgE;AAChE;AACA;AACA;AACA,4CAA4C,4DAA4D;AACxG,4CAA4C,4DAA4D;AACxG,uDAAuD,6CAA6C;AACpG,SAAS;;AAET;AACA,+EAA+E;AAC/E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0CAA0C,2GAA2G;AACrJ;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,6BAA6B,+BAA+B;AAC5D;AACA;AACA,8CAA8C,iBAAiB;AAC/D,SAAS;;AAET;AACA;AACA;AACA,sDAAsD;AACtD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6CAA6C,6FAA6F;AAC1I;AACA;AACA;AACA;AACA;AACA;AACA,wD;AACA,iG;AACA;AACA;AACA;AACA;AACA;AACA,iDAAiD,iBAAiB;AAClE,aAAa,OAAO;AACpB;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA,yCAAyC;AACzC,2EAA2E;AAC3E;AACA;AACA;AACA;AACA,6CAA6C,iBAAiB;AAC9D,SAAS;;AAET;AACA;AACA,mEAAmE;AACnE,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8BAA8B;AAC9B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0CAA0C;AAC1C,uFAAuF;AACvF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sIAAsI,cAAc,kBAAkB;AACtK;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8CAA8C,iBAAiB;AAC/D;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA,0CAA0C;AAC1C,sEAAsE;AACtE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qDAAqD,iBAAiB;AACtE;AACA,iBAAiB;AACjB,aAAa;AACb;AACA,SAAS;;AAET,uDAAuD;AACvD;AACA,0CAA0C,+GAA+G;AACzJ;AACA;AACA;AACA;AACA;AACA;AACA,0DAA0D,eAAe,OAAO;AAChF;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA,6DAA6D;AAC7D,4DAA4D;AAC5D,4DAA4D;AAC5D;AACA;AACA;AACA,+CAA+C,oBAAoB,eAAe;AAClF,yCAAyC,oBAAoB,eAAe;AAC5E;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kDAAkD,iBAAiB;AACnE;AACA,aAAa;AACb;AACA,kDAAkD,iBAAiB;AACnE;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA,4CAA4C;AAC5C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wCAAwC,aAAa;AACrD;AACA;AACA;AACA;AACA,yDAAyD;AACzD;AACA;AACA,aAAa,OAAO;AACpB;AACA;AACA;AACA;AACA;AACA;AACA,qDAAqD;AACrD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yDAAyD;AACzD;AACA;AACA;AACA;AACA;AACA,0CAA0C,+DAA+D;AACzG;AACA;AACA;AACA,8CAA8C,iBAAiB;AAC/D;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA,0CAA0C,yFAAyF;AACnI;AACA;AACA;AACA;AACA;AACA;AACA,kDAAkD,iBAAiB;AACnE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iDAAiD,oCAAoC;AACrF;AACA;AACA;AACA;AACA;AACA;AACA,8CAA8C,iBAAiB;AAC/D,SAAS;;AAET;AACA;;AAEA;AACA;AACA;AACA,+EAA+E;AAC/E;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0CAA0C,qDAAqD;AAC/F;AACA;AACA;AACA;AACA;AACA,8CAA8C,iBAAiB;AAC/D;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+EAA+E;AAC/E;AACA;AACA;AACA,0CAA0C,sDAAsD;AAChG;AACA;AACA;AACA,2EAA2E;AAC3E,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,iCAAiC,gBAAgB;AACjD;AACA;AACA,wCAAwC,MAAM;AAC9C;AACA;;AAEA;AACA,iCAAiC,iBAAiB;AAClD;;AAEA;AACA;AACA;AACA,4EAA4E;AAC5E,qEAAqE;AACrE,uEAAuE;AACvE,sGAAsG;AACtG,sGAAsG;AACtG,mDAAmD;AACnD;AACA;AACA;AACA;AACA,iCAAiC;AACjC;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA,8CAA8C,iBAAiB;AAC/D;AACA;AACA,oCAAoC,cAAc,cAAc,EAAE,KAAK;;AAEvE;AACA;AACA,aAAa;AACb;AACA;;AAEA;AACA,SAAS;;AAET;AACA;AACA;AACA,+EAA+E;AAC/E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0CAA0C,+DAA+D;AACzG;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yE;AACA;AACA,yEAAyE;AACzE;AACA,yCAAyC;AACzC;;AAEA;AACA;AACA,uDAAuD,cAAc,EAAE,EAAE;;AAEzE;AACA,8CAA8C,iBAAiB;AAC/D;AACA,gDAAgD;AAChD,oDAAoD,yBAAyB;AAC7E;AACA;AACA;;AAEA;AACA,6CAA6C;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+DAA+D,cAAc,EAAE;AAC/E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2CAA2C;AAC3C;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,6EAA6E;AAC7E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2HAA2H;AAC3H;AACA,sGAAsG,iBAAiB,cAAc,gCAAgC,6BAA6B,sBAAsB;AACxN;AACA;AACA;AACA;AACA;AACA;AACA,2EAA2E;AAC3E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kCAAkC,gBAAgB,aAAa,YAAY;AAC3E;AACA,gDAAgD;AAChD;AACA;AACA,kCAAkC,WAAW;AAC7C;AACA;AACA,0CAA0C,gBAAgB,aAAa,YAAY;AACnF;AACA,0CAA0C,WAAW;AACrD;AACA,yCAAyC,mDAAmD;AAC5F;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6CAA6C,qDAAqD;AAClG;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6CAA6C,6CAA6C;AAC1F;AACA;AACA,iBAAiB;AACjB;AACA;AACA,yGAAyG;AACzG,kGAAkG;AAClG;AACA;AACA;;AAEA;AACA;AACA,wCAAwC,6BAA6B,EAAE;AACvE;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0EAA0E;AAC1E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA,0CAA0C,sDAAsD;AAChG;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8CAA8C,iBAAiB;AAC/D,SAAS;;AAET;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kHAAkH;AAClH;AACA,8GAA8G,gCAAgC;AAC9I;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6GAA6G;AAC7G;AACA;AACA;AACA;AACA;AACA;AACA,oFAAoF;AACpF;AACA;AACA;AACA;AACA,yDAAyD,kBAAkB;AAC3E;AACA,2EAA2E;AAC3E,kFAAkF;AAClF,uEAAuE;AACvE,sCAAsC;AACtC;AACA;AACA;AACA,2FAA2F,gCAAgC;AAC3H,yDAAyD,kBAAkB;AAC3E;AACA,4FAA4F,gCAAgC;AAC5H,yDAAyD,kBAAkB;AAC3E;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA,sBAAsB,kBAAkB;AACxC;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,yCAAyC;;AAEzC;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yBAAyB,QAAQ;AACjC;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA,+DAA+D,OAAO;AACtE;AACA;;AAEA;;AAEA;AACA;AACA;AACA,6CAA6C,4HAA4H;AACzK;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA,6CAA6C,sBAAsB,yBAAyB,sBAAsB;;AAElH;AACA;;AAEA;AACA;AACA;AACA,wEAAwE,SAAS;;AAEjF;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA,yBAAyB;;AAEzB;AACA;AACA,wDAAwD,OAAO;AAC/D;AACA;;AAEA;AACA,uDAAuD,iBAAiB;AACxE,iBAAiB,QAAQ;AACzB;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,yCAAyC,gGAAgG;AACzI;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA,qBAAqB;;AAErB,gEAAgE;AAChE;;AAEA,iBAAiB;AACjB;AACA;AACA;;AAEA,yCAAyC,eAAe,yBAAyB,eAAe;;AAEhG;AACA;AACA;AACA;;AAEA;;AAEA;AACA,mDAAmD,iDAAiD;AACpG;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA,+JAA+J,uBAAuB;AACtL;AACA,qBAAqB;AACrB;AACA;AACA,yKAAyK,uBAAuB;AAChM;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,iBAAiB;AACjB;AACA,iBAAiB;AACjB,wDAAwD,OAAO;AAC/D;AACA;AACA;;AAEA;AACA;AACA,yBAAyB;AACzB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA,0CAA0C,4GAA4G;AACtJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uCAAuC,+BAA+B;AACtE;AACA,iBAAiB;AACjB;AACA;AACA,8CAA8C,iBAAiB;AAC/D,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA,8DAA8D,iBAAiB,2CAA2C;;AAE1H;AACA;;AAEA;AACA,6DAA6D;AAC7D;AACA;AACA,6DAA6D;AAC7D;AACA;AACA,6CAA6C,mCAAmC;AAChF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yGAAyG;AACzG;AACA,8DAA8D;AAC9D,6EAA6E;AAC7E,8EAA8E;AAC9E,uEAAuE;AACvE,+FAA+F;AAC/F,qHAAqH;AACrH;AACA;AACA;AACA;AACA,mFAAmF,mBAAmB;AACtG,wCAAwC,MAAM;AAC9C;AACA;AACA;AACA,6CAA6C,8CAA8C;AAC3F;AACA,iEAAiE;AACjE;AACA;AACA;AACA,6CAA6C,mCAAmC;AAChF;AACA;AACA,6DAA6D;AAC7D;AACA;AACA,6DAA6D;AAC7D;AACA;AACA,6DAA6D;AAC7D;AACA;AACA;AACA,iDAAiD,mCAAmC;AACpF;AACA,6DAA6D;AAC7D;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,iDAAiD,+EAA+E;AAChI;AACA;AACA;AACA;AACA,0DAA0D,oDAAoD;AAC9G;AACA;AACA,8DAA8D,iBAAiB;AAC/E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wDAAwD,gBAAgB,EAAE;AAC1E,6BAA6B;AAC7B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yDAAyD,8DAA8D;AACvH,6DAA6D,iBAAiB;AAC9E;AACA;AACA;AACA;AACA;AACA;AACA,yDAAyD,gEAAgE;AACzH,6DAA6D,iBAAiB;AAC9E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qDAAqD,iBAAiB;AACtE,iBAAiB;AACjB;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA,uEAAuE;AACvE;AACA,iBAAiB;AACjB;AACA;AACA;AACA,mDAAmD,0DAA0D,cAAc,EAAE,GAAG;AAChI;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uEAAuE;AACvE;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qCAAqC;AACrC,iEAAiE,oCAAoC;AACrG;AACA;AACA;AACA;AACA;AACA,qEAAqE,oEAAoE;AACzI,6DAA6D,+BAA+B,QAAQ;AACpG;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yDAAyD,uCAAuC;AAChG;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB,iBAAiB;AACjB,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;;AAEA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kCAAkC,uBAAuB;AACzD;AACA;AACA;AACA;AACA;AACA;AACA,uEAAuE;AACvE,aAAa;AACb;AACA;AACA;AACA;AACA,iBAAiB;AACjB,yCAAyC,0BAA0B,0BAA0B,EAAE;AAC/F;AACA;AACA;AACA;AACA,2CAA2C,WAAW;AACtD;AACA;AACA;AACA;AACA;AACA;AACA,+BAA+B,KAAI;AACnC;AACA,6CAA6C,KAAK,kDAAkD,eAAe;AACnH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+BAA+B,yBAAyB;AACxD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+BAA+B,yBAAyB;AACxD;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mCAAmC,yBAAyB;AAC5D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+BAA+B,yBAAyB;AACxD;AACA;AACA;AACA;AACA;AACA;AACA,yBAAyB;AACzB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BAA2B,yBAAyB;AACpD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oDAAoD,OAAO,UAAU;AACrE,6DAA6D,KAAK,UAAU;AAC5E;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA,2BAA2B,0BAA0B;AACrD;AACA;AACA;AACA;AACA;AACA,kGAAkG,WAAW,mBAAmB,EAAE;AAClI;AACA;AACA;AACA;AACA;AACA;AACA,yHAAyH;AACzH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kGAAkG,mCAAmC;AACrI;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yHAAyH;AACzH;AACA;AACA;AACA;AACA,yHAAyH;AACzH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qFAAqF;AACrF;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uCAAuC,OAAO,MAAM;AACpD;AACA;;AAEA;AACA,mKAAmK;AACnK;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0FAA0F,WAAW,mBAAmB,EAAE;AAC1H,mGAAmG,WAAW,cAAc,EAAE;AAC9H;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA,iEAAiE,uBAAuB,EAAE,OAAO,2BAA2B;AAC5H,2CAA2C,cAAc,2BAA2B,EAAE,OAAO,cAAc;AAC3G,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gDAAgD;AAChD,yE;AACA,0E;AACA,yBAAyB;AACzB;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6BAA6B;AAC7B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA,yBAAyB;AACzB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,sGAAsG,cAAc;;AAEpH;AACA;AACA,4CAA4C;AAC5C;AACA;AACA;AACA;AACA,4CAA4C;AAC5C;AACA;AACA;AACA;AACA,4CAA4C;AAC5C;AACA;AACA;AACA,6BAA6B,2BAA2B;AACxD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+GAA+G;AAC/G;AACA;AACA;AACA,+DAA+D;AAC/D;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA,4DAA4D;AAC5D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,yIAAyI;AACzI;AACA;AACA;AACA;AACA;AACA,iGAAiG,gCAAgC;AACjI;AACA;AACA,+FAA+F;AAC/F,yGAAyG;AACzG,6FAA6F;AAC7F,qGAAqG,gCAAgC;AACrI;AACA;AACA;AACA;AACA;AACA,4CAA4C;AAC5C;AACA;AACA;AACA;AACA,6BAA6B,sBAAsB;AACnD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4DAA4D;AAC5D;AACA;AACA;AACA;AACA;AACA,+GAA+G;AAC/G;AACA;AACA;AACA,+DAA+D;AAC/D;AACA;AACA;AACA;AACA,yEAAyE;AACzE;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA,qDAAqD;AACrD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BAA2B,WAAW;AACtC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA,2BAA2B,yBAAyB;AACpD;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qDAAqD;AACrD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wEAAwE;AACxE;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yEAAyE;AACzE;AACA;AACA;AACA;AACA;AACA,qDAAqD,UAAU;AAC/D;AACA;AACA;AACA;AACA;AACA,uCAAuC,qBAAqB,EAAE;AAC9D,aAAa,OAAO;AACpB;AACA;AACA;AACA;AACA;AACA,uEAAuE;AACvE;AACA;AACA;AACA;AACA;AACA,qDAAqD,YAAY;AACjE;AACA;AACA;AACA;AACA;AACA,uCAAuC,qBAAqB,EAAE;AAC9D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sFAAsF,cAAc;AACpG,6BAA6B;AAC7B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wGAAwG;AACxG,wGAAwG;AACxG,wGAAwG;AACxG;AACA;AACA,6FAA6F;AAC7F;AACA,gFAAgF;AAChF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2GAA2G;AAC3G;AACA,wGAAwG;AACxG,mHAAmH;AACnH;AACA;AACA;AACA,2DAA2D;AAC3D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6FAA6F,gCAAgC;AAC7H;AACA;AACA;AACA;AACA,sFAAsF;AACtF,oEAAoE,kBAAkB,EAAE;AACxF,mGAAmG,4CAA4C;AAC/I,gGAAgG,gCAAgC;AAChI;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6DAA6D;AAC7D;AACA,0GAA0G,kBAAkB;AAC5H;AACA;AACA;AACA,qGAAqG,gCAAgC;AACrI,kHAAkH;AAClH,gGAAgG,gCAAgC;AAChI;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iCAAiC,WAAW,wDAAwD,eAAe;AACnH;AACA;AACA;AACA;AACA;AACA,yIAAyI;AACzI;AACA;AACA,0DAA0D;AAC1D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0EAA0E,6CAA6C,0CAA0C;AACjK,kDAAkD,cAAc,gCAAgC;AAChG,kDAAkD,YAAY;AAC9D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA,qEAAqE;AACrE,sGAAsG;AACtG;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sEAAsE;AACtE,wEAAwE;AACxE;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA,oCAAoC,kCAAkC,EAAE;AACxE,SAAS;;AAET;AACA;AACA,oCAAoC,qBAAqB,EAAE,MAAM;AACjE,SAAS;;AAET;AACA;AACA;AACA;AACA,yCAAyC;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA,wEAAwE;AACxE,4EAA4E;AAC5E;AACA;AACA;AACA,8CAA8C,sEAAsE;AACpH,qDAAqD,8CAA8C,+CAA+C,EAAE,QAAQ;AAC5J;AACA,yEAAyE;AACzE;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA,kDAAkD,iBAAiB;AACnE;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA,kEAAkE;AAClE;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA,0CAA0C,4EAA4E;AACtH,iDAAiD,8CAA8C,+CAA+C,EAAE,QAAQ;AACxJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA,8CAA8C,iBAAiB;AAC/D;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA,kEAAkE;AAClE;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA,iB;AACA;AACA,SAAS;;AAET;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gEAAgE;AAChE;AACA;AACA,oGAAoG;AACpG;AACA,yBAAyB,OAAO;AAChC;AACA;AACA;AACA;AACA,+FAA+F;AAC/F;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;;AAEA;AACA;AACA,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,4BAA4B;AAC5B,4BAA4B;AAC5B;AACA;;AAEA,yBAAyB;AACzB,yBAAyB;AACzB;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,8BAA8B,2BAA2B;AACzD;AACA,gDAAgD,SAAS;AACzD,oDAAoD;AACpD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oDAAoD,6BAA6B,8CAA8C;AAC/H;AACA;AACA;AACA;AACA;AACA;;AAEA,SAAS;AACT;AACA;AACA;AACA,SAAS;AACT;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,yCAAyC;AACzC,+DAA+D;AAC/D,6CAA6C,SAAS,2DAA2D;AACjH;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,+CAA+C;AAC/C,kEAAkE;AAClE,mDAAmD,YAAY,8DAA8D;AAC7H;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mDAAmD;AACnD;AACA,6BAA6B;AAC7B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8GAA8G,cAAc,EAAE;AAC9H,6BAA6B;AAC7B;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0FAA0F,cAAc,EAAE;AAC1G;AACA,SAAS;;AAET;AACA;AACA;AACA,yDAAyD;AACzD;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA,yDAAyD;AACzD;AACA;AACA;AACA;AACA,kGAAkG,cAAc,EAAE;AAClH,iBAAiB;AACjB;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA,gCAAgC,aAAa;AAC7C,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA,aAAa;AACb;AACA,SAAS;;AAET;AACA;AACA;AACA,0CAA0C,8FAA8F;AACxI;;AAEA;AACA;AACA;AACA;AACA,8DAA8D,iBAAiB;AAC/E;AACA,iDAAiD,iBAAiB;AAClE;AACA,aAAa;AACb;AACA;AACA,8DAA8D,iBAAiB;AAC/E;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB,wCAAwC,cAAc,EAAE;AACxD;AACA;AACA,mEAAmE,iBAAiB;AACpF,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB,qDAAqD,iBAAiB;AACtE;AACA,iBAAiB;AACjB;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA,0CAA0C,8FAA8F;AACxI;;AAEA;AACA;AACA;AACA;AACA,8DAA8D,oBAAoB;AAClF;AACA,iDAAiD,iBAAiB;AAClE;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB,8DAA8D,oBAAoB;AAClF,wCAAwC,cAAc,EAAE;AACxD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB,qDAAqD,iBAAiB;AACtE;AACA,iBAAiB;AACjB;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA,6DAA6D;AAC7D,SAAS;;AAET;AACA;AACA;AACA;AACA,8EAA8E;AAC9E,0BAA0B;AAC1B;AACA,SAAS;;AAET;AACA;AACA;AACA,uDAAuD;AACvD;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA,0DAA0D;AAC1D,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA,oDAAoD;AACpD,SAAS;;AAET;AACA;AACA,gFAAgF;AAChF;AACA;AACA,yCAAyC,8DAA8D;AACvG;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8FAA8F,cAAc;AAC5G,0BAA0B;AAC1B;AACA,6CAA6C,iBAAiB;AAC9D;AACA,oCAAoC;AACpC;AACA;AACA,aAAa;AACb;;AAEA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,+CAA+C,0DAA0D,cAAc,EAAE,GAAG;AAC5H;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kCAAkC,aAAa;AAC/C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,+CAA+C,0DAA0D,cAAc,EAAE,GAAG;AAC5H;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0EAA0E;AAC1E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6CAA6C;AAC7C,+GAA+G;AAC/G;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iDAAiD,iBAAiB;AAClE;AACA,SAAS;;AAET;AACA;AACA,gFAAgF;AAChF;AACA;AACA;AACA,yCAAyC,qHAAqH;AAC9J;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8BAA8B,uCAAuC;AACrE,iDAAiD;AACjD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mFAAmF;AACnF;AACA,2CAA2C;AAC3C,qBAAqB;AACrB,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+EAA+E;AAC/E;AACA;AACA;AACA;AACA;AACA,mHAAmH;AACnH,iBAAiB;AACjB;AACA;AACA;AACA;AACA,4HAA4H;AAC5H,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA,6CAA6C,mCAAmC;AAChF;AACA,6CAA6C,iBAAiB;AAC9D;AACA,SAAS;;AAET;AACA,gFAAgF;AAChF;AACA;AACA;AACA;AACA,0CAA0C;AAC1C,4GAA4G;AAC5G;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+BAA+B;AAC/B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA,qDAAqD,6EAA6E;AAClI;AACA;AACA;AACA;AACA,yDAAyD,iBAAiB;AAC1E;AACA,qBAAqB;AACrB;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uIAAuI;AACvI;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA,qDAAqD,8EAA8E;AACnI;AACA;AACA;AACA;AACA,yDAAyD,iBAAiB;AAC1E;AACA,qBAAqB;AACrB;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA,qDAAqD,+EAA+E;AACpI;AACA;AACA;AACA;AACA,yDAAyD,iBAAiB;AAC1E;AACA,qBAAqB;AACrB;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA,qDAAqD,gFAAgF;AACrI;AACA;AACA;AACA;AACA,yDAAyD,iBAAiB;AAC1E;AACA,qBAAqB;AACrB;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mIAAmI;AACnI;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uIAAuI;AACvI;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA,qDAAqD,iFAAiF;AACtI;AACA;AACA;AACA;AACA,yDAAyD,iBAAiB;AAC1E;AACA,qBAAqB;AACrB;AACA,aAAa;AACb;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4EAA4E,0CAA0C;AACtH;AACA;AACA;AACA,2EAA2E,0CAA0C;AACrH;AACA;AACA;AACA,8EAA8E,0CAA0C;AACxH;AACA;AACA,yCAAyC,mBAAmB,OAAO,wBAAwB;AAC3F;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,8CAA8C,iBAAiB;AAC/D;AACA,SAAS;;AAET;AACA;AACA,0CAA0C,sDAAsD;AAChG;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8CAA8C,iBAAiB;AAC/D;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gCAAgC,eAAe,0CAA0C;AACzF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,6CAA6C;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA,0CAA0C;AAC1C;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,wCAAwC,6BAA6B,EAAE;AACvE;AACA;AACA;AACA;AACA,qCAAqC,+BAA+B,oCAAoC,YAAY,mBAAmB;AACvI;AACA,oCAAoC,2CAA2C,EAAE;AACjF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,+CAA+C,aAAa,aAAa;AACzE,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8CAA8C,mFAAmF;AACjI;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mFAAmF,oBAAoB,kBAAkB;AACzH,uEAAuE,4CAA4C;AACnH,2DAA2D,4BAA4B,2BAA2B,0BAA0B;AAC5I;AACA;AACA,yGAAyG;AACzG,qFAAqF;AACrF;AACA;AACA;AACA,0GAA0G;AAC1G,qFAAqF;AACrF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA,yDAAyD,iBAAiB;AAC1E,qBAAqB;AACrB,iBAAiB;AACjB,aAAa;AACb;AACA,8CAA8C,kFAAkF;AAChI;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qDAAqD,iBAAiB;AACtE,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,+EAA+E,gBAAgB,EAAE;;AAEjG;AACA;AACA;AACA,+CAA+C,0DAA0D,cAAc,EAAE,GAAG;AAC5H;AACA;AACA;AACA;AACA;AACA;AACA,8BAA8B,aAAa;AAC3C;AACA;AACA,iEAAiE;AACjE,+DAA+D;AAC/D;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA,6CAA6C,4FAA4F;AACzI;AACA;AACA;AACA;AACA;AACA,2FAA2F;AAC3F;AACA;AACA;AACA,iDAAiD,gBAAgB;AACjE,SAAS;;AAET;AACA;AACA,qCAAqC;AACrC;AACA;AACA,0CAA0C,oEAAoE;AAC9G;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA,iDAAiD,gBAAgB;AACjE,aAAa;AACb;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA,0CAA0C,qEAAqE;AAC/G;AACA;AACA,0DAA0D;AAC1D;AACA;AACA,iDAAiD,gBAAgB;AACjE,aAAa;AACb,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA,0CAA0C,kEAAkE;AAC5G;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iDAAiD,gBAAgB;AACjE,aAAa;AACb,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA,0CAA0C,kEAAkE;AAC5G;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iDAAiD,gBAAgB;AACjE,aAAa;AACb,SAAS;;AAET;AACA;AACA,SAAS;;AAET;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,yDAAyD;AACzD;AACA,iEAAiE;AACjE,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA,+FAA+F,YAAY;AAC3G;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA,wBAAwB;AACxB,qCAAqC;AACrC;AACA;AACA;AACA;AACA;AACA,qIAAqI;;AAErI;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA,oHAAoH;AACpH,8DAA8D,oDAAoD;AAClH,wGAAwG,gDAAgD,gBAAgB,aAAa;AACrL,0GAA0G,iBAAiB;AAC3H,yDAAyD,sBAAsB,qBAAqB,oBAAoB;AACxH,4FAA4F;AAC5F;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yBAAyB;AACzB,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA,yBAAyB,EAAE;AAC3B;AACA;AACA,qBAAqB;AACrB;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA,SAAS;;AAET;;AAEA;AACA;AACA;AACA;AACA,iCAAiC;AACjC;AACA;AACA,sFAAsF,gCAAgC,kDAAkD,mBAAmB;AAC3L,+FAA+F,eAAe,WAAW,UAAU;AACnI,yCAAyC,aAAa,yCAAyC,aAAa,cAAc,YAAY;AACtI;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yBAAyB;AACzB,qBAAqB;AACrB;AACA,iBAAiB;AACjB,aAAa;AACb,2DAA2D,iBAAiB,EAAE;AAC9E;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA,iCAAiC;AACjC;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA,aAAa;AACb;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA,aAAa,+BAA+B;AAC5C;AACA;;AAEA;AACA;;AAEA,CAAC;;AAED;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,sDAAsD,UAAU,WAAW,YAAY,cAAc;AACrG,iFAAiF;AACjF;AACA,sDAAsD,aAAa,WAAW,YAAY,oBAAoB;AAC9G,kEAAkE;AAClE;AACA;AACA;AACA;AACA,SAAS;AACT,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,2EAA2E;AAC3E,0DAA0D;AAC1D;AACA;AACA;AACA,SAAS;AACT;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,aAAa;AACb,SAAS;AACT;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sDAAsD,UAAU,WAAW,YAAY,cAAc;AACrG,iFAAiF;AACjF;AACA,sDAAsD,aAAa,WAAW,YAAY,oBAAoB;AAC9G;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET,KAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4EAA4E;AAC5E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;;AAEA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,8BAA8B;AAC9B,8BAA8B;AAC9B;AACA;AACA,4BAA4B;AAC5B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,wBAAwB,eAAe;AACvC;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BAA2B,iBAAiB;AAC5C,4CAA4C;AAC5C;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA,2BAA2B,gBAAgB;AAC3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wCAAwC;AACxC;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA,2BAA2B,sBAAsB;AACjD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA,gCAAgC,uBAAuB;AACvD;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,gCAAgC,uBAAuB;AACvD,iDAAiD;AACjD;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA,2BAA2B,sBAAsB;AACjD;AACA;AACA;AACA;AACA;AACA;AACA,oCAAoC,wCAAwC,EAAE,MAAM;AACpF;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA,2BAA2B,sBAAsB;AACjD;AACA;AACA;AACA;AACA;AACA;AACA,oCAAoC,wCAAwC,EAAE,MAAM;AACpF;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA,2BAA2B,sBAAsB;AACjD;AACA;AACA;AACA;AACA;AACA;AACA,oCAAoC,wCAAwC,EAAE,MAAM;AACpF;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA,2BAA2B,sBAAsB;AACjD;AACA;AACA;AACA;AACA;AACA;AACA,oCAAoC,wCAAwC,EAAE,MAAM;AACpF;AACA,SAAS;;AAET;AACA;AACA,gFAAgF;AAChF;AACA,0CAA0C,+GAA+G;AACzJ;AACA;AACA;AACA,+BAA+B,sBAAsB;AACrD,aAAa;AACb;AACA;AACA;AACA;;AAEA;AACA,oJAAoJ;AACpJ;AACA;AACA,+FAA+F;AAC/F;AACA;AACA;AACA,qCAAqC,4BAA4B,EAAE;AACnE,uCAAuC,2BAA2B,mBAAmB,sBAAsB,iBAAiB,0BAA0B,EAAE;AACxJ;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA,iBAAiB;AACjB;AACA;AACA,qCAAqC,8BAA8B;AACnE,0BAA0B,0BAA0B;AACpD,uCAAuC,YAAY,wHAAwH,EAAE;AAC7K,0BAA0B,YAAY,iHAAiH,EAAE;AACzJ;AACA;AACA;AACA;AACA;AACA,8CAA8C,iBAAiB;AAC/D;AACA,SAAS;;AAET;AACA;AACA;AACA,0CAA0C,+DAA+D;AACzG;AACA;AACA,gFAAgF;AAChF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8CAA8C,iBAAiB;AAC/D;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA,0CAA0C,qDAAqD;AAC/F;;AAEA;;AAEA;AACA,8CAA8C,iBAAiB;AAC/D;AACA,SAAS;;AAET;AACA;AACA,0CAA0C,sDAAsD;AAChG;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8CAA8C,iBAAiB;AAC/D,SAAS;;AAET;AACA;;AAEA;AACA;AACA;AACA;AACA,0CAA0C,0FAA0F;AACpI;AACA;AACA;AACA;AACA;AACA;AACA,+DAA+D,GAAG;AAClE;AACA;AACA,mCAAmC,sBAAsB;AACzD;AACA;AACA;AACA;AACA,wCAAwC,8BAA8B,EAAE;AACxE;AACA;AACA,8CAA8C,iBAAiB;AAC/D;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA,0CAA0C,yFAAyF;AACnI;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8BAA8B;AAC9B;AACA;AACA;AACA,4DAA4D,yBAAyB,sBAAsB,qBAAqB;AAChI;AACA,qHAAqH,iBAAiB;AACtI,iBAAiB;AACjB,aAAa;AACb;AACA;AACA,aAAa;AACb;AACA,8CAA8C,iBAAiB;AAC/D;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2CAA2C;AAC3C;AACA;AACA,kGAAkG,cAAc;AAChH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kDAAkD,0BAA0B,uBAAuB,sBAAsB,qBAAqB,QAAQ;AACtJ;AACA,6BAA6B,4BAA4B,EAAE;AAC3D,+BAA+B,2BAA2B,mBAAmB,sBAAsB,iBAAiB,0BAA0B,EAAE;AAChJ;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA,aAAa;AACb;AACA;;AAEA;AACA;AACA,CAAC;;;AAGD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,8BAA8B;AAC9B,8BAA8B;AAC9B,4BAA4B;AAC5B;AACA,4BAA4B;AAC5B;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8BAA8B,0BAA0B;AACxD,2BAA2B,kBAAkB;AAC7C,6CAA6C;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,SAAS;AACT;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yBAAyB;AACzB;AACA,SAAS;;AAET;AACA;AACA,SAAS;;AAET;AACA;AACA,2BAA2B,kBAAkB;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oCAAoC;AACpC;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA,2BAA2B,sBAAsB;AACjD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA,gCAAgC,wBAAwB;AACxD;AACA;AACA,4BAA4B,wBAAwB;AACpD;AACA,wDAAwD;AACxD;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA,2BAA2B,sBAAsB;AACjD;AACA;AACA;AACA;AACA;AACA;AACA,oCAAoC,wCAAwC,EAAE,MAAM;AACpF;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA,2BAA2B,sBAAsB;AACjD;AACA;AACA;AACA;AACA;AACA;AACA,oCAAoC,wCAAwC,EAAE,MAAM;AACpF;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA,2BAA2B,sBAAsB;AACjD;AACA;AACA;AACA;AACA;AACA;AACA,oCAAoC,wCAAwC,EAAE,MAAM;AACpF;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA,2BAA2B,sBAAsB;AACjD;AACA;AACA;AACA;AACA;AACA;AACA,oCAAoC,wCAAwC,EAAE,MAAM;AACpF;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA,2BAA2B,sBAAsB;AACjD;AACA;AACA;AACA;AACA;AACA;AACA,oCAAoC,wCAAwC,EAAE,MAAM;AACpF;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA,2BAA2B,sBAAsB;AACjD;AACA;AACA;AACA;AACA;AACA;AACA,oCAAoC,wCAAwC,EAAE,MAAM;AACpF;AACA,SAAS;;AAET;AACA;AACA;AACA,0CAA0C,+DAA+D;AACzG;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BAA2B,uBAAuB;AAClD;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8CAA8C,iBAAiB;AAC/D;AACA,SAAS;;AAET;AACA;AACA;AACA,0CAA0C,6GAA6G;AACvJ;;AAEA;AACA;AACA,+BAA+B,uBAAuB;AACtD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA,aAAa;AACb;AACA;AACA,gCAAgC,2BAA2B,EAAE,OAAO,uBAAuB;AAC3F,kCAAkC,yBAAyB,EAAE,OAAO,4BAA4B;AAChG;AACA;AACA,8CAA8C,iBAAiB;AAC/D;AACA,SAAS;;AAET;AACA;AACA;AACA,0CAA0C,qDAAqD;AAC/F;;AAEA;;AAEA;AACA,8CAA8C,iBAAiB;AAC/D;AACA,SAAS;;AAET;AACA;AACA,0CAA0C,sDAAsD;AAChG;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8CAA8C,iBAAiB;AAC/D,SAAS;;AAET;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,yCAAyC;AACzC;AACA;AACA;AACA,qFAAqF,4CAA4C;AACjI,mGAAmG;AACnG,0HAA0H;AAC1H,mGAAmG;AACnG,sGAAsG;AACtG;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,mEAAmE;AACnE;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA,8CAA8C;AAC9C,gFAAgF;AAChF;;AAEA;AACA;AACA;AACA,kEAAkE,GAAG;AACrE;AACA;AACA,uCAAuC,sBAAsB;AAC7D;AACA;AACA;AACA;AACA,4CAA4C,8BAA8B,EAAE;AAC5E;;AAEA;AACA,kDAAkD,iBAAiB;AACnE;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA,8CAA8C;AAC9C,gEAAgE;AAChE;;AAEA;AACA;;AAEA;AACA,mCAAmC,uBAAuB;AAC1D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gEAAgE,qBAAqB;AACrF;AACA;AACA,8DAA8D,qBAAqB;AACnF;AACA,uDAAuD,oEAAoE;AAC3H;AACA;AACA,iCAAiC;AACjC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yBAAyB;AACzB;AACA;;AAEA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA,kEAAkE,GAAG;AACrE;AACA;AACA,uCAAuC,sBAAsB;AAC7D;AACA;AACA;AACA,4CAA4C,8BAA8B,EAAE;AAC5E;AACA;AACA,kDAAkD,iBAAiB;AACnE;AACA;AACA;;AAEA;AACA;AACA,CAAC;;;AAGD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,gCAAgC;AAChC;AACA,gCAAgC;AAChC,kCAAkC;AAClC;AACA;AACA;AACA;AACA;AACA;AACA,kCAAkC;AAClC,kCAAkC;AAClC;AACA,kCAAkC;AAClC,kCAAkC;AAClC,kCAAkC;AAClC;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8BAA8B,0BAA0B;AACxD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,SAAS;AACT;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iCAAiC;AACjC;AACA;AACA;AACA,+BAA+B;AAC/B,sCAAsC;AACtC;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET,6BAA6B;AAC7B;AACA;AACA,2BAA2B,sBAAsB;AACjD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kFAAkF;AAClF;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BAA2B,yBAAyB;AACpD;AACA;AACA;AACA,qDAAqD,YAAY;AACjE;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET,iDAAiD;AACjD;AACA;AACA,sCAAsC;AACtC,+BAA+B,gBAAgB;AAC/C;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+BAA+B,yBAAyB;AACxD;AACA,2DAA2D;AAC3D,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET,kDAAkD,6BAA6B,iBAAiB;AAChG;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BAA2B,yBAAyB;AACpD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET,2BAA2B;AAC3B;AACA,2BAA2B,sBAAsB;AACjD;AACA;AACA;AACA;AACA;AACA,kEAAkE;AAClE;AACA,SAAS;;AAET,2BAA2B;AAC3B;AACA,2BAA2B,sBAAsB;AACjD;AACA;AACA;AACA;AACA;AACA,kEAAkE;AAClE;AACA,SAAS;;AAET,8BAA8B;AAC9B;AACA,2BAA2B,sBAAsB;AACjD;AACA;AACA;AACA;AACA;AACA;AACA,kEAAkE;AAClE;AACA,SAAS;;AAET,6BAA6B;AAC7B;AACA,2BAA2B,sBAAsB;AACjD;AACA;AACA;AACA;AACA;AACA,kEAAkE;AAClE;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA,8BAA8B,cAAc;AAC5C;AACA;AACA;AACA;AACA;AACA,gEAAgE;AAChE,SAAS;;AAET;AACA;AACA;AACA;AACA,0CAA0C,4DAA4D;AACtG;AACA;AACA;AACA;AACA;AACA;AACA,8CAA8C,iBAAiB;AAC/D,oCAAoC,iBAAiB,EAAE;AACvD;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA,2BAA2B,yBAAyB;AACpD;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA,0CAA0C,0DAA0D;AACpG;AACA;AACA;AACA;AACA;AACA;AACA,8CAA8C,iBAAiB;AAC/D,oCAAoC,iBAAiB,EAAE;AACvD;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA,2BAA2B,yBAAyB;AACpD;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA,gDAAgD;AAChD;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6CAA6C,yFAAyF;AACtI;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kEAAkE,GAAG;AACrE;AACA;AACA,uCAAuC,sBAAsB;AAC7D;AACA;AACA;AACA;AACA,4CAA4C,8BAA8B,EAAE;AAC5E;AACA;AACA,iDAAiD,iBAAiB;AAClE,aAAa;AACb,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA,yCAAyC,2EAA2E;AACpH;AACA;AACA,6DAA6D;AAC7D;AACA;AACA,sCAAsC;AACtC;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA,sCAAsC;AACtC;AACA;AACA,sCAAsC;AACtC;AACA;AACA,sCAAsC;AACtC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6CAA6C,iBAAiB;;AAE9D;AACA;AACA;AACA,4CAA4C,sBAAsB,EAAE;AACpE;AACA;;AAEA;AACA;AACA;AACA,0CAA0C;AAC1C;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8EAA8E;AAC9E,iBAAiB;AACjB;AACA;AACA,qBAAqB;AACrB,sDAAsD;AACtD;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,0EAA0E;AAC1E;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8BAA8B,sDAAsD;AACpF;AACA;AACA,8BAA8B,sDAAsD;AACpF;AACA,SAAS;;AAET;AACA,gFAAgF;AAChF;AACA;AACA,0CAA0C,kFAAkF;AAC5H;AACA;AACA;AACA;AACA,8CAA8C,iBAAiB;AAC/D,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6CAA6C,qFAAqF;AAClI;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wD;AACA,8F;AACA;AACA;AACA;AACA;AACA;AACA,iDAAiD,iBAAiB;AAClE,aAAa,OAAO;AACpB,SAAS;;AAET;AACA;AACA;AACA,yCAAyC,wHAAwH;AACjK;AACA;AACA;AACA;AACA,6CAA6C,iBAAiB;AAC9D,SAAS;;AAET;AACA;AACA;AACA,0CAA0C,+DAA+D;AACzG;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8CAA8C,iBAAiB;AAC/D;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA,gFAAgF;AAChF;AACA,0CAA0C,wFAAwF;AAClI;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BAA2B,uBAAuB;AAClD;AACA;AACA;AACA,4CAA4C,qBAAqB;AACjE;AACA;AACA,8CAA8C,iBAAiB;AAC/D;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oGAAoG,oDAAoD;AACxJ,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA,8LAA8L;AAC9L,mGAAmG;AACnG,yGAAyG;AACzG,kFAAkF;AAClF,6FAA6F;AAC7F,sGAAsG;AACtG,qHAAqH;AACrH,oFAAoF,gCAAgC;AACpH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gGAAgG,oDAAoD;AACpJ;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA,gFAAgF;AAChF;AACA,0CAA0C,qDAAqD;AAC/F;AACA;AACA,kDAAkD;AAClD;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA,8CAA8C,iBAAiB;AAC/D;AACA,SAAS;;AAET;AACA;AACA,0CAA0C,sDAAsD;AAChG;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8CAA8C,iBAAiB;AAC/D,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;;AAEA;AACA;AACA,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,8BAA8B;AAC9B;AACA,4CAA4C;AAC5C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8BAA8B;AAC9B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA,0CAA0C,YAAY,eAAe;AACrE;AACA;AACA,0BAA0B;AAC1B;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mCAAmC,eAAe;AAClD;AACA;AACA;AACA;AACA,iBAAiB,OAAO;AACxB;AACA;AACA;AACA,mCAAmC,eAAe;AAClD;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uEAAuE;AACvE;AACA;AACA,aAAa;AACb,qDAAqD;AACrD;AACA;AACA;AACA;AACA,aAAa;AACb,SAAS;AACT;;AAEA;;AAEA,kBAAkB;;AAElB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oDAAoD;AACpD,2CAA2C;AAC3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qCAAqC;AACrC;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,uHAAuH;AACvH;AACA;AACA;AACA;AACA;AACA,qCAAqC;AACrC,qCAAqC;AACrC;AACA;AACA,wEAAwE,oBAAoB,EAAE;AAC9F;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wCAAwC,YAAY;AACpD,wCAAwC,YAAY;AACpD;AACA,oDAAoD;AACpD,2CAA2C;AAC3C;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oDAAoD;AACpD,2CAA2C;AAC3C;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,4CAA4C;AAC5C;AACA;AACA,4CAA4C;AAC5C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iEAAiE;AACjE;AACA;AACA;AACA,wIAAwI;AACxI;AACA;AACA;AACA;AACA;AACA;AACA,wEAAwE;AACxE;AACA;AACA;AACA;AACA;AACA,yCAAyC;AACzC;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4CAA4C,eAAe,EAAE,MAAM;AACnE;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4CAA4C;AAC5C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yCAAyC;AACzC;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yCAAyC;AACzC;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gDAAgD,8BAA8B;AAC9E,gDAAgD,6BAA6B;AAC7E,gDAAgD,6BAA6B;AAC7E,gDAAgD,4BAA4B;AAC5E,gDAAgD,+BAA+B;AAC/E,gDAAgD,6BAA6B;AAC7E,gDAAgD;AAChD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gEAAgE;AAChE;AACA;AACA;AACA;AACA;AACA;AACA,2GAA2G,iBAAiB;AAC5H,iEAAiE,kBAAkB,gBAAgB;AACnG;AACA,wC;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA,8E;AACA,0DAA0D,YAAY,yBAAyB,sCAAsC;AACrI;AACA;AACA,sHAAsH;AACtH,6BAA6B;AAC7B;AACA,qHAAqH;AACrH;AACA,yBAAyB;AACzB;AACA;AACA;AACA,gD;AACA,wE;AACA;AACA,yBAAyB;AACzB,qBAAqB;AACrB,gD;AACA,sE;AACA;AACA,yBAAyB;AACzB;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kJAAkJ,MAAM;AACxJ,qBAAqB;AACrB,wHAAwH,MAAM;AAC9H;AACA;AACA,uGAAuG;AACvG;AACA;AACA;AACA;AACA,wDAAwD;AACxD;AACA,kD;AACA;AACA,8E;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA,4EAA4E;AAC5E,8EAA8E;AAC9E,0EAA0E;AAC1E,4EAA4E;AAC5E,wEAAwE;AACxE,4EAA4E;AAC5E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qDAAqD,iGAAiG;AACtJ;AACA;AACA;AACA;AACA;AACA,yDAAyD,kGAAkG;AAC3J;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iEAAiE,iBAAiB;AAClF,6BAA6B;AAC7B;AACA;AACA;AACA,6DAA6D;AAC7D,oEAAoE;AACpE,4FAA4F,yDAAyD;AACrJ,6EAA6E,0BAA0B;AACvG,+EAA+E;AAC/E,2FAA2F;AAC3F,2FAA2F;AAC3F;AACA;AACA;AACA;AACA,2DAA2D,mBAAmB,aAAa;AAC3F;AACA,iEAAiE;AACjE;AACA;AACA;AACA;AACA,mEAAmE,uBAAuB,kBAAkB,yBAAyB,qBAAqB;AAC1J;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yDAAyD,iBAAiB;AAC1E,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yDAAyD,qGAAqG;AAC9J;AACA;AACA,6DAA6D,iBAAiB;AAC9E;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6DAA6D,6FAA6F;AAC1J;AACA;AACA,iEAAiE,iBAAiB;AAClF;AACA,yBAAyB;AACzB,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4BAA4B,6FAA6F;AACzH;AACA,gCAAgC,oCAAoC;AACpE;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oEAAoE,mBAAmB,6BAA6B;AACpH,oEAAoE,mBAAmB,6BAA6B;AACpH;AACA,0EAA0E;AAC1E;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wCAAwC,eAAe,EAAE,K;AACzD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wCAAwC,qBAAqB,EAAE;AAC/D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4CAA4C,qBAAqB,EAAE;AACnE,iBAAiB;AACjB;AACA;AACA;AACA,0CAA0C,0DAA0D;AACpG;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gDAAgD,qBAAqB,EAAE;AACvE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gDAAgD,qBAAqB,EAAE;AACvE;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA,oDAAoD,qBAAqB,EAAE;AAC3E;AACA;AACA;AACA;AACA;AACA;AACA,oDAAoD,qBAAqB,EAAE;AAC3E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0CAA0C,oBAAoB;AAC9D;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uEAAuE;AACvE;AACA;AACA;AACA;AACA;AACA,wCAAwC,qBAAqB,EAAE;AAC/D;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kDAAkD;AAClD;AACA;AACA;AACA;AACA,kDAAkD;AAClD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0BAA0B,iBAAiB,YAAY;AACvD;AACA;AACA,kDAAkD;AAClD;AACA;AACA;AACA;AACA;AACA;AACA,kDAAkD;AAClD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kDAAkD;AAClD;AACA;AACA;AACA;AACA,kDAAkD;AAClD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2EAA2E;AAC3E;AACA;AACA;AACA;AACA;AACA;AACA,oDAAoD;AACpD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kEAAkE;AAClE;AACA;AACA;AACA;AACA;AACA,6DAA6D,+FAA+F;AAC5J;AACA,sDAAsD;AACtD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iEAAiE,iBAAiB;AAClF,6BAA6B;AAC7B;AACA,wCAAwC;AACxC,6DAA6D,+FAA+F;AAC5J;AACA,sDAAsD;AACtD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iEAAiE,iBAAiB;AAClF;AACA,yBAAyB;AACzB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6DAA6D,kGAAkG;AAC/J;AACA;AACA;AACA;AACA;AACA;AACA,iEAAiE,iBAAiB;AAClF;AACA;AACA;AACA,yDAAyD;AACzD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yBAAyB;AACzB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yBAAyB;AACzB;AACA;AACA,yBAAyB;AACzB;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sEAAsE;AACtE;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iDAAiD;AACjD;AACA;AACA;AACA,iDAAiD;AACjD;AACA;AACA,mCAAmC;AACnC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iDAAiD,iFAAiF;AAClI;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0DAA0D,+FAA+F;AACzJ;AACA;AACA;AACA;AACA;AACA,gHAAgH,6BAA6B,sBAAsB,GAAG;AACtK;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gGAAgG;AAChG;AACA;AACA;AACA,8DAA8D,iBAAiB;AAC/E,yBAAyB;AACzB;AACA;AACA,4CAA4C;AAC5C,0DAA0D,4FAA4F;AACtJ;AACA;AACA;AACA;AACA,qCAAqC,uCAAuC;AAC5E;AACA,uDAAuD,6BAA6B,sBAAsB,GAAG;AAC7G,uDAAuD,4CAA4C;AACnG;AACA;AACA;AACA;AACA;AACA,8DAA8D,iBAAiB;AAC/E,yBAAyB;AACzB;AACA,qDAAqD,iBAAiB;AACtE,iBAAiB;AACjB;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yCAAyC,2CAA2C;AACpF;AACA;AACA;AACA;AACA,yCAAyC,2CAA2C;AACpF;AACA;AACA,yCAAyC,kEAAkE;AAC3G;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0FAA0F;AAC1F,qBAAqB;AACrB;AACA;AACA;AACA;AACA,0CAA0C;AAC1C;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA,wC;AACA;AACA,yFAAyF;AACzF,4D;AACA;AACA,iBAAiB;AACjB,aAAa;AACb;AACA;AACA;AACA;AACA;AACA,6CAA6C,iBAAiB;AAC9D,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4CAA4C;AAC5C,qBAAqB;AACrB;AACA;AACA;AACA,yBAAyB;AACzB,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA,gHAAgH;AAChH,8BAA8B;AAC9B,qBAAqB;AACrB;AACA;AACA;AACA,yBAAyB,2BAA2B,yBAAyB;AAC7E;AACA;AACA;AACA;AACA;AACA;AACA,6BAA6B;AAC7B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wEAAwE,gDAAgD,EAAE;AAC1H;AACA,yCAAyC;AACzC;AACA,iCAAiC;AACjC;AACA,yBAAyB;AACzB;AACA;AACA;AACA;AACA,yCAAyC,wDAAwD;AACjG,yBAAyB;AACzB;AACA;AACA;AACA,6BAA6B;AAC7B,yBAAyB;AACzB;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA,qBAAqB;AACrB,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA,qHAAqH;AACrH,8BAA8B;AAC9B,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA,qCAAqC,wDAAwD;AAC7F;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA,kGAAkG,OAAO,6BAA6B,EAAE;AACxI;AACA;AACA;AACA,6CAA6C,wDAAwD;AACrG;AACA;AACA,6BAA6B;AAC7B;AACA,wDAAwD,wFAAwF,EAAE;AAClJ,6BAA6B;AAC7B,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yBAAyB,K;AACzB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6DAA6D;AAC7D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iEAAiE,qGAAqG;AACtK;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qEAAqE,iBAAiB;AACtF;AACA,6BAA6B;AAC7B;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yBAAyB;AACzB;AACA;AACA;AACA,6DAA6D,4FAA4F;AACzJ;;AAEA;;AAEA;AACA,iEAAiE,iBAAiB,G;AAClF,6BAA6B;AAC7B;AACA;AACA,iCAAiC;AACjC;AACA;AACA;AACA,yBAAyB;AACzB;AACA;AACA;AACA;AACA,aAAa;AACb,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oGAAoG;AACpG;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yBAAyB;AACzB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iCAAiC;AACjC;AACA;AACA,yBAAyB;AACzB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yBAAyB;AACzB;AACA;AACA;AACA,6BAA6B;AAC7B;AACA;AACA,yBAAyB;;AAEzB;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,SAAS;;AAET;AACA;AACA;AACA,6BAA6B;AAC7B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA,mCAAmC,0DAA0D;AAC7F;AACA;AACA,uEAAuE;AACvE,iBAAiB;AACjB;AACA;AACA;AACA,kC;AACA;AACA,uEAAuE;AACvE,iBAAiB;AACjB,kDAAkD,mBAAmB;AACrE,kDAAkD,qBAAqB;AACvE,kDAAkD,qBAAqB,EAAE;AACzE;AACA,iDAAiD,+BAA+B,EAAE;AAClF;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sCAAsC;AACtC,sCAAsC;AACtC,uEAAuE;AACvE,wEAAwE;AACxE;AACA;AACA;AACA,0CAA0C;AAC1C;AACA,uFAAuF;AACvF,sDAAsD,aAAa,oBAAoB;AACvF;AACA,8DAA8D;AAC9D;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uFAAuF;AACvF,sDAAsD,aAAa,oBAAoB;AACvF,8DAA8D;AAC9D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;;AAEjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA,oCAAoC,0DAA0D;AAC9F;AACA,2EAA2E;AAC3E,qBAAqB;AACrB;AACA;AACA;AACA,2EAA2E;AAC3E,qBAAqB;AACrB,sDAAsD,mBAAmB;AACzE,sDAAsD,qBAAqB;AAC3E,sDAAsD,6CAA6C,qBAAqB,EAAE;AAC1H;AACA,kDAAkD,+BAA+B,EAAE;AACnF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA,qDAAqD,KAAK;AAC1D;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA,kEAAkE,OAAO;AACzE;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qC;AACA;AACA;AACA,yCAAyC,O;AACzC;AACA;AACA,yCAAyC,2FAA2F;AACpI;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yDAAyD,iBAAiB;AAC1E;AACA,iBAAiB;AACjB;AACA,aAAa;AACb;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA,+BAA+B,iBAAiB;AAChD;AACA,mCAAmC;AACnC,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA,8CAA8C,uBAAuB;AACrE;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA,2BAA2B,OAAO;AAClC;AACA,+BAA+B,OAAO;AACtC;AACA,uGAAuG;AACvG,yFAAyF,WAAW;AACpG;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6BAA6B,aAAa,QAAQ;AAClD,4CAA4C,aAAa,QAAQ;AACjE,+CAA+C,qBAAqB,EAAE,OAAO,qBAAqB;AAClG;;AAEA;AACA;AACA;AACA;AACA;AACA,kDAAkD,SAAS;AAC3D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,0BAA0B,OAAO;AACjC;AACA,kCAAkC,MAAM,iDAAiD;AACzF;AACA,iBAAiB;AACjB;AACA,kEAAkE;AAClE;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,yFAAyF;AACzF;AACA,8DAA8D;AAC9D,mDAAmD;AACnD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8BAA8B,WAAW;AACzC;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA,yBAAyB,MAAM;AAC/B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA,yBAAyB,MAAM;AAC/B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA,8BAA8B;AAC9B;AACA,4BAA4B;AAC5B,4BAA4B;AAC5B,4BAA4B;AAC5B,2BAA2B;AAC3B,2BAA2B;AAC3B;AACA;AACA;AACA;AACA;AACA,4BAA4B;AAC5B,4BAA4B;;AAE5B;AACA,+BAA+B;AAC/B;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8BAA8B,WAAW,cAAc,sBAAsB,aAAa,gBAAgB;AAC1G;AACA,6CAA6C,WAAW;AACxD;AACA;AACA,4EAA4E,6BAA6B,wBAAwB;AACjI;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA,6CAA6C;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA,wDAAwD;AACxD,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA,0DAA0D;AAC1D,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA,uDAAuD;AACvD;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB,aAAa;AACb;AACA,aAAa;AACb;AACA,aAAa,QAAQ;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,SAAS;AACT;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA,4DAA4D;AAC5D;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,kCAAkC;AAClC;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA,0CAA0C,sEAAsE;AAChH;AACA;AACA;AACA;AACA;AACA,oCAAoC,uBAAuB,KAAK;AAChE;AACA,8CAA8C,iBAAiB;AAC/D,SAAS;;AAET;AACA;AACA,wBAAwB;AACxB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yCAAyC,sDAAsD;AAC/F;AACA;AACA;AACA;AACA,yCAAyC,mDAAmD;AAC5F;AACA;AACA;AACA;AACA,yCAAyC,2DAA2D;AACpG;AACA;AACA;AACA;AACA;AACA,yCAAyC,wDAAwD;AACjG;AACA;AACA;AACA;AACA,yCAAyC,yDAAyD;AAClG;AACA;AACA;AACA;AACA,yFAAyF;AACzF;AACA;AACA;AACA;AACA;AACA,yCAAyC,sFAAsF;AAC/H,yBAAyB;AACzB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iCAAiC,sDAAsD;AACvF;AACA;AACA,iCAAiC,iFAAiF;AAClH;AACA;AACA;AACA,0CAA0C,uEAAuE;AACjH;AACA;AACA;AACA;AACA,gDAAgD;AAChD,2EAA2E,wBAAwB;AACnG,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA,yBAAyB;AACzB,qBAAqB;AACrB,iBAAiB;AACjB,sDAAsD,wBAAwB;AAC9E;AACA,gD;AACA;AACA;AACA,8CAA8C,iBAAiB;AAC/D;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA,uEAAuE,IAAI;AAC3E;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA,wDAAwD;AACxD,SAAS;;AAET,gDAAgD;AAChD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0CAA0C,uFAAuF;AACjI,iDAAiD,8CAA8C,+CAA+C,EAAE,QAAQ;AACxJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oCAAoC,uBAAuB,EAAE;AAC7D;AACA;AACA;AACA;AACA,mCAAmC,sBAAsB;AACzD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iDAAiD,4DAA4D;AAC7G;AACA,qEAAqE,+CAA+C;AACpH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6BAA6B;AAC7B;AACA;AACA;AACA,qCAAqC,+BAA+B,EAAE,YAAY;AAClF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6BAA6B;AAC7B,0DAA0D;AAC1D,0DAA0D;AAC1D;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qDAAqD,iBAAiB;AACtE;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA,oCAAoC;AACpC,kDAAkD,4DAA4D;AAC9G;AACA;AACA;AACA;AACA,6BAA6B,uCAAuC;AACpE;AACA,+CAA+C,6BAA6B,sBAAsB,GAAG;AACrG,+CAA+C,4CAA4C;AAC3F;AACA;AACA;AACA,sDAAsD,iBAAiB;AACvE,iBAAiB;AACjB;AACA,8CAA8C,iBAAiB;AAC/D,SAAS;;AAET;AACA;AACA,SAAS;;AAET;AACA;AACA,gDAAgD;AAChD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iDAAiD;AACjD;AACA,6CAA6C,oFAAoF;AACjI;AACA;AACA;AACA;AACA,uCAAuC,sBAAsB,EAAE;AAC/D;AACA;AACA;AACA;AACA,uCAAuC,sBAAsB;AAC7D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yBAAyB;AACzB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,qDAAqD,4EAA4E;AACjI;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iCAAiC;AACjC;AACA;AACA;AACA,yCAAyC,+BAA+B,EAAE,YAAY;AACtF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iCAAiC;AACjC,8DAA8D;AAC9D;AACA;AACA,yBAAyB;AACzB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yDAAyD,iBAAiB;AAC1E;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA,wCAAwC;AACxC,sDAAsD,4DAA4D;AAClH;AACA;AACA;AACA,6BAA6B,oBAAoB,SAAS,4CAA4C;AACtG;AACA;AACA,0DAA0D,iBAAiB;AAC3E,qBAAqB;AACrB;AACA,iDAAiD,iBAAiB;AAClE,aAAa;AACb,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA,oCAAoC,yBAAyB,EAAE,MAAM;AACrE,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA,2BAA2B;AAC3B;AACA;AACA;AACA;AACA;AACA;AACA,6CAA6C,oDAAoD;AACjG;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+BAA+B,2BAA2B;AAC1D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4GAA4G;AAC5G;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA,0CAA0C,wEAAwE;AAClH;AACA;AACA;AACA;AACA;AACA;AACA,8CAA8C,iBAAiB;AAC/D,SAAS;;AAET;AACA;AACA;AACA,0CAA0C,qDAAqD;AAC/F;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6CAA6C,iBAAiB;;AAE9D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uCAAuC,SAAS;AAChD,0DAA0D,gBAAgB,OAAO;AACjF;AACA;AACA;AACA,aAAa;AACb;AACA,0CAA0C,uEAAuE;AACjH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8EAA8E,SAAS;AACvF;AACA;AACA,yDAAyD,MAAM;AAC/D;AACA;AACA;AACA,mFAAmF,SAAS;AAC5F;AACA;AACA,8DAA8D,MAAM;AACpE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iDAAiD,2GAA2G;AAC5J;AACA,2DAA2D;AAC3D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yBAAyB;AACzB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qDAAqD,iBAAiB;AACtE,iBAAiB;AACjB;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uDAAuD,kBAAkB,mBAAmB;AAC5F;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6DAA6D;AAC7D;AACA;AACA;AACA;AACA,yBAAyB;AACzB;AACA,yBAAyB;AACzB;AACA,yBAAyB;AACzB;AACA;AACA;AACA,uDAAuD,kBAAkB,oCAAoC;AAC7G;AACA;AACA;AACA;AACA,uDAAuD,kBAAkB,oCAAoC;AAC7G;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yBAAyB;AACzB;AACA;AACA;AACA;AACA;AACA,uDAAuD,kBAAkB,mBAAmB;AAC5F;AACA;AACA;AACA;AACA;AACA,2BAA2B,gBAAgB;AAC3C;AACA;AACA;AACA,8CAA8C,iBAAiB;AAC/D;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0CAA0C,wGAAwG;AAClJ;AACA;AACA;AACA,iDAAiD;AACjD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,wDAAwD,iBAAiB,2CAA2C;AACpH;AACA,iDAAiD,+EAA+E;AAChI;AACA;AACA,qDAAqD,iBAAiB;AACtE,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA,kDAAkD,cAAc,wCAAwC;AACxG;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA,8CAA8C,iBAAiB;AAC/D;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA,gDAAgD;AAChD,oDAAoD,yBAAyB;AAC7E;AACA;AACA,oCAAoC,cAAc,eAAe,EAAE,OAAO;AAC1E;AACA;AACA;AACA;AACA;AACA,0DAA0D;AAC1D;AACA,SAAS;;AAET;AACA;AACA,0CAA0C,sDAAsD;AAChG;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8CAA8C,iBAAiB;AAC/D;AACA;AACA;;AAEA;AACA;AACA,CAAC","file":"w2ui.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./node_modules/w2ui/w2ui-1.4.3.js\");\n","/* w2ui 1.4.3 (c) http://w2ui.com, vitmalina@gmail.com */\nvar w2ui  = w2ui  || {};\nvar w2obj = w2obj || {}; // expose object to be able to overwrite default functions\n\n/************************************************\n*  Library: Web 2.0 UI for jQuery\n*  - Following objects are defines\n*        - w2ui             - object that will contain all widgets\n*        - w2obj            - object with widget prototypes\n*        - w2utils          - basic utilities\n*        - $().w2render     - common render\n*        - $().w2destroy    - common destroy\n*        - $().w2marker     - marker plugin\n*        - $().w2tag        - tag plugin\n*        - $().w2overlay    - overlay plugin\n*        - $().w2menu       - menu plugin\n*        - w2utils.event    - generic event object\n*        - w2utils.keyboard - object for keyboard navigation\n*  - Dependencies: jQuery\n*\n* == NICE TO HAVE ==\n*   - overlay should be displayed where more space (on top or on bottom)\n*   - write and article how to replace certain framework functions\n*   - onComplete should pass widget as context (this)\n*   - add maxHeight for the w2menu\n*   - user localization from another lib (make it generic), https://github.com/jquery/globalize#readme\n*   - hidden and disabled in menus\n*   - isTime should support seconds\n*   - TEST On IOS\n*\n************************************************/\n\nvar w2utils = (function () {\n    var tmp = {}; // for some temp variables\n    var obj = {\n        version  : '1.4.3',\n        settings : {\n            \"locale\"            : \"en-us\",\n            \"date_format\"       : \"m/d/yyyy\",\n            \"date_display\"      : \"Mon d, yyyy\",\n            \"time_format\"       : \"hh:mi pm\",\n            \"currencyPrefix\"    : \"$\",\n            \"currencySuffix\"    : \"\",\n            \"currencyPrecision\" : 2,\n            \"groupSymbol\"       : \",\",\n            \"decimalSymbol\"     : \".\",\n            \"shortmonths\"       : [\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Oct\", \"Nov\", \"Dec\"],\n            \"fullmonths\"        : [\"January\", \"February\", \"March\", \"April\", \"May\", \"June\", \"July\", \"August\", \"September\", \"October\", \"November\", \"December\"],\n            \"shortdays\"         : [\"M\", \"T\", \"W\", \"T\", \"F\", \"S\", \"S\"],\n            \"fulldays\"          : [\"Monday\", \"Tuesday\", \"Wednesday\", \"Thursday\", \"Friday\", \"Saturday\", \"Sunday\"],\n            \"dataType\"          : 'HTTP',   // can be HTTP, RESTFULL, JSON (case sensative)\n            \"phrases\"           : {}        // empty object for english phrases\n        },\n        isInt           : isInt,\n        isFloat         : isFloat,\n        isMoney         : isMoney,\n        isHex           : isHex,\n        isAlphaNumeric  : isAlphaNumeric,\n        isEmail         : isEmail,\n        isDate          : isDate,\n        isTime          : isTime,\n        age             : age,\n        date            : date,\n        size            : size,\n        formatNumber    : formatNumber,\n        formatDate      : formatDate,\n        formatTime      : formatTime,\n        formatDateTime  : formatDateTime,\n        stripTags       : stripTags,\n        encodeTags      : encodeTags,\n        escapeId        : escapeId,\n        base64encode    : base64encode,\n        base64decode    : base64decode,\n        transition      : transition,\n        lock            : lock,\n        unlock          : unlock,\n        lang            : lang,\n        locale          : locale,\n        getSize         : getSize,\n        scrollBarSize   : scrollBarSize,\n        checkName       : checkName,\n        checkUniqueId   : checkUniqueId,\n        parseRoute      : parseRoute,\n        // some internal variables\n        isIOS : ((navigator.userAgent.toLowerCase().indexOf('iphone') != -1 ||\n                 navigator.userAgent.toLowerCase().indexOf('ipod') != -1 ||\n                 navigator.userAgent.toLowerCase().indexOf('ipad') != -1) \n                 ? true : false),\n        isIE : ((navigator.userAgent.toLowerCase().indexOf('msie') != -1 ||\n                 navigator.userAgent.toLowerCase().indexOf('trident') != -1 )\n                 ? true : false)\n    };\n    return obj;\n\n    function isInt (val) {\n        var re = /^[-+]?[0-9]+$/;\n        return re.test(val);\n    }\n\n    function isFloat (val) {\n        if (typeof val == 'string') val = val.replace(w2utils.settings.decimalSymbol, '.');\n        return (typeof val === 'number' || (typeof val === 'string' && val !== '')) && !isNaN(Number(val));\n    }\n\n    function isMoney (val) {\n        var se = w2utils.settings;\n        var re = new RegExp('^'+ (se.currencyPrefix ? '\\\\' + se.currencyPrefix + '?' : '') +'[-+]?[0-9]*[\\\\'+ w2utils.settings.decimalSymbol +']?[0-9]+'+ (se.currencySuffix ? '\\\\' + se.currencySuffix + '?' : '') +'$', 'i');\n        if (typeof val === 'string') {\n            val = val.replace(new RegExp(se.groupSymbol, 'g'), '');\n        }\n        if (typeof val === 'object' || val === '') return false;\n        return re.test(val);\n    }\n\n    function isHex (val) {\n        var re = /^[a-fA-F0-9]+$/;\n        return re.test(val);\n    }\n\n    function isAlphaNumeric (val) {\n        var re = /^[a-zA-Z0-9_-]+$/;\n        return re.test(val);\n    }\n\n    function isEmail (val) {\n        var email = /^[a-zA-Z0-9._%-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,4}$/;\n        return email.test(val);\n    }\n\n    function isDate (val, format, retDate) {\n        if (!val) return false;\n\n        var dt   = 'Invalid Date';\n        var month, day, year;\n\n        if (format == null) format = w2utils.settings.date_format;\n\n        if (typeof val.getUTCFullYear === 'function' && typeof val.getUTCMonth === 'function' && typeof val.getUTCDate === 'function') {\n            year = val.getUTCFullYear();\n            month = val.getUTCMonth();\n            day = val.getUTCDate();\n        } else if (typeof val.getFullYear === 'function' && typeof val.getMonth === 'function' && typeof val.getDate === 'function') {\n            year = val.getFullYear();\n            month = val.getMonth();\n            day = val.getDate();\n        } else {\n            val = String(val);\n            // convert month formats\n            if (RegExp('mon', 'ig').test(format)) {\n                format = format.replace(/month/ig, 'm').replace(/mon/ig, 'm').replace(/dd/ig, 'd').replace(/[, ]/ig, '/').replace(/\\/\\//g, '/').toLowerCase();\n                val    = val.replace(/[, ]/ig, '/').replace(/\\/\\//g, '/').toLowerCase();\n                for (var m = 0, len = w2utils.settings.fullmonths.length; m < len; m++) {\n                    var t = w2utils.settings.fullmonths[m];\n                    val = val.replace(RegExp(t, 'ig'), (parseInt(m) + 1)).replace(RegExp(t.substr(0, 3), 'ig'), (parseInt(m) + 1));\n                }\n            }\n            // format date\n            var tmp  = val.replace(/-/g, '/').replace(/\\./g, '/').toLowerCase().split('/');\n            var tmp2 = format.replace(/-/g, '/').replace(/\\./g, '/').toLowerCase();\n            if (tmp2 === 'mm/dd/yyyy') { month = tmp[0]; day = tmp[1]; year = tmp[2]; }\n            if (tmp2 === 'm/d/yyyy')   { month = tmp[0]; day = tmp[1]; year = tmp[2]; }\n            if (tmp2 === 'dd/mm/yyyy') { month = tmp[1]; day = tmp[0]; year = tmp[2]; }\n            if (tmp2 === 'd/m/yyyy')   { month = tmp[1]; day = tmp[0]; year = tmp[2]; }\n            if (tmp2 === 'yyyy/dd/mm') { month = tmp[2]; day = tmp[1]; year = tmp[0]; }\n            if (tmp2 === 'yyyy/d/m')   { month = tmp[2]; day = tmp[1]; year = tmp[0]; }\n            if (tmp2 === 'yyyy/mm/dd') { month = tmp[1]; day = tmp[2]; year = tmp[0]; }\n            if (tmp2 === 'yyyy/m/d')   { month = tmp[1]; day = tmp[2]; year = tmp[0]; }\n            if (tmp2 === 'mm/dd/yy')   { month = tmp[0]; day = tmp[1]; year = tmp[2]; }\n            if (tmp2 === 'm/d/yy')     { month = tmp[0]; day = tmp[1]; year = parseInt(tmp[2]) + 1900; }\n            if (tmp2 === 'dd/mm/yy')   { month = tmp[1]; day = tmp[0]; year = parseInt(tmp[2]) + 1900; }\n            if (tmp2 === 'd/m/yy')     { month = tmp[1]; day = tmp[0]; year = parseInt(tmp[2]) + 1900; }\n            if (tmp2 === 'yy/dd/mm')   { month = tmp[2]; day = tmp[1]; year = parseInt(tmp[0]) + 1900; }\n            if (tmp2 === 'yy/d/m')     { month = tmp[2]; day = tmp[1]; year = parseInt(tmp[0]) + 1900; }\n            if (tmp2 === 'yy/mm/dd')   { month = tmp[1]; day = tmp[2]; year = parseInt(tmp[0]) + 1900; }\n            if (tmp2 === 'yy/m/d')     { month = tmp[1]; day = tmp[2]; year = parseInt(tmp[0]) + 1900; }\n        }\n        if (!isInt(year)) return false;\n        if (!isInt(month)) return false;\n        if (!isInt(day)) return false;\n        year = +year;\n        month = +month;\n        day = +day;\n        dt = new Date(year, month - 1, day);\n        // do checks\n        if (month == null) return false;\n        if (String(dt) == 'Invalid Date') return false;\n        if ((dt.getMonth() + 1 !== month) || (dt.getDate() !== day) || (dt.getFullYear() !== year)) return false;\n        if (retDate === true) return dt; else return true;\n    }\n\n    function isTime (val, retTime) {\n        // Both formats 10:20pm and 22:20\n        if (val == null) return false;\n        var max, pm;\n        // -- process american format\n        val = String(val);\n        val = val.toUpperCase();\n        pm = val.indexOf('PM') >= 0;\n        var ampm = (pm || val.indexOf('AM') >= 0);\n        if (ampm) max = 12; else max = 24;\n        val = val.replace('AM', '').replace('PM', '');\n        val = $.trim(val);\n        // ---\n        var tmp = val.split(':');\n        var h = parseInt(tmp[0] || 0), m = parseInt(tmp[1] || 0);\n        // accept edge case: 3PM is a good timestamp, but 3 (without AM or PM) is NOT:\n        if ((!ampm || tmp.length !== 1) && tmp.length !== 2) { return false; }\n        if (tmp[0] === '' || h < 0 || h > max || !this.isInt(tmp[0]) || tmp[0].length > 2) { return false; }\n        if (tmp.length === 2 && (tmp[1] === '' || m < 0 || m > 59 || !this.isInt(tmp[1]) || tmp[1].length !== 2)) { return false; }\n        // check the edge cases: 12:01AM is ok, as is 12:01PM, but 24:01 is NOT ok while 24:00 is (midnight; equivalent to 00:00).\n        // meanwhile, there is 00:00 which is ok, but 0AM nor 0PM are okay, while 0:01AM and 0:00AM are.\n        if (!ampm && max === h && m !== 0) { return false; }\n        if (ampm && tmp.length === 1 && h === 0) { return false; }\n\n        if (retTime === true) {\n            if (pm) h += 12;\n            return {\n                hours: h,\n                minutes: m\n            };\n        }\n        return true;\n    }\n\n    function age (dateStr) {\n        if (dateStr === '' || dateStr == null) return '';\n        var d1 = new Date(dateStr);\n        if (w2utils.isInt(dateStr)) d1 = new Date(Number(dateStr)); // for unix timestamps\n        if (String(d1) == 'Invalid Date') return '';\n\n        var d2  = new Date();\n        var sec = (d2.getTime() - d1.getTime()) / 1000;\n        var amount = '';\n        var type   = '';\n        if (sec < 0) {\n            amount = '<span style=\"color: #aaa\">future</span>';\n            type   = '';\n        } else if (sec < 60) {\n            amount = Math.floor(sec);\n            type   = 'sec';\n            if (sec < 0) { amount = 0; type = 'sec'; }\n        } else if (sec < 60*60) {\n            amount = Math.floor(sec/60);\n            type   = 'min';\n        } else if (sec < 24*60*60) {\n            amount = Math.floor(sec/60/60);\n            type   = 'hour';\n        } else if (sec < 30*24*60*60) {\n            amount = Math.floor(sec/24/60/60);\n            type   = 'day';\n        } else if (sec < 365.25*24*60*60) {\n            amount = Math.floor(sec/365.25/24/60/60*10)/10;\n            type   = 'month';\n        } else if (sec >= 365.25*24*60*60) {\n            amount = Math.floor(sec/365.25/24/60/60*10)/10;\n            type   = 'year';\n        }\n        return amount + ' ' + type + (amount > 1 ? 's' : '');\n    }\n\n    function date (dateStr) {\n        if (dateStr === '' || dateStr == null) return '';\n        var d1 = new Date(dateStr);\n        if (w2utils.isInt(dateStr)) d1 = new Date(Number(dateStr)); // for unix timestamps\n        if (String(d1) == 'Invalid Date') return '';\n\n        var months = w2utils.settings.shortmonths;\n        var d2   = new Date(); // today\n        var d3   = new Date();\n        d3.setTime(d3.getTime() - 86400000); // yesterday\n\n        var dd1  = months[d1.getMonth()] + ' ' + d1.getDate() + ', ' + d1.getFullYear();\n        var dd2  = months[d2.getMonth()] + ' ' + d2.getDate() + ', ' + d2.getFullYear();\n        var dd3  = months[d3.getMonth()] + ' ' + d3.getDate() + ', ' + d3.getFullYear();\n\n        var time = (d1.getHours() - (d1.getHours() > 12 ? 12 :0)) + ':' + (d1.getMinutes() < 10 ? '0' : '') + d1.getMinutes() + ' ' + (d1.getHours() >= 12 ? 'pm' : 'am');\n        var time2= (d1.getHours() - (d1.getHours() > 12 ? 12 :0)) + ':' + (d1.getMinutes() < 10 ? '0' : '') + d1.getMinutes() + ':' + (d1.getSeconds() < 10 ? '0' : '') + d1.getSeconds() + ' ' + (d1.getHours() >= 12 ? 'pm' : 'am');\n        var dsp = dd1;\n        if (dd1 === dd2) dsp = time;\n        if (dd1 === dd3) dsp = w2utils.lang('Yesterday');\n\n        return '<span title=\"'+ dd1 +' ' + time2 +'\">'+ dsp +'</span>';\n    }\n\n    function size (sizeStr) {\n        if (!w2utils.isFloat(sizeStr) || sizeStr === '') return '';\n        sizeStr = parseFloat(sizeStr);\n        if (sizeStr === 0) return 0;\n        var sizes = ['Bt', 'KB', 'MB', 'GB', 'TB'];\n        var i = parseInt( Math.floor( Math.log(sizeStr) / Math.log(1024) ) );\n        return (Math.floor(sizeStr / Math.pow(1024, i) * 10) / 10).toFixed(i === 0 ? 0 : 1) + ' ' + sizes[i];\n    }\n\n    function formatNumber (val, groupSymbol, decimalSymbol) {\n        var ret = '';\n        if (groupSymbol == null) groupSymbol = w2utils.settings.groupSymbol || ',';\n        if (decimalSymbol == null) decimalSymbol = w2utils.settings.decimalSymbol || '.';\n        // check if this is a number\n        if (w2utils.isFloat(val) || w2utils.isInt(val) || w2utils.isMoney(val)) {\n            tmp = String(val).split('.');\n            ret = String(tmp[0]).replace(/(\\d)(?=(\\d\\d\\d)+(?!\\d))/g, \"$1\" + groupSymbol);\n            if (tmp[1] != null) ret += w2utils.settings.decimalSymbol + tmp[1];\n        }\n        return ret;\n    }\n\n    function formatDate (dateStr, format) { // IMPORTANT dateStr HAS TO BE valid JavaScript Date String\n        var months = w2utils.settings.shortmonths;\n        var fullMonths = w2utils.settings.fullmonths;\n        if (!format) format = this.settings.date_format;\n        if (dateStr === '' || dateStr == null || (typeof dateStr == 'object' && !dateStr.getMonth)) return '';\n\n        var dt = new Date(dateStr);\n        if (w2utils.isInt(dateStr)) dt = new Date(Number(dateStr)); // for unix timestamps\n        if (String(dt) == 'Invalid Date') return '';\n\n        var year  = dt.getFullYear();\n        var month = dt.getMonth();\n        var date  = dt.getDate();\n        return format.toLowerCase()\n            .replace('month', w2utils.settings.fullmonths[month])\n            .replace('mon', w2utils.settings.shortmonths[month])\n            .replace(/yyyy/g, year)\n            .replace(/yyy/g, year)\n            .replace(/yy/g, year > 2000 ? 100 + parseInt(String(year).substr(2)) : String(year).substr(2))\n            .replace(/(^|[^a-z$])y/g, '$1' + year)            // only y's that are not preceeded by a letter\n            .replace(/mm/g, (month + 1 < 10 ? '0' : '') + (month + 1))\n            .replace(/dd/g, (date < 10 ? '0' : '') + date)\n            .replace(/th/g, (date == 1 ? 'st' : 'th'))\n            .replace(/th/g, (date == 2 ? 'nd' : 'th'))\n            .replace(/th/g, (date == 3 ? 'rd' : 'th'))\n            .replace(/(^|[^a-z$])m/g, '$1' + (month + 1))     // only y's that are not preceeded by a letter\n            .replace(/(^|[^a-z$])d/g, '$1' + date);           // only y's that are not preceeded by a letter\n    }\n\n    function formatTime (dateStr, format) { // IMPORTANT dateStr HAS TO BE valid JavaScript Date String\n        var months = w2utils.settings.shortmonths;\n        var fullMonths = w2utils.settings.fullmonths;\n        if (!format) format = this.settings.time_format;\n        if (dateStr === '' || dateStr == null || (typeof dateStr == 'object' && !dateStr.getMonth)) return '';\n\n        var dt = new Date(dateStr);\n        if (w2utils.isInt(dateStr)) dt  = new Date(Number(dateStr)); // for unix timestamps\n        if (w2utils.isTime(dateStr)) {\n            var tmp = w2utils.isTime(dateStr, true);\n            dt = new Date();\n            dt.setHours(tmp.hours);\n            dt.setMinutes(tmp.minutes);\n        }\n        if (String(dt) == 'Invalid Date') return '';\n\n        var type = 'am';\n        var hour = dt.getHours();\n        var h24  = dt.getHours();\n        var min  = dt.getMinutes();\n        var sec  = dt.getSeconds();\n        if (min < 10) min = '0' + min;\n        if (sec < 10) sec = '0' + sec;\n        if (format.indexOf('am') !== -1 || format.indexOf('pm') !== -1) {\n            if (hour >= 12) type = 'pm';\n            if (hour > 12)  hour = hour - 12;\n        }\n        return format.toLowerCase()\n            .replace('am', type)\n            .replace('pm', type)\n            .replace('hhh', (hour < 10 ? '0' + hour : hour))\n            .replace('hh24', (h24 < 10 ? '0' + h24 : h24))\n            .replace('h24', h24)\n            .replace('hh', hour)\n            .replace('mm', min)\n            .replace('mi', min)\n            .replace('ss', sec)\n            .replace(/(^|[^a-z$])h/g, '$1' + hour)    // only y's that are not preceeded by a letter\n            .replace(/(^|[^a-z$])m/g, '$1' + min)     // only y's that are not preceeded by a letter\n            .replace(/(^|[^a-z$])s/g, '$1' + sec);    // only y's that are not preceeded by a letter\n    }\n\n    function formatDateTime(dateStr, format) {\n        var fmt;\n        if (dateStr === '' || dateStr == null || (typeof dateStr == 'object' && !dateStr.getMonth)) return '';\n        if (typeof format !== 'string') {\n            fmt = [this.settings.date_format, this.settings.time_format];\n        } else {\n            fmt = format.split('|');\n        }\n        return this.formatDate(dateStr, fmt[0]) + ' ' + this.formatTime(dateStr, fmt[1]);\n    }\n\n    function stripTags (html) {\n        if (html === null) return html;\n        switch (typeof html) {\n            case 'number':\n                break;\n            case 'string':\n                html = $.trim(String(html).replace(/(<([^>]+)>)/ig, \"\"));\n                break;\n            case 'object':\n                for (var a in html) html[a] = this.stripTags(html[a]);\n                break;\n        }\n        return html;\n    }\n\n    function encodeTags (html) {\n        if (html === null) return html;\n        switch (typeof html) {\n            case 'number':\n                break;\n            case 'string':\n                html = String(html).replace(/&/g, \"&amp;\").replace(/>/g, \"&gt;\").replace(/</g, \"&lt;\").replace(/\"/g, \"&quot;\");\n                break;\n            case 'object':\n                for (var a in html) html[a] = this.encodeTags(html[a]);\n                break;\n        }\n        return html;\n    }\n\n    function escapeId (id) {\n        if (id === '' || id == null) return '';\n        return String(id).replace(/([;&,\\.\\+\\*\\~'`:\"\\!\\^#$%@\\[\\]\\(\\)=<>\\|\\/? {}\\\\])/g, '\\\\$1');\n    }\n\n    function base64encode (input) {\n        var output = \"\";\n        var chr1, chr2, chr3, enc1, enc2, enc3, enc4;\n        var i = 0;\n        var keyStr = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\";\n        input = utf8_encode(input);\n\n        while (i < input.length) {\n            chr1 = input.charCodeAt(i++);\n            chr2 = input.charCodeAt(i++);\n            chr3 = input.charCodeAt(i++);\n            enc1 = chr1 >> 2;\n            enc2 = ((chr1 & 3) << 4) | (chr2 >> 4);\n            enc3 = ((chr2 & 15) << 2) | (chr3 >> 6);\n            enc4 = chr3 & 63;\n            if (isNaN(chr2)) {\n                enc3 = enc4 = 64;\n            } else if (isNaN(chr3)) {\n                enc4 = 64;\n            }\n            output = output + keyStr.charAt(enc1) + keyStr.charAt(enc2) + keyStr.charAt(enc3) + keyStr.charAt(enc4);\n        }\n\n        function utf8_encode (string) {\n            var string = String(string).replace(/\\r\\n/g,\"\\n\");\n            var utftext = \"\";\n\n            for (var n = 0; n < string.length; n++) {\n                var c = string.charCodeAt(n);\n                if (c < 128) {\n                    utftext += String.fromCharCode(c);\n                }\n                else if((c > 127) && (c < 2048)) {\n                    utftext += String.fromCharCode((c >> 6) | 192);\n                    utftext += String.fromCharCode((c & 63) | 128);\n                }\n                else {\n                    utftext += String.fromCharCode((c >> 12) | 224);\n                    utftext += String.fromCharCode(((c >> 6) & 63) | 128);\n                    utftext += String.fromCharCode((c & 63) | 128);\n                }\n            }\n            return utftext;\n        }\n\n        return output;\n    }\n\n    function base64decode (input) {\n        var output = \"\";\n        var chr1, chr2, chr3;\n        var enc1, enc2, enc3, enc4;\n        var i = 0;\n        var keyStr = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\";\n        input = input.replace(/[^A-Za-z0-9\\+\\/\\=]/g, \"\");\n\n        while (i < input.length) {\n            enc1 = keyStr.indexOf(input.charAt(i++));\n            enc2 = keyStr.indexOf(input.charAt(i++));\n            enc3 = keyStr.indexOf(input.charAt(i++));\n            enc4 = keyStr.indexOf(input.charAt(i++));\n            chr1 = (enc1 << 2) | (enc2 >> 4);\n            chr2 = ((enc2 & 15) << 4) | (enc3 >> 2);\n            chr3 = ((enc3 & 3) << 6) | enc4;\n            output = output + String.fromCharCode(chr1);\n            if (enc3 !== 64) {\n                output = output + String.fromCharCode(chr2);\n            }\n            if (enc4 !== 64) {\n                output = output + String.fromCharCode(chr3);\n            }\n        }\n        output = utf8_decode(output);\n\n        function utf8_decode (utftext) {\n            var string = \"\";\n            var i = 0;\n            var c = 0, c2, c3;\n\n            while ( i < utftext.length ) {\n                c = utftext.charCodeAt(i);\n                if (c < 128) {\n                    string += String.fromCharCode(c);\n                    i++;\n                }\n                else if((c > 191) && (c < 224)) {\n                    c2 = utftext.charCodeAt(i+1);\n                    string += String.fromCharCode(((c & 31) << 6) | (c2 & 63));\n                    i += 2;\n                }\n                else {\n                    c2 = utftext.charCodeAt(i+1);\n                    c3 = utftext.charCodeAt(i+2);\n                    string += String.fromCharCode(((c & 15) << 12) | ((c2 & 63) << 6) | (c3 & 63));\n                    i += 3;\n                }\n            }\n\n            return string;\n        }\n\n        return output;\n    }\n\n    function transition (div_old, div_new, type, callBack) {\n        var width  = $(div_old).width();\n        var height = $(div_old).height();\n        var time   = 0.5;\n\n        if (!div_old || !div_new) {\n            console.log('ERROR: Cannot do transition when one of the divs is null');\n            return;\n        }\n\n        div_old.parentNode.style.cssText += cross('perspective', '700px') +'; overflow: hidden;';\n        div_old.style.cssText += '; position: absolute; z-index: 1019; '+ cross('backface-visibility', 'hidden');\n        div_new.style.cssText += '; position: absolute; z-index: 1020; '+ cross('backface-visibility', 'hidden');\n\n        switch (type) {\n            case 'slide-left':\n                // init divs\n                div_old.style.cssText += 'overflow: hidden; '+ cross('transform', 'translate3d(0, 0, 0)', 'translate(0, 0)');\n                div_new.style.cssText += 'overflow: hidden; '+ cross('transform', 'translate3d('+ width + 'px, 0, 0)', 'translate('+ width +'px, 0)');\n                $(div_new).show();\n                // -- need a timing function because otherwise not working\n                window.setTimeout(function() {\n                    div_new.style.cssText += cross('transition', time+'s') +';'+ cross('transform', 'translate3d(0, 0, 0)', 'translate(0, 0)');\n                    div_old.style.cssText += cross('transition', time+'s') +';'+ cross('transform', 'translate3d(-'+ width +'px, 0, 0)', 'translate(-'+ width +'px, 0)');\n                }, 1);\n                break;\n\n            case 'slide-right':\n                // init divs\n                div_old.style.cssText += 'overflow: hidden; '+ cross('transform', 'translate3d(0, 0, 0)', 'translate(0, 0)');\n                div_new.style.cssText += 'overflow: hidden; '+ cross('transform', 'translate3d(-'+ width +'px, 0, 0)', 'translate(-'+ width +'px, 0)');\n                $(div_new).show();\n                // -- need a timing function because otherwise not working\n                window.setTimeout(function() {\n                    div_new.style.cssText += cross('transition', time+'s') +'; '+ cross('transform', 'translate3d(0px, 0, 0)', 'translate(0px, 0)');\n                    div_old.style.cssText += cross('transition', time+'s') +'; '+ cross('transform', 'translate3d('+ width +'px, 0, 0)', 'translate('+ width +'px, 0)');\n                }, 1);\n                break;\n\n            case 'slide-down':\n                // init divs\n                div_old.style.cssText += 'overflow: hidden; z-index: 1; '+ cross('transform', 'translate3d(0, 0, 0)', 'translate(0, 0)');\n                div_new.style.cssText += 'overflow: hidden; z-index: 0; '+ cross('transform', 'translate3d(0, 0, 0)', 'translate(0, 0)');\n                $(div_new).show();\n                // -- need a timing function because otherwise not working\n                window.setTimeout(function() {\n                    div_new.style.cssText += cross('transition', time+'s') +'; '+ cross('transform', 'translate3d(0, 0, 0)', 'translate(0, 0)');\n                    div_old.style.cssText += cross('transition', time+'s') +'; '+ cross('transform', 'translate3d(0, '+ height +'px, 0)', 'translate(0, '+ height +'px)');\n                }, 1);\n                break;\n\n            case 'slide-up':\n                // init divs\n                div_old.style.cssText += 'overflow: hidden; '+ cross('transform', 'translate3d(0, 0, 0)', 'translate(0, 0)');\n                div_new.style.cssText += 'overflow: hidden; '+ cross('transform', 'translate3d(0, '+ height +'px, 0)', 'translate(0, '+ height +'px)');\n                $(div_new).show();\n                // -- need a timing function because otherwise not working\n                window.setTimeout(function() {\n                    div_new.style.cssText += cross('transition', time+'s') +'; '+ cross('transform', 'translate3d(0, 0, 0)', 'translate(0, 0)');\n                    div_old.style.cssText += cross('transition', time+'s') +'; '+ cross('transform', 'translate3d(0, 0, 0)', 'translate(0, 0)');\n                }, 1);\n                break;\n\n            case 'flip-left':\n                // init divs\n                div_old.style.cssText += 'overflow: hidden; '+ cross('transform', 'rotateY(0deg)');\n                div_new.style.cssText += 'overflow: hidden; '+ cross('transform', 'rotateY(-180deg)');\n                $(div_new).show();\n                // -- need a timing function because otherwise not working\n                window.setTimeout(function() {\n                    div_new.style.cssText += cross('transition', time+'s') +'; '+ cross('transform', 'rotateY(0deg)');\n                    div_old.style.cssText += cross('transition', time+'s') +'; '+ cross('transform', 'rotateY(180deg)');\n                }, 1);\n                break;\n\n            case 'flip-right':\n                // init divs\n                div_old.style.cssText += 'overflow: hidden; '+ cross('transform', 'rotateY(0deg)');\n                div_new.style.cssText += 'overflow: hidden; '+ cross('transform', 'rotateY(180deg)');\n                $(div_new).show();\n                // -- need a timing function because otherwise not working\n                window.setTimeout(function() {\n                    div_new.style.cssText += cross('transition', time+'s') +'; '+ cross('transform', 'rotateY(0deg)');\n                    div_old.style.cssText += cross('transition', time+'s') +'; '+ cross('transform', 'rotateY(-180deg)');\n                }, 1);\n                break;\n\n            case 'flip-down':\n                // init divs\n                div_old.style.cssText += 'overflow: hidden; '+ cross('transform', 'rotateX(0deg)');\n                div_new.style.cssText += 'overflow: hidden; '+ cross('transform', 'rotateX(180deg)');\n                $(div_new).show();\n                // -- need a timing function because otherwise not working\n                window.setTimeout(function() {\n                    div_new.style.cssText += cross('transition', time+'s') +'; '+ cross('transform', 'rotateX(0deg)');\n                    div_old.style.cssText += cross('transition', time+'s') +'; '+ cross('transform', 'rotateX(-180deg)');\n                }, 1);\n                break;\n\n            case 'flip-up':\n                // init divs\n                div_old.style.cssText += 'overflow: hidden; '+ cross('transform', 'rotateX(0deg)');\n                div_new.style.cssText += 'overflow: hidden; '+ cross('transform', 'rotateX(-180deg)');\n                $(div_new).show();\n                // -- need a timing function because otherwise not working\n                window.setTimeout(function() {\n                    div_new.style.cssText += cross('transition', time+'s') +'; '+ cross('transform', 'rotateX(0deg)');\n                    div_old.style.cssText += cross('transition', time+'s') +'; '+ cross('transform', 'rotateX(180deg)');\n                }, 1);\n                break;\n\n            case 'pop-in':\n                // init divs\n                div_old.style.cssText += 'overflow: hidden; '+ cross('transform', 'translate3d(0, 0, 0)', 'translate(0, 0)');\n                div_new.style.cssText += 'overflow: hidden; '+ cross('transform', 'translate3d(0, 0, 0)', 'translate(0, 0)') + '; '+ cross('transform', 'scale(.8)') + '; opacity: 0;';\n                $(div_new).show();\n                // -- need a timing function because otherwise not working\n                window.setTimeout(function() {\n                    div_new.style.cssText += cross('transition', time+'s') +'; '+ cross('transform', 'scale(1)') +'; opacity: 1;';\n                    div_old.style.cssText += cross('transition', time+'s') +';';\n                }, 1);\n                break;\n\n            case 'pop-out':\n                // init divs\n                div_old.style.cssText += 'overflow: hidden; '+ cross('transform', 'translate3d(0, 0, 0)', 'translate(0, 0)') +'; '+ cross('transform', 'scale(1)') +'; opacity: 1;';\n                div_new.style.cssText += 'overflow: hidden; '+ cross('transform', 'translate3d(0, 0, 0)', 'translate(0, 0)') +'; opacity: 0;';\n                $(div_new).show();\n                // -- need a timing function because otherwise not working\n                window.setTimeout(function() {\n                    div_new.style.cssText += cross('transition', time+'s') +'; opacity: 1;';\n                    div_old.style.cssText += cross('transition', time+'s') +'; '+ cross('transform', 'scale(1.7)') +'; opacity: 0;';\n                }, 1);\n                break;\n\n            default:\n                // init divs\n                div_old.style.cssText += 'overflow: hidden; '+ cross('transform', 'translate3d(0, 0, 0)', 'translate(0, 0)');\n                div_new.style.cssText += 'overflow: hidden; '+ cross('transform', 'translate3d(0, 0, 0)', 'translate(0, 0)') +'; opacity: 0;';\n                $(div_new).show();\n                // -- need a timing function because otherwise not working\n                window.setTimeout(function() {\n                    div_new.style.cssText += cross('transition', time +'s') +'; opacity: 1;';\n                    div_old.style.cssText += cross('transition', time +'s');\n                }, 1);\n                break;\n        }\n\n        setTimeout(function () {\n            if (type === 'slide-down') {\n                $(div_old).css('z-index', '1019');\n                $(div_new).css('z-index', '1020');\n            }\n            if (div_new) {\n                $(div_new).css({\n                    'opacity': '1',\n                    '-webkit-transition': '',\n                    '-moz-transition': '',\n                    '-ms-transition': '',\n                    '-o-transition': '',\n                    '-webkit-transform': '',\n                    '-moz-transform': '',\n                    '-ms-transform': '',\n                    '-o-transform': '',\n                    '-webkit-backface-visibility': '',\n                    '-moz-backface-visibility': '',\n                    '-ms-backface-visibility': '',\n                    '-o-backface-visibility': ''\n                });\n            }\n            if (div_old) {\n                $(div_old).css({\n                    'opacity': '1',\n                    '-webkit-transition': '',\n                    '-moz-transition': '',\n                    '-ms-transition': '',\n                    '-o-transition': '',\n                    '-webkit-transform': '',\n                    '-moz-transform': '',\n                    '-ms-transform': '',\n                    '-o-transform': '',\n                    '-webkit-backface-visibility': '',\n                    '-moz-backface-visibility': '',\n                    '-ms-backface-visibility': '',\n                    '-o-backface-visibility': ''\n                });\n                if (div_old.parentNode) $(div_old.parentNode).css({\n                    '-webkit-perspective': '',\n                    '-moz-perspective': '',\n                    '-ms-perspective': '',\n                    '-o-perspective': ''\n                });\n            }\n            if (typeof callBack === 'function') callBack();\n        }, time * 1000);\n\n        function cross(property, value, none_webkit_value) {\n            var isWebkit=!!window.webkitURL; // jQuery no longer supports $.browser - RR\n            if (!isWebkit && typeof none_webkit_value !== 'undefined') value = none_webkit_value;\n            return ';'+ property +': '+ value +'; -webkit-'+ property +': '+ value +'; -moz-'+ property +': '+ value +'; '+\n                '-ms-'+ property +': '+ value +'; -o-'+ property +': '+ value +';';\n        }\n    }\n\n    function lock (box, msg, spinner) {\n        var options = {};\n        if (typeof msg === 'object') {\n            options = msg;\n        } else {\n            options.msg     = msg;\n            options.spinner = spinner;\n        }\n        if (!options.msg && options.msg !== 0) options.msg = '';\n        w2utils.unlock(box);\n        $(box).prepend(\n            '<div class=\"w2ui-lock\"></div>'+\n            '<div class=\"w2ui-lock-msg\"></div>'\n        );\n        var $lock = $(box).find('.w2ui-lock');\n        var mess = $(box).find('.w2ui-lock-msg');\n        if (!options.msg) mess.css({ 'background-color': 'transparent', 'border': '0px' });\n        if (options.spinner === true) options.msg = '<div class=\"w2ui-spinner\" '+ (!options.msg ? 'style=\"width: 35px; height: 35px\"' : '') +'></div>' + options.msg;\n        if (options.opacity != null) $lock.css('opacity', options.opacity);\n        if (typeof $lock.fadeIn == 'function') {\n            $lock.fadeIn(200);\n            mess.html(options.msg).fadeIn(200);\n        } else {\n            $lock.show();\n            mess.html(options.msg).show(0);            \n        }\n        // hide all tags (do not hide overlays as the form can be in overlay)\n        $().w2tag();\n    }\n\n    function unlock (box) {\n        $(box).find('.w2ui-lock').remove();\n        $(box).find('.w2ui-lock-msg').remove();\n    }\n\n    function getSize (el, type) {\n        var $el = $(el);\n        var bwidth = {\n            left    : parseInt($el.css('border-left-width')) || 0,\n            right   : parseInt($el.css('border-right-width')) || 0,\n            top     : parseInt($el.css('border-top-width')) || 0,\n            bottom  : parseInt($el.css('border-bottom-width')) || 0\n        };\n        var mwidth = {\n            left    : parseInt($el.css('margin-left')) || 0,\n            right   : parseInt($el.css('margin-right')) || 0,\n            top     : parseInt($el.css('margin-top')) || 0,\n            bottom  : parseInt($el.css('margin-bottom')) || 0\n        };\n        var pwidth = {\n            left    : parseInt($el.css('padding-left')) || 0,\n            right   : parseInt($el.css('padding-right')) || 0,\n            top     : parseInt($el.css('padding-top')) || 0,\n            bottom  : parseInt($el.css('padding-bottom')) || 0\n        };\n        switch (type) {\n            case 'top'      : return bwidth.top + mwidth.top + pwidth.top;\n            case 'bottom'   : return bwidth.bottom + mwidth.bottom + pwidth.bottom;\n            case 'left'     : return bwidth.left + mwidth.left + pwidth.left;\n            case 'right'    : return bwidth.right + mwidth.right + pwidth.right;\n            case 'width'    : return bwidth.left + bwidth.right + mwidth.left + mwidth.right + pwidth.left + pwidth.right + parseInt($el.width());\n            case 'height'   : return bwidth.top + bwidth.bottom + mwidth.top + mwidth.bottom + pwidth.top + pwidth.bottom + parseInt($el.height());\n            case '+width'   : return bwidth.left + bwidth.right + mwidth.left + mwidth.right + pwidth.left + pwidth.right;\n            case '+height'  : return bwidth.top + bwidth.bottom + mwidth.top + mwidth.bottom + pwidth.top + pwidth.bottom;\n        }\n        return 0;\n    }\n\n    function lang (phrase) {\n        var translation = this.settings.phrases[phrase];\n        if (translation == null) return phrase; else return translation;\n    }\n\n    function locale (locale) {\n        if (!locale) locale = 'en-us';\n        if (locale.length === 5) locale = 'locale/'+ locale +'.json';\n        // load from the file\n        $.ajax({\n            url      : locale,\n            type     : \"GET\",\n            dataType : \"JSON\",\n            async    : false,\n            cache    : false,\n            success  : function (data, status, xhr) {\n                w2utils.settings = $.extend(true, w2utils.settings, data);\n                // apply translation to some prototype functions\n                var p = w2obj.grid.prototype;\n                for (var b in p.buttons) {\n                    p.buttons[b].caption = w2utils.lang(p.buttons[b].caption);\n                    p.buttons[b].hint    = w2utils.lang(p.buttons[b].hint);\n                }\n                p.msgDelete  = w2utils.lang(p.msgDelete);\n                p.msgNotJSON = w2utils.lang(p.msgNotJSON);\n                p.msgRefresh = w2utils.lang(p.msgRefresh);\n            },\n            error    : function (xhr, status, msg) {\n                console.log('ERROR: Cannot load locale '+ locale);\n            }\n        });\n    }\n\n    function scrollBarSize () {\n        if (tmp.scrollBarSize) return tmp.scrollBarSize;\n        var html =\n            '<div id=\"_scrollbar_width\" style=\"position: absolute; top: -300px; width: 100px; height: 100px; overflow-y: scroll;\">'+\n            '    <div style=\"height: 120px\">1</div>'+\n            '</div>';\n        $('body').append(html);\n        tmp.scrollBarSize = 100 - $('#_scrollbar_width > div').width();\n        $('#_scrollbar_width').remove();\n        if (String(navigator.userAgent).indexOf('MSIE') >= 0) tmp.scrollBarSize  = tmp.scrollBarSize / 2; // need this for IE9+\n        return tmp.scrollBarSize;\n    }\n\n\n    function checkName (params, component) { // was w2checkNameParam\n        if (!params || typeof params.name === 'undefined') {\n            console.log('ERROR: The parameter \"name\" is required but not supplied in $().'+ component +'().');\n            return false;\n        }\n        if (typeof w2ui[params.name] !== 'undefined') {\n            console.log('ERROR: The parameter \"name\" is not unique. There are other objects already created with the same name (obj: '+ params.name +').');\n            return false;\n        }\n        if (!w2utils.isAlphaNumeric(params.name)) {\n            console.log('ERROR: The parameter \"name\" has to be alpha-numeric (a-z, 0-9, dash and underscore). ');\n            return false;\n        }\n        return true;\n    }\n\n    function checkUniqueId (id, items, itemsDecription, objName) { // was w2checkUniqueId\n        if (!$.isArray(items)) items = [items];\n        for (var i = 0; i < items.length; i++) {\n            if (items[i].id === id) {\n                console.log('ERROR: The parameter \"id='+ id +'\" is not unique within the current '+ itemsDecription +'. (obj: '+ objName +')');\n                return false;\n            }\n        }\n        return true;\n    }\n\n    function parseRoute(route) {\n        var keys = [];\n        var path = route\n            .replace(/\\/\\(/g, '(?:/')\n            .replace(/\\+/g, '__plus__')\n            .replace(/(\\/)?(\\.)?:(\\w+)(?:(\\(.*?\\)))?(\\?)?/g, function(_, slash, format, key, capture, optional) {\n                keys.push({ name: key, optional: !! optional });\n                slash = slash || '';\n                return '' + (optional ? '' : slash) + '(?:' + (optional ? slash : '') + (format || '') + (capture || (format && '([^/.]+?)' || '([^/]+?)')) + ')' + (optional || '');\n            })\n            .replace(/([\\/.])/g, '\\\\$1')\n            .replace(/__plus__/g, '(.+)')\n            .replace(/\\*/g, '(.*)');\n        return {\n            path  : new RegExp('^' + path + '$', 'i'),\n            keys  : keys\n        };\n    }\n})();\n\n/***********************************************************\n*  Generic Event Object\n*  --- This object is reused across all other\n*  --- widgets in w2ui.\n*\n*********************************************************/\n\nw2utils.event = {\n\n    on: function (eventData, handler) {\n        if (!$.isPlainObject(eventData)) eventData = { type: eventData };\n        eventData = $.extend({ type: null, execute: 'before', target: null, onComplete: null }, eventData);\n\n        if (!eventData.type) { console.log('ERROR: You must specify event type when calling .on() method of '+ this.name); return; }\n        if (!handler) { console.log('ERROR: You must specify event handler function when calling .on() method of '+ this.name); return; }\n        if (!$.isArray(this.handlers)) this.handlers = [];\n        this.handlers.push({ event: eventData, handler: handler });\n    },\n\n    off: function (eventData, handler) {\n        if (!$.isPlainObject(eventData)) eventData = { type: eventData };\n        eventData = $.extend({}, { type: null, execute: 'before', target: null, onComplete: null }, eventData);\n\n        if (!eventData.type) { console.log('ERROR: You must specify event type when calling .off() method of '+ this.name); return; }\n        if (!handler) { handler = null; }\n        // remove handlers\n        var newHandlers = [];\n        for (var h = 0, len = this.handlers.length; h < len; h++) {\n            var t = this.handlers[h];\n            if ((t.event.type === eventData.type || eventData.type === '*') &&\n                (t.event.target === eventData.target || eventData.target === null) &&\n                (t.handler === handler || handler === null))\n            {\n                // match\n            } else {\n                newHandlers.push(t);\n            }\n        }\n        this.handlers = newHandlers;\n    },\n\n    trigger: function (eventData) {\n        var eventData = $.extend({ type: null, phase: 'before', target: null }, eventData, {\n            isStopped: false, isCancelled: false,\n            preventDefault  : function () { this.isCancelled = true; },\n            stopPropagation : function () { this.isStopped   = true; }\n        });\n        if (eventData.phase === 'before') eventData.onComplete = null;\n        var args, fun, tmp;\n        if (eventData.target == null) eventData.target = null;\n        if (!$.isArray(this.handlers)) this.handlers = [];\n        // process events in REVERSE order\n        for (var h = this.handlers.length-1; h >= 0; h--) {\n            var item = this.handlers[h];\n            if ((item.event.type === eventData.type || item.event.type === '*') &&\n                (item.event.target === eventData.target || item.event.target === null) &&\n                (item.event.execute === eventData.phase || item.event.execute === '*' || item.event.phase === '*'))\n            {\n                eventData = $.extend({}, item.event, eventData);\n                // check handler arguments\n                args = [];\n                tmp  = RegExp(/\\((.*?)\\)/).exec(item.handler);\n                if (tmp) args = tmp[1].split(/\\s*,\\s*/);\n                if (args.length === 2) {\n                    item.handler.call(this, eventData.target, eventData); // old way for back compatibility\n                } else {\n                    item.handler.call(this, eventData); // new way\n                }\n                if (eventData.isStopped === true || eventData.stop === true) return eventData; // back compatibility eventData.stop === true\n            }\n        }\n        // main object events\n        var funName = 'on' + eventData.type.substr(0,1).toUpperCase() + eventData.type.substr(1);\n        if (eventData.phase === 'before' && typeof this[funName] === 'function') {\n            fun = this[funName];\n            // check handler arguments\n            args = [];\n            tmp  = RegExp(/\\((.*?)\\)/).exec(fun);\n            if (tmp) args = tmp[1].split(/\\s*,\\s*/);\n            if (args.length === 2) {\n                fun.call(this, eventData.target, eventData); // old way for back compatibility\n            } else {\n                fun.call(this, eventData); // new way\n            }\n            if (eventData.isStopped === true || eventData.stop === true) return eventData; // back compatibility eventData.stop === true\n        }\n        // item object events\n        if (eventData.object != null && eventData.phase === 'before' &&\n            typeof eventData.object[funName] === 'function')\n        {\n            fun = eventData.object[funName];\n            // check handler arguments\n            args = [];\n            tmp  = RegExp(/\\((.*?)\\)/).exec(fun);\n            if (tmp) args = tmp[1].split(/\\s*,\\s*/);\n            if (args.length === 2) {\n                fun.call(this, eventData.target, eventData); // old way for back compatibility\n            } else {\n                fun.call(this, eventData); // new way\n            }\n            if (eventData.isStopped === true || eventData.stop === true) return eventData;\n        }\n        // execute onComplete\n        if (eventData.phase === 'after' && typeof eventData.onComplete === 'function') eventData.onComplete.call(this, eventData);\n\n        return eventData;\n    }\n};\n\n/***********************************************************\n*  Common Keyboard Handler. Supported in\n*  - grid\n*  - sidebar\n*  - popup\n*\n*********************************************************/\n\nw2utils.keyboard = (function (obj) {\n    // private scope\n    var w2ui_name = null;\n\n    obj.active    = active;\n    obj.clear     = clear;\n\n    init();\n    return obj;\n\n    function init() {\n        $(document).on('keydown', keydown);\n        $(document).on('mousedown', mousedown);\n    }\n\n    function keydown (event) {\n        var tag = event.target.tagName;\n        if ($.inArray(tag, ['INPUT', 'SELECT', 'TEXTAREA']) !== -1) return;\n        if ($(event.target).prop('contenteditable') === 'true') return;\n        if (!w2ui_name) return;\n        // pass to appropriate widget\n        if (w2ui[w2ui_name] && typeof w2ui[w2ui_name].keydown === 'function') {\n            w2ui[w2ui_name].keydown.call(w2ui[w2ui_name], event);\n        }\n    }\n\n    function mousedown (event) {\n        var tag = event.target.tagName;\n        var obj = $(event.target).parents('.w2ui-reset');\n        if (obj.length > 0) {\n            var name = obj.attr('name');\n            if (w2ui[name] && w2ui[name].keyboard) w2ui_name = name;\n        }\n    }\n\n    function active (new_w2ui_name) {\n        if (typeof new_w2ui_name !== 'undefined') w2ui_name = new_w2ui_name;\n        return w2ui_name;\n    }\n\n    function clear () {\n        w2ui_name = null;\n    }\n\n})({});\n\n/***********************************************************\n*  Commonly used plugins\n*  --- used primarily in grid and form\n*\n*********************************************************/\n\n(function () {\n\n    $.fn.w2render = function (name) {\n        if ($(this).length > 0) {\n            if (typeof name === 'string' && w2ui[name]) w2ui[name].render($(this)[0]);\n            if (typeof name === 'object') name.render($(this)[0]);\n        }\n    };\n\n    $.fn.w2destroy = function (name) {\n        if (!name && this.length > 0) name = this.attr('name');\n        if (typeof name === 'string' && w2ui[name]) w2ui[name].destroy();\n        if (typeof name === 'object') name.destroy();\n    };\n\n    $.fn.w2marker = function (str) {\n        if (str === '' || str == null) { // remove marker\n            return $(this).each(function (index, el) {\n                el.innerHTML = el.innerHTML.replace(/\\<span class=\\\"w2ui\\-marker\\\"\\>(.*)\\<\\/span\\>/ig, '$1'); // unmark\n            });\n        } else { // add marker\n            return $(this).each(function (index, el) {\n                if (typeof str === 'string') str = [str];\n                el.innerHTML = el.innerHTML.replace(/\\<span class=\\\"w2ui\\-marker\\\"\\>(.*)\\<\\/span\\>/ig, '$1'); // unmark\n                for (var s in str) {\n                    var tmp = str[s];\n                    if (typeof tmp !== 'string') tmp = String(tmp);\n                    // escape regex special chars\n                    tmp = tmp.replace(/[-[\\]{}()*+?.,\\\\^$|#\\s]/g, \"\\\\$&\").replace(/&/g, '&amp;').replace(/</g, '&gt;').replace(/>/g, '&lt;');\n                    var regex = new RegExp(tmp + '(?!([^<]+)?>)', \"gi\"); // only outside tags\n                    el.innerHTML = el.innerHTML.replace(regex, replaceValue);\n                }\n                function replaceValue(matched) { // mark new\n                    return '<span class=\"w2ui-marker\">' + matched + '</span>';\n                }\n            });\n        }\n    };\n\n    // -- w2tag - appears on the right side from element, there can be multiple on screen at a time\n\n    $.fn.w2tag = function (text, options) {\n        if (!$.isPlainObject(options)) options = {};\n        if (!$.isPlainObject(options.css)) options.css = {};\n        if (typeof options['class'] === 'undefined') options['class'] = '';\n        // remove all tags\n        if ($(this).length === 0) {\n            $('.w2ui-tag').each(function (index, elem) {\n                var opt = $(elem).data('options');\n                if (opt == null) opt = {};\n                $($(elem).data('taged-el')).removeClass( opt['class'] );\n                clearInterval($(elem).data('timer'));\n                $(elem).remove();\n            });\n            return;\n        }\n        return $(this).each(function (index, el) {\n            // show or hide tag\n            var tagOrigID = el.id;\n            var tagID = w2utils.escapeId(el.id);\n            if (text === '' || text == null) {\n                $('#w2ui-tag-'+tagID).css('opacity', 0);\n                setTimeout(function () {\n                    // remmove element\n                    clearInterval($('#w2ui-tag-'+tagID).data('timer'));\n                    $('#w2ui-tag-'+tagID).remove();\n                }, 300);\n            } else {\n                // remove elements\n                clearInterval($('#w2ui-tag-'+tagID).data('timer'));\n                $('#w2ui-tag-'+tagID).remove();\n                // insert\n                $('body').append(\n                    '<div id=\"w2ui-tag-'+ tagOrigID +'\" class=\"w2ui-tag '+ ($(el).parents('.w2ui-popup').length > 0 ? 'w2ui-tag-popup' : '') +\n                    '\" style=\"\"></div>');\n\n                var timer = setInterval(function () {\n                    // monitor if destroyed\n                    if ($(el).length === 0 || ($(el).offset().left === 0 && $(el).offset().top === 0)) {\n                        clearInterval($('#w2ui-tag-'+tagID).data('timer'));\n                        tmp_hide();\n                        return;\n                    }\n                    // monitor if moved\n                    if ($('#w2ui-tag-'+tagID).data('position') !== ($(el).offset().left + el.offsetWidth) + 'x' + $(el).offset().top) {\n                        $('#w2ui-tag-'+tagID).css({\n                            '-webkit-transition' : '.2s',\n                            '-moz-transition'    : '.2s',\n                            '-ms-transition'     : '.2s',\n                            '-o-transition'      : '.2s',\n                            left: ($(el).offset().left + el.offsetWidth) + 'px',\n                            top: $(el).offset().top + 'px'\n                        }).data('position', ($(el).offset().left + el.offsetWidth) + 'x' + $(el).offset().top);\n                    }\n                }, 100);\n                setTimeout(function () {\n                    if (!$(el).offset()) return;\n                    $('#w2ui-tag-'+tagID).css({\n                        opacity: '1',\n                        left: ($(el).offset().left + el.offsetWidth) + 'px',\n                        top: $(el).offset().top + 'px'\n                    }).html('<div style=\"margin-top: -2px 0px 0px -2px; white-space: nowrap;\"> <div class=\"w2ui-tag-body\">'+ text +'</div> </div>')\n                    .data('text', text)\n                    .data('taged-el', el)\n                    .data('options', options)\n                    .data('position', ($(el).offset().left + el.offsetWidth) + 'x' + $(el).offset().top)\n                    .data('timer', timer);\n                    $(el).off('keypress', tmp_hide).on('keypress', tmp_hide).off('change', tmp_hide).on('change', tmp_hide)\n                        .css(options.css).addClass(options['class']);\n                    if (typeof options.onShow === 'function') options.onShow();\n                }, 1);\n                var originalCSS = '';\n                if ($(el).length > 0) originalCSS = $(el)[0].style.cssText;\n                // bind event to hide it\n                function tmp_hide() {\n                    $tag = $('#w2ui-tag-'+tagID);\n                    if ($tag.length <= 0) return;\n                    clearInterval($tag.data('timer'));\n                    $tag.remove();\n                    $(el).off('keypress', tmp_hide).removeClass(options['class']);\n                    if ($(el).length > 0) $(el)[0].style.cssText = originalCSS;\n                    if (typeof options.onHide === 'function') options.onHide();\n                }\n            }\n        });\n    };\n\n    // w2overlay - appears under the element, there can be only one at a time\n\n    $.fn.w2overlay = function (html, options) {\n        var obj  = this;\n        var name = '';\n        var defaults = {\n            name      : null,      // it not null, then allows multiple concurent overlays\n            html      : '',        // html text to display\n            align     : 'none',    // can be none, left, right, both\n            left      : 0,         // offset left\n            top       : 0,         // offset top\n            tipLeft   : 30,        // tip offset left\n            width     : 0,         // fixed width\n            height    : 0,         // fixed height\n            maxWidth  : null,      // max width if any\n            maxHeight : null,      // max height if any\n            style     : '',        // additional style for main div\n            'class'   : '',        // additional class name for main div\n            onShow    : null,      // event on show\n            onHide    : null,      // event on hide\n            openAbove : false,     // show abover control\n            tmp       : {}\n        };\n        if (arguments.length == 1) {\n            if (typeof html == 'object') {\n                options = html; \n            } else {\n                options = { html: html };\n            }\n        }\n        if (arguments.length == 2) options.html = html;\n        if (!$.isPlainObject(options)) options = {};\n        options = $.extend({}, defaults, options);\n        if (options.name) name = '-' + options.name;\n        // if empty then hide\n        var tmp_hide;\n        if (this.length === 0 || options.html === '' || options.html == null) {\n            if ($('#w2ui-overlay'+ name).length > 0) {\n                tmp_hide = $('#w2ui-overlay'+ name)[0].hide;\n                if (typeof tmp_hide === 'function') tmp_hide();\n            } else {\n            $('#w2ui-overlay'+ name).remove();\n            }\n            return $(this);\n        }\n        if ($('#w2ui-overlay'+ name).length > 0) {\n            tmp_hide = $('#w2ui-overlay'+ name)[0].hide;\n            $(document).off('click', tmp_hide);\n            if (typeof tmp_hide === 'function') tmp_hide();\n        }\n        $('body').append(\n            '<div id=\"w2ui-overlay'+ name +'\" style=\"display: none\"'+\n            '        class=\"w2ui-reset w2ui-overlay '+ ($(this).parents('.w2ui-popup, .w2ui-overlay-popup').length > 0 ? 'w2ui-overlay-popup' : '') +'\">'+\n            '    <style></style>'+\n            '    <div style=\"'+ options.style +'\" class=\"'+ options['class'] +'\"></div>'+\n            '</div>'\n        );\n        // init\n        var div1 = $('#w2ui-overlay'+ name);\n        var div2 = div1.find(' > div');\n        div2.html(options.html);\n        // pick bg color of first div\n        var bc  = div2.css('background-color');\n        if (bc != null && bc !== 'rgba(0, 0, 0, 0)' && bc !== 'transparent') div1.css('background-color', bc);\n\n        div1.data('element', obj.length > 0 ? obj[0] : null)\n            .data('options', options)\n            .data('position', $(obj).offset().left + 'x' + $(obj).offset().top)\n            .fadeIn('fast').on('mousedown', function (event) {\n                $('#w2ui-overlay'+ name).data('keepOpen', true);\n                if (['INPUT', 'TEXTAREA', 'SELECT'].indexOf(event.target.tagName) === -1) event.preventDefault();\n            });\n        div1[0].hide    = hide;\n        div1[0].resize    = resize;\n\n        // need time to display\n        resize();\n        setTimeout(function () {\n            resize();\n            $(document).off('click', hide).on('click', hide);\n            if (typeof options.onShow === 'function') options.onShow();\n        }, 10);\n\n        monitor();\n        return $(this);\n\n        // monitor position\n        function monitor() {\n            var tmp = $('#w2ui-overlay'+ name);\n            if (tmp.data('element') !== obj[0]) return; // it if it different overlay\n            if (tmp.length === 0) return;\n            var pos = $(obj).offset().left + 'x' + $(obj).offset().top;\n            if (tmp.data('position') !== pos) {\n                hide();\n            } else {\n                setTimeout(monitor, 250);\n            }\n        }\n\n        // click anywhere else hides the drop down\n        function hide () {\n            var div1 = $('#w2ui-overlay'+ name);\n            if (div1.data('keepOpen') === true) {\n                div1.removeData('keepOpen');\n                return;\n            }\n            var result;\n            if (typeof options.onHide === 'function') result = options.onHide();\n            if (result === false) return;\n            div1.remove();\n            $(document).off('click', hide);\n            clearInterval(div1.data('timer'));\n        }\n\n        function resize () {\n            var div1 = $('#w2ui-overlay'+ name);\n            var div2 = div1.find(' > div');\n            // if goes over the screen, limit height and width\n            if (div1.length > 0) {\n                div2.height('auto').width('auto');\n                // width/height\n                var overflowX = false;\n                var overflowY = false;\n                var h = div2.height();\n                var w = div2.width();\n                if (options.width && options.width < w) w = options.width;\n                if (w < 30) w = 30;\n                // if content of specific height\n                if (options.tmp.contentHeight) {\n                    h = options.tmp.contentHeight;\n                    div2.height(h);\n                    setTimeout(function () {\n                        if (div2.height() > div2.find('div.menu > table').height()) {\n                            div2.find('div.menu').css('overflow-y', 'hidden');\n                        }\n                    }, 1);\n                    setTimeout(function () { div2.find('div.menu').css('overflow-y', 'auto'); }, 10);\n                }\n                if (options.tmp.contentWidth) {\n                    w = options.tmp.contentWidth;\n                    div2.width(w);\n                    setTimeout(function () {\n                        if (div2.width() > div2.find('div.menu > table').width()) {\n                            div2.find('div.menu').css('overflow-x', 'hidden');\n                        }\n                    }, 1);\n                    setTimeout(function () { div2.find('div.menu').css('overflow-y', 'auto'); }, 10);\n                }\n                // alignment\n                switch (options.align) {\n                    case 'both':\n                        options.left = 17;\n                        if (options.width === 0) options.width = w2utils.getSize($(obj), 'width');\n                        break;\n                    case 'left':\n                        options.left = 17;\n                        break;\n                    case 'right':\n                        options.tipLeft = w - 45;\n                        options.left = w2utils.getSize($(obj), 'width') - w + 10;\n                        break;\n                }\n                // adjust position\n                var tmp = (w - 17) / 2;\n                var boxLeft  = options.left;\n                var boxWidth = options.width;\n                var tipLeft  = options.tipLeft;\n                if (w === 30 && !boxWidth) boxWidth = 30; else boxWidth = (options.width ? options.width : 'auto');\n                if (tmp < 25) {\n                    boxLeft = 25 - tmp;\n                    tipLeft = Math.floor(tmp);\n                }\n                // Y coord\n                div1.css({\n                    top         : (obj.offset().top + w2utils.getSize(obj, 'height') + options.top + 7) + 'px',\n                    left        : ((obj.offset().left > 25 ? obj.offset().left : 25) + boxLeft) + 'px',\n                    'min-width' : boxWidth,\n                    'min-height': (options.height ? options.height : 'auto')\n                });\n                // $(window).height() - has a problem in FF20\n                var maxHeight = window.innerHeight + $(document).scrollTop() - div2.offset().top - 7;\n                var maxWidth  = window.innerWidth + $(document).scrollLeft() - div2.offset().left - 7;\n                if ((maxHeight > -50 && maxHeight < 210) || options.openAbove === true) {\n                    // show on top\n                    maxHeight = div2.offset().top - $(document).scrollTop() - 7;\n                    if (options.maxHeight && maxHeight > options.maxHeight) maxHeight = options.maxHeight;\n                    if (h > maxHeight) {\n                        overflowY = true;\n                        div2.height(maxHeight).width(w).css({ 'overflow-y': 'auto' });\n                        h = maxHeight;\n                    }\n                    div1.css('top', ($(obj).offset().top - h - 24 + options.top) + 'px');\n                    div1.find('>style').html(\n                        '#w2ui-overlay'+ name +':before { display: none; margin-left: '+ parseInt(tipLeft) +'px; }'+\n                        '#w2ui-overlay'+ name +':after { display: block; margin-left: '+ parseInt(tipLeft) +'px; }'\n                    );\n                } else {\n                    // show under\n                    if (options.maxHeight && maxHeight > options.maxHeight) maxHeight = options.maxHeight;\n                    if (h > maxHeight) {\n                        overflowY = true;\n                        div2.height(maxHeight).width(w).css({ 'overflow-y': 'auto' });\n                    }\n                    div1.find('>style').html(\n                        '#w2ui-overlay'+ name +':before { display: block; margin-left: '+ parseInt(tipLeft) +'px; }'+\n                        '#w2ui-overlay'+ name +':after { display: none; margin-left: '+ parseInt(tipLeft) +'px; }'\n                    );\n                }\n                // check width\n                w = div2.width();\n                maxWidth = window.innerWidth + $(document).scrollLeft() - div2.offset().left - 7;\n                if (options.maxWidth && maxWidth > options.maxWidth) maxWidth = options.maxWidth;\n                if (w > maxWidth && options.align !== 'both') {\n                    options.align = 'right';\n                    setTimeout(function () { resize(); }, 1);\n                }\n                // check scroll bar\n                if (overflowY && overflowX) div2.width(w + w2utils.scrollBarSize() + 2);\n            }\n        }\n    };\n\n    $.fn.w2menu = function (menu, options) {\n        /*\n        ITEM STRUCTURE\n            item : {\n                id       : null,\n                text     : '',\n                style    : '',\n                img      : '',\n                icon     : '',\n                count    : '',\n                hidden   : false,\n                disabled : false\n                ...\n            }\n        */\n        var defaults = {\n            index      : null,        // current selected\n            items      : [],\n            render     : null,\n            msgNoItems : 'No items',\n            onSelect   : null,\n            tmp        : {}\n        };\n        var obj  = this;\n        var name = '';\n        if (menu === 'refresh') {\n            // if not show - call blur\n            if ($('#w2ui-overlay'+ name).length > 0) {\n                options = $.extend($.fn.w2menuOptions, options);\n                var scrTop = $('#w2ui-overlay'+ name +' div.menu').scrollTop();\n                $('#w2ui-overlay'+ name +' div.menu').html(getMenuHTML());\n                $('#w2ui-overlay'+ name +' div.menu').scrollTop(scrTop);\n                mresize();\n            } else {\n                $(this).w2menu(options);\n            }\n        } else {\n            if (arguments.length === 1) options = menu; else options.items = menu;\n            if (typeof options !== 'object') options = {};\n            options = $.extend({}, defaults, options);\n            $.fn.w2menuOptions = options;\n            if (options.name) name = '-' + options.name;\n            if (typeof options.select === 'function' && typeof options.onSelect !== 'function') options.onSelect = options.select;\n            if (typeof options.onRender === 'function' && typeof options.render !== 'function') options.render = options.onRender;\n            // since only one overlay can exist at a time\n            $.fn.w2menuHandler = function (event, index) {\n                if (typeof options.onSelect === 'function') {\n                    // need time so that menu first hides\n                    setTimeout(function () {\n                        options.onSelect({\n                            index : index,\n                            item  : options.items[index],\n                            originalEvent: event\n                        });\n                    }, 10);\n                }\n                // do not uncomment (enum in grid search will not work)\n                // setTimeout(function () { $(document).click(); }, 50);\n            };\n            var html = '';\n            if (options.search) {\n                html +=\n                    '<div style=\"position: absolute; top: 0px; height: 40px; left: 0px; right: 0px; border-bottom: 1px solid silver; background-color: #ECECEC; padding: 8px 5px;\">'+\n                    '    <div class=\"w2ui-icon icon-search\" style=\"position: absolute; margin-top: 4px; margin-left: 6px; width: 11px; background-position: left !important;\"></div>'+\n                    '    <input id=\"menu-search\" type=\"text\" style=\"width: 100%; outline: none; padding-left: 20px;\" onclick=\"event.stopPropagation();\">'+\n                    '</div>';\n                options.style += ';background-color: #ECECEC';\n                options.index = 0;\n                for (var i in options.items) options.items[i].hidden = false;\n            }\n            html += '<div class=\"menu\" style=\"position: absolute; top: '+ (options.search ? 40 : 0) + 'px; bottom: 0px; width: 100%; overflow: auto;\">' +\n                        getMenuHTML() +\n                    '</div>';\n            var ret = $(this).w2overlay(html, options);\n            setTimeout(function () {\n                $('#w2ui-overlay'+ name +' #menu-search')\n                    .on('keyup', change)\n                    .on('keydown', function (event) {\n                        // cancel tab key\n                        if (event.keyCode === 9) { event.stopPropagation(); event.preventDefault(); }\n                    });\n                if (options.search) {\n                    if (['text', 'password'].indexOf($(obj)[0].type) != -1 || $(obj)[0].tagName == 'texarea') return;\n                    $('#w2ui-overlay'+ name +' #menu-search').focus();                    \n                }\n            }, 200);\n            mresize();\n            return ret;\n        }\n\n        function mresize() {\n            setTimeout(function () {\n                // show selected\n                $('#w2ui-overlay'+ name +' tr.w2ui-selected').removeClass('w2ui-selected');\n                var cur        = $('#w2ui-overlay'+ name +' tr[index='+ options.index +']');\n                var scrTop    = $('#w2ui-overlay'+ name +' div.menu').scrollTop();\n                cur.addClass('w2ui-selected');\n                if (options.tmp) options.tmp.contentHeight = $('#w2ui-overlay'+ name +' table').height() + (options.search ? 50 : 10);\n                if (options.tmp) options.tmp.contentWidth  = $('#w2ui-overlay'+ name +' table').width();\n                if ($('#w2ui-overlay'+ name).length > 0) $('#w2ui-overlay'+ name)[0].resize();\n                // scroll into view\n                if (cur.length > 0) {\n                    var top    = cur[0].offsetTop - 5; // 5 is margin top\n                    var el     = $('#w2ui-overlay'+ name +' div.menu');\n                    var height = el.height();\n                    $('#w2ui-overlay'+ name +' div.menu').scrollTop(scrTop);\n                    if (top < scrTop || top + cur.height() > scrTop + height) {\n                        $('#w2ui-overlay'+ name +' div.menu').animate({ 'scrollTop': top - (height - cur.height() * 2) / 2 }, 200, 'linear');\n                    }\n                }\n            }, 1);\n        }\n\n        function change(event) {\n            var search  = this.value;\n            var key     = event.keyCode;\n            var cancel  = false;\n            switch (key) {\n                case 13: // enter\n                    $('#w2ui-overlay'+ name).remove();\n                    $.fn.w2menuHandler(event, options.index);\n                    break;\n                case 9:  // tab\n                case 27: // escape\n                    $('#w2ui-overlay'+ name).remove();\n                    $.fn.w2menuHandler(event, -1);\n                    break;\n                case 38: // up\n                    options.index = w2utils.isInt(options.index) ? parseInt(options.index) : 0;\n                    options.index--;\n                    while (options.index > 0 && options.items[options.index].hidden) options.index--;\n                    if (options.index === 0 && options.items[options.index].hidden) {\n                        while (options.items[options.index] && options.items[options.index].hidden) options.index++;\n                    }\n                    if (options.index < 0) options.index = 0;\n                    cancel = true;\n                    break;\n                case 40: // down\n                    options.index = w2utils.isInt(options.index) ? parseInt(options.index) : 0;\n                    options.index++;\n                    while (options.index < options.items.length-1 && options.items[options.index].hidden) options.index++;\n                    if (options.index === options.items.length-1 && options.items[options.index].hidden) {\n                        while (options.items[options.index] && options.items[options.index].hidden) options.index--;\n                    }\n                    if (options.index >= options.items.length) options.index = options.items.length - 1;\n                    cancel = true;\n                    break;\n            }\n            // filter\n            if (!cancel) {\n                var shown  = 0;\n                for (var i in options.items) {\n                    var item = options.items[i];\n                    var prefix = '';\n                    var suffix = '';\n                    if (['is', 'begins with'].indexOf(options.match) !== -1) prefix = '^';\n                    if (['is', 'ends with'].indexOf(options.match) !== -1) suffix = '$';\n                    try {\n                        var re = new RegExp(prefix + search + suffix, 'i');\n                        if (re.test(item.text) || item.text === '...') item.hidden = false; else item.hidden = true;\n                    } catch (e) {}\n                    // do not show selected items\n                    if (obj.type === 'enum' && $.inArray(item.id, ids) !== -1) item.hidden = true;\n                    if (item.hidden !== true) shown++;\n                }\n                options.index = 0;\n                while (options.index < options.items.length-1 && options.items[options.index].hidden) options.index++;\n                if (shown <= 0) options.index = -1;\n            }\n            $(obj).w2menu('refresh', options);\n            mresize();\n        }\n\n        function getMenuHTML () {\n            if (options.spinner) {\n                return  '<table class=\"w2ui-drop-menu\"><tr><td style=\"padding: 5px 10px 10px 10px; text-align: center\">'+\n                        '    <div class=\"w2ui-spinner\" style=\"width: 18px; height: 18px; position: relative; top: 5px;\"></div> '+\n                        '    <div style=\"display: inline-block; padding: 3px; color: #999;\">'+ w2utils.lang('Loading...') +'</div>'+\n                        '</td></tr></table>';\n            }\n            var count        = 0;\n            var menu_html    = '<table cellspacing=\"0\" cellpadding=\"0\" class=\"w2ui-drop-menu\">';\n            var img = null, icon = null;\n            for (var f = 0; f < options.items.length; f++) {\n                var mitem = options.items[f];\n                if (typeof mitem === 'string') {\n                    mitem = { id: mitem, text: mitem };\n                } else {\n                    if (mitem.text != null && mitem.id == null) mitem.id = mitem.text;\n                    if (mitem.text == null && mitem.id != null) mitem.text = mitem.id;\n                    if (mitem.caption != null) mitem.text = mitem.caption;\n                    img  = mitem.img;\n                    icon = mitem.icon;\n                    if (img  == null) img  = null;\n                    if (icon == null) icon = null;\n                }\n                if (mitem.hidden !== true) {\n                    var imgd = '';\n                    var txt = mitem.text;\n                    if (typeof options.render === 'function') txt = options.render(mitem, options);\n                    if (img)  imgd = '<td class=\"menu-icon\"><div class=\"w2ui-tb-image w2ui-icon '+ img +'\"></div></td>';\n                    if (icon) imgd = '<td class=\"menu-icon\" align=\"center\"><span class=\"w2ui-icon '+ icon +'\"></span></td>';\n                    // render only if non-empty\n                    if (typeof txt !== 'undefined' && txt !== '' && !(/^-+$/.test(txt))) {\n                        var bg = (count % 2 === 0 ? 'w2ui-item-even' : 'w2ui-item-odd');\n                        if (options.altRows !== true) bg = '';\n                        var colspan = 1;\n                        if (imgd == '') colspan++;\n                        if (mitem.count == null) colspan++;\n                        menu_html +=\n                            '<tr index=\"'+ f + '\" style=\"'+ (mitem.style ? mitem.style : '') +'\" '+\n                            '        class=\"'+ bg +' '+ (options.index === f ? 'w2ui-selected' : '') + ' ' + (mitem.disabled === true ? 'w2ui-disabled' : '') +'\"'+\n                            '        onmousedown=\"$(this).parent().find(\\'tr\\').removeClass(\\'w2ui-selected\\'); $(this).addClass(\\'w2ui-selected\\');\"'+\n                            '        onclick=\"event.stopPropagation(); '+\n                            '               if ('+ (mitem.disabled === true ? 'true' : 'false') + ') return;'+\n                            '               $(\\'#w2ui-overlay'+ name +'\\').remove(); '+\n                            '               $.fn.w2menuHandler(event, \\''+ f +'\\');\">'+\n                                imgd +\n                            '   <td class=\"menu-text\" colspan=\"'+ colspan +'\">'+ txt +'</td>'+\n                            '   <td class=\"menu-count\">'+ (mitem.count != null ? '<span>' + mitem.count + '</span>' : '') + '</td>' +\n                            '</tr>';\n                        count++;\n                    } else {\n                        // horizontal line\n                        menu_html += '<tr><td colspan=\"2\" style=\"padding: 6px; pointer-events: none\"><div style=\"border-top: 1px solid silver;\"></div></td></tr>';\n                    }\n                }\n                options.items[f] = mitem;\n            }\n            if (count === 0) {\n                menu_html += '<tr><td style=\"padding: 13px; color: #999; text-align: center\">'+ options.msgNoItems +'</div></td></tr>';\n            }\n            menu_html += \"</table>\";\n            return menu_html;\n        }\n    };\n})();\n\n\n/************************************************************************\n*   Library: Web 2.0 UI for jQuery (using prototypical inheritance)\n*   - Following objects defined\n*        - w2grid        - grid widget\n*        - $().w2grid    - jQuery wrapper\n*   - Dependencies: jQuery, w2utils, w2toolbar, w2fields, w2alert, w2confirm\n*\n* == NICE TO HAVE == \n*   - frozen columns\n*   - add colspans\n*   - allow this.total to be unknown (-1)\n*   - column autosize based on largest content\n*   - easy bubbles in the grid\n*   - More than 2 layers of header groups\n*   - reorder columns/records\n*   - hidden searches could not be clearned by the user\n*   - problem with .set() and arrays, array get extended too, but should be replaced\n*   - move events into prototype\n*   - add grid.focus()\n*   - add showExtra, KickIn Infinite scroll when so many records\n*   - after edit stay on the same record option\n*   - allow render: function to be filters\n*\n************************************************************************/\n\n(function () {\n    var w2grid = function(options) {\n\n        // public properties\n        this.name         = null;\n        this.box          = null;     // HTML element that hold this element\n        this.header       = '';\n        this.url          = '';\n        this.routeData    = {};       // data for dynamic routes\n        this.columns      = [];       // { field, caption, size, attr, render, hidden, gridMinWidth, editable }\n        this.columnGroups = [];       // { span: int, caption: 'string', master: true/false }\n        this.records      = [];       // { recid: int(requied), field1: 'value1', ... fieldN: 'valueN', style: 'string', editable: true/false, summary: true/false, changes: object }\n        this.summary      = [];       // arry of summary records, same structure as records array\n        this.searches     = [];       // { type, caption, field, inTag, outTag, hidden }\n        this.searchData   = [];\n        this.sortData     = [];\n        this.postData     = {};\n        this.toolbar      = {};       // if not empty object; then it is toolbar object\n\n        this.show = {\n            header          : false,\n            toolbar         : false,\n            footer          : false,\n            columnHeaders   : true,\n            lineNumbers     : false,\n            expandColumn    : false,\n            selectColumn    : false,\n            emptyRecords    : true,\n            toolbarReload   : true,\n            toolbarColumns  : true,\n            toolbarSearch   : true,\n            toolbarAdd      : false,\n            toolbarEdit     : false,\n            toolbarDelete   : false,\n            toolbarSave     : false,\n            selectionBorder : true,\n            recordTitles    : true,\n            skipRecords     : true\n        };\n\n        this.autoLoad       = true;     // for infinite scroll\n        this.fixedBody      = true;     // if false; then grid grows with data\n        this.recordHeight   = 24;\n        this.keyboard       = true;\n        this.selectType     = 'row';    // can be row|cell\n        this.multiSearch    = true;\n        this.multiSelect    = true;\n        this.multiSort      = true;\n        this.reorderColumns = false;\n        this.reorderRows    = false;\n        this.markSearch     = true;\n\n        this.total   = 0;     // server total\n        this.limit   = 100;\n        this.offset  = 0;     // how many records to skip (for infinite scroll) when pulling from server\n        this.style   = '';\n        this.ranges  = [];\n        this.menu    = [];\n        this.method  = null;         // if defined, then overwrited ajax method\n        this.recid   = null;\n        this.parser  = null;\n\n        // events\n        this.onAdd              = null;\n        this.onEdit             = null;\n        this.onRequest          = null;        // called on any server event\n        this.onLoad             = null;\n        this.onDelete           = null;\n        this.onDeleted          = null;\n        this.onSubmit           = null;\n        this.onSave             = null;\n        this.onSelect           = null;\n        this.onUnselect         = null;\n        this.onClick            = null;\n        this.onDblClick         = null;\n        this.onContextMenu      = null;\n        this.onMenuClick        = null;        // when context menu item selected\n        this.onColumnClick      = null;\n        this.onColumnResize     = null;\n        this.onSort             = null;\n        this.onSearch           = null;\n        this.onChange           = null;        // called when editable record is changed\n        this.onRestore          = null;        // called when editable record is restored\n        this.onExpand           = null;\n        this.onCollapse         = null;\n        this.onError            = null;\n        this.onKeydown          = null;\n        this.onToolbar          = null;     // all events from toolbar\n        this.onColumnOnOff      = null;\n        this.onCopy             = null;\n        this.onPaste            = null;\n        this.onSelectionExtend  = null;\n        this.onEditField        = null;\n        this.onRender           = null;\n        this.onRefresh          = null;\n        this.onReload           = null;\n        this.onResize           = null;\n        this.onDestroy          = null;\n        this.onStateSave        = null;\n        this.onStateRestore     = null;\n\n        // internal\n        this.last = {\n            field     : 'all',\n            caption   : w2utils.lang('All Fields'),\n            logic     : 'OR',\n            search    : '',\n            searchIds : [],\n            selection : {\n                indexes : [],\n                columns : {}\n            },\n            multi       : false,\n            scrollTop   : 0,\n            scrollLeft  : 0,\n            sortData    : null,\n            sortCount   : 0,\n            xhr         : null,\n            range_start : null,\n            range_end   : null,\n            sel_ind     : null,\n            sel_col     : null,\n            sel_type    : null,\n            edit_col    : null\n        };\n\n        $.extend(true, this, w2obj.grid, options);\n    };\n\n    // ====================================================\n    // -- Registers as a jQuery plugin\n\n    $.fn.w2grid = function(method) {\n        if (typeof method === 'object' || !method ) {\n            // check name parameter\n            if (!w2utils.checkName(method, 'w2grid')) return;\n            // remember items\n            var columns      = method.columns;\n            var columnGroups = method.columnGroups;\n            var records      = method.records;\n            var searches     = method.searches;\n            var searchData   = method.searchData;\n            var sortData     = method.sortData;\n            var postData     = method.postData;\n            var toolbar      = method.toolbar;\n            // extend items\n            var object = new w2grid(method);\n            $.extend(object, { postData: {}, records: [], columns: [], searches: [], toolbar: {}, sortData: [], searchData: [], handlers: [] });\n            if (object.onExpand != null) object.show.expandColumn = true;\n            $.extend(true, object.toolbar, toolbar);\n            // reassign variables\n            for (var p in columns)      object.columns[p]       = $.extend(true, {}, columns[p]);\n            for (var p in columnGroups) object.columnGroups[p]  = $.extend(true, {}, columnGroups[p]);\n            for (var p in searches)     object.searches[p]      = $.extend(true, {}, searches[p]);\n            for (var p in searchData)   object.searchData[p]    = $.extend(true, {}, searchData[p]);\n            for (var p in sortData)     object.sortData[p]      = $.extend(true, {}, sortData[p]);\n            object.postData = $.extend(true, {}, postData);\n\n            // check if there are records without recid\n            for (var r in records) {\n                if (records[r].recid == null || typeof records[r].recid == 'undefined') {\n                    console.log('ERROR: Cannot add records without recid. (obj: '+ object.name +')');\n                    return;\n                }\n                object.records[r] = $.extend(true, {}, records[r]);\n            }\n            // add searches\n            for (var c in object.columns) {\n                var col = object.columns[c];\n                if (typeof col.searchable == 'undefined' || object.getSearch(col.field) != null) continue;\n                var stype = col.searchable;\n                var attr  = '';\n                if (col.searchable === true) { stype = 'text'; attr = 'size=\"20\"'; }\n                object.addSearch({ field: col.field, caption: col.caption, type: stype, attr: attr });\n            }\n            // init toolbar\n            object.initToolbar();\n            // render if necessary\n            if ($(this).length !== 0) {\n                object.render($(this)[0]);\n            }\n            // register new object\n            w2ui[object.name] = object;\n            return object;\n\n        } else if (w2ui[$(this).attr('name')]) {\n            var obj = w2ui[$(this).attr('name')];\n            obj[method].apply(obj, Array.prototype.slice.call(arguments, 1));\n            return this;\n        } else {\n            console.log('ERROR: Method ' +  method + ' does not exist on jQuery.w2grid');\n        }\n    }\n\n    // ====================================================\n    // -- Implementation of core functionality\n\n    w2grid.prototype = {\n        // ----\n        // properties that need to be in prototype\n\n        msgDelete       : w2utils.lang('Are you sure you want to delete selected records?'),\n        msgNotJSON      : w2utils.lang('Returned data is not in valid JSON format.'),\n        msgAJAXerror    : w2utils.lang('AJAX error. See console for more details.'),\n        msgRefresh      : w2utils.lang('Refreshing...'),\n\n        // for easy button overwrite\n        buttons: {\n            'reload'   : { type: 'button', id: 'w2ui-reload', icon: 'w2ui-icon-reload', hint: w2utils.lang('Reload data in the list') },\n            'columns'  : { type: 'drop', id: 'w2ui-column-on-off', icon: 'w2ui-icon-columns', hint: w2utils.lang('Show/hide columns'), arrow: false, html: '' },\n            'search'   : { type: 'html',   id: 'w2ui-search',\n                            html: '<div class=\"w2ui-icon icon-search-down w2ui-search-down\" title=\"'+ 'Select Search Field' +'\" '+\n                                  'onclick=\"var obj = w2ui[$(this).parents(\\'div.w2ui-grid\\').attr(\\'name\\')]; obj.searchShowFields();\"></div>'\n                          },\n            'search-go': { type: 'check',  id: 'w2ui-search-advanced', caption: w2utils.lang('Search...'), hint: w2utils.lang('Open Search Fields') },\n            'add'      : { type: 'button', id: 'w2ui-add', caption: w2utils.lang('Add New'), hint: w2utils.lang('Add new record'), icon: 'w2ui-icon-plus' },\n            'edit'     : { type: 'button', id: 'w2ui-edit', caption: w2utils.lang('Edit'), hint: w2utils.lang('Edit selected record'), icon: 'w2ui-icon-pencil', disabled: true },\n            'delete'   : { type: 'button', id: 'w2ui-delete', caption: w2utils.lang('Delete'), hint: w2utils.lang('Delete selected records'), icon: 'w2ui-icon-cross', disabled: true },\n            'save'     : { type: 'button', id: 'w2ui-save', caption: w2utils.lang('Save'), hint: w2utils.lang('Save changed records'), icon: 'w2ui-icon-check' }\n        },\n\n        add: function (record) {\n            if (!$.isArray(record)) record = [record];\n            var added = 0;\n            for (var o in record) {\n                if (this.recid && typeof record[o].recid == 'undefined') record[o].recid = record[o][this.recid];\n                if (record[o].recid == null || typeof record[o].recid == 'undefined') {\n                    console.log('ERROR: Cannot add record without recid. (obj: '+ this.name +')');\n                    continue;\n                }\n                this.records.push(record[o]);\n                added++;\n            }\n            var url = (typeof this.url != 'object' ? this.url : this.url.get);\n            if (!url) {\n                this.total = this.records.length;\n                this.localSort();\n                this.localSearch();\n            }\n            this.refresh(); // ??  should it be reload?\n            return added;\n        },\n\n        find: function (obj, returnIndex) {\n            if (typeof obj == 'undefined' || obj == null) obj = {};\n            var recs    = [];\n            var hasDots    = false;\n            // check if property is nested - needed for speed\n            for (var o in obj) if (String(o).indexOf('.') != -1) hasDots = true;\n            // look for an item\n            for (var i = 0; i < this.records.length; i++) {\n                var match = true;\n                for (var o in obj) {\n                    var val = this.records[i][o];\n                    if (hasDots && String(o).indexOf('.') != -1) val = this.parseField(this.records[i], o);\n                    if (obj[o] != val) match = false;\n                }\n                if (match && returnIndex !== true) recs.push(this.records[i].recid);\n                if (match && returnIndex === true) recs.push(i);\n            }\n            return recs;\n        },\n\n        set: function (recid, record, noRefresh) { // does not delete existing, but overrides on top of it\n            if (typeof recid == 'object') {\n                noRefresh = record;\n                record    = recid;\n                recid     = null;\n            }\n            // update all records\n            if (recid == null) {\n                for (var r in this.records) {\n                    $.extend(true, this.records[r], record); // recid is the whole record\n                }\n                if (noRefresh !== true) this.refresh();\n            } else { // find record to update\n                var ind = this.get(recid, true);\n                if (ind == null) return false;\n                var isSummary = (this.records[ind] && this.records[ind].recid == recid ? false : true);\n                if (isSummary) {\n                    $.extend(true, this.summary[ind], record);\n                } else {\n                    $.extend(true, this.records[ind], record);\n                }\n                if (noRefresh !== true) this.refreshRow(recid); // refresh only that record\n            }\n            return true;\n        },\n\n        get: function (recid, returnIndex) {\n            // search records\n            for (var i = 0; i < this.records.length; i++) {\n                if (this.records[i].recid == recid) {\n                    if (returnIndex === true) return i; else return this.records[i];\n                }\n            }\n            // search summary\n            for (var i = 0; i < this.summary.length; i++) {\n                if (this.summary[i].recid == recid) {\n                    if (returnIndex === true) return i; else return this.summary[i];\n                }\n            }\n            return null;\n        },\n\n        remove: function () {\n            var removed = 0;\n            for (var a = 0; a < arguments.length; a++) {\n                for (var r = this.records.length-1; r >= 0; r--) {\n                    if (this.records[r].recid == arguments[a]) { this.records.splice(r, 1); removed++; }\n                }\n            }\n            var url = (typeof this.url != 'object' ? this.url : this.url.get);\n            if (!url) {\n                this.localSort();\n                this.localSearch();\n            }\n            this.refresh();\n            return removed;\n        },\n\n        addColumn: function (before, columns) {\n            var added = 0;\n            if (arguments.length == 1) {\n                columns = before;\n                before  = this.columns.length;\n            } else {\n                if (typeof before == 'string') before = this.getColumn(before, true);\n                if (before === null) before = this.columns.length;\n            }\n            if (!$.isArray(columns)) columns = [columns];\n            for (var o in columns) {\n                this.columns.splice(before, 0, columns[o]);\n                before++;\n                added++;\n            }\n            this.refresh();\n            return added;\n        },\n\n        removeColumn: function () {\n            var removed = 0;\n            for (var a = 0; a < arguments.length; a++) {\n                for (var r = this.columns.length-1; r >= 0; r--) {\n                    if (this.columns[r].field == arguments[a]) { this.columns.splice(r, 1); removed++; }\n                }\n            }\n            this.refresh();\n            return removed;\n        },\n\n        getColumn: function (field, returnIndex) {\n            for (var i = 0; i < this.columns.length; i++) {\n                if (this.columns[i].field == field) {\n                    if (returnIndex === true) return i; else return this.columns[i];\n                }\n            }\n            return null;\n        },\n\n        toggleColumn: function () {\n            var effected = 0;\n            for (var a = 0; a < arguments.length; a++) {\n                for (var r = this.columns.length-1; r >= 0; r--) {\n                    var col = this.columns[r];\n                    if (col.field == arguments[a]) {\n                        col.hidden = !col.hidden;\n                        effected++;\n                    }\n                }\n            }\n            this.refresh();\n            return effected;\n        },\n\n        showColumn: function () {\n            var shown = 0;\n            for (var a = 0; a < arguments.length; a++) {\n                for (var r = this.columns.length-1; r >= 0; r--) {\n                    var col = this.columns[r];\n                    if (col.gridMinWidth) delete col.gridMinWidth;\n                    if (col.field == arguments[a] && col.hidden !== false) {\n                        col.hidden = false;\n                        shown++;\n                    }\n                }\n            }\n            this.refresh();\n            return shown;\n        },\n\n        hideColumn: function () {\n            var hidden = 0;\n            for (var a = 0; a < arguments.length; a++) {\n                for (var r = this.columns.length-1; r >= 0; r--) {\n                    var col = this.columns[r];\n                    if (col.field == arguments[a] && col.hidden !== true) {\n                        col.hidden = true;\n                        hidden++;\n                    }\n                }\n            }\n            this.refresh();\n            return hidden;\n        },\n\n        addSearch: function (before, search) {\n            var added = 0;\n            if (arguments.length == 1) {\n                search = before;\n                before = this.searches.length;\n            } else {\n                if (typeof before == 'string') before = this.getSearch(before, true);\n                if (before === null) before = this.searches.length;\n            }\n            if (!$.isArray(search)) search = [search];\n            for (var o in search) {\n                this.searches.splice(before, 0, search[o]);\n                before++;\n                added++;\n            }\n            this.searchClose();\n            return added;\n        },\n\n        removeSearch: function () {\n            var removed = 0;\n            for (var a = 0; a < arguments.length; a++) {\n                for (var r = this.searches.length-1; r >= 0; r--) {\n                    if (this.searches[r].field == arguments[a]) { this.searches.splice(r, 1); removed++; }\n                }\n            }\n            this.searchClose();\n            return removed;\n        },\n\n        getSearch: function (field, returnIndex) {\n            for (var i = 0; i < this.searches.length; i++) {\n                if (this.searches[i].field == field) {\n                    if (returnIndex === true) return i; else return this.searches[i];\n                }\n            }\n            return null;\n        },\n\n        toggleSearch: function () {\n            var effected = 0;\n            for (var a = 0; a < arguments.length; a++) {\n                for (var r = this.searches.length-1; r >= 0; r--) {\n                    if (this.searches[r].field == arguments[a]) {\n                        this.searches[r].hidden = !this.searches[r].hidden;\n                        effected++;\n                    }\n                }\n            }\n            this.searchClose();\n            return effected;\n        },\n\n        showSearch: function () {\n            var shown = 0;\n            for (var a = 0; a < arguments.length; a++) {\n                for (var r = this.searches.length-1; r >= 0; r--) {\n                    if (this.searches[r].field == arguments[a] && this.searches[r].hidden !== false) {\n                        this.searches[r].hidden = false;\n                        shown++;\n                    }\n                }\n            }\n            this.searchClose();\n            return shown;\n        },\n\n        hideSearch: function () {\n            var hidden = 0;\n            for (var a = 0; a < arguments.length; a++) {\n                for (var r = this.searches.length-1; r >= 0; r--) {\n                    if (this.searches[r].field == arguments[a] && this.searches[r].hidden !== true) {\n                        this.searches[r].hidden = true;\n                        hidden++;\n                    }\n                }\n            }\n            this.searchClose();\n            return hidden;\n        },\n\n        getSearchData: function (field) {\n            for (var s in this.searchData) {\n                if (this.searchData[s].field == field) return this.searchData[s];\n            }\n            return null;\n        },\n\n        localSort: function (silent) {\n            var url = (typeof this.url != 'object' ? this.url : this.url.get);\n            if (url) {\n                console.log('ERROR: grid.localSort can only be used on local data source, grid.url should be empty.');\n                return;\n            }\n            if ($.isEmptyObject(this.sortData)) return;\n            var time = (new Date()).getTime();\n            var obj = this;\n            // process date fields\n            obj.prepareData();\n            // process sortData\n            for (var s in this.sortData) {\n                var column = this.getColumn(this.sortData[s].field); \n                if (!column) return;\n                if (typeof column.render == 'string') {\n                    if (['date', 'age'].indexOf(column.render.split(':')[0]) != -1) {\n                        this.sortData[s]['field_'] = column.field + '_';\n                    }\n                    if (['time'].indexOf(column.render.split(':')[0]) != -1) {\n                        this.sortData[s]['field_'] = column.field + '_';\n                    }\n                }\n            }\n            // process sort\n            this.records.sort(function (a, b) {\n                var ret = 0;\n                for (var s in obj.sortData) {\n                    var fld = obj.sortData[s].field;\n                    if (obj.sortData[s].field_) fld = obj.sortData[s].field_;\n                    var aa = a[fld];\n                    var bb = b[fld];\n                    if (String(fld).indexOf('.') != -1) {\n                        aa = obj.parseField(a, fld);\n                        bb = obj.parseField(b, fld);\n                    }\n                    if (typeof aa == 'string') aa = $.trim(aa.toLowerCase());\n                    if (typeof bb == 'string') bb = $.trim(bb.toLowerCase());\n                    if (aa > bb) ret = (obj.sortData[s].direction == 'asc' ? 1 : -1);\n                    if (aa < bb) ret = (obj.sortData[s].direction == 'asc' ? -1 : 1);\n                    if (typeof aa != 'object' && typeof bb == 'object') ret = -1;\n                    if (typeof bb != 'object' && typeof aa == 'object') ret = 1;\n                    if (aa == null && bb != null) ret = 1;    // all nuls and undefined on bottom\n                    if (aa != null && bb == null) ret = -1;\n                    if (ret != 0) break;\n                }\n                return ret;\n            });\n            time = (new Date()).getTime() - time;\n            if (silent !== true) setTimeout(function () { obj.status(w2utils.lang('Sorting took') + ' ' + time/1000 + ' ' + w2utils.lang('sec')); }, 10);\n            return time;\n        },\n\n        localSearch: function (silent) {\n            var url = (typeof this.url != 'object' ? this.url : this.url.get);\n            if (url) {\n                console.log('ERROR: grid.localSearch can only be used on local data source, grid.url should be empty.');\n                return;\n            }\n            var time = (new Date()).getTime();\n            var obj = this;\n            this.total = this.records.length;\n            // mark all records as shown\n            this.last.searchIds = [];\n            // prepare date/time fields\n            this.prepareData();\n            // hide records that did not match\n            if (this.searchData.length > 0 && !url) {\n                this.total = 0;\n                for (var r in this.records) {\n                    var rec = this.records[r];\n                    var fl  = 0;\n                    for (var s in this.searchData) {\n                        var sdata      = this.searchData[s];\n                        var search     = this.getSearch(sdata.field);\n                        if (sdata  == null) continue;\n                        if (search == null) search = { field: sdata.field, type: sdata.type };\n                        var val1 = String(obj.parseField(rec, search.field)).toLowerCase();\n                        if (typeof sdata.value != 'undefined') {\n                            if (!$.isArray(sdata.value)) {\n                                var val2 = String(sdata.value).toLowerCase();\n                            } else {\n                                var val2 = sdata.value[0];\n                                var val3 = sdata.value[1];\n                            }\n                        }\n                        switch (sdata.operator) {\n                            case 'is':\n                                 if (rec[search.field] == sdata.value) fl++; // do not hide record\n                                if (search.type == 'date') {\n                                    var val1 = w2utils.formatDate(rec[search.field + '_'], 'yyyy-mm-dd');\n                                    var val2 = w2utils.formatDate(val2, 'yyyy-mm-dd');\n                                    if (val1 == val2) fl++;\n                                }\n                                if (search.type == 'time') {\n                                    var val1 = w2utils.formatTime(rec[search.field + '_'], 'h24:mi');\n                                    var val2 = w2utils.formatTime(val2, 'h24:mi');\n                                    if (val1 == val2) fl++;\n                                }\n                                break;\n                            case 'between':\n                                if (['int', 'float', 'money', 'currency', 'percent'].indexOf(search.type) != -1) {\n                                    if (parseFloat(rec[search.field]) >= parseFloat(val2) && parseFloat(rec[search.field]) <= parseFloat(val3)) fl++;\n                                }\n                                if (search.type == 'date') {\n                                    var val1 = rec[search.field + '_'];\n                                    var val2 = w2utils.isDate(val2, w2utils.settings.date_format, true);\n                                    var val3 = w2utils.isDate(val3, w2utils.settings.date_format, true);\n                                    if (val3 != null) val3 = new Date(val3.getTime() + 86400000); // 1 day\n                                    if (val1 >= val2 && val1 < val3) fl++;\n                                }\n                                if (search.type == 'time') {\n                                    var val1 = rec[search.field + '_'];\n                                    var val2 = w2utils.isTime(val2, true);\n                                    var val3 = w2utils.isTime(val3, true);\n                                    val2 = (new Date()).setHours(val2.hours, val2.minutes, val2.seconds ? val2.seconds : 0, 0);\n                                    val3 = (new Date()).setHours(val3.hours, val3.minutes, val3.seconds ? val3.seconds : 0, 0);\n                                    if (val1 >= val2 && val1 < val3) fl++;\n                                }\n                                break;\n                            case 'in':\n                                var tmp = sdata.value;\n                                if (sdata.svalue) tmp = sdata.svalue;\n                                if (tmp.indexOf(val1) !== -1) fl++;\n                                break;\n                            case 'not in':\n                                var tmp = sdata.value;\n                                if (sdata.svalue) tmp = sdata.svalue;\n                                if (tmp.indexOf(val1) == -1) fl++;\n                                break;\n                            case 'begins':\n                            case 'begins with': // need for back compatib.\n                                if (val1.indexOf(val2) == 0) fl++; // do not hide record\n                                break;\n                            case 'contains':\n                                if (val1.indexOf(val2) >= 0) fl++; // do not hide record\n                                break;\n                            case 'ends':\n                            case 'ends with': // need for back compatib.\n                                if (val1.indexOf(val2) >= 0 && val1.indexOf(val2) == val1.length - val2.length) fl++; // do not hide record\n                                break;\n                        }\n                    }\n                    if ((this.last.logic == 'OR' && fl != 0) || (this.last.logic == 'AND' && fl == this.searchData.length)) this.last.searchIds.push(parseInt(r));\n                }\n                this.total = this.last.searchIds.length;\n            }\n            time = (new Date()).getTime() - time;\n            if (silent !== true) setTimeout(function () { obj.status(w2utils.lang('Search took') + ' ' + time/1000 + ' ' + w2utils.lang('sec')); }, 10);\n            return time;\n        },\n\n        getRangeData: function (range, extra) {\n            var rec1 = this.get(range[0].recid, true);\n            var rec2 = this.get(range[1].recid, true);\n            var col1 = range[0].column;\n            var col2 = range[1].column;\n\n            var res = [];\n            if (col1 == col2) { // one row\n                for (var r = rec1; r <= rec2; r++) {\n                    var record = this.records[r];\n                    var dt = record[this.columns[col1].field] || null;\n                    if (extra !== true) {\n                        res.push(dt);\n                    } else {\n                        res.push({ data: dt, column: col1, index: r, record: record });\n                    }\n                }\n            } else if (rec1 == rec2) { // one line\n                var record = this.records[rec1];\n                for (var i = col1; i <= col2; i++) {\n                    var dt = record[this.columns[i].field] || null;\n                    if (extra !== true) {\n                        res.push(dt);\n                    } else {\n                        res.push({ data: dt, column: i, index: rec1, record: record });\n                    }\n                }\n            } else {\n                for (var r = rec1; r <= rec2; r++) {\n                    var record = this.records[r];\n                    res.push([]);\n                    for (var i = col1; i <= col2; i++) {\n                        var dt = record[this.columns[i].field];\n                        if (extra !== true) {\n                            res[res.length-1].push(dt);\n                        } else {\n                            res[res.length-1].push({ data: dt, column: i, index: r, record: record });\n                        }\n                    }\n                }\n            }\n            return res;\n        },\n\n        addRange: function (ranges) {\n            var added = 0;\n            if (this.selectType == 'row') return added;\n            if (!$.isArray(ranges)) ranges = [ranges];\n            // if it is selection\n            for (var r in ranges) {\n                if (typeof ranges[r] != 'object') ranges[r] = { name: 'selection' };\n                if (ranges[r].name == 'selection') {\n                    if (this.show.selectionBorder === false) continue;\n                    var sel = this.getSelection();\n                    if (sel.length == 0) {\n                        this.removeRange(ranges[r].name);\n                        continue;\n                    } else {\n                        var first = sel[0];\n                        var last  = sel[sel.length-1];\n                        var td1   = $('#grid_'+ this.name +'_rec_'+ first.recid + ' td[col='+ first.column +']');\n                        var td2   = $('#grid_'+ this.name +'_rec_'+ last.recid + ' td[col='+ last.column +']');\n                    }\n                } else { // other range\n                    var first = ranges[r].range[0];\n                    var last  = ranges[r].range[1];\n                    var td1   = $('#grid_'+ this.name +'_rec_'+ first.recid + ' td[col='+ first.column +']');\n                    var td2   = $('#grid_'+ this.name +'_rec_'+ last.recid + ' td[col='+ last.column +']');\n                }\n                if (first) {\n                    var rg = {\n                        name: ranges[r].name,\n                        range: [{ recid: first.recid, column: first.column }, { recid: last.recid, column: last.column }],\n                        style: ranges[r].style || ''\n                    };\n                    // add range\n                    var ind = false;\n                    for (var t in this.ranges) if (this.ranges[t].name == ranges[r].name) { ind = r; break; }\n                    if (ind !== false) {\n                        this.ranges[ind] = rg;\n                    } else {\n                        this.ranges.push(rg);\n                    }\n                    added++\n                }\n            }\n            this.refreshRanges();\n            return added;\n        },\n\n        removeRange: function () {\n            var removed = 0;\n            for (var a = 0; a < arguments.length; a++) {\n                var name = arguments[a];\n                $('#grid_'+ this.name +'_'+ name).remove();\n                for (var r = this.ranges.length-1; r >= 0; r--) {\n                    if (this.ranges[r].name == name) {\n                        this.ranges.splice(r, 1);\n                        removed++;\n                    }\n                }\n            }\n            return removed;\n        },\n\n        refreshRanges: function () {\n            var obj  = this;\n            var time = (new Date()).getTime();\n            var rec  = $('#grid_'+ this.name +'_records');\n            for (var r in this.ranges) {\n                var rg    = this.ranges[r];\n                var first = rg.range[0];\n                var last  = rg.range[1];\n                var td1   = $('#grid_'+ this.name +'_rec_'+ first.recid + ' td[col='+ first.column +']');\n                var td2   = $('#grid_'+ this.name +'_rec_'+ last.recid + ' td[col='+ last.column +']');\n                if ($('#grid_'+ this.name +'_'+ rg.name).length == 0) {\n                    rec.append('<div id=\"grid_'+ this.name +'_' + rg.name +'\" class=\"w2ui-selection\" style=\"'+ rg.style +'\">'+\n                                    (rg.name == 'selection' ?  '<div id=\"grid_'+ this.name +'_resizer\" class=\"w2ui-selection-resizer\"></div>' : '')+\n                                '</div>');\n                } else {\n                    $('#grid_'+ this.name +'_'+ rg.name).attr('style', rg.style);\n                }\n                if (td1.length > 0 && td2.length > 0) {\n                    $('#grid_'+ this.name +'_'+ rg.name).css({\n                        left     : (td1.position().left - 1 + rec.scrollLeft()) + 'px',\n                        top     : (td1.position().top - 1 + rec.scrollTop()) + 'px',\n                        width     : (td2.position().left - td1.position().left + td2.width() + 3) + 'px',\n                        height     : (td2.position().top - td1.position().top + td2.height() + 3) + 'px'\n                    });\n                }\n            }\n\n            // add resizer events\n            $(this.box).find('#grid_'+ this.name +'_resizer').off('mousedown').on('mousedown', mouseStart);\n            //$(this.box).find('#grid_'+ this.name +'_resizer').off('selectstart').on('selectstart', function () { return false; }); // fixes chrome cursror bug\n\n            var eventData = { phase: 'before', type: 'selectionExtend', target: obj.name, originalRange: null, newRange: null };\n\n            function mouseStart (event) {\n                var sel = obj.getSelection();\n                obj.last.move = {\n                    type   : 'expand',\n                    x      : event.screenX,\n                    y      : event.screenY,\n                    divX   : 0,\n                    divY   : 0,\n                    recid  : sel[0].recid,\n                    column : sel[0].column,\n                    originalRange : [{ recid: sel[0].recid, column: sel[0].column }, { recid: sel[sel.length-1].recid, column: sel[sel.length-1].column }],\n                    newRange      : [{ recid: sel[0].recid, column: sel[0].column }, { recid: sel[sel.length-1].recid, column: sel[sel.length-1].column }]\n                };\n                $(document).off('mousemove', mouseMove).on('mousemove', mouseMove);\n                $(document).off('mouseup', mouseStop).on('mouseup', mouseStop);\n            }\n\n            function mouseMove (event) {\n                var mv = obj.last.move;\n                if (!mv || mv.type != 'expand') return;\n                mv.divX = (event.screenX - mv.x);\n                mv.divY = (event.screenY - mv.y);\n                // find new cell\n                var recid, column;\n                var tmp = event.originalEvent.target;\n                if (tmp.tagName != 'TD') tmp = $(tmp).parents('td')[0];\n                if (typeof $(tmp).attr('col') != 'undefined') column = parseInt($(tmp).attr('col'));\n                tmp = $(tmp).parents('tr')[0];\n                recid = $(tmp).attr('recid');\n                // new range\n                if (mv.newRange[1].recid == recid && mv.newRange[1].column == column) return;\n                var prevNewRange = $.extend({}, mv.newRange);\n                mv.newRange = [{ recid: mv.recid, column: mv.column }, { recid: recid, column: column }];\n                // event before\n                eventData = obj.trigger($.extend(eventData, { originalRange: mv.originalRange, newRange : mv.newRange }));\n                if (eventData.isCancelled === true) {\n                    mv.newRange        = prevNewRange;\n                    eventData.newRange = prevNewRange;\n                    return;\n                } else {\n                    // default behavior\n                    obj.removeRange('grid-selection-expand');\n                    obj.addRange({\n                        name  : 'grid-selection-expand',\n                        range : eventData.newRange,\n                        style : 'background-color: rgba(100,100,100,0.1); border: 2px dotted rgba(100,100,100,0.5);'\n                    });\n                }\n            }\n\n            function mouseStop (event) {\n                // default behavior\n                obj.removeRange('grid-selection-expand');\n                delete obj.last.move;\n                $(document).off('mousemove', mouseMove);\n                $(document).off('mouseup', mouseStop);\n                // event after\n                obj.trigger($.extend(eventData, { phase: 'after' }));\n            }\n\n            return (new Date()).getTime() - time;\n        },\n\n        select: function () {\n            var selected = 0;\n            var sel    = this.last.selection;\n            if (!this.multiSelect) this.selectNone();\n            for (var a = 0; a < arguments.length; a++) {\n                var recid  = typeof arguments[a] == 'object' ? arguments[a].recid : arguments[a];\n                var record = this.get(recid);\n                if (record == null) continue;\n                var index  = this.get(recid, true);\n                var recEl  = $('#grid_'+ this.name +'_rec_'+ w2utils.escapeId(recid));\n                if (this.selectType == 'row') {\n                    if (sel.indexes.indexOf(index) >= 0) continue;\n                    // event before\n                    var eventData = this.trigger({ phase: 'before', type: 'select', target: this.name, recid: recid, index: index });\n                    if (eventData.isCancelled === true) continue;\n                    // default action\n                    sel.indexes.push(index);\n                    sel.indexes.sort(function(a, b) { return a-b });\n                    recEl.addClass('w2ui-selected').data('selected', 'yes');\n                    recEl.find('.w2ui-grid-select-check').prop(\"checked\", true);\n                    selected++;\n                } else {\n                    var col  = arguments[a].column;\n                    if (!w2utils.isInt(col)) { // select all columns\n                        var cols = [];\n                        for (var c in this.columns) { if (this.columns[c].hidden) continue; cols.push({ recid: recid, column: parseInt(c) }); }\n                        if (!this.multiSelect) cols = cols.splice(0, 1);\n                        return this.select.apply(this, cols);\n                    }\n                    var s = sel.columns[index] || [];\n                    if ($.isArray(s) && s.indexOf(col) != -1) continue;\n                    // event before\n                    var eventData = this.trigger({ phase: 'before', type: 'select', target: this.name, recid: recid, index: index, column: col });\n                    if (eventData.isCancelled === true) continue;\n                    // default action\n                    if (sel.indexes.indexOf(index) == -1) {\n                        sel.indexes.push(index);\n                        sel.indexes.sort(function(a, b) { return a-b });\n                    }\n                    s.push(col);\n                    s.sort(function(a, b) { return a-b }); // sort function must be for numerical sort\n                    recEl.find(' > td[col='+ col +']').addClass('w2ui-selected');\n                    selected++;\n                    recEl.data('selected', 'yes');\n                    recEl.find('.w2ui-grid-select-check').prop(\"checked\", true);\n                    // save back to selection object\n                    sel.columns[index] = s;\n                }\n                // event after\n                this.trigger($.extend(eventData, { phase: 'after' }));\n            }\n            // all selected?\n            if (sel.indexes.length == this.records.length || (this.searchData.length !== 0 && sel.indexes.length == this.last.searchIds.length)) {\n                $('#grid_'+ this.name +'_check_all').prop('checked', true);\n            } else {\n                $('#grid_'+ this.name +'_check_all').prop('checked', false);\n            }\n            this.status();\n            this.addRange('selection');\n            return selected;\n        },\n\n        unselect: function () {\n            var unselected = 0;\n            var sel = this.last.selection;\n            for (var a = 0; a < arguments.length; a++) {\n                var recid  = typeof arguments[a] == 'object' ? arguments[a].recid : arguments[a];\n                var record = this.get(recid);\n                if (record == null) continue;\n                var index  = this.get(record.recid, true);\n                var recEl  = $('#grid_'+ this.name +'_rec_'+ w2utils.escapeId(recid));\n                if (this.selectType == 'row') {\n                    if (sel.indexes.indexOf(index) == -1) continue;\n                    // event before\n                    var eventData = this.trigger({ phase: 'before', type: 'unselect', target: this.name, recid: recid, index: index });\n                    if (eventData.isCancelled === true) continue;\n                    // default action\n                    sel.indexes.splice(sel.indexes.indexOf(index), 1);\n                    recEl.removeClass('w2ui-selected').removeData('selected');\n                    if (recEl.length != 0) recEl[0].style.cssText = 'height: '+ this.recordHeight +'px; ' + recEl.attr('custom_style');\n                    recEl.find('.w2ui-grid-select-check').prop(\"checked\", false);\n                    unselected++;\n                } else {\n                    var col  = arguments[a].column;\n                    if (!w2utils.isInt(col)) { // unselect all columns\n                        var cols = [];\n                        for (var c in this.columns) { if (this.columns[c].hidden) continue; cols.push({ recid: recid, column: parseInt(c) }); }\n                        return this.unselect.apply(this, cols);\n                    }\n                    var s = sel.columns[index];\n                    if (!$.isArray(s) || s.indexOf(col) == -1) continue;\n                    // event before\n                    var eventData = this.trigger({ phase: 'before', type: 'unselect', target: this.name, recid: recid, column: col });\n                    if (eventData.isCancelled === true) continue;\n                    // default action\n                    s.splice(s.indexOf(col), 1);\n                    $('#grid_'+ this.name +'_rec_'+ w2utils.escapeId(recid) + ' > td[col='+ col +']').removeClass('w2ui-selected');\n                    unselected++;\n                    if (s.length == 0) {\n                        delete sel.columns[index];\n                        sel.indexes.splice(sel.indexes.indexOf(index), 1);\n                        recEl.removeData('selected');\n                        recEl.find('.w2ui-grid-select-check').prop(\"checked\", false);\n                    }\n                }\n                // event after\n                this.trigger($.extend(eventData, { phase: 'after' }));\n            }\n            // all selected?\n            if (sel.indexes.length == this.records.length || (this.searchData.length !== 0 && sel.indexes.length == this.last.searchIds.length)) {\n                $('#grid_'+ this.name +'_check_all').prop('checked', true);\n            } else {\n                $('#grid_'+ this.name +'_check_all').prop('checked', false);\n            }\n            // show number of selected\n            this.status();\n            this.addRange('selection');\n            return unselected;\n        },\n\n        selectAll: function () {\n            if (this.multiSelect === false) return;\n            // event before\n            var eventData = this.trigger({ phase: 'before', type: 'select', target: this.name, all: true });\n            if (eventData.isCancelled === true) return;\n            // default action\n            var url  = (typeof this.url != 'object' ? this.url : this.url.get);\n            var sel  = this.last.selection;\n            var cols = [];\n            for (var c in this.columns) cols.push(parseInt(c));\n            // if local data source and searched\n            sel.indexes = [];\n            if (!url && this.searchData.length !== 0) {\n                // local search applied\n                for (var i = 0; i < this.last.searchIds.length; i++) {\n                    sel.indexes.push(this.last.searchIds[i]);\n                    if (this.selectType != 'row') sel.columns[this.last.searchIds[i]] = cols.slice(); // .slice makes copy of the array\n                }\n            } else {\n                var buffered = this.records.length;\n                if (this.searchData.length != 0 && !this.url) buffered = this.last.searchIds.length;\n                for (var i = 0; i < buffered; i++) {\n                    sel.indexes.push(i);\n                    if (this.selectType != 'row') sel.columns[i] = cols.slice(); // .slice makes copy of the array\n                }\n            }\n            this.refresh();\n            // enable/disable toolbar buttons\n            var sel = this.getSelection();\n            if (sel.length == 1) this.toolbar.enable('w2ui-edit'); else this.toolbar.disable('w2ui-edit');\n            if (sel.length >= 1) this.toolbar.enable('w2ui-delete'); else this.toolbar.disable('w2ui-delete');\n            this.addRange('selection');\n            // event after\n            this.trigger($.extend(eventData, { phase: 'after' }));\n        },\n\n        selectNone: function () {\n            // event before\n            var eventData = this.trigger({ phase: 'before', type: 'unselect', target: this.name, all: true });\n            if (eventData.isCancelled === true) return;\n            // default action\n            var sel = this.last.selection;\n            for (var s in sel.indexes) {\n                var index = sel.indexes[s];\n                var rec   = this.records[index];\n                var recid = rec ? rec.recid : null;\n                var recEl = $('#grid_'+ this.name +'_rec_'+ w2utils.escapeId(recid));\n                recEl.removeClass('w2ui-selected').removeData('selected');\n                recEl.find('.w2ui-grid-select-check').prop(\"checked\", false);\n                // for not rows\n                if (this.selectType != 'row') {\n                    var cols = sel.columns[index];\n                    for (var c in cols) recEl.find(' > td[col='+ cols[c] +']').removeClass('w2ui-selected');\n                }\n            }\n            sel.indexes = [];\n            sel.columns = {};\n            this.toolbar.disable('w2ui-edit', 'w2ui-delete');\n            this.removeRange('selection');\n            $('#grid_'+ this.name +'_check_all').prop('checked', false);\n            // event after\n            this.trigger($.extend(eventData, { phase: 'after' }));\n        },\n\n        getSelection: function (returnIndex) {\n            var ret = [];\n            var sel = this.last.selection;\n            if (this.selectType == 'row') {\n                for (var s in sel.indexes) {\n                    if (!this.records[sel.indexes[s]]) continue;\n                    if (returnIndex === true) ret.push(sel.indexes[s]); else ret.push(this.records[sel.indexes[s]].recid);\n                }\n                return ret;\n            } else {\n                for (var s in sel.indexes) {\n                    var cols = sel.columns[sel.indexes[s]];\n                    if (!this.records[sel.indexes[s]]) continue;\n                    for (var c in cols) {\n                        ret.push({ recid: this.records[sel.indexes[s]].recid, index: parseInt(sel.indexes[s]), column: cols[c] });\n                    }\n                }\n                return ret;\n            }\n        },\n\n        search: function (field, value) {\n            var obj         = this;\n            var url         = (typeof this.url != 'object' ? this.url : this.url.get);\n            var searchData  = [];\n            var last_multi  = this.last.multi;\n            var last_logic  = this.last.logic;\n            var last_field  = this.last.field;\n            var last_search = this.last.search;\n            // 1: search() - advanced search (reads from popup)\n            if (arguments.length == 0) {\n                last_search = '';\n                // advanced search\n                for (var s in this.searches) {\n                    var search   = this.searches[s];\n                    var operator = $('#grid_'+ this.name + '_operator_'+s).val();\n                    var field1   = $('#grid_'+ this.name + '_field_'+s);\n                    var field2   = $('#grid_'+ this.name + '_field2_'+s);\n                    var value1   = field1.val();\n                    var value2   = field2.val();\n                    var svalue   = null;\n                    if (['int', 'float', 'money', 'currency', 'percent'].indexOf(search.type) != -1) {\n                        var fld1 = field1.data('w2field');\n                        var fld2 = field2.data('w2field');\n                        if (fld1) value1 = fld1.clean(value1);\n                        if (fld2) value2 = fld2.clean(value2);\n                    }\n                    if (['list', 'enum'].indexOf(search.type) != -1) {\n                        value1 = field1.data('selected') || {};\n                        if ($.isArray(value1)) {\n                            svalue = [];\n                            for (var v in value1) {\n                                svalue.push(w2utils.isFloat(value1[v].id) ? parseFloat(value1[v].id) : String(value1[v].id).toLowerCase());\n                                delete value1[v].hidden;\n                            }\n                        } else {\n                            value1 = value1.id || '';\n                        }\n                    }\n                    if ((value1 != '' && value1 != null) || (typeof value2 != 'undefined' && value2 != '')) {\n                        var tmp = {\n                            field    : search.field,\n                            type     : search.type,\n                            operator : operator\n                        }\n                        if (operator == 'between') {\n                            $.extend(tmp, { value: [value1, value2] });\n                        } else if (operator == 'in' && typeof value1 == 'string') {\n                            $.extend(tmp, { value: value1.split(',') });\n                        } else if (operator == 'not in' && typeof value1 == 'string') {\n                            $.extend(tmp, { value: value1.split(',') });\n                        } else {\n                            $.extend(tmp, { value: value1 });\n                        }\n                        if (svalue) $.extend(tmp, { svalue: svalue });\n                        // conver date to unix time\n                        try {\n                            if (search.type == 'date' && operator == 'between') {\n                                tmp.value[0] = value1; // w2utils.isDate(value1, w2utils.settings.date_format, true).getTime();\n                                tmp.value[1] = value2; // w2utils.isDate(value2, w2utils.settings.date_format, true).getTime();\n                            }\n                            if (search.type == 'date' && operator == 'is') {\n                                tmp.value = value1; // w2utils.isDate(value1, w2utils.settings.date_format, true).getTime();\n                            }\n                        } catch (e) {\n\n                        }\n                        searchData.push(tmp);\n                    }\n                }\n                if (searchData.length > 0 && !url) {\n                    last_multi = true;\n                    last_logic = 'AND';\n                } else {\n                    last_multi = true;\n                    last_logic = 'AND';\n                }\n            }\n            // 2: search(field, value) - regular search\n            if (typeof field == 'string') {\n                last_field  = field;\n                last_search = value;\n                last_multi  = false;\n                last_logic  = 'OR';\n                // loop through all searches and see if it applies\n                if (typeof value != 'undefined') {\n                    if (field.toLowerCase() == 'all') {\n                        // if there are search fields loop thru them\n                        if (this.searches.length > 0) {\n                            for (var s in this.searches) {\n                                var search = this.searches[s];\n                                if (search.type == 'text' || (search.type == 'alphanumeric' && w2utils.isAlphaNumeric(value))\n                                        || (search.type == 'int' && w2utils.isInt(value)) || (search.type == 'float' && w2utils.isFloat(value))\n                                        || (search.type == 'percent' && w2utils.isFloat(value)) || (search.type == 'hex' && w2utils.isHex(value))\n                                        || (search.type == 'currency' && w2utils.isMoney(value)) || (search.type == 'money' && w2utils.isMoney(value))\n                                        || (search.type == 'date' && w2utils.isDate(value)) ) {\n                                    var tmp = {\n                                        field    : search.field,\n                                        type     : search.type,\n                                        operator : (search.type == 'text' ? 'contains' : 'is'),\n                                        value    : value\n                                    };\n                                    searchData.push(tmp);\n                                }\n                                // range in global search box\n                                if (['int', 'float', 'money', 'currency', 'percent'].indexOf(search.type) != -1 && String(value).indexOf('-') != -1) {\n                                    var t = String(value).split('-');\n                                    var tmp = {\n                                        field    : search.field,\n                                        type     : search.type,\n                                        operator : 'between',\n                                        value    : [t[0], t[1]]\n                                    };\n                                    searchData.push(tmp);\n                                }\n                            }\n                        } else {\n                            // no search fields, loop thru columns\n                            for (var c in this.columns) {\n                                var tmp = {\n                                    field    : this.columns[c].field,\n                                    type     : 'text',\n                                    operator : 'contains',\n                                    value    : value\n                                };\n                                searchData.push(tmp);\n                            }\n                        }\n                    } else {\n                        var el = $('#grid_'+ this.name +'_search_all');\n                        var search = this.getSearch(field);\n                        if (search == null) search = { field: field, type: 'text' };\n                        if (search.field == field) this.last.caption = search.caption;\n                        if (search.type == 'list') {\n                            var tmp = el.data('selected');\n                            if (tmp && !$.isEmptyObject(tmp)) value = tmp.id;\n                        }\n                        if (value != '') {\n                            var op  = 'contains';\n                            var val = value;\n                            if (['date', 'time', 'list'].indexOf(search.type) != -1) op = 'is';\n                            if (search.type == 'int' && value != '') {\n                                op = 'is';\n                                if (String(value).indexOf('-') != -1) {\n                                    var tmp = value.split('-');\n                                    if (tmp.length == 2) {\n                                        op = 'between';\n                                        val = [parseInt(tmp[0]), parseInt(tmp[1])];\n                                    }\n                                }\n                                if (String(value).indexOf(',') != -1) {\n                                    var tmp = value.split(',');\n                                    op  = 'in';\n                                    val = [];\n                                    for (var t in tmp) val.push(tmp[t]);\n                                }\n                            }\n                            var tmp = {\n                                field    : search.field,\n                                type     : search.type,\n                                operator : op,\n                                value    : val\n                            }\n                            searchData.push(tmp);\n                        }\n                    }\n                }\n            }\n            // 3: search([ { field, value, [operator,] [type] }, { field, value, [operator,] [type] } ], logic) - submit whole structure\n            if ($.isArray(field)) {\n                var logic = 'AND';\n                if (typeof value == 'string') {\n                    logic = value.toUpperCase();\n                    if (logic != 'OR' && logic != 'AND') logic = 'AND';\n                }\n                last_search = '';\n                last_multi  = true;\n                last_logic  = logic;\n                for (var f in field) {\n                    var data   = field[f];\n                    var search = this.getSearch(data.field);\n                    if (search == null) search = { type: 'text', operator: 'contains' };\n                    // merge current field and search if any\n                    searchData.push($.extend(true, {}, search, data));\n                }\n            }\n            // event before\n            var eventData = this.trigger({ phase: 'before', type: 'search', target: this.name, searchData: searchData,\n                    searchField: (field ? field : 'multi'), searchValue: (value ? value : 'multi') });\n            if (eventData.isCancelled === true) return;\n            // default action\n            this.searchData  = eventData.searchData;\n            this.last.field  = last_field;\n            this.last.search = last_search;\n            this.last.multi  = last_multi;\n            this.last.logic  = last_logic;\n            this.last.scrollTop         = 0;\n            this.last.scrollLeft        = 0;\n            this.last.selection.indexes = [];\n            this.last.selection.columns = {};\n            // -- clear all search field\n            this.searchClose();\n            this.set({ expanded: false }, true);\n            // apply search\n            if (url) {\n                this.last.xhr_offset = 0;\n                this.reload();\n            } else {\n                // local search\n                this.localSearch();\n                this.refresh();\n            }\n            // event after\n            this.trigger($.extend(eventData, { phase: 'after' }));\n        },\n\n        searchOpen: function () {\n            if (!this.box) return;\n            if (this.searches.length == 0) return;\n            var obj = this;\n            // show search\n            $('#tb_'+ this.name +'_toolbar_item_w2ui-search-advanced').w2overlay(\n                this.getSearchesHTML(),    {\n                    name    : 'searches-'+ this.name,\n                    left    : -10,\n                    'class' : 'w2ui-grid-searches',\n                    onShow  : function () {\n                        if (obj.last.logic == 'OR') obj.searchData = [];\n                        obj.initSearches();\n                        $('#w2ui-overlay-searches-'+ this.name +' .w2ui-grid-searches').data('grid-name', obj.name);\n                        var sfields = $('#w2ui-overlay-searches-'+ this.name +' .w2ui-grid-searches *[rel=search]');\n                        if (sfields.length > 0) sfields[0].focus();\n                    }\n                }\n            );\n        },\n\n        searchClose: function () {\n            if (!this.box) return;\n            if (this.searches.length == 0) return;\n            if (this.toolbar) this.toolbar.uncheck('w2ui-search-advanced')\n            // hide search\n            if ($('#w2ui-overlay-searches-'+ this.name +' .w2ui-grid-searches').length > 0) {\n                $().w2overlay('', { name: 'searches-'+ this.name });\n            }\n        },\n\n        searchShowFields: function () {\n            var el   = $('#grid_'+ this.name +'_search_all');\n            var html = '<div class=\"w2ui-select-field\"><table>';\n            for (var s = -1; s < this.searches.length; s++) {\n                var search = this.searches[s];\n                if (s == -1) {\n                    if (!this.multiSearch) continue;\n                    search = { field: 'all', caption: w2utils.lang('All Fields') };\n                } else {\n                    if (this.searches[s].hidden === true) continue;\n                }\n                html += '<tr '+ (w2utils.isIOS ? 'onTouchStart' : 'onClick') +'=\"w2ui[\\''+ this.name +'\\'].initAllField(\\''+ search.field +'\\')\">'+\n                        '    <td><input type=\"radio\" tabIndex=\"-1\" '+ (search.field == this.last.field ? 'checked' : '') +'></td>'+\n                        '    <td>'+ search.caption +'</td>'+\n                        '</tr>';\n            }\n            html += \"</table></div>\";\n            // need timer otherwise does nto show with list type\n            setTimeout(function () {\n                $(el).w2overlay(html, { left: -10 });\n            }, 1);\n        },\n\n        initAllField: function (field, value) {\n            var el     = $('#grid_'+ this.name +'_search_all');\n            var search = this.getSearch(field);\n            if (field == 'all') {\n                search = { field: 'all', caption: w2utils.lang('All Fields') };\n                el.w2field('clear');\n                el.change().focus();\n            } else {\n                var st = search.type;\n                if (['enum', 'select'].indexOf(st) != -1) st = 'list';\n                el.w2field(st, $.extend({}, search.options, { suffix: '', autoFormat: false, selected: value }));\n                if (['list', 'enum'].indexOf(search.type) != -1) {\n                    this.last.search = '';\n                    this.last.item   = '';\n                    el.val('');\n                }\n                // set focus\n                setTimeout(function () { \n                    el.focus(); /* do not do el.change() as it will refresh grid and pull from server */ \n                }, 1);\n            }\n            // update field\n            if (this.last.search != '') {\n                this.search(search.field, this.last.search);\n            } else {\n                this.last.field   = search.field;\n                this.last.caption = search.caption;\n            }\n            el.attr('placeholder', search.caption);\n            $().w2overlay();\n        },\n\n        searchReset: function (noRefresh) {\n            // event before\n            var eventData = this.trigger({ phase: 'before', type: 'search', target: this.name, searchData: [] });\n            if (eventData.isCancelled === true) return;\n            // default action\n            this.searchData  = [];\n            this.last.search = '';\n            this.last.logic  = 'OR';\n            // --- do not reset to All Fields (I think)\n            // if (this.last.multi) {\n            //     if (!this.multiSearch) {\n            //         this.last.field     = this.searches[0].field;\n            //         this.last.caption     = this.searches[0].caption;\n            //     } else {\n            //         this.last.field      = 'all';\n            //         this.last.caption     = w2utils.lang('All Fields');\n            //     }\n            // }\n            this.last.multi      = false;\n            this.last.xhr_offset = 0;\n            // reset scrolling position\n            this.last.scrollTop  = 0;\n            this.last.scrollLeft = 0;\n            this.last.selection.indexes = [];\n            this.last.selection.columns = {};\n            // -- clear all search field\n            this.searchClose();\n            $('#grid_'+ this.name +'_search_all').val('');\n            // apply search\n            if (!noRefresh) this.reload();\n            // event after\n            this.trigger($.extend(eventData, { phase: 'after' }));\n        },\n\n        clear: function (noRefresh) {\n            // this.offset              = 0;   // clear should not reset offset\n            // this.total               = 0;   // clear should not reset total\n            this.records                = [];\n            this.summary                = [];\n            this.last.scrollTop         = 0;\n            this.last.scrollLeft        = 0;\n            this.last.selection.indexes = [];\n            this.last.selection.columns = {};\n            this.last.range_start       = null;\n            this.last.range_end         = null;\n            this.last.xhr_offset        = 0;\n            if (!noRefresh) this.refresh();\n        },\n\n        reset: function (noRefresh) {\n            // reset last remembered state\n            this.offset                 = 0;\n            this.total                  = 0;\n            this.last.scrollTop         = 0;\n            this.last.scrollLeft        = 0;\n            this.last.selection.indexes = [];\n            this.last.selection.columns = {};\n            this.last.range_start       = null;\n            this.last.range_end         = null;\n            this.last.xhr_offset        = 0;\n            this.searchReset(noRefresh);\n            // initial sort\n            if (this.last.sortData != null ) this.sortData = this.last.sortData;\n            // select none without refresh\n            this.set({ expanded: false }, true);\n            // refresh\n            if (!noRefresh) this.refresh();\n        },\n\n        skip: function (offset) {\n            var url = (typeof this.url != 'object' ? this.url : this.url.get);\n            if (url) {\n                this.offset = parseInt(offset);\n                if (this.offset > this.total) this.offset = this.total - this.limit;\n                if (this.offset < 0 || !w2utils.isInt(this.offset)) this.offset = 0;\n                this.records  = [];\n                this.last.xhr_offset = 0;\n                this.last.pull_more  = true;\n                this.last.scrollTop  = 0;\n                this.last.scrollLeft = 0;\n                $('#grid_'+ this.name +'_records').prop('scrollTop',  0);\n                this.reload();\n            } else {\n                console.log('ERROR: grid.skip() can only be called when you have remote data source.');\n            }\n        },\n\n        load: function (url, callBack) {\n            if (typeof url == 'undefined') {\n                console.log('ERROR: You need to provide url argument when calling .load() method of \"'+ this.name +'\" object.');\n                return;\n            }\n            // default action\n            this.request('get-records', {}, url, callBack);\n        },\n\n        reload: function (callBack) {\n            var url = (typeof this.url != 'object' ? this.url : this.url.get);\n            if (url) {\n                this.clear(true);\n                this.request('get-records', {}, null, callBack);\n            } else {\n                this.last.scrollTop   = 0;\n                this.last.scrollLeft  = 0;\n                this.last.range_start = null;\n                this.last.range_end   = null;\n                this.localSearch();\n                this.refresh();\n                if (typeof callBack == 'function') callBack({ status: 'success' });\n            }\n        },\n\n        request: function (cmd, add_params, url, callBack) {\n            if (typeof add_params == 'undefined') add_params = {};\n            if (typeof url == 'undefined' || url == '' || url == null) url = this.url;\n            if (url == '' || url == null) return;\n            // build parameters list\n            var params = {};\n            if (!w2utils.isInt(this.offset)) this.offset = 0;\n            if (!w2utils.isInt(this.last.xhr_offset)) this.last.xhr_offset = 0;\n            // add list params\n            params['cmd']         = cmd;\n            params['selected']    = this.getSelection();\n            params['limit']       = this.limit;\n            params['offset']      = parseInt(this.offset) + this.last.xhr_offset;\n            params['search']      = this.searchData;\n            params['searchLogic'] = this.last.logic;\n            params['sort']        = this.sortData;\n            if (this.searchData.length == 0) {\n                delete params['search'];\n                delete params['searchLogic'];\n            }\n            if (this.sortData.length == 0) {\n                delete params['sort'];\n            }\n            // append other params\n            $.extend(params, this.postData);\n            $.extend(params, add_params);\n            // event before\n            if (cmd == 'get-records') {\n                var eventData = this.trigger({ phase: 'before', type: 'request', target: this.name, url: url, postData: params });\n                if (eventData.isCancelled === true) { if (typeof callBack == 'function') callBack({ status: 'error', message: 'Request aborted.' }); return; }\n            } else {\n                var eventData = { url: url, postData: params };\n            }\n            // call server to get data\n            var obj = this;\n            if (this.last.xhr_offset == 0) {\n                this.lock(this.msgRefresh, true);\n            } else {\n                var more = $('#grid_'+ this.name +'_rec_more');\n                if (this.autoLoad === true) {\n                    more.show().find('td').html('<div><div style=\"width: 20px; height: 20px;\" class=\"w2ui-spinner\"></div></div>');\n                } else {\n                    more.find('td').html('<div>'+ w2utils.lang('Load') + ' ' + obj.limit + ' ' + w2utils.lang('More') + '...</div>');\n                }\n            }\n            if (this.last.xhr) try { this.last.xhr.abort(); } catch (e) {};\n            // URL\n            var url = (typeof eventData.url != 'object' ? eventData.url : eventData.url.get);\n            if (params.cmd == 'save-records' && typeof eventData.url == 'object')   url = eventData.url.save;\n            if (params.cmd == 'delete-records' && typeof eventData.url == 'object') url = eventData.url.remove;\n            // process url with routeData\n            if (!$.isEmptyObject(obj.routeData)) {\n                var info  = w2utils.parseRoute(url);\n                if (info.keys.length > 0) {\n                    for (var k = 0; k < info.keys.length; k++) {\n                        if (obj.routeData[info.keys[k].name] == null) continue;\n                        url = url.replace((new RegExp(':'+ info.keys[k].name, 'g')), obj.routeData[info.keys[k].name]);\n                    }\n                }\n            }\n            // ajax ptions\n            var ajaxOptions = {\n                type     : 'POST',\n                url      : url,\n                data     : eventData.postData, \n                dataType : 'text'  // expected data type from server\n            };\n            if (w2utils.settings.dataType == 'HTTP') {\n                ajaxOptions.data = (typeof ajaxOptions.data == 'object' ? String($.param(ajaxOptions.data, false)).replace(/%5B/g, '[').replace(/%5D/g, ']') : ajaxOptions.data);\n            }\n            if (w2utils.settings.dataType == 'RESTFULL') {\n                ajaxOptions.type = 'GET';\n                if (params.cmd == 'save-records')   ajaxOptions.type = 'PUT';  // so far it is always update\n                if (params.cmd == 'delete-records') ajaxOptions.type = 'DELETE';\n                ajaxOptions.data = (typeof ajaxOptions.data == 'object' ? String($.param(ajaxOptions.data, false)).replace(/%5B/g, '[').replace(/%5D/g, ']') : ajaxOptions.data);\n            }\n            if (w2utils.settings.dataType == 'JSON') {\n                ajaxOptions.type        = 'POST';\n                ajaxOptions.data        = JSON.stringify(ajaxOptions.data);\n                ajaxOptions.contentType = 'application/json';\n            }\n            if (this.method) ajaxOptions.type = this.method;\n\n            this.last.xhr_cmd   = params.cmd;\n            this.last.xhr_start = (new Date()).getTime();\n            this.last.xhr = $.ajax(ajaxOptions)\n                .done(function (data, status, xhr) {\n                    obj.requestComplete(status, cmd, callBack);\n                })\n                .fail(function (xhr, status, error) {\n                    // trigger event\n                    var errorObj = { status: status, error: error, rawResponseText: xhr.responseText };\n                    var eventData2 = obj.trigger({ phase: 'before', type: 'error', error: errorObj, xhr: xhr });\n                    if (eventData2.isCancelled === true) return;\n                    // default behavior\n                    if (status != 'abort') {\n                        var data;\n                        try { data = $.parseJSON(xhr.responseText) } catch (e) {}\n                        console.log('ERROR: Server communication failed.', \n                            '\\n   EXPECTED:', { status: 'success', total: 5, records: [{ recid: 1, field: 'value' }] }, \n                            '\\n         OR:', { status: 'error', message: 'error message' },\n                            '\\n   RECEIVED:', typeof data == 'object' ? data : xhr.responseText);\n                        obj.requestComplete('error', cmd, callBack);\n                    }\n                    // event after\n                    obj.trigger($.extend(eventData2, { phase: 'after' }));\n                });\n            if (cmd == 'get-records') {\n                // event after\n                this.trigger($.extend(eventData, { phase: 'after' }));\n            }\n        },\n\n        requestComplete: function(status, cmd, callBack) {\n            var obj = this;\n            this.unlock();\n            setTimeout(function () { obj.status(w2utils.lang('Server Response') + ' ' + ((new Date()).getTime() - obj.last.xhr_start)/1000 +' ' + w2utils.lang('sec')); }, 10);\n            this.last.pull_more    = false;\n            this.last.pull_refresh = true;\n\n            // event before\n            var event_name = 'load';\n            if (this.last.xhr_cmd == 'save-records') event_name   = 'save';\n            if (this.last.xhr_cmd == 'delete-records') event_name = 'deleted';\n            var eventData = this.trigger({ phase: 'before', target: this.name, type: event_name, xhr: this.last.xhr, status: status });\n            if (eventData.isCancelled === true) {\n                if (typeof callBack == 'function') callBack({ status: 'error', message: 'Request aborted.' });\n                return;\n            }\n            // parse server response\n            var data;\n            var responseText = this.last.xhr.responseText;\n            if (status != 'error') {\n                // default action\n                if (typeof responseText != 'undefined' && responseText != '') {\n                    // check if the onLoad handler has not already parsed the data\n                    if (typeof responseText == \"object\") {\n                        data = responseText;\n                    } else {\n                        if (typeof obj.parser == 'function') {\n                            data = obj.parser(responseText);\n                            if (typeof data != 'object') {\n                                console.log('ERROR: Your parser did not return proper object');\n                            }\n                        } else {\n                            // $.parseJSON or $.getJSON did not work because those expect perfect JSON data - where everything is in double quotes\n                            //\n                            // TODO: avoid (potentially malicious) code injection from the response.\n                            try { eval('data = '+ responseText); } catch (e) { }\n                        }\n                    }\n                    // convert recids\n                    if (obj.recid) {\n                        for (var r in data.records) {\n                            data.records[r]['recid'] = data.records[r][obj.recid];\n                        }\n                    }\n                    if (typeof data == 'undefined') {\n                        data = {\n                            status       : 'error',\n                            message      : this.msgNotJSON,\n                            responseText : responseText\n                        };\n                    }\n                    if (data['status'] == 'error') {\n                        obj.error(data['message']);\n                    } else {\n                        if (cmd == 'get-records') {\n                            if (this.last.xhr_offset == 0) {\n                                this.records = [];\n                                this.summary = [];\n                                //data.xhr_status=data.status;\n                                delete data.status;\n                                $.extend(true, this, data);\n                            } else {\n                                var records = data.records;\n                                delete data.records;\n                                //data.xhr_status=data.status;\n                                delete data.status;\n                                $.extend(true, this, data);\n                                for (var r in records) {\n                                    this.records.push(records[r]);\n                                }\n                            }\n                        }\n                        if (cmd == 'delete-records') {\n                            // reset() also triggers reload\n                            this.reset(); // unselect old selections\n                            return;\n                        }\n                    }\n                }\n            } else {\n                data = {\n                    status       : 'error',\n                    message      : this.msgAJAXerror,\n                    responseText : responseText\n                };\n                obj.error(this.msgAJAXerror);\n            }\n            // event after\n            var url = (typeof this.url != 'object' ? this.url : this.url.get);\n            if (!url) {\n                this.localSort();\n                this.localSearch();\n            }\n            this.total = parseInt(this.total);\n            this.trigger($.extend(eventData, { phase: 'after' }));\n            // do not refresh if loading on infinite scroll\n            if (this.last.xhr_offset == 0) this.refresh(); else this.scroll();\n            // call back\n            if (typeof callBack == 'function') callBack(data);\n        },\n\n        error: function (msg) {\n            var obj = this;\n            // let the management of the error outside of the grid\n            var eventData = this.trigger({ target: this.name, type: 'error', message: msg , xhr: this.last.xhr });\n            if (eventData.isCancelled === true) {\n                if (typeof callBack == 'function') callBack({ status: 'error', message: 'Request aborted.' });\n                return;\n            }\n            w2alert(msg, 'Error');\n            // event after\n            this.trigger($.extend(eventData, { phase: 'after' }));\n        },\n\n        getChanges: function () {\n            var changes = [];\n            for (var r in this.records) {\n                var rec = this.records[r];\n                if (typeof rec['changes'] != 'undefined') {\n                    changes.push($.extend(true, { recid: rec.recid }, rec.changes));\n                }\n            }\n            return changes;\n        },\n\n        mergeChanges: function () {\n            var changes = this.getChanges();\n            for (var c in changes) {\n                var record = this.get(changes[c].recid);\n                for (var s in changes[c]) {\n                    if (s == 'recid') continue; // do not allow to change recid\n                    try { eval('record.' + s + ' = changes[c][s]'); } catch (e) {}\n                    delete record.changes;\n                }\n            }\n            this.refresh();\n        },\n\n        // ===================================================\n        // --  Action Handlers\n\n        save: function () {\n            var obj = this;\n            var changes = this.getChanges();\n            // event before\n            var eventData = this.trigger({ phase: 'before', target: this.name, type: 'submit', changes: changes });\n            if (eventData.isCancelled === true) return;\n            var url = (typeof this.url != 'object' ? this.url : this.url.save);\n            if (url) {\n                this.request('save-records', { 'changes' : eventData.changes }, null,\n                    function (data) {\n                        if (data.status !== 'error') {\n                            // only merge changes, if save was successful\n                            obj.mergeChanges();\n                        }\n                        // event after\n                        obj.trigger($.extend(eventData, { phase: 'after' }));\n                    }\n                );\n            } else {\n                this.mergeChanges();\n                // event after\n                this.trigger($.extend(eventData, { phase: 'after' }));\n            }\n        },\n\n        editField: function (recid, column, value, event) {\n            var obj   = this;\n            var index = obj.get(recid, true);\n            var rec   = obj.records[index];\n            var col   = obj.columns[column];\n            var edit  = col ? col.editable : null;\n            if (!rec || !col || !edit || rec.editable === false) return;\n            if (['enum', 'file'].indexOf(edit.type) != -1) {\n                console.log('ERROR: input types \"enum\" and \"file\" are not supported in inline editing.');\n                return;\n            }\n            // event before\n            var eventData = obj.trigger({ phase: 'before', type: 'editField', target: obj.name, recid: recid, column: column, value: value,\n                index: index, originalEvent: event });\n            if (eventData.isCancelled === true) return;\n            value = eventData.value;\n            // default behaviour\n            this.selectNone();\n            this.select({ recid: recid, column: column });\n            this.last.edit_col = column;\n            if (['checkbox', 'check'].indexOf(edit.type) != -1) return;\n            // create input element\n            var tr = $('#grid_'+ obj.name +'_rec_'+ w2utils.escapeId(recid));\n            var el = tr.find('[col='+ column +'] > div');\n            if (typeof edit.inTag   == 'undefined') edit.inTag   = '';\n            if (typeof edit.outTag  == 'undefined') edit.outTag  = '';\n            if (typeof edit.style   == 'undefined') edit.style   = '';\n            if (typeof edit.items   == 'undefined') edit.items   = [];\n            var val = (rec.changes && typeof rec.changes[col.field] != 'undefined' ? w2utils.stripTags(rec.changes[col.field]) : w2utils.stripTags(rec[col.field]));\n            if (val == null || typeof val == 'undefined') val = '';\n            if (typeof value != 'undefined' && value != null) val = value;\n            var addStyle = (typeof col.style != 'undefined' ? col.style + ';' : '');\n            if (typeof col.render == 'string' && ['number', 'int', 'float', 'money', 'percent'].indexOf(col.render.split(':')[0]) != -1) {\n                addStyle += 'text-align: right;';\n            }\n            // mormalize items\n            if (edit.items.length > 0 && !$.isPlainObject(edit.items[0])) {\n                edit.items = w2obj.field.prototype.normMenu(edit.items);\n            }\n            if (edit.type == 'select') {\n                var html = '';\n                for (var i in edit.items) {\n                    html += '<option value=\"'+ edit.items[i].id +'\" '+ (edit.items[i].id == val ? 'selected' : '') +'>'+ edit.items[i].text +'</option>';\n                }\n                el.addClass('w2ui-editable')\n                    .html('<select id=\"grid_'+ obj.name +'_edit_'+ recid +'_'+ column +'\" column=\"'+ column +'\" '+\n                        '    style=\"width: 100%; '+ addStyle + edit.style +'\" field=\"'+ col.field +'\" recid=\"'+ recid +'\" '+\n                        '    '+ edit.inTag +\n                        '>'+ html +'</select>' + edit.outTag);\n                el.find('select').focus()\n                    .on('change', function (event) {\n                        delete obj.last.move;\n                    })\n                    .on('blur', function (event) {\n                        obj.editChange.call(obj, this, index, column, event);\n                    });\n            } else {\n                el.addClass('w2ui-editable')\n                    .html('<input id=\"grid_'+ obj.name +'_edit_'+ recid +'_'+ column +'\" '+\n                        '    type=\"text\" style=\"font-family: inherit; font-size: inherit; outline: none; '+ addStyle + edit.style +'\" field=\"'+ col.field +'\" recid=\"'+ recid +'\" '+\n                        '    column=\"'+ column +'\" '+ edit.inTag +\n                        '>' + edit.outTag);\n                if (value == null) el.find('input').val(val != 'object' ? val : '');\n                // init w2field\n                var input = el.find('input').get(0);\n                $(input).w2field(edit.type, $.extend(edit, { selected: val }))\n                // add blur listener\n                setTimeout(function () {\n                    var tmp = input;\n                    if (edit.type == 'list') {\n                        tmp = $($(input).data('w2field').helpers.focus).find('input');\n                        if (typeof val != 'object' && val != '') tmp.val(val).css({ opacity: 1 }).prev().css({ opacity: 1 });\n                    }\n                    $(tmp).on('blur', function (event) {\n                        obj.editChange.call(obj, input, index, column, event);\n                    });\n                }, 10);\n                if (value != null) $(input).val(val != 'object' ? val : '');\n            }\n            setTimeout(function () {\n                el.find('input, select')\n                    .on('click', function (event) {\n                        event.stopPropagation();\n                    })\n                    .on('keydown', function (event) {\n                        var cancel = false;\n                        switch (event.keyCode) {\n                            case 9:  // tab\n                                cancel = true;\n                                var next_rec = recid;\n                                var next_col = event.shiftKey ? obj.prevCell(column, true) : obj.nextCell(column, true);\n                                // next or prev row\n                                if (next_col == null) {\n                                    var tmp = event.shiftKey ? obj.prevRow(index) : obj.nextRow(index);\n                                    if (tmp != null && tmp != index) {\n                                        next_rec = obj.records[tmp].recid;\n                                        // find first editable row\n                                        for (var c in obj.columns) {\n                                            var tmp = obj.columns[c].editable;\n                                            if (typeof tmp != 'undefined' && ['checkbox', 'check'].indexOf(tmp.type) == -1) {\n                                                next_col = parseInt(c);\n                                                if (!event.shiftKey) break;\n                                            }\n                                        }\n                                    }\n\n                                }\n                                if (next_rec === false) next_rec = recid;\n                                if (next_col == null) next_col = column;\n                                // init new or same record\n                                this.blur();\n                                setTimeout(function () {\n                                    if (obj.selectType != 'row') {\n                                        obj.selectNone();\n                                        obj.select({ recid: next_rec, column: next_col });\n                                    } else {\n                                        obj.editField(next_rec, next_col, null, event);\n                                    }\n                                }, 1);\n                                break;\n\n                            case 13: // enter\n                                this.blur();\n                                var next = event.shiftKey ? obj.prevRow(index) : obj.nextRow(index);\n                                if (next != null && next != index) {\n                                    setTimeout(function () {\n                                        if (obj.selectType != 'row') {\n                                            obj.selectNone();\n                                            obj.select({ recid: obj.records[next].recid, column: column });\n                                        } else {\n                                            obj.editField(obj.records[next].recid, column, null, event);\n                                        }\n                                    }, 100);\n                                }\n                                break;\n\n                            case 38: // up arrow\n                                if (!event.shiftKey) break;\n                                cancel = true;\n                                var next = obj.prevRow(index);\n                                if (next != index) {\n                                    this.blur();\n                                    setTimeout(function () {\n                                        if (obj.selectType != 'row') {\n                                            obj.selectNone();\n                                            obj.select({ recid: obj.records[next].recid, column: column });\n                                        } else {\n                                            obj.editField(obj.records[next].recid, column, null, event);\n                                        }\n                                    }, 1);\n                                }\n                                break;\n\n                            case 40: // down arrow\n                                if (!event.shiftKey) break;\n                                cancel = true;\n                                var next = obj.nextRow(index);\n                                if (next != null && next != index) {\n                                    this.blur();\n                                    setTimeout(function () {\n                                        if (obj.selectType != 'row') {\n                                            obj.selectNone();\n                                            obj.select({ recid: obj.records[next].recid, column: column });\n                                        } else {\n                                            obj.editField(obj.records[next].recid, column, null, event);\n                                        }\n                                    }, 1);\n                                }\n                                break;\n\n                            case 27: // escape\n                                var old = obj.parseField(rec, col.field);\n                                if (rec.changes && typeof rec.changes[col.field] != 'undefined') old = rec.changes[col.field];\n                                this.value = typeof old != 'undefined' ? old : '';\n                                this.blur();\n                                setTimeout(function () { obj.select({ recid: recid, column: column }) }, 1);\n                                break;\n                        }\n                        if (cancel) if (event.preventDefault) event.preventDefault();\n                    });\n                // focus and select\n                var tmp = el.find('input').focus();\n                if (value != null) {\n                    // set cursor to the end\n                    tmp[0].setSelectionRange(tmp.val().length, tmp.val().length);\n                } else {\n                    tmp.select();\n                }\n\n            }, 1);\n            // event after\n            obj.trigger($.extend(eventData, { phase: 'after' }));\n        },\n\n        editChange: function (el, index, column, event) {\n            // all other fields\n            var summary = index < 0;\n            index = index < 0 ? -index - 1 : index;\n            var records = summary ? this.summary : this.records;\n            var rec     = records[index];\n            var tr      = $('#grid_'+ this.name +'_rec_'+ w2utils.escapeId(rec.recid));\n            var col     = this.columns[column];\n            var new_val = el.value;\n            var old_val = this.parseField(rec, col.field);\n            var tmp     = $(el).data('w2field');\n            if (tmp) {\n                new_val = tmp.clean(new_val);\n                if (tmp.type == 'list' && new_val != '') new_val = $(el).data('selected');\n            }\n            if (el.type == 'checkbox') {\n                if (rec.editable === false) el.checked = !el.checked;\n                new_val = el.checked;\n            }\n            // change/restore event\n            var eventData = {\n                phase: 'before', type: 'change', target: this.name, input_id: el.id, recid: rec.recid, index: index, column: column,\n                value_new: new_val, value_previous: (rec.changes && rec.changes.hasOwnProperty(col.field) ? rec.changes[col.field]: old_val), value_original: old_val\n            };\n            while (true) {\n                new_val = eventData.value_new;\n                if ((typeof new_val != 'object' && String(old_val) != String(new_val)) || \n                    (typeof new_val == 'object' && (typeof old_val != 'object' || new_val.id != old_val.id))) {\n                    // change event\n                    eventData = this.trigger($.extend(eventData, { type: 'change', phase: 'before' }));\n                    if (eventData.isCancelled !== true) {\n                        if (new_val !== eventData.value_new) {\n                            // re-evaluate the type of change to be made\n                            continue;\n                        }\n                        // default action\n                        rec.changes = rec.changes || {};\n                        rec.changes[col.field] = eventData.value_new;\n                        // event after\n                        this.trigger($.extend(eventData, { phase: 'after' }));\n                    }\n                } else {\n                    // restore event\n                    eventData = this.trigger($.extend(eventData, { type: 'restore', phase: 'before' }));\n                    if (eventData.isCancelled !== true) {\n                        if (new_val !== eventData.value_new) {\n                            // re-evaluate the type of change to be made\n                            continue;\n                        }\n                        // default action\n                        if (rec.changes) delete rec.changes[col.field];\n                        if ($.isEmptyObject(rec.changes)) delete rec.changes;\n                        // event after\n                        this.trigger($.extend(eventData, { phase: 'after' }));\n                    }\n                }\n                break;\n            }\n            // refresh cell\n            var cell = this.getCellHTML(index, column, summary);\n            if (!summary) {\n                if (rec.changes && typeof rec.changes[col.field] != 'undefined') {\n                    $(tr).find('[col='+ column +']').addClass('w2ui-changed').html(cell);\n                } else {\n                    $(tr).find('[col='+ column +']').removeClass('w2ui-changed').html(cell);\n                }\n            }\n        },\n\n        \"delete\": function (force) {\n            var obj = this;\n            // event before\n            var eventData = this.trigger({ phase: 'before', target: this.name, type: 'delete', force: force });\n            if (eventData.isCancelled === true) return;\n            force = eventData.force;\n            // default action\n            var recs = this.getSelection();\n            if (recs.length == 0) return;\n            if (this.msgDelete != '' && !force) {\n                w2confirm({\n                    title   : w2utils.lang('Delete Confirmation'), \n                    msg     : obj.msgDelete, \n                    btn_yes : { \"class\": 'btn-red' },\n                    callBack: function (result) {\n                        if (result == 'Yes') w2ui[obj.name]['delete'](true);\n                    }\n                });\n                return;\n            }\n            // call delete script\n            var url = (typeof this.url != 'object' ? this.url : this.url.remove);\n            if (url) {\n                this.request('delete-records');\n            } else {\n                this.selectNone();\n                if (typeof recs[0] != 'object') {\n                    this.remove.apply(this, recs);\n                } else {\n                    // clear cells\n                    for (var r in recs) {\n                        var fld = this.columns[recs[r].column].field;\n                        var ind = this.get(recs[r].recid, true);\n                        if (ind != null && fld != 'recid') {\n                            this.records[ind][fld] = '';\n                            if (this.records[ind].changes) delete this.records[ind].changes[fld];\n                        }\n                    }\n                    this.refresh();\n                }\n            }\n            // event after\n            this.trigger($.extend(eventData, { phase: 'after' }));\n        },\n\n        click: function (recid, event) {\n            var time = (new Date()).getTime();\n            var column = null;\n            if (this.last.cancelClick == true || (event && event.altKey)) return;\n            if (typeof recid == 'object') {\n                column = recid.column;\n                recid  = recid.recid;\n            }\n            if (typeof event == 'undefined') event = {};\n            // check for double click\n            if (time - parseInt(this.last.click_time) < 350 && this.last.click_recid == recid && event.type == 'click') {\n                this.dblClick(recid, event);\n                return;\n            }\n            this.last.click_time  = time;\n            this.last.click_recid = recid;\n            // column user clicked on\n            if (column == null && event.target) {\n                var tmp = event.target;\n                if (tmp.tagName != 'TD') tmp = $(tmp).parents('td')[0];\n                if (typeof $(tmp).attr('col') != 'undefined') column = parseInt($(tmp).attr('col'));\n            }\n            // event before\n            var eventData = this.trigger({ phase: 'before', target: this.name, type: 'click', recid: recid, column: column, originalEvent: event });\n            if (eventData.isCancelled === true) return;\n            // if it is subgrid unselect top grid\n            var parent = $('#grid_'+ this.name +'_rec_'+ w2utils.escapeId(recid)).parents('tr');\n            if (parent.length > 0 && String(parent.attr('id')).indexOf('expanded_row') != -1) {\n                var grid  = parent.parents('.w2ui-grid').attr('name');\n                w2ui[grid].selectNone();\n                // all subgrids\n                parent.parents('.w2ui-grid').find('.w2ui-expanded-row .w2ui-grid').each(function (index, el) {\n                    var grid = $(el).attr('name');\n                    if (w2ui[grid]) w2ui[grid].selectNone();\n                });\n            }\n            // unselect all subgrids\n            $(this.box).find('.w2ui-expanded-row .w2ui-grid').each(function (index, el) {\n                var grid = $(el).attr('name');\n                if (w2ui[grid]) w2ui[grid].selectNone();\n            });\n            // default action\n            var obj = this;\n            var sel = this.getSelection();\n            $('#grid_'+ this.name +'_check_all').prop(\"checked\", false);\n            var ind    = this.get(recid, true);\n            var record = this.records[ind];\n            var selectColumns  = [];\n            obj.last.sel_ind   = ind;\n            obj.last.sel_col   = column;\n            obj.last.sel_recid = recid;\n            obj.last.sel_type  = 'click';\n            // multi select with shif key\n            if (event.shiftKey && sel.length > 0 && obj.multiSelect) {\n                if (sel[0].recid) {\n                    var start = this.get(sel[0].recid, true);\n                    var end   = this.get(recid, true);\n                    if (column > sel[0].column) {\n                        var t1 = sel[0].column;\n                        var t2 = column;\n                    } else {\n                        var t1 = column;\n                        var t2 = sel[0].column;\n                    }\n                    for (var c = t1; c <= t2; c++) selectColumns.push(c);\n                } else {\n                    var start = this.get(sel[0], true);\n                    var end   = this.get(recid, true);\n                }\n                var sel_add = []\n                if (start > end) { var tmp = start; start = end; end = tmp; }\n                var url = (typeof this.url != 'object' ? this.url : this.url.get);\n                for (var i = start; i <= end; i++) {\n                    if (this.searchData.length > 0 && !url && $.inArray(i, this.last.searchIds) == -1) continue;\n                    if (this.selectType == 'row') {\n                        sel_add.push(this.records[i].recid);\n                    } else {\n                        for (var sc in selectColumns) sel_add.push({ recid: this.records[i].recid, column: selectColumns[sc] });\n                    }\n                    //sel.push(this.records[i].recid);\n                }\n                this.select.apply(this, sel_add);\n            } else {\n                var last = this.last.selection;\n                var flag = (last.indexes.indexOf(ind) != -1 ? true : false);\n                // clear other if necessary\n                if (((!event.ctrlKey && !event.shiftKey && !event.metaKey) || !this.multiSelect) && !this.showSelectColumn) {\n                    if (this.selectType != 'row' && $.inArray(column, last.columns[ind]) == -1) flag = false;\n                    if (sel.length > 300) this.selectNone(); else this.unselect.apply(this, sel);\n                    if (flag === true) {\n                        this.unselect({ recid: recid, column: column });\n                    } else {\n                        this.select({ recid: recid, column: column });\n                    }\n                } else {\n                    if (this.selectType != 'row' && $.inArray(column, last.columns[ind]) == -1) flag = false;\n                    if (flag === true) {\n                        this.unselect({ recid: recid, column: column });\n                    } else {\n                        this.select({ recid: recid, column: column });\n                    }\n                }\n            }\n            this.status();\n            obj.initResize();\n            // event after\n            this.trigger($.extend(eventData, { phase: 'after' }));\n        },\n\n        columnClick: function (field, event) {\n            // event before\n            var eventData = this.trigger({ phase: 'before', type: 'columnClick', target: this.name, field: field, originalEvent: event });\n            if (eventData.isCancelled === true) return;\n            // default behaviour\n            var column = this.getColumn(field);\n            if (column && column.sortable) {\n                this.sort(field, null, (event && (event.ctrlKey || event.metaKey) ? true : false) );\n            }\n            // event after\n            this.trigger($.extend(eventData, { phase: 'after' }));\n        },\n\n        keydown: function (event) {\n            // this method is called from w2utils\n            var obj = this;\n            if (obj.keyboard !== true) return;\n            // trigger event\n            var eventData = obj.trigger({ phase: 'before', type: 'keydown', target: obj.name, originalEvent: event });\n            if (eventData.isCancelled === true) return;\n            // default behavior\n            var empty   = false;\n            var records = $('#grid_'+ obj.name +'_records');\n            var sel     = obj.getSelection();\n            if (sel.length == 0) empty = true;\n            var recid   = sel[0] || null;\n            var columns = [];\n            var recid2  = sel[sel.length-1];\n            if (typeof recid == 'object' && recid != null) {\n                recid   = sel[0].recid;\n                columns = [];\n                var ii  = 0;\n                while (true) {\n                    if (!sel[ii] || sel[ii].recid != recid) break;\n                    columns.push(sel[ii].column);\n                    ii++;\n                }\n                recid2  = sel[sel.length-1].recid;\n            }\n            var ind    = obj.get(recid, true);\n            var ind2   = obj.get(recid2, true);\n            var rec    = obj.get(recid);\n            var recEL  = $('#grid_'+ obj.name +'_rec_'+ (ind !== null ? w2utils.escapeId(obj.records[ind].recid) : 'none'));\n            var cancel = false;\n            var key    = event.keyCode;\n            var shiftKey= event.shiftKey;\n            if (key == 9) { // tab key\n                if (event.shiftKey) key = 37; else key = 39; // replace with arrows\n                shiftKey = false;\n                cancel   = true;\n            }\n            switch (key) {\n                case 8:  // backspace\n                case 46: // delete\n                    if (this.show.toolbarDelete) obj[\"delete\"]();\n                    cancel = true;\n                    event.stopPropagation();\n                    break;\n\n                case 27: // escape\n                    obj.selectNone();\n                    if (sel.length > 0 && typeof sel[0] == 'object') {\n                        obj.select({ recid: sel[0].recid, column: sel[0].column });\n                    }\n                    cancel = true;\n                    break;\n\n                case 65: // cmd + A\n                    if (!event.metaKey && !event.ctrlKey) break;\n                    obj.selectAll();\n                    cancel = true;\n                    break;\n\n                case 70: // cmd + F\n                    if (!event.metaKey && !event.ctrlKey) break;\n                    $('#grid_'+ obj.name + '_search_all').focus();\n                    cancel = true;\n                    break;\n\n                case 13: // enter\n                    // if expandable columns - expand it\n                    if (this.selectType == 'row' && obj.show.expandColumn === true) {\n                        if (recEL.length <= 0) break;\n                        obj.toggle(recid, event);\n                        cancel = true;\n                    } else { // or enter edit\n                        for (var c in this.columns) {\n                            if (this.columns[c].editable) {\n                                columns.push(parseInt(c));\n                                break;\n                            }\n                        }\n                        // edit last column that was edited\n                        if (this.selectType == 'row' && this.last.edit_col) columns = [this.last.edit_col];\n                        if (columns.length > 0) {\n                            obj.editField(recid, columns[0], null, event);\n                            cancel = true;\n                        }\n                    }\n                    break;\n\n                case 37: // left\n                    if (empty) break;\n                    // check if this is subgrid\n                    var parent = $('#grid_'+ this.name +'_rec_'+ w2utils.escapeId(obj.records[ind].recid)).parents('tr');\n                    if (parent.length > 0 && String(parent.attr('id')).indexOf('expanded_row') != -1) {\n                        var recid = parent.prev().attr('recid');\n                        var grid  = parent.parents('.w2ui-grid').attr('name');\n                        obj.selectNone();\n                        w2utils.keyboard.active(grid);\n                        w2ui[grid].set(recid, { expanded: false });\n                        w2ui[grid].collapse(recid);\n                        w2ui[grid].click(recid);\n                        cancel = true;\n                        break;\n                    }\n                    if (this.selectType == 'row') {\n                        if (recEL.length <= 0 || rec.expanded !== true ) break;\n                        obj.set(recid, { expanded: false }, true);\n                        obj.collapse(recid, event);\n                    } else {\n                        var prev = obj.prevCell(columns[0]);\n                        if (prev != null) {\n                            if (shiftKey && obj.multiSelect) {\n                                if (tmpUnselect()) return;\n                                var tmp    = [];\n                                var newSel = [];\n                                var unSel  = [];\n                                if (columns.indexOf(this.last.sel_col) == 0 && columns.length > 1) {\n                                    for (var i in sel) {\n                                        if (tmp.indexOf(sel[i].recid) == -1) tmp.push(sel[i].recid);\n                                        unSel.push({ recid: sel[i].recid, column: columns[columns.length-1] });\n                                    }\n                                } else {\n                                    for (var i in sel) {\n                                        if (tmp.indexOf(sel[i].recid) == -1) tmp.push(sel[i].recid);\n                                        newSel.push({ recid: sel[i].recid, column: prev });\n                                    }\n                                }\n                                obj.unselect.apply(obj, unSel);\n                                obj.select.apply(obj, newSel);\n                            } else {\n                                event.shiftKey = false;\n                                obj.click({ recid: recid, column: prev }, event);\n                            }\n                        } else {\n                            // if selected more then one, then select first\n                            if (!shiftKey) {\n                                for (var s=1; s<sel.length; s++) obj.unselect(sel[s]);\n                            }\n                        }\n                    }\n                    cancel = true;\n                    break;\n\n                case 39: // right\n                    if (empty) break;\n                    if (this.selectType == 'row') {\n                        if (recEL.length <= 0 || rec.expanded === true || obj.show.expandColumn !== true) break;\n                        obj.expand(recid, event);\n                    } else {\n                        var next = obj.nextCell(columns[columns.length-1]);\n                        if (next !== null) {\n                            if (shiftKey && key == 39 && obj.multiSelect) {\n                                if (tmpUnselect()) return;\n                                var tmp    = [];\n                                var newSel = [];\n                                var unSel  = [];\n                                if (columns.indexOf(this.last.sel_col) == columns.length-1 && columns.length > 1) {\n                                    for (var i in sel) {\n                                        if (tmp.indexOf(sel[i].recid) == -1) tmp.push(sel[i].recid);\n                                        unSel.push({ recid: sel[i].recid, column: columns[0] });\n                                    }\n                                } else {\n                                    for (var i in sel) {\n                                        if (tmp.indexOf(sel[i].recid) == -1) tmp.push(sel[i].recid);\n                                        newSel.push({ recid: sel[i].recid, column: next });\n                                    }\n                                }\n                                obj.unselect.apply(obj, unSel);\n                                obj.select.apply(obj, newSel);\n                            } else {\n                                obj.click({ recid: recid, column: next }, event);\n                            }\n                        } else {\n                            // if selected more then one, then select first\n                            if (!shiftKey) {\n                                for (var s=0; s<sel.length-1; s++) obj.unselect(sel[s]);\n                            }\n                        }\n                    }\n                    cancel = true;\n                    break;\n\n                case 38: // up\n                    if (empty) selectTopRecord();\n                    if (recEL.length <= 0) break;\n                    // move to the previous record\n                    var prev = obj.prevRow(ind);\n                    if (prev != null) {\n                        // jump into subgrid\n                        if (obj.records[prev].expanded) {\n                            var subgrid = $('#grid_'+ obj.name +'_rec_'+ w2utils.escapeId(obj.records[prev].recid) +'_expanded_row').find('.w2ui-grid');\n                            if (subgrid.length > 0 && w2ui[subgrid.attr('name')]) {\n                                obj.selectNone();\n                                var grid = subgrid.attr('name');\n                                var recs = w2ui[grid].records;\n                                w2utils.keyboard.active(grid);\n                                w2ui[grid].click(recs[recs.length-1].recid);\n                                cancel = true;\n                                break;\n                            }\n                        }\n                        if (shiftKey && obj.multiSelect) { // expand selection\n                            if (tmpUnselect()) return;\n                            if (obj.selectType == 'row') {\n                                if (obj.last.sel_ind > prev && obj.last.sel_ind != ind2) {\n                                    obj.unselect(obj.records[ind2].recid);\n                                } else {\n                                    obj.select(obj.records[prev].recid);\n                                }\n                            } else {\n                                if (obj.last.sel_ind > prev && obj.last.sel_ind != ind2) {\n                                    prev = ind2;\n                                    var tmp = [];\n                                    for (var c in columns) tmp.push({ recid: obj.records[prev].recid, column: columns[c] });\n                                    obj.unselect.apply(obj, tmp);\n                                } else {\n                                    var tmp = [];\n                                    for (var c in columns) tmp.push({ recid: obj.records[prev].recid, column: columns[c] });\n                                    obj.select.apply(obj, tmp);\n                                }\n                            }\n                        } else { // move selected record\n                            if (sel.length > 300) this.selectNone(); else this.unselect.apply(this, sel);\n                            obj.click({ recid: obj.records[prev].recid, column: columns[0] }, event);\n                        }\n                        obj.scrollIntoView(prev);\n                        if (event.preventDefault) event.preventDefault();\n                    } else {\n                        // if selected more then one, then select first\n                        if (!shiftKey) {\n                            for (var s=1; s<sel.length; s++) obj.unselect(sel[s]);\n                        }\n                        // jump out of subgird (if first record)\n                        var parent = $('#grid_'+ obj.name +'_rec_'+ w2utils.escapeId(obj.records[ind].recid)).parents('tr');\n                        if (parent.length > 0 && String(parent.attr('id')).indexOf('expanded_row') != -1) {\n                            var recid = parent.prev().attr('recid');\n                            var grid  = parent.parents('.w2ui-grid').attr('name');\n                            obj.selectNone();\n                            w2utils.keyboard.active(grid);\n                            w2ui[grid].click(recid);\n                            cancel = true;\n                            break;\n                        }\n                    }\n                    break;\n\n                case 40: // down\n                    if (empty) selectTopRecord();\n                    if (recEL.length <= 0) break;\n                    // jump into subgrid\n                    if (obj.records[ind2].expanded) {\n                        var subgrid = $('#grid_'+ this.name +'_rec_'+ w2utils.escapeId(obj.records[ind2].recid) +'_expanded_row').find('.w2ui-grid');\n                        if (subgrid.length > 0 && w2ui[subgrid.attr('name')]) {\n                            obj.selectNone();\n                            var grid = subgrid.attr('name');\n                            var recs = w2ui[grid].records;\n                            w2utils.keyboard.active(grid);\n                            w2ui[grid].click(recs[0].recid);\n                            cancel = true;\n                            break;\n                        }\n                    }\n                    // move to the next record\n                    var next = obj.nextRow(ind2);\n                    if (next != null) {\n                        if (shiftKey && obj.multiSelect) { // expand selection\n                            if (tmpUnselect()) return;\n                            if (obj.selectType == 'row') {\n                                if (this.last.sel_ind < next && this.last.sel_ind != ind) {\n                                    obj.unselect(obj.records[ind].recid);\n                                } else {\n                                    obj.select(obj.records[next].recid);\n                                }\n                            } else {\n                                if (this.last.sel_ind < next && this.last.sel_ind != ind) {\n                                    next = ind;\n                                    var tmp = [];\n                                    for (var c in columns) tmp.push({ recid: obj.records[next].recid, column: columns[c] });\n                                    obj.unselect.apply(obj, tmp);\n                                } else {\n                                    var tmp = [];\n                                    for (var c in columns) tmp.push({ recid: obj.records[next].recid, column: columns[c] });\n                                    obj.select.apply(obj, tmp);\n                                }\n                            }\n                        } else { // move selected record\n                            if (sel.length > 300) this.selectNone(); else this.unselect.apply(this, sel);\n                            obj.click({ recid: obj.records[next].recid, column: columns[0] }, event);\n                        }\n                        obj.scrollIntoView(next);\n                        cancel = true;\n                    } else {\n                        // if selected more then one, then select first\n                        if (!shiftKey) {\n                            for (var s=0; s<sel.length-1; s++) obj.unselect(sel[s]);\n                        }\n                        // jump out of subgrid (if last record in subgrid)\n                        var parent = $('#grid_'+ this.name +'_rec_'+ w2utils.escapeId(obj.records[ind2].recid)).parents('tr');\n                        if (parent.length > 0 && String(parent.attr('id')).indexOf('expanded_row') != -1) {\n                            var recid = parent.next().attr('recid');\n                            var grid  = parent.parents('.w2ui-grid').attr('name');\n                            obj.selectNone();\n                            w2utils.keyboard.active(grid);\n                            w2ui[grid].click(recid);\n                            cancel = true;\n                            break;\n                        }\n                    }\n                    break;\n\n                // copy & paste\n\n                case 17: // ctrl key\n                case 91: // cmd key\n                    if (empty) break;\n                    var text = obj.copy();\n                    $('body').append('<textarea id=\"_tmp_copy_data\" '+\n                        '   onpaste=\"var obj = this; setTimeout(function () { w2ui[\\''+ obj.name + '\\'].paste(obj.value); }, 1);\" '+\n                        '   onkeydown=\"w2ui[\\''+ obj.name +'\\'].keydown(event)\"'+\n                        '   style=\"position: absolute; top: -100px; height: 1px; width: 1px\">'+ text +'</textarea>');\n                    $('#_tmp_copy_data').focus().select();\n                    // remove _tmp_copy_data textarea\n                    $(document).on('keyup', tmp_key_down);\n                    function tmp_key_down() { \n                        $('#_tmp_copy_data').remove(); \n                        $(document).off('keyup', tmp_key_down); \n                    }\n                    break;\n\n                case 88: // x - cut\n                    if (empty) break;\n                    if (event.ctrlKey || event.metaKey) {\n                        setTimeout(function () { obj[\"delete\"](true); }, 100);\n                    }\n                    break;\n            }\n            var tmp = [187, 189, 32]; // =-spacebar\n            for (var i=48; i<=90; i++) tmp.push(i); // 0-9,a-z,A-Z\n            if (tmp.indexOf(key) != -1 && !event.ctrlKey && !event.metaKey && !cancel) {\n                if (columns.length == 0) columns.push(0);\n                var tmp = String.fromCharCode(key);\n                if (key == 187) tmp = '=';\n                if (key == 189) tmp = '-';\n                if (!shiftKey)  tmp = tmp.toLowerCase();\n                obj.editField(recid, columns[0], tmp, event);\n                cancel = true;\n            }\n            if (cancel) { // cancel default behaviour\n                if (event.preventDefault) event.preventDefault();\n            }\n            // event after\n            obj.trigger($.extend(eventData, { phase: 'after' }));\n\n            function selectTopRecord() {\n                var ind = Math.floor((records[0].scrollTop + (records.height() / 2.1)) / obj.recordHeight);\n                if (!obj.records[ind]) ind = 0;\n                obj.select({ recid: obj.records[ind].recid, column: 0});\n            }\n\n            function tmpUnselect () {\n                if (obj.last.sel_type != 'click') return false;\n                if (obj.selectType != 'row') {\n                    obj.last.sel_type = 'key';\n                    if (sel.length > 1) {\n                        for (var s in sel) {\n                            if (sel[s].recid == obj.last.sel_recid && sel[s].column == obj.last.sel_col) {\n                                sel.splice(s, 1);\n                                break;\n                            }\n                        }\n                        obj.unselect.apply(obj, sel);\n                        return true;\n                    }\n                    return false;\n                } else {\n                    obj.last.sel_type = 'key';\n                    if (sel.length > 1) {\n                        sel.splice(sel.indexOf(obj.records[obj.last.sel_ind].recid), 1);\n                        obj.unselect.apply(obj, sel);\n                        return true;\n                    }\n                    return false;\n                }\n            }\n        },\n\n        scrollIntoView: function (ind) {\n            var buffered = this.records.length;\n            if (this.searchData.length != 0 && !this.url) buffered = this.last.searchIds.length;\n            if (typeof ind == 'undefined') {\n                var sel = this.getSelection();\n                if (sel.length == 0) return;\n                ind = this.get(sel[0], true);\n            }\n            var records = $('#grid_'+ this.name +'_records');\n            if (buffered == 0) return;\n            // if all records in view\n            var len = this.last.searchIds.length;\n            if (records.height() > this.recordHeight * (len > 0 ? len : buffered)) return;\n            if (len > 0) ind = this.last.searchIds.indexOf(ind); // if seach is applied\n            // scroll to correct one\n            var t1 = Math.floor(records[0].scrollTop / this.recordHeight);\n            var t2 = t1 + Math.floor(records.height() / this.recordHeight);\n            if (ind == t1) records.animate({ 'scrollTop': records.scrollTop() - records.height() / 1.3 }, 250, 'linear');\n            if (ind == t2) records.animate({ 'scrollTop': records.scrollTop() + records.height() / 1.3 }, 250, 'linear');\n            if (ind < t1 || ind > t2) records.animate({ 'scrollTop': (ind - 1) * this.recordHeight });\n        },\n\n        dblClick: function (recid, event) {\n            //if (window.getSelection) window.getSelection().removeAllRanges(); // clear selection\n            // find columns\n            var column = null;\n            if (typeof recid == 'object') {\n                column = recid.column;\n                recid  = recid.recid;\n            }\n            if (typeof event == 'undefined') event = {};\n            // column user clicked on\n            if (column == null && event.target) {\n                var tmp = event.target;\n                if (tmp.tagName != 'TD') tmp = $(tmp).parents('td')[0];\n                column = parseInt($(tmp).attr('col'));\n            }\n            // event before\n            var eventData = this.trigger({ phase: 'before', target: this.name, type: 'dblClick', recid: recid, column: column, originalEvent: event });\n            if (eventData.isCancelled === true) return;\n            // default action\n            this.selectNone();\n            var col = this.columns[column];\n            if (col && $.isPlainObject(col.editable)) {\n                this.editField(recid, column, null, event);\n            } else {\n                this.select({ recid: recid, column: column });\n            }\n            // event after\n            this.trigger($.extend(eventData, { phase: 'after' }));\n        },\n\n        contextMenu: function (recid, event) {\n            var obj = this;\n            if (obj.last.userSelect == 'text') return;\n            if (typeof event == 'undefined') event = { offsetX: 0, offsetY: 0, target: $('#grid_'+ obj.name +'_rec_'+ recid)[0] };\n            if (typeof event.offsetX === 'undefined') {\n                event.offsetX = event.layerX - event.target.offsetLeft;\n                event.offsetY = event.layerY - event.target.offsetTop;\n            }\n            if (w2utils.isFloat(recid)) recid = parseFloat(recid);\n            if (this.getSelection().indexOf(recid) == -1) obj.click(recid);\n            // need timeout to allow click to finish first\n            setTimeout(function () {\n                // event before\n                var eventData = obj.trigger({ phase: 'before', type: 'contextMenu', target: obj.name, originalEvent: event, recid: recid });\n                if (eventData.isCancelled === true) return;\n                // default action\n                if (obj.menu.length > 0) {\n                    $(obj.box).find(event.target)\n                        .w2menu(obj.menu, {\n                            left    : event.offsetX,\n                            onSelect: function (event) { \n                                obj.menuClick(recid, parseInt(event.index), event.originalEvent); \n                            }\n                        }\n                    );\n                }\n                // event after\n                obj.trigger($.extend(eventData, { phase: 'after' }));\n            }, 150); // need timer 150 for FF\n            // cancel event\n            if (event.preventDefault) event.preventDefault();\n        },\n\n        menuClick: function (recid, index, event) {\n            var obj = this;\n            // event before\n            var eventData = obj.trigger({ phase: 'before', type: 'menuClick', target: obj.name, originalEvent: event, \n                recid: recid, menuIndex: index, menuItem: obj.menu[index] });\n            if (eventData.isCancelled === true) return;\n            // default action\n            // -- empty\n            // event after\n            obj.trigger($.extend(eventData, { phase: 'after' }));\n        },\n\n        toggle: function (recid) {\n            var rec = this.get(recid);\n            if (rec.expanded === true) return this.collapse(recid); else return this.expand(recid);\n        },\n\n        expand: function (recid) {\n            var rec = this.get(recid);\n            var obj = this;\n            var id  = w2utils.escapeId(recid);\n            if ($('#grid_'+ this.name +'_rec_'+ id +'_expanded_row').length > 0) return false;\n            if (rec.expanded == 'none') return false;\n            // insert expand row\n            var tmp = 1 + (this.show.selectColumn ? 1 : 0);\n            var addClass = ''; // ($('#grid_'+this.name +'_rec_'+ w2utils.escapeId(recid)).hasClass('w2ui-odd') ? 'w2ui-odd' : 'w2ui-even');\n            $('#grid_'+ this.name +'_rec_'+ id).after(\n                    '<tr id=\"grid_'+ this.name +'_rec_'+ recid +'_expanded_row\" class=\"w2ui-expanded-row '+ addClass +'\">'+\n                        (this.show.lineNumbers ? '<td class=\"w2ui-col-number\"></td>' : '') +\n                    '    <td class=\"w2ui-grid-data w2ui-expanded1\" colspan=\"'+ tmp +'\"><div style=\"display: none\"></div></td>'+\n                    '    <td colspan=\"100\" class=\"w2ui-expanded2\">'+\n                    '        <div id=\"grid_'+ this.name +'_rec_'+ recid +'_expanded\" style=\"opacity: 0\"></div>'+\n                    '    </td>'+\n                    '</tr>');\n            // event before\n            var eventData = this.trigger({ phase: 'before', type: 'expand', target: this.name, recid: recid,\n                box_id: 'grid_'+ this.name +'_rec_'+ recid +'_expanded', ready: ready });\n            if (eventData.isCancelled === true) {\n                $('#grid_'+ this.name +'_rec_'+ id +'_expanded_row').remove();\n                return;\n            }\n            // default action\n            $('#grid_'+ this.name +'_rec_'+ id).attr('expanded', 'yes').addClass('w2ui-expanded');\n            $('#grid_'+ this.name +'_rec_'+ id +'_expanded_row').show();\n            $('#grid_'+ this.name +'_cell_'+ this.get(recid, true) +'_expand div').html('<div class=\"w2ui-spinner\" style=\"width: 16px; height: 16px; margin: -2px 2px;\"></div>');\n            rec.expanded = true;\n            // check if height of expanded row > 5 then remove spinner\n            setTimeout(ready, 300);\n            function ready() {\n                var div1 = $('#grid_'+ obj.name +'_rec_'+ id +'_expanded');\n                var div2 = $('#grid_'+ obj.name +'_rec_'+ id +'_expanded_row .w2ui-expanded1 > div');\n                if (div1.height() < 5) return;\n                div1.css('opacity', 1);\n                div2.show().css('opacity', 1);\n                $('#grid_'+ obj.name +'_cell_'+ obj.get(recid, true) +'_expand div').html('-');\n            }\n            // event after\n            this.trigger($.extend(eventData, { phase: 'after' }));\n            this.resizeRecords();\n            return true;\n        },\n\n        collapse: function (recid) {\n            var rec = this.get(recid);\n            var obj = this;\n            var id  = w2utils.escapeId(recid);\n            if ($('#grid_'+ this.name +'_rec_'+ id +'_expanded_row').length == 0) return false;\n            // event before\n            var eventData = this.trigger({ phase: 'before', type: 'collapse', target: this.name, recid: recid,\n                box_id: 'grid_'+ this.name +'_rec_'+ id +'_expanded' });\n            if (eventData.isCancelled === true) return;\n            // default action\n            $('#grid_'+ this.name +'_rec_'+ id).removeAttr('expanded').removeClass('w2ui-expanded');\n            $('#grid_'+ this.name +'_rec_'+ id +'_expanded').css('opacity', 0);\n            $('#grid_'+ this.name +'_cell_'+ this.get(recid, true) +'_expand div').html('+');\n            setTimeout(function () {\n                $('#grid_'+ obj.name +'_rec_'+ id +'_expanded').height('0px');\n                setTimeout(function () {\n                    $('#grid_'+ obj.name +'_rec_'+ id +'_expanded_row').remove();\n                    delete rec.expanded;\n                    // event after\n                    obj.trigger($.extend(eventData, { phase: 'after' }));\n                    obj.resizeRecords();\n                }, 300);\n            }, 200);\n            return true;\n        },\n\n        sort: function (field, direction, multiField) { // if no params - clears sort\n            // event before\n            var eventData = this.trigger({ phase: 'before', type: 'sort', target: this.name, field: field, direction: direction, multiField: multiField });\n            if (eventData.isCancelled === true) return;\n            // check if needed to quit\n            if (typeof field != 'undefined') {\n                // default action\n                var sortIndex = this.sortData.length;\n                for (var s in this.sortData) {\n                    if (this.sortData[s].field == field) { sortIndex = s; break; }\n                }\n                if (typeof direction == 'undefined' || direction == null) {\n                    if (typeof this.sortData[sortIndex] == 'undefined') {\n                        direction = 'asc';\n                    } else {\n                        switch (String(this.sortData[sortIndex].direction)) {\n                            case 'asc'  : direction = 'desc'; break;\n                            case 'desc' : direction = 'asc';  break;\n                            default     : direction = 'asc';  break;\n                        }\n                    }\n                }\n                if (this.multiSort === false) { this.sortData = []; sortIndex = 0; }\n                if (multiField != true) { this.sortData = []; sortIndex = 0; }\n                // set new sort\n                if (typeof this.sortData[sortIndex] == 'undefined') this.sortData[sortIndex] = {};\n                this.sortData[sortIndex].field        = field;\n                this.sortData[sortIndex].direction = direction;\n            } else {\n                this.sortData = [];\n            }\n            this.selectNone();\n            // if local\n            var url = (typeof this.url != 'object' ? this.url : this.url.get);\n            if (!url) {\n                this.localSort();\n                if (this.searchData.length > 0) this.localSearch(true);\n                // event after\n                this.trigger($.extend(eventData, { phase: 'after' }));\n                this.refresh();\n            } else {\n                // event after\n                this.trigger($.extend(eventData, { phase: 'after' }));\n                this.last.xhr_offset = 0;\n                this.reload();\n            }\n        },\n\n        copy: function () {\n            var sel = this.getSelection();\n            if (sel.length == 0) return '';\n            var text = '';\n            if (typeof sel[0] == 'object') { // cell copy\n                // find min/max column\n                var minCol = sel[0].column;\n                var maxCol = sel[0].column;\n                var recs   = [];\n                for (var s in sel) {\n                    if (sel[s].column < minCol) minCol = sel[s].column;\n                    if (sel[s].column > maxCol) maxCol = sel[s].column;\n                    if (recs.indexOf(sel[s].index) == -1) recs.push(sel[s].index);\n                }\n                recs.sort();\n                for (var r in recs) {\n                    var ind = recs[r];\n                    for (var c = minCol; c <= maxCol; c++) {\n                        var col = this.columns[c];\n                        if (col.hidden === true) continue;\n                        text += w2utils.stripTags(this.getCellHTML(ind, c)) + '\\t';\n                    }\n                    text = text.substr(0, text.length-1); // remove last \\t\n                    text += '\\n';\n                }\n            } else { // row copy\n                // copy headers\n                for (var c in this.columns) {\n                    var col = this.columns[c];\n                    if (col.hidden === true) continue;\n                    text += '\"' + w2utils.stripTags(col.caption ? col.caption : col.field) + '\"\\t';\n                }\n                text = text.substr(0, text.length-1); // remove last \\t\n                text += '\\n';\n                // copy selected text                \n                for (var s in sel) {\n                    var ind = this.get(sel[s], true);\n                    for (var c in this.columns) {\n                        var col = this.columns[c];\n                        if (col.hidden === true) continue;\n                        text += '\"' + w2utils.stripTags(this.getCellHTML(ind, c)) + '\"\\t';\n                    }\n                    text = text.substr(0, text.length-1); // remove last \\t\n                    text += '\\n';\n                }\n            }\n            text = text.substr(0, text.length - 1);\n            // before event\n            var eventData = this.trigger({ phase: 'before', type: 'copy', target: this.name, text: text });\n            if (eventData.isCancelled === true) return '';\n            text = eventData.text;\n            // event after\n            this.trigger($.extend(eventData, { phase: 'after' }));\n            return text;\n        },\n\n        paste: function (text) {\n            var sel = this.getSelection();\n            var ind = this.get(sel[0].recid, true);\n            var col = sel[0].column;\n            // before event\n            var eventData = this.trigger({ phase: 'before', type: 'paste', target: this.name, text: text, index: ind, column: col });\n            if (eventData.isCancelled === true) return;\n            text = eventData.text;\n            // default action\n            if (this.selectType == 'row' || sel.length == 0) {\n                console.log('ERROR: You can paste only if grid.selectType = \\'cell\\' and when at least one cell selected.');\n                // event after\n                this.trigger($.extend(eventData, { phase: 'after' }));\n                return;\n            }\n            var newSel = [];\n            var text   = text.split('\\n');\n            for (var t in text) {\n                var tmp  = text[t].split('\\t');\n                var cnt  = 0;\n                var rec  = this.records[ind];\n                var cols = [];\n                for (var dt in tmp) {\n                    if (!this.columns[col + cnt]) continue;\n                    var field = this.columns[col + cnt].field;\n                    rec.changes = rec.changes || {};\n                    rec.changes[field] = tmp[dt];\n                    cols.push(col + cnt);\n                    cnt++;\n                }\n                for (var c in cols) newSel.push({ recid: rec.recid, column: cols[c] });\n                ind++;\n            }\n            this.selectNone();\n            this.select.apply(this, newSel);\n            this.refresh();\n            // event after\n            this.trigger($.extend(eventData, { phase: 'after' }));\n        },\n\n        // ==================================================\n        // --- Common functions\n\n        resize: function () {\n            var obj  = this;\n            var time = (new Date()).getTime();\n            //if (window.getSelection) window.getSelection().removeAllRanges(); // clear selection\n            // make sure the box is right\n            if (!this.box || $(this.box).attr('name') != this.name) return;\n            // determine new width and height\n            $(this.box).find('> div')\n                .css('width', $(this.box).width())\n                .css('height', $(this.box).height());\n            // event before\n            var eventData = this.trigger({ phase: 'before', type: 'resize', target: this.name });\n            if (eventData.isCancelled === true) return;\n            // resize\n            obj.resizeBoxes();\n            obj.resizeRecords();\n            // event after\n            this.trigger($.extend(eventData, { phase: 'after' }));\n            return (new Date()).getTime() - time;\n        },\n\n        refreshCell: function (recid, field) {\n            var index     = this.get(recid, true);\n            var isSummary = (this.records[index] && this.records[index].recid == recid ? false : true);\n            var col_ind   = this.getColumn(field, true);\n            var rec       = (isSummary ? this.summary[index] : this.records[index]);\n            var col       = this.columns[col_ind];\n            var cell      = $('#grid_'+ this.name + '_rec_'+ recid +' [col='+ col_ind +']');\n            // set cell html and changed flag\n            cell.html(this.getCellHTML(index, col_ind, isSummary));\n            if (rec.changes && typeof rec.changes[col.field] != 'undefined') {\n                cell.addClass('w2ui-changed');\n            } else {\n                cell.removeClass('w2ui-changed');\n            }\n        },\n\n        refreshRow: function (recid) {\n            var tr = $('#grid_'+ this.name +'_rec_'+ w2utils.escapeId(recid));\n            if (tr.length != 0) {\n                var ind  = this.get(recid, true);\n                var line = tr.attr('line');\n                var isSummary = (this.records[ind] && this.records[ind].recid == recid ? false : true);\n                // if it is searched, find index in search array\n                var url = (typeof this.url != 'object' ? this.url : this.url.get);\n                if (this.searchData.length > 0 && !url) for (var s in this.last.searchIds) if (this.last.searchIds[s] == ind) ind = s;\n                $(tr).replaceWith(this.getRecordHTML(ind, line, isSummary));\n                if (isSummary) this.resize();\n            }\n        },\n\n        refresh: function () {\n            var obj  = this;\n            var time = (new Date()).getTime();\n            var url = (typeof this.url != 'object' ? this.url : this.url.get);\n            if (this.total <= 0 && !url && this.searchData.length == 0) {\n                this.total = this.records.length;\n            }\n            //if (window.getSelection) window.getSelection().removeAllRanges(); // clear selection\n            this.toolbar.disable('w2ui-edit', 'w2ui-delete');\n            if (!this.box) return;\n            // event before\n            var eventData = this.trigger({ phase: 'before', target: this.name, type: 'refresh' });\n            if (eventData.isCancelled === true) return;\n            // -- header\n            if (this.show.header) {\n                $('#grid_'+ this.name +'_header').html(this.header +'&nbsp;').show();\n            } else {\n                $('#grid_'+ this.name +'_header').hide();\n            }\n            // -- toolbar\n            if (this.show.toolbar) {\n                // if select-collumn is checked - no toolbar refresh\n                if (this.toolbar && this.toolbar.get('w2ui-column-on-off') && this.toolbar.get('w2ui-column-on-off').checked) {\n                    // no action\n                } else {\n                    $('#grid_'+ this.name +'_toolbar').show();\n                    // refresh toolbar all but search field\n                    if (typeof this.toolbar == 'object') {\n                        var tmp = this.toolbar.items;\n                        for (var t in tmp) {\n                            if (tmp[t].id == 'w2ui-search' || tmp[t].type == 'break') continue;\n                            this.toolbar.refresh(tmp[t].id);\n                        }\n                    }\n                }\n            } else {\n                $('#grid_'+ this.name +'_toolbar').hide();\n            }\n            // -- make sure search is closed\n            this.searchClose();\n            // search placeholder\n            var el = $('#grid_'+ obj.name +'_search_all');\n            if (!this.multiSearch && this.last.field == 'all' && this.searches.length > 0) {\n                this.last.field   = this.searches[0].field;\n                this.last.caption = this.searches[0].caption;\n            }\n            for (var s in this.searches) {\n                if (this.searches[s].field == this.last.field) this.last.caption = this.searches[s].caption;\n            }\n            if (this.last.multi) {\n                el.attr('placeholder', '[' + w2utils.lang('Multiple Fields') + ']');\n            } else {\n                el.attr('placeholder', this.last.caption);\n            }\n            if (el.val() != this.last.search) {\n                var val = this.last.search;\n                var tmp = el.data('w2field');\n                if (tmp) val = tmp.format(val);\n                el.val(val);\n            }\n\n            // -- separate summary\n            var tmp = this.find({ summary: true }, true);\n            if (tmp.length > 0) {\n                for (var t in tmp) this.summary.push(this.records[tmp[t]]);\n                for (var t=tmp.length-1; t>=0; t--) this.records.splice(tmp[t], 1);\n                this.total = this.total - tmp.length;\n            }\n\n            // collapse all records\n            var rows = obj.find({ expanded: true }, true);\n            for (var r in rows) obj.records[rows[r]].expanded = false;\n\n            // -- body\n            var bodyHTML = '';\n            bodyHTML +=  '<div id=\"grid_'+ this.name +'_records\" class=\"w2ui-grid-records\"'+\n                        '    onscroll=\"var obj = w2ui[\\''+ this.name + '\\']; '+\n                        '        obj.last.scrollTop = this.scrollTop; '+\n                        '        obj.last.scrollLeft = this.scrollLeft; '+\n                        '        $(\\'#grid_'+ this.name +'_columns\\')[0].scrollLeft = this.scrollLeft;'+\n                        '        $(\\'#grid_'+ this.name +'_summary\\')[0].scrollLeft = this.scrollLeft;'+\n                        '        obj.scroll(event);\">'+\n                            this.getRecordsHTML() +\n                        '</div>'+\n                        '<div id=\"grid_'+ this.name +'_columns\" class=\"w2ui-grid-columns\">'+\n                        '    <table>'+ this.getColumnsHTML() +'</table>'+\n                        '</div>'; // Columns need to be after to be able to overlap\n            $('#grid_'+ this.name +'_body').html(bodyHTML);\n            // show summary records\n            if (this.summary.length > 0) {\n                $('#grid_'+ this.name +'_summary').html(this.getSummaryHTML()).show();\n            } else {\n                $('#grid_'+ this.name +'_summary').hide();\n            }\n            // -- footer\n            if (this.show.footer) {\n                $('#grid_'+ this.name +'_footer').html(this.getFooterHTML()).show();\n            } else {\n                $('#grid_'+ this.name +'_footer').hide();\n            }\n            // show/hide clear search link\n             if (this.searchData.length > 0) {\n                $('#grid_'+ this.name +'_searchClear').show();\n            } else {\n                $('#grid_'+ this.name +'_searchClear').hide();\n            }\n            // all selected?\n            var sel = this.last.selection;\n            if (sel.indexes.length == this.records.length || (this.searchData.length !== 0 && sel.indexes.length == this.last.searchIds.length)) {\n                $('#grid_'+ this.name +'_check_all').prop('checked', true);\n            } else {\n                $('#grid_'+ this.name +'_check_all').prop('checked', false);\n            }\n            // show number of selected\n            this.status();\n            // mark selection\n            setTimeout(function () {\n                var str  = $.trim($('#grid_'+ obj.name +'_search_all').val());\n                if (str != '') $(obj.box).find('.w2ui-grid-data > div').w2marker(str);\n            }, 50);\n            // event after\n            this.trigger($.extend(eventData, { phase: 'after' }));\n            obj.resize();\n            obj.addRange('selection');\n            setTimeout(function () { obj.resize(); obj.scroll(); }, 1); // allow to render first\n\n            if ( obj.reorderColumns && !obj.last.columnDrag ) {\n                obj.last.columnDrag = obj.initColumnDrag();\n            } else if ( !obj.reorderColumns && obj.last.columnDrag ) {\n                obj.last.columnDrag.remove();\n            }\n\n            return (new Date()).getTime() - time;\n        },\n\n        render: function (box) {\n            var obj  = this;\n            var time = (new Date()).getTime();\n            //if (window.getSelection) window.getSelection().removeAllRanges(); // clear selection\n            if (typeof box != 'undefined' && box != null) {\n                if ($(this.box).find('#grid_'+ this.name +'_body').length > 0) {\n                    $(this.box)\n                        .removeAttr('name')\n                        .removeClass('w2ui-reset w2ui-grid')\n                        .html('');\n                }\n                this.box = box;\n            }\n            if (!this.box) return;\n            if (this.last.sortData == null) this.last.sortData = this.sortData;\n            // event before\n            var eventData = this.trigger({ phase: 'before', target: this.name, type: 'render', box: box });\n            if (eventData.isCancelled === true) return;\n            // insert Elements\n            $(this.box)\n                .attr('name', this.name)\n                .addClass('w2ui-reset w2ui-grid')\n                .html('<div>'+\n                      '    <div id=\"grid_'+ this.name +'_header\" class=\"w2ui-grid-header\"></div>'+\n                      '    <div id=\"grid_'+ this.name +'_toolbar\" class=\"w2ui-grid-toolbar\"></div>'+\n                      '    <div id=\"grid_'+ this.name +'_body\" class=\"w2ui-grid-body\"></div>'+\n                      '    <div id=\"grid_'+ this.name +'_summary\" class=\"w2ui-grid-body w2ui-grid-summary\"></div>'+\n                      '    <div id=\"grid_'+ this.name +'_footer\" class=\"w2ui-grid-footer\"></div>'+\n                      '</div>');\n            if (this.selectType != 'row') $(this.box).addClass('w2ui-ss');\n            if ($(this.box).length > 0) $(this.box)[0].style.cssText += this.style;\n            // init toolbar\n            this.initToolbar();\n            if (this.toolbar != null) this.toolbar.render($('#grid_'+ this.name +'_toolbar')[0]);\n            // reinit search_all\n            if (this.last.field && this.last.field != 'all') {\n                var sd = this.searchData;\n                this.initAllField(this.last.field, (sd.length == 1 ? sd[0].value : null));\n            }\n            // init footer\n            $('#grid_'+ this.name +'_footer').html(this.getFooterHTML());            \n            // refresh\n            if (!this.last.state) this.last.state = this.stateSave(true); // initial default state\n            this.stateRestore();\n            if (this.url) this.refresh(); // show empty grid (need it) - should it be only for remote data source\n            this.reload();\n\n            // init mouse events for mouse selection\n            $(this.box).on('mousedown', mouseStart);\n            $(this.box).on('selectstart', function () { return false; }); // fixes chrome cursor bug\n\n            // event after\n            this.trigger($.extend(eventData, { phase: 'after' }));\n            // attach to resize event\n            if ($('.w2ui-layout').length == 0) { // if there is layout, it will send a resize event\n                this.tmp_resize = function (event) { w2ui[obj.name].resize(); }\n                $(window).off('resize', this.tmp_resize).on('resize', this.tmp_resize);\n            }\n            return (new Date()).getTime() - time;\n\n            function mouseStart (event) {\n                if (event.which != 1) return; // if not left mouse button\n                // restore css user-select\n                if (obj.last.userSelect == 'text') {\n                    delete obj.last.userSelect;\n                    $(obj.box).find('.w2ui-grid-body')\n                        .css('user-select', 'none')\n                        .css('-webkit-user-select', 'none')\n                        .css('-moz-user-select', 'none')\n                        .css('-ms-user-select', 'none');\n                    $(this.box).on('selectstart', function () { return false; });\n                }\n                // regular record select\n                if ($(event.target).parents().hasClass('w2ui-head') || $(event.target).hasClass('w2ui-head')) return;\n                if (obj.last.move && obj.last.move.type == 'expand') return;\n                // if altKey - alow text selection\n                if (event.altKey) {\n                    $(obj.box).off('selectstart');\n                    $(obj.box).find('.w2ui-grid-body')\n                        .css('user-select', 'text')\n                        .css('-webkit-user-select', 'text')\n                        .css('-moz-user-select', 'text')\n                        .css('-ms-user-select', 'text');\n                    obj.selectNone();\n                    obj.last.move       = { type: 'text-select' };\n                    obj.last.userSelect = 'text';\n                } else {\n                    if (!obj.multiSelect) return;\n                    obj.last.move = {\n                        x      : event.screenX,\n                        y      : event.screenY,\n                        divX   : 0,\n                        divY   : 0,\n                        recid  : $(event.target).parents('tr').attr('recid'),\n                        column : (event.target.tagName == 'TD' ? $(event.target).attr('col') : $(event.target).parents('td').attr('col')),\n                        type   : 'select',\n                        ghost  : false,\n                        start  : true\n                    };\n                }\n                $(document).on('mousemove', mouseMove);\n                $(document).on('mouseup', mouseStop);\n            }\n\n            function mouseMove (event) {\n                var mv = obj.last.move;\n                if (!mv || mv.type != 'select') return;\n                mv.divX = (event.screenX - mv.x);\n                mv.divY = (event.screenY - mv.y);\n                if (Math.abs(mv.divX) <= 1 && Math.abs(mv.divY) <= 1) return; // only if moved more then 1px\n                obj.last.cancelClick = true;\n                if (obj.reorderRows == true) {\n                    if (!mv.ghost) {\n                        var row    = $('#grid_'+ obj.name + '_rec_'+ mv.recid);\n                        var tmp    = row.parents('table').find('tr:first-child').clone();\n                        mv.offsetY = event.offsetY;\n                        mv.from    = mv.recid;\n                        mv.pos     = row.position();\n                        mv.ghost   = $(row).clone(true);\n                        mv.ghost.removeAttr('id');\n                        row.find('td:first-child').replaceWith('<td colspan=\"1000\" style=\"height: '+ obj.recordHeight +'px; background-color: #ddd\"></td>');\n                        var recs = $(obj.box).find('.w2ui-grid-records');\n                        recs.append('<table id=\"grid_'+ obj.name + '_ghost\" style=\"position: absolute; z-index: 999999; opacity: 0.8; border-bottom: 2px dashed #aaa; border-top: 2px dashed #aaa; pointer-events: none;\"></table>');\n                        $('#grid_'+ obj.name + '_ghost').append(tmp).append(mv.ghost);\n                    }\n                    var recid = $(event.target).parents('tr').attr('recid');\n                    if (recid != mv.from) {\n                        var row1 = $('#grid_'+ obj.name + '_rec_'+ mv.recid);\n                        var row2 = $('#grid_'+ obj.name + '_rec_'+ recid);\n                        if (event.screenY - mv.lastY < 0) row1.after(row2); else row2.after(row1);\n                        mv.lastY = event.screenY;\n                        mv.to      = recid;\n                    }\n                    var ghost = $('#grid_'+ obj.name + '_ghost');\n                    var recs  = $(obj.box).find('.w2ui-grid-records');\n                    ghost.css({\n                        top     : mv.pos.top + mv.divY + recs.scrollTop(), // + mv.offsetY - obj.recordHeight / 2,\n                        left : mv.pos.left\n                    });\n                    return;\n                }\n                if (mv.start && mv.recid) {\n                    obj.selectNone();\n                    mv.start = false;\n                }\n                var newSel= [];\n                var recid = (event.target.tagName == 'TR' ? $(event.target).attr('recid') : $(event.target).parents('tr').attr('recid'));\n                if (typeof recid == 'undefined') return;\n                var ind1  = obj.get(mv.recid, true);\n                // |:wolfmanx:| this happens when selection is started on summary row\n                if (ind1 === null) return;\n                var ind2  = obj.get(recid, true);\n                // this happens when selection is extended into summary row (a good place to implement scrolling)\n                if (ind2 === null) return;\n                var col1 = parseInt(mv.column);\n                var col2 = parseInt(event.target.tagName == 'TD' ? $(event.target).attr('col') : $(event.target).parents('td').attr('col'));\n                if (ind1 > ind2) { var tmp = ind1; ind1 = ind2; ind2 = tmp; }\n                // check if need to refresh\n                var tmp = 'ind1:'+ ind1 +',ind2;'+ ind2 +',col1:'+ col1 +',col2:'+ col2;\n                if (mv.range == tmp) return;\n                mv.range = tmp;\n                for (var i = ind1; i <= ind2; i++) {\n                    if (obj.last.searchIds.length > 0 && obj.last.searchIds.indexOf(i) == -1) continue;\n                    if (obj.selectType != 'row') {\n                        if (col1 > col2) { var tmp = col1; col1 = col2; col2 = tmp; }\n                        var tmp = [];\n                        for (var c = col1; c <= col2; c++) {\n                            if (obj.columns[c].hidden) continue;\n                            newSel.push({ recid: obj.records[i].recid, column: parseInt(c) });\n                        }\n                    } else {\n                        newSel.push(obj.records[i].recid);\n                    }\n                }\n                if (obj.selectType != 'row') {\n                    var sel = obj.getSelection();\n                    // add more items\n                    var tmp = [];\n                    for (var ns in newSel) {\n                        var flag = false;\n                        for (var s in sel) if (newSel[ns].recid == sel[s].recid && newSel[ns].column == sel[s].column) flag = true;\n                        if (!flag) tmp.push({ recid: newSel[ns].recid, column: newSel[ns].column });\n                    }\n                    obj.select.apply(obj, tmp);\n                    // remove items\n                    var tmp = [];\n                    for (var s in sel) {\n                        var flag = false;\n                        for (var ns in newSel) if (newSel[ns].recid == sel[s].recid && newSel[ns].column == sel[s].column) flag = true;\n                        if (!flag) tmp.push({ recid: sel[s].recid, column: sel[s].column });\n                    }\n                    obj.unselect.apply(obj, tmp);\n                } else {\n                    if (obj.multiSelect) {\n                        var sel = obj.getSelection();\n                        for (var ns in newSel) if (sel.indexOf(newSel[ns]) == -1) obj.select(newSel[ns]); // add more items\n                        for (var s in sel) if (newSel.indexOf(sel[s]) == -1) obj.unselect(sel[s]); // remove items\n                    }\n                }\n            }\n\n            function mouseStop (event) {\n                var mv = obj.last.move;\n                setTimeout(function () { delete obj.last.cancelClick; }, 1);\n                if ($(event.target).parents().hasClass('.w2ui-head') || $(event.target).hasClass('.w2ui-head')) return;\n                if (mv && mv.type == 'select') {\n                    if (obj.reorderRows == true) {\n                        var ind1 = obj.get(mv.from, true);\n                        var tmp  = obj.records[ind1];\n                        obj.records.splice(ind1, 1);\n                        var ind2 = obj.get(mv.to, true);\n                        if (ind1 > ind2) obj.records.splice(ind2, 0, tmp); else obj.records.splice(ind2+1, 0, tmp);\n                        $('#grid_'+ obj.name + '_ghost').remove();\n                        obj.refresh();\n                    }\n                }\n                delete obj.last.move;\n                $(document).off('mousemove', mouseMove);\n                $(document).off('mouseup', mouseStop);\n            }\n        },\n\n        destroy: function () {\n            // event before\n            var eventData = this.trigger({ phase: 'before', target: this.name, type: 'destroy' });\n            if (eventData.isCancelled === true) return;\n            // remove events\n            $(window).off('resize', this.tmp_resize);\n            // clean up\n            if (typeof this.toolbar == 'object' && this.toolbar.destroy) this.toolbar.destroy();\n            if ($(this.box).find('#grid_'+ this.name +'_body').length > 0) {\n                $(this.box)\n                    .removeAttr('name')\n                    .off('selectstart')\n                    .removeClass('w2ui-reset w2ui-grid')\n                    .html('');\n            }\n            delete w2ui[this.name];\n            // event after\n            this.trigger($.extend(eventData, { phase: 'after' }));\n        },\n\n        // ===========================================\n        // --- Internal Functions\n\n        initColumnOnOff: function () {\n            if (!this.show.toolbarColumns) return;\n            var obj = this;\n            var col_html =  '<div class=\"w2ui-col-on-off\">'+\n                            '<table><tr>'+\n                            '<td style=\"width: 30px\">'+\n                            '    <input id=\"grid_'+ this.name +'_column_ln_check\" type=\"checkbox\" tabIndex=\"-1\" '+ (obj.show.lineNumbers ? 'checked' : '') +\n                            '        onclick=\"w2ui[\\''+ obj.name +'\\'].columnOnOff(this, event, \\'line-numbers\\');\">'+\n                            '</td>'+\n                            '<td onclick=\"w2ui[\\''+ obj.name +'\\'].columnOnOff(this, event, \\'line-numbers\\'); $(\\'#w2ui-overlay\\')[0].hide();\">'+\n                            '    <label for=\"grid_'+ this.name +'_column_ln_check\">'+ w2utils.lang('Line #') +'</label>'+\n                            '</td></tr>';\n            for (var c in this.columns) {\n                var col = this.columns[c];\n                var tmp = this.columns[c].caption;\n                if (col.hideable === false) continue;\n                if (!tmp && this.columns[c].hint) tmp = this.columns[c].hint;\n                if (!tmp) tmp = '- column '+ (parseInt(c) + 1) +' -';\n                col_html += '<tr>'+\n                    '<td style=\"width: 30px\">'+\n                    '    <input id=\"grid_'+ this.name +'_column_'+ c +'_check\" type=\"checkbox\" tabIndex=\"-1\" '+ (col.hidden ? '' : 'checked') +\n                    '        onclick=\"w2ui[\\''+ obj.name +'\\'].columnOnOff(this, event, \\''+ col.field +'\\');\">'+\n                    '</td>'+\n                    '<td>'+\n                    '    <label for=\"grid_'+ this.name +'_column_'+ c +'_check\">'+ tmp +    '</label>'+\n                    '</td>'+\n                    '</tr>';\n            }\n            col_html += '<tr><td colspan=\"2\"><div style=\"border-top: 1px solid #ddd;\"></div></td></tr>';\n            var url = (typeof this.url != 'object' ? this.url : this.url.get);\n            if (url && obj.show.skipRecords) {\n                col_html +=\n                        '<tr><td colspan=\"2\" style=\"padding: 0px\">'+\n                        '    <div style=\"cursor: pointer; padding: 2px 8px; cursor: default\">'+ w2utils.lang('Skip') +\n                        '        <input type=\"text\" style=\"width: 45px\" value=\"'+ this.offset +'\" '+\n                        '            onkeypress=\"if (event.keyCode == 13) { '+\n                        '               w2ui[\\''+ obj.name +'\\'].skip(this.value); '+\n                        '               $(\\'#w2ui-overlay\\')[0].hide(); '+\n                        '            }\"> '+ w2utils.lang('Records')+\n                        '    </div>'+\n                        '</td></tr>';\n            }\n            col_html += '<tr><td colspan=\"2\" onclick=\"w2ui[\\''+ obj.name +'\\'].stateSave(); $(\\'#w2ui-overlay\\')[0].hide();\">'+\n                        '    <div style=\"cursor: pointer; padding: 4px 8px; cursor: default\">'+ w2utils.lang('Save Grid State') + '</div>'+\n                        '</td></tr>'+\n                        '<tr><td colspan=\"2\" onclick=\"w2ui[\\''+ obj.name +'\\'].stateReset(); $(\\'#w2ui-overlay\\')[0].hide();\">'+\n                        '    <div style=\"cursor: pointer; padding: 4px 8px; cursor: default\">'+ w2utils.lang('Restore Default State') + '</div>'+\n                        '</td></tr>';\n            col_html += \"</table></div>\";\n            this.toolbar.get('w2ui-column-on-off').html = col_html;\n        },\n\n        /**\n         *\n         * @param box, grid object\n         * @returns {{remove: Function}} contains a closure around all events to ensure they are removed from the dom\n         */\n        initColumnDrag: function ( box ) {\n            //throw error if using column groups\n            if ( this.columnGroups && this.columnGroups.length ) throw 'Draggable columns are not currently supported with column groups.';\n\n            var obj = this,\n                _dragData = {};\n                _dragData.lastInt = null;\n                _dragData.pressed = false;\n                _dragData.timeout = null;_dragData.columnHead = null;\n\n            //attach orginal event listener\n            $(obj.box).on('mousedown', dragColStart);\n            $(obj.box).on('mouseup', catchMouseup);\n\n            function catchMouseup(){\n                _dragData.pressed = false;\n                clearTimeout( _dragData.timeout );\n            }\n            /**\n             *\n             * @param event, mousedown\n             * @returns {boolean} false, preventsDefault\n             */\n            function dragColStart ( event ) {\n                if ( _dragData.timeout ) clearTimeout( _dragData.timeout );\n                var self = this;\n                _dragData.pressed = true;\n\n                _dragData.timeout = setTimeout(function(){\n                    if ( !_dragData.pressed ) return;\n\n                    var eventData,\n                        columns,\n                        selectedCol,\n                        origColumn,\n                        origColumnNumber,\n                        invalidPreColumns = [ 'w2ui-col-number', 'w2ui-col-expand', 'w2ui-col-select' ],\n                        invalidPostColumns = [ 'w2ui-head-last' ],\n                        invalidColumns = invalidPreColumns.concat( invalidPostColumns ),\n                        preColumnsSelector = '.w2ui-col-number, .w2ui-col-expand, .w2ui-col-select',\n                        preColHeadersSelector = '.w2ui-head.w2ui-col-number, .w2ui-head.w2ui-col-expand, .w2ui-head.w2ui-col-select';\n\n                    // do nothing if it is not a header\n                    if ( !$( event.originalEvent.target ).parents().hasClass( 'w2ui-head' ) ) return;\n\n                    // do nothing if it is an invalid column\n                    for ( var i = 0, l = invalidColumns.length; i < l; i++ ){\n                        if ( $( event.originalEvent.target ).parents().hasClass( invalidColumns[ i ] ) ) return;\n                    }\n\n                    _dragData.numberPreColumnsPresent = $( obj.box ).find( preColHeadersSelector ).length;\n\n                    //start event for drag start\n                    _dragData.columnHead = origColumn = $( event.originalEvent.target ).parents( '.w2ui-head' );\n                    origColumnNumber = parseInt( origColumn.attr( 'col' ), 10);\n                    eventData = obj.trigger({ type: 'columnDragStart', phase: 'before', originalEvent: event, origColumnNumber: origColumnNumber, target: origColumn[0] });\n                    if ( eventData.isCancelled === true ) return false;\n\n                    columns = _dragData.columns = $( obj.box ).find( '.w2ui-head:not(.w2ui-head-last)' );\n\n                    //add events\n                    $( document ).on( 'mouseup', dragColEnd );\n                    $( document ).on( 'mousemove', dragColOver );\n\n                    _dragData.originalPos = parseInt( $( event.originalEvent.target ).parent( '.w2ui-head' ).attr( 'col' ), 10 );\n                    //_dragData.columns.css({ overflow: 'visible' }).children( 'div' ).css({ overflow: 'visible' });\n\n                    //configure and style ghost image\n                    _dragData.ghost = $( self ).clone( true );\n\n                    //hide other elements on ghost except the grid body\n                    $( _dragData.ghost ).find( '[col]:not([col=\"' + _dragData.originalPos + '\"]), .w2ui-toolbar, .w2ui-grid-header' ).remove();\n                    $( _dragData.ghost ).find( preColumnsSelector ).remove();\n                    $( _dragData.ghost ).find( '.w2ui-grid-body' ).css({ top: 0 });\n\n                    selectedCol = $( _dragData.ghost ).find( '[col=\"' + _dragData.originalPos + '\"]' );\n                    $( document.body ).append( _dragData.ghost );\n\n                    $( _dragData.ghost ).css({\n                        width: 0,\n                        height: 0,\n                        margin: 0,\n                        position: 'fixed',\n                        zIndex: 999999,\n                        opacity: 0\n                    }).addClass( '.w2ui-grid-ghost' ).animate({\n                            width: selectedCol.width(),\n                            height: $(obj.box).find('.w2ui-grid-body:first').height(),\n                            left : event.pageX,\n                            top : event.pageY,\n                            opacity: .8\n                        }, 0 );\n\n                    //establish current offsets\n                    _dragData.offsets = [];\n                    for ( var i = 0, l = columns.length; i < l; i++ ) {\n                        _dragData.offsets.push( $( columns[ i ] ).offset().left );\n                    }\n\n                    //conclude event\n                    obj.trigger( $.extend( eventData, { phase: 'after' } ) );\n                }, 150 );//end timeout wrapper\n            }\n\n            function dragColOver ( event ) {\n                if ( !_dragData.pressed ) return;\n\n                var cursorX = event.originalEvent.pageX,\n                    cursorY = event.originalEvent.pageY,\n                    offsets = _dragData.offsets,\n                    lastWidth = $( '.w2ui-head:not(.w2ui-head-last)' ).width();\n\n                _dragData.targetInt = Math.max(_dragData.numberPreColumnsPresent,targetIntersection( cursorX, offsets, lastWidth ));\n\n                markIntersection( _dragData.targetInt );\n                trackGhost( cursorX, cursorY );\n            }\n\n            function dragColEnd ( event ) {\n                _dragData.pressed = false;\n\n                var eventData,\n                    target,\n                    selected,\n                    columnConfig,\n                    targetColumn,\n                    ghosts = $( '.w2ui-grid-ghost' );\n\n                //start event for drag start\n                eventData = obj.trigger({ type: 'columnDragEnd', phase: 'before', originalEvent: event, target: _dragData.columnHead[0] });\n                if ( eventData.isCancelled === true ) return false;\n\n                selected = obj.columns[ _dragData.originalPos ];\n                columnConfig = obj.columns;\n                targetColumn =  $( _dragData.columns[ Math.min(_dragData.lastInt, _dragData.columns.length - 1) ] );\n                target = (_dragData.lastInt < _dragData.columns.length) ? parseInt(targetColumn.attr('col')) : columnConfig.length;\n\n                if ( target !== _dragData.originalPos + 1 && target !== _dragData.originalPos && targetColumn && targetColumn.length ) {\n                    $( _dragData.ghost ).animate({\n                        top: $( obj.box ).offset().top,\n                        left: targetColumn.offset().left,\n                        width: 0,\n                        height: 0,\n                        opacity:.2\n                    }, 300, function(){\n                        $( this ).remove();\n                        ghosts.remove();\n                    });\n\n                    columnConfig.splice( target, 0, $.extend( {}, selected ) );\n                    columnConfig.splice( columnConfig.indexOf( selected ), 1);\n\n                } else {\n                    $( _dragData.ghost ).remove();\n                    ghosts.remove();\n                }\n\n                //_dragData.columns.css({ overflow: '' }).children( 'div' ).css({ overflow: '' });\n\n                $( document ).off( 'mouseup', dragColEnd );\n                $( document ).off( 'mousemove', dragColOver );\n                if ( _dragData.marker ) _dragData.marker.remove();\n                _dragData = {};\n\n                obj.refresh();\n\n                //conclude event\n                obj.trigger( $.extend( eventData, { phase: 'after', targetColumnNumber: target - 1 } ) );\n            }\n\n            function markIntersection( intersection ){\n                if ( !_dragData.marker && !_dragData.markerLeft ) {\n                    _dragData.marker = $('<div class=\"col-intersection-marker\">' +\n                        '<div class=\"top-marker\"></div>' +\n                        '<div class=\"bottom-marker\"></div>' +\n                        '</div>');\n                    _dragData.markerLeft = $('<div class=\"col-intersection-marker\">' +\n                        '<div class=\"top-marker\"></div>' +\n                        '<div class=\"bottom-marker\"></div>' +\n                        '</div>');\n                }\n\n                if ( !_dragData.lastInt || _dragData.lastInt !== intersection ){\n                    _dragData.lastInt = intersection;\n                    _dragData.marker.remove();\n                    _dragData.markerLeft.remove();\n                    $('.w2ui-head').removeClass('w2ui-col-intersection');\n\n                    //if the current intersection is greater than the number of columns add the marker to the end of the last column only\n                    if ( intersection >= _dragData.columns.length ) {\n                        $( _dragData.columns[ _dragData.columns.length - 1 ] ).children( 'div:last' ).append( _dragData.marker.addClass( 'right' ).removeClass( 'left' ) );\n                        $( _dragData.columns[ _dragData.columns.length - 1 ] ).addClass('w2ui-col-intersection');\n                    } else if ( intersection <= _dragData.numberPreColumnsPresent ) {\n                        //if the current intersection is on the column numbers place marker on first available column only\n                        $( _dragData.columns[ _dragData.numberPreColumnsPresent ] ).prepend( _dragData.marker.addClass( 'left' ).removeClass( 'right' ) ).css({ position: 'relative' });\n                        $( _dragData.columns[ _dragData.numberPreColumnsPresent ] ).prev().addClass('w2ui-col-intersection');\n                    } else {\n                        //otherwise prepend the marker to the targeted column and append it to the previous column\n                        $( _dragData.columns[intersection] ).children( 'div:last' ).prepend( _dragData.marker.addClass( 'left' ).removeClass( 'right' ) );\n                        $( _dragData.columns[intersection] ).prev().children( 'div:last' ).append( _dragData.markerLeft.addClass( 'right' ).removeClass( 'left' ) ).css({ position: 'relative' });\n                        $( _dragData.columns[intersection - 1] ).addClass('w2ui-col-intersection');\n                    }\n                }\n            }\n\n            function targetIntersection( cursorX, offsets, lastWidth ){\n                if ( cursorX <= offsets[0] ) {\n                    return 0;\n                } else if ( cursorX >= offsets[offsets.length - 1] + lastWidth ) {\n                    return offsets.length;\n                } else {\n                    for ( var i = 0, l = offsets.length; i < l; i++ ) {\n                        var thisOffset = offsets[ i ];\n                        var nextOffset = offsets[ i + 1 ] || offsets[ i ] + lastWidth;\n                        var midpoint = ( nextOffset - offsets[ i ]) / 2 + offsets[ i ];\n\n                        if ( cursorX > thisOffset && cursorX <= midpoint ) {\n                            return i;\n                        } else if ( cursorX > midpoint && cursorX <= nextOffset ) {\n                            return i + 1;\n                        }\n                    }\n                    return intersection;\n                }\n            }\n\n            function trackGhost( cursorX, cursorY ){\n                $( _dragData.ghost ).css({\n                    left: cursorX - 10,\n                    top: cursorY - 10\n                });\n            }\n\n            //return an object to remove drag if it has ever been enabled\n            return {\n                remove: function(){\n                    $( obj.box ).off( 'mousedown', dragColStart );\n                    $( obj.box ).off( 'mouseup', catchMouseup );\n                    $( obj.box ).find( '.w2ui-head' ).removeAttr( 'draggable' );\n                    obj.last.columnDrag = false;\n                }\n            }\n        },\n\n        columnOnOff: function (el, event, field) {\n            // event before\n            var eventData = this.trigger({ phase: 'before', target: this.name, type: 'columnOnOff', checkbox: el, field: field, originalEvent: event });\n            if (eventData.isCancelled === true) return;\n            // regular processing\n            var obj = this;\n            // collapse expanded rows\n            for (var r in this.records) {\n                if (this.records[r].expanded === true) this.records[r].expanded = false\n            }\n            // show/hide\n            var hide = true;\n            if (field == 'line-numbers') {\n                this.show.lineNumbers = !this.show.lineNumbers;\n                this.refresh();\n            } else {\n                var col = this.getColumn(field);\n                if (col.hidden) {\n                    $(el).prop('checked', true);\n                    this.showColumn(col.field);\n                } else {\n                    $(el).prop('checked', false);\n                    this.hideColumn(col.field);\n                }\n                hide = false;\n            }\n            if (hide) {\n                setTimeout(function () {\n                    $().w2overlay('', { name: 'searches-'+ this.name });\n                    obj.toolbar.uncheck('column-on-off');\n                }, 100);\n            }\n            // event after\n            this.trigger($.extend(eventData, { phase: 'after' }));\n        },\n\n        initToolbar: function () {\n            // -- if toolbar is true\n            if (typeof this.toolbar['render'] == 'undefined') {\n                var tmp_items = this.toolbar.items;\n                this.toolbar.items = [];\n                this.toolbar = $().w2toolbar($.extend(true, {}, this.toolbar, { name: this.name +'_toolbar', owner: this }));\n\n                // =============================================\n                // ------ Toolbar Generic buttons\n\n                if (this.show.toolbarReload) {\n                    this.toolbar.items.push($.extend(true, {}, this.buttons['reload']));\n                }\n                if (this.show.toolbarColumns) {\n                    this.toolbar.items.push($.extend(true, {}, this.buttons['columns']));\n                }\n                if (this.show.toolbarReload || this.show.toolbarColumn) {\n                    this.toolbar.items.push({ type: 'break', id: 'w2ui-break0' });\n                }\n                if (this.show.toolbarSearch) {\n                    var html =\n                        '<div class=\"w2ui-toolbar-search\">'+\n                        '<table cellpadding=\"0\" cellspacing=\"0\"><tr>'+\n                        '    <td>'+ this.buttons['search'].html +'</td>'+\n                        '    <td>'+\n                        '        <input id=\"grid_'+ this.name +'_search_all\" class=\"w2ui-search-all\" '+\n                        '            placeholder=\"'+ this.last.caption +'\" value=\"'+ this.last.search +'\"'+\n                        '            onkeydown=\"if (event.keyCode == 13 && w2utils.isIE) this.onchange();\"'+\n                        '            onchange=\"'+\n                        '                var val = this.value; '+\n                        '                var fld = $(this).data(\\'w2field\\'); '+\n                        '                var dat = $(this).data(\\'selected\\'); '+\n                        '                if (fld) val = fld.clean(val);'+\n                        '                if (dat != null && $.isPlainObject(dat)) val = dat.id;'+\n                        '                w2ui[\\''+ this.name +'\\'].search(w2ui[\\''+ this.name +'\\'].last.field, val); '+\n                        '            \">'+\n                        '    </td>'+\n                        '    <td>'+\n                        '        <div title=\"'+ w2utils.lang('Clear Search') +'\" class=\"w2ui-search-clear\" id=\"grid_'+ this.name +'_searchClear\"  '+\n                        '             onclick=\"var obj = w2ui[\\''+ this.name +'\\']; obj.searchReset();\" '+\n                        '        >&nbsp;&nbsp;</div>'+\n                        '    </td>'+\n                        '</tr></table>'+\n                        '</div>';\n                    this.toolbar.items.push({ type: 'html', id: 'w2ui-search', html: html });\n                    if (this.multiSearch && this.searches.length > 0) {\n                        this.toolbar.items.push($.extend(true, {}, this.buttons['search-go']));\n                    }\n                }\n                if (this.show.toolbarSearch && (this.show.toolbarAdd || this.show.toolbarEdit || this.show.toolbarDelete || this.show.toolbarSave)) {\n                    this.toolbar.items.push({ type: 'break', id: 'w2ui-break1' });\n                }\n                if (this.show.toolbarAdd) {\n                    this.toolbar.items.push($.extend(true, {}, this.buttons['add']));\n                }\n                if (this.show.toolbarEdit) {\n                    this.toolbar.items.push($.extend(true, {}, this.buttons['edit']));\n                }\n                if (this.show.toolbarDelete) {\n                    this.toolbar.items.push($.extend(true, {}, this.buttons['delete']));\n                }\n                if (this.show.toolbarSave) {\n                    if (this.show.toolbarAdd || this.show.toolbarDelete || this.show.toolbarEdit) {\n                        this.toolbar.items.push({ type: 'break', id: 'w2ui-break2' });\n                    }\n                    this.toolbar.items.push($.extend(true, {}, this.buttons['save']));\n                }\n                // add original buttons\n                for (var i in tmp_items) this.toolbar.items.push(tmp_items[i]);\n\n                // =============================================\n                // ------ Toolbar onClick processing\n\n                var obj = this;\n                this.toolbar.on('click', function (event) {\n                    var eventData = obj.trigger({ phase: 'before', type: 'toolbar', target: event.target, originalEvent: event });\n                    if (eventData.isCancelled === true) return;\n                    var id = event.target;\n                    switch (id) {\n                        case 'w2ui-reload':\n                            var eventData2 = obj.trigger({ phase: 'before', type: 'reload', target: obj.name });\n                            if (eventData2.isCancelled === true) return false;\n                            obj.reload();\n                            obj.trigger($.extend(eventData2, { phase: 'after' }));\n                            break;\n                        case 'w2ui-column-on-off':\n                            obj.initColumnOnOff();\n                            obj.initResize();\n                            obj.resize();\n                            break;\n                        case 'w2ui-search-advanced':\n                            var tb = this;\n                            var it = this.get(id);\n                            if (it.checked) {\n                                obj.searchClose();\n                                setTimeout(function () { tb.uncheck(id); }, 1);\n                            } else {\n                                obj.searchOpen();\n                                event.originalEvent.stopPropagation();\n                                function tmp_close() {\n                                    if ($('#w2ui-overlay-searches-'+ obj.name).data('keepOpen') === true) return;\n                                    tb.uncheck(id);\n                                    $(document).off('click', 'body', tmp_close);\n                                }\n                                $(document).on('click', 'body', tmp_close);\n                            }\n                            break;\n                        case 'w2ui-add':\n                            // events\n                            var eventData = obj.trigger({ phase: 'before', target: obj.name, type: 'add', recid: null });\n                            obj.trigger($.extend(eventData, { phase: 'after' }));\n                            break;\n                        case 'w2ui-edit':\n                            var sel     = obj.getSelection();\n                            var recid     = null;\n                            if (sel.length == 1) recid = sel[0];\n                            // events\n                            var eventData = obj.trigger({ phase: 'before', target: obj.name, type: 'edit', recid: recid });\n                            obj.trigger($.extend(eventData, { phase: 'after' }));\n                            break;\n                        case 'w2ui-delete':\n                            obj[\"delete\"]();\n                            break;\n                        case 'w2ui-save':\n                            obj.save();\n                            break;\n                    }\n                    // no default action\n                    obj.trigger($.extend(eventData, { phase: 'after' }));\n                });\n            }\n            return;\n        },\n\n        initResize: function () {\n            var obj = this;\n            //if (obj.resizing === true) return;\n            $(this.box).find('.w2ui-resizer')\n                .off('click')\n                .on('click', function (event) {\n                    if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;\n                    if (event.preventDefault) event.preventDefault();\n                })\n                .off('mousedown')\n                .on('mousedown', function (event) {\n                    if (!event) event = window.event;\n                    if (!window.addEventListener) { window.document.attachEvent('onselectstart', function() { return false; } ); }\n                    obj.resizing = true;\n                    obj.last.tmp = {\n                        x   : event.screenX,\n                        y   : event.screenY,\n                        gx  : event.screenX,\n                        gy  : event.screenY,\n                        col : parseInt($(this).attr('name'))\n                    };\n                    if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;\n                    if (event.preventDefault) event.preventDefault();\n                    // fix sizes\n                    for (var c in obj.columns) {\n                        if (obj.columns[c].hidden) continue;\n                        if (typeof obj.columns[c].sizeOriginal == 'undefined') obj.columns[c].sizeOriginal = obj.columns[c].size;\n                        obj.columns[c].size = obj.columns[c].sizeCalculated;\n                    }\n                    var eventData = { phase: 'before', type: 'columnResize', target: obj.name, column: obj.last.tmp.col, field: obj.columns[obj.last.tmp.col].field };\n                    eventData = obj.trigger($.extend(eventData, { resizeBy: 0, originalEvent: event }));\n                    // set move event\n                    var mouseMove = function (event) {\n                        if (obj.resizing != true) return;\n                        if (!event) event = window.event;\n                        // event before\n                        eventData = obj.trigger($.extend(eventData, { resizeBy: (event.screenX - obj.last.tmp.gx), originalEvent: event }));\n                        if (eventData.isCancelled === true) { eventData.isCancelled = false; return; }\n                        // default action\n                        obj.last.tmp.x = (event.screenX - obj.last.tmp.x);\n                        obj.last.tmp.y = (event.screenY - obj.last.tmp.y);\n                        obj.columns[obj.last.tmp.col].size = (parseInt(obj.columns[obj.last.tmp.col].size) + obj.last.tmp.x) + 'px';\n                        obj.resizeRecords();\n                        // reset\n                        obj.last.tmp.x = event.screenX;\n                        obj.last.tmp.y = event.screenY;\n                    }\n                    var mouseUp = function (event) {\n                        delete obj.resizing;\n                        $(document).off('mousemove', 'body');\n                        $(document).off('mouseup', 'body');\n                        obj.resizeRecords();\n                        // event before\n                        obj.trigger($.extend(eventData, { phase: 'after', originalEvent: event }));\n                    }\n                    $(document).on('mousemove', 'body', mouseMove);\n                    $(document).on('mouseup', 'body', mouseUp);\n                })\n                .each(function (index, el) {\n                    var td  = $(el).parent();\n                    $(el).css({\n                        \"height\"         : '25px',\n                        \"margin-left\"     : (td.width() - 3) + 'px'\n                    })\n                });\n        },\n\n        resizeBoxes: function () {\n            // elements\n            var main     = $(this.box).find('> div');\n            var header   = $('#grid_'+ this.name +'_header');\n            var toolbar  = $('#grid_'+ this.name +'_toolbar');\n            var summary  = $('#grid_'+ this.name +'_summary');\n            var footer   = $('#grid_'+ this.name +'_footer');\n            var body     = $('#grid_'+ this.name +'_body');\n            var columns  = $('#grid_'+ this.name +'_columns');\n            var records  = $('#grid_'+ this.name +'_records');\n\n            if (this.show.header) {\n                header.css({\n                    top:   '0px',\n                    left:  '0px',\n                    right: '0px'\n                });\n            }\n\n            if (this.show.toolbar) {\n                toolbar.css({\n                    top:   ( 0 + (this.show.header ? w2utils.getSize(header, 'height') : 0) ) + 'px',\n                    left:  '0px',\n                    right: '0px'\n                });\n            }\n            if (this.show.footer) {\n                footer.css({\n                    bottom: '0px',\n                    left:  '0px',\n                    right: '0px'\n                });\n            }\n            if (this.summary.length > 0) {\n                summary.css({\n                    bottom: ( 0 + (this.show.footer ? w2utils.getSize(footer, 'height') : 0) ) + 'px',\n                    left:  '0px',\n                    right: '0px'\n                });\n            }\n            body.css({\n                top: ( 0 + (this.show.header ? w2utils.getSize(header, 'height') : 0) + (this.show.toolbar ? w2utils.getSize(toolbar, 'height') : 0) ) + 'px',\n                bottom: ( 0 + (this.show.footer ? w2utils.getSize(footer, 'height') : 0) + (this.summary.length > 0 ? w2utils.getSize(summary, 'height') : 0) ) + 'px',\n                left:   '0px',\n                right:  '0px'\n            });\n        },\n\n        resizeRecords: function () {\n            var obj = this;\n            // remove empty records\n            $(this.box).find('.w2ui-empty-record').remove();\n            // -- Calculate Column size in PX\n            var box     = $(this.box);\n            var grid    = $(this.box).find('> div');\n            var header  = $('#grid_'+ this.name +'_header');\n            var toolbar = $('#grid_'+ this.name +'_toolbar');\n            var summary = $('#grid_'+ this.name +'_summary');\n            var footer  = $('#grid_'+ this.name +'_footer');\n            var body    = $('#grid_'+ this.name +'_body');\n            var columns = $('#grid_'+ this.name +'_columns');\n            var records = $('#grid_'+ this.name +'_records');\n\n            // body might be expanded by data\n            if (!this.fixedBody) {\n                // allow it to render records, then resize\n                var calculatedHeight = w2utils.getSize(columns, 'height')\n                    + w2utils.getSize($('#grid_'+ obj.name +'_records table'), 'height');\n                obj.height = calculatedHeight\n                    + w2utils.getSize(grid, '+height')\n                    + (obj.show.header ? w2utils.getSize(header, 'height') : 0)\n                    + (obj.show.toolbar ? w2utils.getSize(toolbar, 'height') : 0)\n                    + (summary.css('display') != 'none' ? w2utils.getSize(summary, 'height') : 0)\n                    + (obj.show.footer ? w2utils.getSize(footer, 'height') : 0);\n                grid.css('height', obj.height);\n                body.css('height', calculatedHeight);\n                box.css('height', w2utils.getSize(grid, 'height') + w2utils.getSize(box, '+height'));\n            } else {\n                // fixed body height\n                var calculatedHeight =  grid.height()\n                    - (this.show.header ? w2utils.getSize(header, 'height') : 0)\n                    - (this.show.toolbar ? w2utils.getSize(toolbar, 'height') : 0)\n                    - (summary.css('display') != 'none' ? w2utils.getSize(summary, 'height') : 0)\n                    - (this.show.footer ? w2utils.getSize(footer, 'height') : 0);\n                body.css('height', calculatedHeight);\n            }\n\n            var buffered = this.records.length;\n            if (this.searchData.length != 0 && !this.url) buffered = this.last.searchIds.length;\n            // check overflow\n            var bodyOverflowX = false;\n            var bodyOverflowY = false;\n            if (body.width() < $(records).find('>table').width()) bodyOverflowX = true;\n            if (body.height() - columns.height() < $(records).find('>table').height() + (bodyOverflowX ? w2utils.scrollBarSize() : 0)) bodyOverflowY = true;\n            if (!this.fixedBody) { bodyOverflowY = false; }\n            if (bodyOverflowX || bodyOverflowY) {\n                columns.find('> table > tbody > tr:nth-child(1) td.w2ui-head-last').css('width', w2utils.scrollBarSize()).show();\n                records.css({\n                    top: ((this.columnGroups.length > 0 && this.show.columns ? 1 : 0) + w2utils.getSize(columns, 'height')) +'px',\n                    \"-webkit-overflow-scrolling\": \"touch\",\n                    \"overflow-x\": (bodyOverflowX ? 'auto' : 'hidden'),\n                    \"overflow-y\": (bodyOverflowY ? 'auto' : 'hidden') });\n            } else {\n                columns.find('> table > tbody > tr:nth-child(1) td.w2ui-head-last').hide();\n                records.css({\n                    top: ((this.columnGroups.length > 0 && this.show.columns ? 1 : 0) + w2utils.getSize(columns, 'height')) +'px',\n                    overflow: 'hidden'\n                });\n                if (records.length > 0) { this.last.scrollTop  = 0; this.last.scrollLeft = 0; } // if no scrollbars, always show top\n            }\n            if (this.show.emptyRecords && !bodyOverflowY) {\n                var max = Math.floor(records.height() / this.recordHeight) + 1;\n                if (this.fixedBody) {\n                    for (var di = buffered; di <= max; di++) {\n                        var html  = '';\n                        html += '<tr class=\"'+ (di % 2 ? 'w2ui-even' : 'w2ui-odd') + ' w2ui-empty-record\" style=\"height: '+ this.recordHeight +'px\">';\n                        if (this.show.lineNumbers)  html += '<td class=\"w2ui-col-number\"></td>';\n                        if (this.show.selectColumn) html += '<td class=\"w2ui-grid-data w2ui-col-select\"></td>';\n                        if (this.show.expandColumn) html += '<td class=\"w2ui-grid-data w2ui-col-expand\"></td>';\n                        var j = 0;\n                        while (true && this.columns.length > 0) {\n                            var col = this.columns[j];\n                            if (col.hidden) { j++; if (typeof this.columns[j] == 'undefined') break; else continue; }\n                            html += '<td class=\"w2ui-grid-data\" '+ (typeof col.attr != 'undefined' ? col.attr : '') +' col=\"'+ j +'\"></td>';\n                            j++;\n                            if (typeof this.columns[j] == 'undefined') break;\n                        }\n                        html += '<td class=\"w2ui-grid-data-last\"></td>';\n                        html += '</tr>';\n                        $('#grid_'+ this.name +'_records > table').append(html);\n                    }\n                }\n            }\n            if (body.length > 0) {\n                var width_max = parseInt(body.width())\n                    - (bodyOverflowY ? w2utils.scrollBarSize() : 0)\n                    - (this.show.lineNumbers ? 34 : 0)\n                    - (this.show.selectColumn ? 26 : 0)\n                    - (this.show.expandColumn ? 26 : 0);\n                var width_box = width_max;\n                var percent = 0;\n                // gridMinWidth processiong\n                var restart = false;\n                for (var i = 0; i < this.columns.length; i++) {\n                    var col = this.columns[i];\n                    if (col.gridMinWidth > 0) {\n                        if (col.gridMinWidth > width_box && col.hidden !== true) {\n                            col.hidden = true;\n                            restart = true;\n                        }\n                        if (col.gridMinWidth < width_box && col.hidden === true) {\n                            col.hidden = false;\n                            restart = true;\n                        }\n                    }\n                }\n                if (restart === true) {\n                    this.refresh();\n                    return;\n                }\n                // assign PX column s\n                for (var i = 0; i < this.columns.length; i++) {\n                    var col = this.columns[i];\n                    if (col.hidden) continue;\n                    if (String(col.size).substr(String(col.size).length-2).toLowerCase() == 'px') {\n                        width_max -= parseFloat(col.size);\n                        this.columns[i].sizeCalculated = col.size;\n                        this.columns[i].sizeType = 'px';\n                    } else {\n                        percent += parseFloat(col.size);\n                        this.columns[i].sizeType = '%';\n                        delete col.sizeCorrected;\n                    }\n                }\n                // if sum != 100% -- reassign proportionally\n                if (percent != 100 && percent > 0) {\n                    for (var i = 0; i < this.columns.length; i++) {\n                        var col = this.columns[i];\n                        if (col.hidden) continue;\n                        if (col.sizeType == '%') {\n                            col.sizeCorrected = Math.round(parseFloat(col.size) * 100 * 100 / percent) / 100 + '%';\n                        }\n                    }\n                }\n                // calculate % columns\n                for (var i = 0; i < this.columns.length; i++) {\n                    var col = this.columns[i];\n                    if (col.hidden) continue;\n                    if (col.sizeType == '%') {\n                        if (typeof this.columns[i].sizeCorrected != 'undefined') {\n                            // make it 1px smaller, so margin of error can be calculated correctly\n                            this.columns[i].sizeCalculated = Math.floor(width_max * parseFloat(col.sizeCorrected) / 100) - 1 + 'px';\n                        } else {\n                            // make it 1px smaller, so margin of error can be calculated correctly\n                            this.columns[i].sizeCalculated = Math.floor(width_max * parseFloat(col.size) / 100) - 1 + 'px';\n                        }\n                    }\n                }\n            }\n            // fix margin of error that is due percentage calculations\n            var width_cols = 0;\n            for (var i = 0; i < this.columns.length; i++) {\n                var col = this.columns[i];\n                if (col.hidden) continue;\n                if (typeof col.min == 'undefined') col.min = 20;\n                if (parseInt(col.sizeCalculated) < parseInt(col.min)) col.sizeCalculated = col.min + 'px';\n                if (parseInt(col.sizeCalculated) > parseInt(col.max)) col.sizeCalculated = col.max + 'px';\n                width_cols += parseInt(col.sizeCalculated);\n            }\n            var width_diff = parseInt(width_box) - parseInt(width_cols);\n            if (width_diff > 0 && percent > 0) {\n                var i = 0;\n                while (true) {\n                    var col = this.columns[i];\n                    if (typeof col == 'undefined') { i = 0; continue; }\n                    if (col.hidden || col.sizeType == 'px') { i++; continue; }\n                    col.sizeCalculated = (parseInt(col.sizeCalculated) + 1) + 'px';\n                    width_diff--;\n                    if (width_diff == 0) break;\n                    i++;\n                }\n            } else if (width_diff > 0) {\n                columns.find('> table > tbody > tr:nth-child(1) td.w2ui-head-last').css('width', w2utils.scrollBarSize()).show();\n            }\n            // resize columns\n            columns.find('> table > tbody > tr:nth-child(1) td').each(function (index, el) {\n                var ind = $(el).attr('col');\n                if (typeof ind != 'undefined' && obj.columns[ind]) $(el).css('width', obj.columns[ind].sizeCalculated);\n                // last column\n                if ($(el).hasClass('w2ui-head-last')) {\n                    $(el).css('width', w2utils.scrollBarSize() + (width_diff > 0 && percent == 0 ? width_diff : 0) + 'px');\n                }\n            });\n            // if there are column groups - hide first row (needed for sizing)\n            if (columns.find('> table > tbody > tr').length == 3) {\n                columns.find('> table > tbody > tr:nth-child(1) td').html('').css({\n                    'height' : '0px',\n                    'border' : '0px',\n                    'padding': '0px',\n                    'margin' : '0px'\n                });\n            }\n            // resize records\n            records.find('> table > tbody > tr:nth-child(1) td').each(function (index, el) {\n                var ind = $(el).attr('col');\n                if (typeof ind != 'undefined' && obj.columns[ind]) $(el).css('width', obj.columns[ind].sizeCalculated);\n                // last column\n                if ($(el).hasClass('w2ui-grid-data-last')) {\n                    $(el).css('width', (width_diff > 0 && percent == 0 ? width_diff : 0) + 'px');\n                }\n            });\n            // resize summary\n            summary.find('> table > tbody > tr:nth-child(1) td').each(function (index, el) {\n                var ind = $(el).attr('col');\n                if (typeof ind != 'undefined' && obj.columns[ind]) $(el).css('width', obj.columns[ind].sizeCalculated);\n                // last column\n                if ($(el).hasClass('w2ui-grid-data-last')) {\n                    $(el).css('width', w2utils.scrollBarSize() + (width_diff > 0 && percent == 0 ? width_diff : 0) + 'px');\n                }\n            });\n            this.initResize();\n            this.refreshRanges();\n            // apply last scroll if any\n            if ((this.last.scrollTop || this.last.scrollLeft) && records.length > 0) {\n                columns.prop('scrollLeft', this.last.scrollLeft);\n                records.prop('scrollTop',  this.last.scrollTop);\n                records.prop('scrollLeft', this.last.scrollLeft);\n            }\n        },\n\n        getSearchesHTML: function () {\n            var html = '<table cellspacing=\"0\">';\n            var showBtn = false;\n            for (var i = 0; i < this.searches.length; i++) {\n                var s = this.searches[i];\n                s.type = String(s.type).toLowerCase();\n                if (s.hidden) continue;\n                var btn = '';\n                if (showBtn == false) {\n                    btn = '<button class=\"btn close-btn\" onclick=\"obj = w2ui[\\''+ this.name +'\\']; if (obj) { obj.searchClose(); }\">X</button';\n                    showBtn = true;\n                }\n                if (typeof s.inTag   == 'undefined') s.inTag     = '';\n                if (typeof s.outTag  == 'undefined') s.outTag     = '';\n                if (typeof s.type    == 'undefined') s.type     = 'text';\n                if (['text', 'alphanumeric', 'combo'].indexOf(s.type) != -1) {\n                    var operator =  '<select id=\"grid_'+ this.name +'_operator_'+ i +'\" onclick=\"event.stopPropagation();\">'+\n                        '    <option value=\"is\">'+ w2utils.lang('is') +'</option>'+\n                        '    <option value=\"begins\">'+ w2utils.lang('begins') +'</option>'+\n                        '    <option value=\"contains\">'+ w2utils.lang('contains') +'</option>'+\n                        '    <option value=\"ends\">'+ w2utils.lang('ends') +'</option>'+\n                        '</select>';\n                }\n                if (['int', 'float', 'money', 'currency', 'percent', 'date', 'time'].indexOf(s.type) != -1) {\n                    var operator =  '<select id=\"grid_'+ this.name +'_operator_'+ i +'\" '+\n                        '        onchange=\"w2ui[\\''+ this.name + '\\'].initOperator(this, '+ i +');\" onclick=\"event.stopPropagation();\">'+\n                        '    <option value=\"is\">'+ w2utils.lang('is') +'</option>'+\n                        (['int'].indexOf(s.type) != -1 ? '<option value=\"in\">'+ w2utils.lang('in') +'</option>' : '') +\n                        (['int'].indexOf(s.type) != -1 ? '<option value=\"not in\">'+ w2utils.lang('not in') +'</option>' : '') +\n                        '<option value=\"between\">'+ w2utils.lang('between') +'</option>'+\n                        '</select>';\n                }\n                if (['select', 'list', 'hex'].indexOf(s.type) != -1) {\n                    var operator =  '<select id=\"grid_'+ this.name +'_operator_'+ i +'\" onclick=\"event.stopPropagation();\">'+\n                        '    <option value=\"is\">'+ w2utils.lang('is') +'</option>'+\n                        '</select>';\n                }\n                if (['enum'].indexOf(s.type) != -1) {\n                    var operator =  '<select id=\"grid_'+ this.name +'_operator_'+ i +'\" onclick=\"event.stopPropagation();\">'+\n                        '    <option value=\"in\">'+ w2utils.lang('in') +'</option>'+\n                        '    <option value=\"not in\">'+ w2utils.lang('not in') +'</option>'+\n                        '</select>';\n                }\n                html += '<tr>'+\n                        '    <td class=\"close-btn\">'+ btn +'</td>' +\n                        '    <td class=\"caption\">'+ s.caption +'</td>' +\n                        '    <td class=\"operator\">'+ operator +'</td>'+\n                        '    <td class=\"value\">';\n\n                switch (s.type) {\n                    case 'text':\n                    case 'alphanumeric':\n                    case 'hex':\n                    case 'list':\n                    case 'combo':\n                    case 'enum':\n                        html += '<input rel=\"search\" type=\"text\" style=\"width: 300px;\" id=\"grid_'+ this.name +'_field_'+ i +'\" name=\"'+ s.field +'\" '+ s.inTag +'>';\n                        break;\n\n                    case 'int':\n                    case 'float':\n                    case 'money':\n                    case 'currency':\n                    case 'percent':\n                    case 'date':\n                    case 'time':\n                        html += '<input rel=\"search\" type=\"text\" size=\"12\" id=\"grid_'+ this.name +'_field_'+ i +'\" name=\"'+ s.field +'\" '+ s.inTag +'>'+\n                                '<span id=\"grid_'+ this.name +'_range_'+ i +'\" style=\"display: none\">'+\n                                '&nbsp;-&nbsp;&nbsp;<input rel=\"search\" type=\"text\" style=\"width: 90px\" id=\"grid_'+ this.name +'_field2_'+i+'\" name=\"'+ s.field +'\" '+ s.inTag +'>'+\n                                '</span>';\n                        break;\n\n                    case 'select':\n                        html += '<select rel=\"search\" id=\"grid_'+ this.name +'_field_'+ i +'\" name=\"'+ s.field +'\" '+ s.inTag +'  onclick=\"event.stopPropagation();\"></select>';\n                        break;\n\n                }\n                html += s.outTag +\n                        '    </td>' +\n                        '</tr>';\n            }\n            html += '<tr>'+\n                    '    <td colspan=\"4\" class=\"actions\">'+\n                    '        <div>'+\n                    '        <button class=\"btn\" onclick=\"obj = w2ui[\\''+ this.name +'\\']; if (obj) { obj.searchReset(); }\">'+ w2utils.lang('Reset') + '</button>'+\n                    '        <button class=\"btn btn-blue\" onclick=\"obj = w2ui[\\''+ this.name +'\\']; if (obj) { obj.search(); }\">'+ w2utils.lang('Search') + '</button>'+\n                    '        </div>'+\n                    '    </td>'+\n                    '</tr></table>';\n            return html;\n        },\n\n        initOperator: function (el, search_ind) {\n            var obj     = this;\n            var search  = obj.searches[search_ind];\n            var range   = $('#grid_'+ obj.name + '_range_'+ search_ind);\n            var fld1    = $('#grid_'+ obj.name +'_field_'+ search_ind);\n            var fld2    = fld1.parent().find('span input');\n            if ($(el).val() == 'in' || $(el).val() == 'not in') { fld1.w2field('clear'); } else { fld1.w2field(search.type); }\n            if ($(el).val() == 'between') { range.show(); fld2.w2field(search.type); } else { range.hide(); }\n        },\n\n        initSearches: function () {\n            var obj = this;\n            // init searches\n            for (var s in this.searches) {\n                var search = this.searches[s];\n                var sdata  = this.getSearchData(search.field);\n                search.type = String(search.type).toLowerCase();\n                if (typeof search.options != 'object') search.options = {};\n                // init types\n                switch (search.type) {\n                    case 'text':\n                    case 'alphanumeric':\n                        $('#grid_'+ this.name +'_operator_'+s).val('begins');\n                        if (['alphanumeric', 'hex'].indexOf(search.type) != -1) {\n                            $('#grid_'+ this.name +'_field_' + s).w2field(search.type, search.options);\n                        }\n                        break;\n\n                    case 'int':\n                    case 'float':\n                    case 'money':\n                    case 'currency':\n                    case 'percent':\n                    case 'date':\n                    case 'time':\n                        if (sdata && sdata.type == 'int' && ['in', 'not in'].indexOf(sdata.operator) != -1) break;\n                        $('#grid_'+ this.name +'_field_'+s).w2field(search.type, search.options);\n                        $('#grid_'+ this.name +'_field2_'+s).w2field(search.type, search.options);\n                        setTimeout(function () { // convert to date if it is number\n                            $('#grid_'+ obj.name +'_field_'+s).keydown(); \n                            $('#grid_'+ obj.name +'_field2_'+s).keydown(); \n                        }, 1);\n                        break;\n\n                    case 'hex':\n                        break;\n\n                    case 'list':\n                    case 'combo':\n                    case 'enum':\n                        var options = search.options;\n                        if (search.type == 'list') options.selected = {};\n                        if (search.type == 'enum') options.selected = [];\n                        if (sdata) options.selected = sdata.value;\n                        $('#grid_'+ this.name +'_field_'+s).w2field(search.type, options);\n                        if (search.type == 'combo') {\n                            $('#grid_'+ this.name +'_operator_'+s).val('begins');\n                        }\n                        break;\n\n                    case 'select':\n                        // build options\n                        var options = '<option value=\"\">--</option>';\n                        for (var i in search.options.items) {\n                            var si = search.options.items[i];\n                            if ($.isPlainObject(search.options.items[i])) {\n                                var val = si.id;\n                                var txt = si.text;\n                                if (typeof val == 'undefined' && typeof si.value != 'undefined')   val = si.value;\n                                if (typeof txt == 'undefined' && typeof si.caption != 'undefined') txt = si.caption;\n                                if (val == null) val = '';\n                                options += '<option value=\"'+ val +'\">'+ txt +'</option>';\n                            } else {\n                                options += '<option value=\"'+ si +'\">'+ si +'</option>';\n                            }\n                        }\n                        $('#grid_'+ this.name +'_field_'+s).html(options);\n                        break;\n                }\n                if (sdata != null) {\n                    if (sdata.type == 'int' && ['in', 'not in'].indexOf(sdata.operator) != -1) {\n                        $('#grid_'+ this.name +'_field_'+ s).w2field('clear').val(sdata.value);\n                    }\n                    $('#grid_'+ this.name +'_operator_'+ s).val(sdata.operator).trigger('change');\n                    if (!$.isArray(sdata.value)) {\n                        if (typeof sdata.value != 'udefined') $('#grid_'+ this.name +'_field_'+ s).val(sdata.value).trigger('change');\n                    } else {\n                        if (['in', 'not in'].indexOf(sdata.operator) != -1) {\n                            $('#grid_'+ this.name +'_field_'+ s).val(sdata.value).trigger('change');\n                        } else {\n                            $('#grid_'+ this.name +'_field_'+ s).val(sdata.value[0]).trigger('change');\n                            $('#grid_'+ this.name +'_field2_'+ s).val(sdata.value[1]).trigger('change');\n                        }\n                    }\n                }\n            }\n            // add on change event\n            $('#w2ui-overlay-searches-'+ this.name +' .w2ui-grid-searches *[rel=search]').on('keypress', function (evnt) {\n                if (evnt.keyCode == 13) {\n                    obj.search();\n                    $().w2overlay();\n                }\n            });\n        },\n\n        getColumnsHTML: function () {\n            var obj  = this;\n            var html = '';\n            if (this.show.columnHeaders) {\n                if (this.columnGroups.length > 0) {\n                    html = getColumns(true) + getGroups() + getColumns(false);\n                } else {\n                    html = getColumns(true);\n                }\n            }\n            return html;\n\n            function getGroups () {\n                var html = '<tr>';\n                // add empty group at the end\n                if (obj.columnGroups[obj.columnGroups.length-1].caption != '') obj.columnGroups.push({ caption: '' });\n\n                if (obj.show.lineNumbers) {\n                    html += '<td class=\"w2ui-head w2ui-col-number\">'+\n                            '    <div>&nbsp;</div>'+\n                            '</td>';\n                }\n                if (obj.show.selectColumn) {\n                    html += '<td class=\"w2ui-head w2ui-col-select\">'+\n                            '    <div>&nbsp;</div>'+\n                            '</td>';\n                }\n                if (obj.show.expandColumn) {\n                    html += '<td class=\"w2ui-head w2ui-col-expand\">'+\n                            '    <div>&nbsp;</div>'+\n                            '</td>';\n                }\n                var ii = 0;\n                for (var i=0; i<obj.columnGroups.length; i++) {\n                    var colg = obj.columnGroups[i];\n                    var col  = obj.columns[ii];\n                    if (typeof colg.span == 'undefined' || colg.span != parseInt(colg.span)) colg.span = 1;\n                    if (typeof colg.colspan != 'undefined') colg.span = colg.colspan;\n                    if (colg.master === true) {\n                        var sortStyle = '';\n                        for (var si in obj.sortData) {\n                            if (obj.sortData[si].field == col.field) {\n                                if (RegExp('asc', 'i').test(obj.sortData[si].direction))  sortStyle = 'w2ui-sort-up';\n                                if (RegExp('desc', 'i').test(obj.sortData[si].direction)) sortStyle = 'w2ui-sort-down';\n                            }\n                        }\n                        var resizer = \"\";\n                        if (col.resizable !== false) {\n                            resizer = '<div class=\"w2ui-resizer\" name=\"'+ ii +'\"></div>';\n                        }\n                        html += '<td class=\"w2ui-head '+ sortStyle +'\" col=\"'+ ii + '\" rowspan=\"2\" colspan=\"'+ (colg.span + (i == obj.columnGroups.length-1 ? 1 : 0) ) +'\" '+\n                                '    onclick=\"w2ui[\\''+ obj.name +'\\'].columnClick(\\''+ col.field +'\\', event);\">'+\n                                    resizer +\n                                '    <div class=\"w2ui-col-group w2ui-col-header '+ (sortStyle ? 'w2ui-col-sorted' : '') +'\">'+\n                                '        <div class=\"'+ sortStyle +'\"></div>'+\n                                        (!col.caption ? '&nbsp;' : col.caption) +\n                                '    </div>'+\n                                '</td>';\n                    } else {\n                        html += '<td class=\"w2ui-head\" col=\"'+ ii + '\" '+\n                                '        colspan=\"'+ (colg.span + (i == obj.columnGroups.length-1 ? 1 : 0) ) +'\">'+\n                                '    <div class=\"w2ui-col-group\">'+\n                                    (!colg.caption ? '&nbsp;' : colg.caption) +\n                                '    </div>'+\n                                '</td>';\n                    }\n                    ii += colg.span;\n                }\n                html += '</tr>';\n                return html;\n            }\n\n            function getColumns (master) {\n                var html = '<tr>',\n                    reorderCols = (obj.reorderColumns && (!obj.columnGroups || !obj.columnGroups.length)) ? ' w2ui-reorder-cols-head ' : '';\n                if (obj.show.lineNumbers) {\n                    html += '<td class=\"w2ui-head w2ui-col-number\" onclick=\"w2ui[\\''+ obj.name +'\\'].columnClick(\\'line-number\\', event);\">'+\n                            '    <div>#</div>'+\n                            '</td>';\n                }\n                if (obj.show.selectColumn) {\n                    html += '<td class=\"w2ui-head w2ui-col-select\" '+\n                            '        onclick=\"if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;\">'+\n                            '    <div>'+\n                            '        <input type=\"checkbox\" id=\"grid_'+ obj.name +'_check_all\" tabIndex=\"-1\"'+\n                            '            style=\"' + (obj.multiSelect == false ? 'display: none;' : '') + '\"'+\n                            '            onclick=\"if (this.checked) w2ui[\\''+ obj.name +'\\'].selectAll(); '+\n                            '                     else w2ui[\\''+ obj.name +'\\'].selectNone(); '+\n                            '                     if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;\">'+\n                            '    </div>'+\n                            '</td>';\n                }\n                if (obj.show.expandColumn) {\n                    html += '<td class=\"w2ui-head w2ui-col-expand\">'+\n                            '    <div>&nbsp;</div>'+\n                            '</td>';\n                }\n                var ii = 0;\n                var id = 0;\n                for (var i=0; i<obj.columns.length; i++) {\n                    var col  = obj.columns[i];\n                    var colg = {};\n                    if (i == id) {\n                        id = id + (typeof obj.columnGroups[ii] != 'undefined' ? parseInt(obj.columnGroups[ii].span) : 0);\n                        ii++;\n                    }\n                    if (typeof obj.columnGroups[ii-1] != 'undefined') var colg = obj.columnGroups[ii-1];\n                    if (col.hidden) continue;\n                    var sortStyle = '';\n                    for (var si in obj.sortData) {\n                        if (obj.sortData[si].field == col.field) {\n                            if (RegExp('asc', 'i').test(obj.sortData[si].direction))  sortStyle = 'w2ui-sort-up';\n                            if (RegExp('desc', 'i').test(obj.sortData[si].direction)) sortStyle = 'w2ui-sort-down';\n                        }\n                    }\n                    if (colg['master'] !== true || master) { // grouping of columns\n                        var resizer = \"\";\n                        if (col.resizable !== false) {\n                            resizer = '<div class=\"w2ui-resizer\" name=\"'+ i +'\"></div>';\n                        }\n                        html += '<td col=\"'+ i +'\" class=\"w2ui-head '+ sortStyle + reorderCols + '\" ' +\n                                '    onclick=\"w2ui[\\''+ obj.name +'\\'].columnClick(\\''+ col.field +'\\', event);\">'+\n                                    resizer +\n                                '    <div class=\"w2ui-col-header '+ (sortStyle ? 'w2ui-col-sorted' : '') +'\">'+\n                                '        <div class=\"'+ sortStyle +'\"></div>'+\n                                        (!col.caption ? '&nbsp;' : col.caption) +\n                                '    </div>'+\n                                '</td>';\n                    }\n                }\n                html += '<td class=\"w2ui-head w2ui-head-last\"><div>&nbsp;</div></td>';\n                html += '</tr>';\n                return html;\n            }\n        },\n\n        getRecordsHTML: function () {\n            var buffered = this.records.length;\n            if (this.searchData.length != 0 && !this.url) buffered = this.last.searchIds.length;\n            // larget number works better with chrome, smaller with FF.\n            if (buffered > 300) this.show_extra = 30; else this.show_extra = 300;\n            var records  = $('#grid_'+ this.name +'_records');\n            var limit    = Math.floor(records.height() / this.recordHeight) + this.show_extra + 1;\n            if (!this.fixedBody || limit > buffered) limit = buffered;\n            // always need first record for resizing purposes\n            var html = '<table>' + this.getRecordHTML(-1, 0);\n            // first empty row with height\n            html += '<tr id=\"grid_'+ this.name + '_rec_top\" line=\"top\" style=\"height: '+ 0 +'px\">'+\n                    '    <td colspan=\"200\"></td>'+\n                    '</tr>';\n            for (var i = 0; i < limit; i++) {\n                html += this.getRecordHTML(i, i+1);\n            }\n            html += '<tr id=\"grid_'+ this.name + '_rec_bottom\" line=\"bottom\" style=\"height: '+ ((buffered - limit) * this.recordHeight) +'px\">'+\n                    '    <td colspan=\"200\"></td>'+\n                    '</tr>'+\n                    '<tr id=\"grid_'+ this.name +'_rec_more\" style=\"display: none\">'+\n                    '    <td colspan=\"200\" class=\"w2ui-load-more\"></td>'+\n                    '</tr>'+\n                    '</table>';\n            this.last.range_start = 0;\n            this.last.range_end   = limit;\n            return html;\n        },\n\n        getSummaryHTML: function () {\n            if (this.summary.length == 0) return;\n            var html = '<table>';\n            for (var i = 0; i < this.summary.length; i++) {\n                html += this.getRecordHTML(i, i+1, true);\n            }\n            html += '</table>';\n            return html;\n        },\n\n        scroll: function (event) {\n            var time    = (new Date()).getTime();\n            var obj     = this;\n            var records = $('#grid_'+ this.name +'_records');\n            var buffered = this.records.length;\n            if (this.searchData.length != 0 && !this.url) buffered = this.last.searchIds.length;\n            if (buffered == 0 || records.length == 0 || records.height() == 0) return;\n            if (buffered > 300) this.show_extra = 30; else this.show_extra = 300;\n            // need this to enable scrolling when this.limit < then a screen can fit\n            if (records.height() < buffered * this.recordHeight && records.css('overflow-y') == 'hidden') {\n                if (this.total > 0) this.refresh();\n                return;\n            }\n            // update footer\n            var t1 = Math.round(records[0].scrollTop / this.recordHeight + 1);\n            var t2 = t1 + (Math.round(records.height() / this.recordHeight) - 1);\n            if (t1 > buffered) t1 = buffered;\n            if (t2 > buffered) t2 = buffered;\n            var url = (typeof this.url != 'object' ? this.url : this.url.get);\n            $('#grid_'+ this.name + '_footer .w2ui-footer-right').html(w2utils.formatNumber(this.offset + t1) + '-' + w2utils.formatNumber(this.offset + t2) + ' ' + w2utils.lang('of') + ' ' +    w2utils.formatNumber(this.total) +\n                    (url ? ' ('+ w2utils.lang('buffered') + ' '+ w2utils.formatNumber(buffered) + (this.offset > 0 ? ', skip ' + w2utils.formatNumber(this.offset) : '') + ')' : '')\n            );\n            // only for local data source, else no extra records loaded\n            if (!url && (!this.fixedBody || this.total <= 300)) return;\n            // regular processing\n            var start     = Math.floor(records[0].scrollTop / this.recordHeight) - this.show_extra;\n            var end        = start + Math.floor(records.height() / this.recordHeight) + this.show_extra * 2 + 1;\n            // var div     = start - this.last.range_start;\n            if (start < 1) start = 1;\n            if (end > this.total) end = this.total;\n            var tr1 = records.find('#grid_'+ this.name +'_rec_top');\n            var tr2 = records.find('#grid_'+ this.name +'_rec_bottom');\n            // if row is expanded\n            if (String(tr1.next().prop('id')).indexOf('_expanded_row') != -1) tr1.next().remove();\n            if (this.total > end && String(tr2.prev().prop('id')).indexOf('_expanded_row') != -1) tr2.prev().remove();\n            var first = parseInt(tr1.next().attr('line'));\n            var last  = parseInt(tr2.prev().attr('line'));\n            //$('#log').html('buffer: '+ this.buffered +' start-end: ' + start + '-'+ end + ' ===> first-last: ' + first + '-' + last);\n            if (first < start || first == 1 || this.last.pull_refresh) { // scroll down\n                // console.log('end', end, 'last', last, 'show_extre', this.show_extra, this.last.pull_refresh);\n                if (end <= last + this.show_extra - 2 && end != this.total) return;\n                this.last.pull_refresh = false;\n                // remove from top\n                while (true) {\n                    var tmp = records.find('#grid_'+ this.name +'_rec_top').next();\n                    if (tmp.attr('line') == 'bottom') break;\n                    if (parseInt(tmp.attr('line')) < start) tmp.remove(); else break;\n                }\n                // add at bottom\n                var tmp = records.find('#grid_'+ this.name +'_rec_bottom').prev();\n                var rec_start = tmp.attr('line');\n                if (rec_start == 'top') rec_start = start;\n                for (var i = parseInt(rec_start) + 1; i <= end; i++) {\n                    if (!this.records[i-1]) continue;\n                    if (this.records[i-1].expanded === true) this.records[i-1].expanded = false;\n                    tr2.before(this.getRecordHTML(i-1, i));\n                }\n                markSearch();\n                setTimeout(function() { obj.refreshRanges(); }, 0);\n            } else { // scroll up\n                if (start >= first - this.show_extra + 2 && start > 1) return;\n                // remove from bottom\n                while (true) {\n                    var tmp = records.find('#grid_'+ this.name +'_rec_bottom').prev();\n                    if (tmp.attr('line') == 'top') break;\n                    if (parseInt(tmp.attr('line')) > end) tmp.remove(); else break;\n                }\n                // add at top\n                var tmp = records.find('#grid_'+ this.name +'_rec_top').next();\n                var rec_start = tmp.attr('line');\n                if (rec_start == 'bottom') rec_start = end;\n                for (var i = parseInt(rec_start) - 1; i >= start; i--) {\n                    if (!this.records[i-1]) continue;\n                    if (this.records[i-1].expanded === true) this.records[i-1].expanded = false;\n                    tr1.after(this.getRecordHTML(i-1, i));\n                }\n                markSearch();\n                setTimeout(function() { obj.refreshRanges(); }, 0);\n            }\n            // first/last row size\n            var h1 = (start - 1) * obj.recordHeight;\n            var h2 = (buffered - end) * obj.recordHeight;\n            if (h2 < 0) h2 = 0;\n            tr1.css('height', h1 + 'px');\n            tr2.css('height', h2 + 'px');\n            obj.last.range_start = start;\n            obj.last.range_end   = end;\n            // load more if needed\n            var s = Math.floor(records[0].scrollTop / this.recordHeight);\n            var e = s + Math.floor(records.height() / this.recordHeight);\n            if (e + 10 > buffered && this.last.pull_more !== true && buffered < this.total - this.offset) {\n                if (this.autoLoad === true) {\n                    this.last.pull_more = true;\n                    this.last.xhr_offset += this.limit;\n                    this.request('get-records');\n                } else {\n                    var more = $('#grid_'+ this.name +'_rec_more');\n                    if (more.css('display') == 'none') {\n                        more.show()\n                            .on('click', function () {\n                                obj.last.pull_more = true;\n                                obj.last.xhr_offset += obj.limit;\n                                obj.request('get-records');\n                                // show spinner the last\n                                $(this).find('td').html('<div><div style=\"width: 20px; height: 20px;\" class=\"w2ui-spinner\"></div></div>');\n                            });\n                    }\n                    if (more.find('td').text().indexOf('Load') == -1) {\n                        more.find('td').html('<div>'+ w2utils.lang('Load') + ' ' + obj.limit + ' ' + w2utils.lang('More') + '...</div>');\n                    }\n                }\n            }\n            // check for grid end\n            if (buffered >= this.total - this.offset) $('#grid_'+ this.name +'_rec_more').hide();\n            return;\n\n            function markSearch() {\n                // mark search\n                if(obj.markSearch === false) return;\n                clearTimeout(obj.last.marker_timer);\n                obj.last.marker_timer = setTimeout(function () {\n                    // mark all search strings\n                    var str = [];\n                    for (var s in obj.searchData) {\n                        var tmp = obj.searchData[s];\n                        if ($.inArray(tmp.value, str) == -1) str.push(tmp.value);\n                    }\n                    if (str.length > 0) $(obj.box).find('.w2ui-grid-data > div').w2marker(str);\n                }, 50);\n            }\n        },\n\n        getRecordHTML: function (ind, lineNum, summary) {\n            var rec_html = '';\n            var sel = this.last.selection;\n            var record;\n            // first record needs for resize purposes\n            if (ind == -1) {\n                rec_html += '<tr line=\"0\">';\n                if (this.show.lineNumbers)  rec_html += '<td class=\"w2ui-col-number\" style=\"height: 0px;\"></td>';\n                if (this.show.selectColumn) rec_html += '<td class=\"w2ui-col-select\" style=\"height: 0px;\"></td>';\n                if (this.show.expandColumn) rec_html += '<td class=\"w2ui-col-expand\" style=\"height: 0px;\"></td>';\n                for (var i in this.columns) {\n                    if (this.columns[i].hidden) continue;\n                    rec_html += '<td class=\"w2ui-grid-data\" col=\"'+ i +'\" style=\"height: 0px;\"></td>';\n                }\n                rec_html += '<td class=\"w2ui-grid-data-last\" style=\"height: 0px;\"></td>';\n                rec_html += '</tr>';\n                return rec_html;\n            }\n            // regular record\n            var url = (typeof this.url != 'object' ? this.url : this.url.get);\n            if (summary !== true) {\n                if (this.searchData.length > 0 && !url) {\n                    if (ind >= this.last.searchIds.length) return '';\n                    ind = this.last.searchIds[ind];\n                    record = this.records[ind];\n                } else {\n                    if (ind >= this.records.length) return '';\n                    record = this.records[ind];\n                }\n            } else {\n                if (ind >= this.summary.length) return '';\n                record = this.summary[ind];\n            }\n            if (!record) return '';\n            var id = w2utils.escapeId(record.recid);\n            var isRowSelected = false;\n            if (sel.indexes.indexOf(ind) != -1) isRowSelected = true;\n            // render TR\n            rec_html += '<tr id=\"grid_'+ this.name +'_rec_'+ record.recid +'\" recid=\"'+ record.recid +'\" line=\"'+ lineNum +'\" '+\n                ' class=\"'+ (lineNum % 2 == 0 ? 'w2ui-even' : 'w2ui-odd') + \n                    (isRowSelected && this.selectType == 'row' ? ' w2ui-selected' : '') + \n                    (record.editable === false ? ' w2ui-no-edit' : '') +\n                    (record.expanded === true ? ' w2ui-expanded' : '') + '\" ' +\n                (summary !== true ?\n                    (w2utils.isIOS ?\n                        '    onclick  = \"w2ui[\\''+ this.name +'\\'].dblClick(\\''+ record.recid +'\\', event);\"'\n                        :\n                        '    onclick  = \"w2ui[\\''+ this.name +'\\'].click(\\''+ record.recid +'\\', event);\"'+\n                        '    oncontextmenu = \"w2ui[\\''+ this.name +'\\'].contextMenu(\\''+ record.recid +'\\', event);\"'\n                     )\n                    : ''\n                ) +\n                ' style=\"height: '+ this.recordHeight +'px; '+ (!isRowSelected && typeof record['style'] == 'string' ? record['style'] : '') +'\" '+\n                    ( typeof record['style'] == 'string' ? 'custom_style=\"'+ record['style'] +'\"' : '') +\n                '>';\n            if (this.show.lineNumbers) {\n                rec_html += '<td id=\"grid_'+ this.name +'_cell_'+ ind +'_number' + (summary ? '_s' : '') + '\" class=\"w2ui-col-number\">'+\n                                (summary !== true ? '<div>'+ lineNum +'</div>' : '') +\n                            '</td>';\n            }\n            if (this.show.selectColumn) {\n                rec_html +=\n                        '<td id=\"grid_'+ this.name +'_cell_'+ ind +'_select' + (summary ? '_s' : '') + '\" class=\"w2ui-grid-data w2ui-col-select\" '+\n                        '        onclick=\"if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;\">'+\n                            (summary !== true ?\n                            '    <div>'+\n                            '        <input class=\"w2ui-grid-select-check\" type=\"checkbox\" tabIndex=\"-1\"'+\n                            '            '+ (isRowSelected ? 'checked=\"checked\"' : '') +\n                            '            onclick=\"var obj = w2ui[\\''+ this.name +'\\']; '+\n                            '                if (!obj.multiSelect) { obj.selectNone(); }'+\n                            '                if (this.checked) obj.select(\\''+ record.recid + '\\'); else obj.unselect(\\''+ record.recid + '\\'); '+\n                            '                if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;\">'+\n                            '    </div>'\n                            :\n                            '' ) +\n                        '</td>';\n            }\n            if (this.show.expandColumn) {\n                var tmp_img = '';\n                if (record.expanded === true)  tmp_img = '-'; else tmp_img = '+';\n                if (record.expanded == 'none') tmp_img = '';\n                if (record.expanded == 'spinner') tmp_img = '<div class=\"w2ui-spinner\" style=\"width: 16px; margin: -2px 2px;\"></div>';\n                rec_html +=\n                        '<td id=\"grid_'+ this.name +'_cell_'+ ind +'_expand' + (summary ? '_s' : '') + '\" class=\"w2ui-grid-data w2ui-col-expand\">'+\n                            (summary !== true ?\n                            '    <div ondblclick=\"if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;\" '+\n                            '            onclick=\"w2ui[\\''+ this.name +'\\'].toggle(\\''+ record.recid +'\\', event); '+\n                            '                if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;\">'+\n                            '        '+ tmp_img +' </div>'\n                            :\n                            '' ) +\n                        '</td>';\n            }\n            var col_ind = 0;\n            while (true) {\n                var col = this.columns[col_ind];\n                if (col.hidden) { col_ind++; if (typeof this.columns[col_ind] == 'undefined') break; else continue; }\n                var isChanged = !summary && record.changes && typeof record.changes[col.field] != 'undefined';\n                var rec_cell  = this.getCellHTML(ind, col_ind, summary);\n                var addStyle  = '';\n                if (typeof col.render == 'string') {\n                    var tmp = col.render.toLowerCase().split(':');\n                    if (['number', 'int', 'float', 'money', 'currency', 'percent'].indexOf(tmp[0]) != -1) addStyle += 'text-align: right;';\n                }\n                if (typeof record.style == 'object' && typeof record.style[col_ind] == 'string') {\n                    addStyle += record.style[col_ind] + ';';\n                }\n                var isCellSelected = false;\n                if (isRowSelected && $.inArray(col_ind, sel.columns[ind]) != -1) isCellSelected = true;\n                rec_html += '<td class=\"w2ui-grid-data'+ (isCellSelected ? ' w2ui-selected' : '') + (isChanged ? ' w2ui-changed' : '') +'\" col=\"'+ col_ind +'\" '+\n                            '    style=\"'+ addStyle + (typeof col.style != 'undefined' ? col.style : '') +'\" '+\n                                          (typeof col.attr != 'undefined' ? col.attr : '') +'>'+\n                                rec_cell +\n                            '</td>';\n                col_ind++;\n                if (typeof this.columns[col_ind] == 'undefined') break;\n            }\n            rec_html += '<td class=\"w2ui-grid-data-last\"></td>';\n            rec_html += '</tr>';\n            return rec_html;\n        },\n\n        getCellHTML: function (ind, col_ind, summary) {\n            var col    = this.columns[col_ind];\n            var record = (summary !== true ? this.records[ind] : this.summary[ind]);\n            var data   = this.getCellValue(ind, col_ind, summary);\n            var edit   = col.editable;\n            // various renderers\n            if (col.render != null) {\n                if (typeof col.render == 'function') {\n                    data = $.trim(col.render.call(this, record, ind, col_ind));\n                    if (data.length < 4 || data.substr(0, 4).toLowerCase() != '<div') data = '<div>' + data + '</div>';\n                }\n                if (typeof col.render == 'object')   data = '<div>' + (col.render[data] || '') + '</div>';\n                if (typeof col.render == 'string') {\n                    var tmp = col.render.toLowerCase().split(':');\n                    var prefix = '';\n                    var suffix = '';\n                    if (['number', 'int', 'float', 'money', 'currency', 'percent'].indexOf(tmp[0]) != -1) {\n                        if (typeof tmp[1] == 'undefined' || !w2utils.isInt(tmp[1])) tmp[1] = 0;\n                        if (tmp[1] > 20) tmp[1] = 20;\n                        if (tmp[1] < 0)  tmp[1] = 0;\n                        if (['money', 'currency'].indexOf(tmp[0]) != -1) { tmp[1] = w2utils.settings.currencyPrecision; prefix = w2utils.settings.currencyPrefix; suffix = w2utils.settings.currencySuffix }\n                        if (tmp[0] == 'percent') { suffix = '%'; if (tmp[1] !== '0') tmp[1] = 1; }\n                        if (tmp[0] == 'int')     { tmp[1] = 0; }\n                        // format\n                        data = '<div>' + (data !== '' ? prefix + w2utils.formatNumber(Number(data).toFixed(tmp[1])) + suffix : '') + '</div>';\n                    }\n                    if (tmp[0] == 'time') {\n                        if (typeof tmp[1] == 'undefined' || tmp[1] == '') tmp[1] = w2utils.settings.time_format;\n                        data = '<div>' + prefix + w2utils.formatTime(data, tmp[1] == 'h12' ? 'hh:mi pm': 'h24:min') + suffix + '</div>';\n                    }\n                    if (tmp[0] == 'date') {\n                        if (typeof tmp[1] == 'undefined' || tmp[1] == '') tmp[1] = w2utils.settings.date_display;\n                        data = '<div>' + prefix + w2utils.formatDate(data, tmp[1]) + suffix + '</div>';\n                    }\n                    if (tmp[0] == 'age') {\n                        data = '<div>' + prefix + w2utils.age(data) + suffix + '</div>';\n                    }\n                    if (tmp[0] == 'toggle') {\n                        data = '<div>' + prefix + (data ? 'Yes' : '') + suffix + '</div>';\n                    }\n                }\n            } else {\n                // if editable checkbox\n                var addStyle = '';\n                if (edit && ['checkbox', 'check'].indexOf(edit.type) != -1) {\n                    var changeInd = summary ? -(ind + 1) : ind;\n                    addStyle = 'text-align: center';\n                    data = '<input type=\"checkbox\" '+ (data ? 'checked' : '') +' onclick=\"' +\n                           '    var obj = w2ui[\\''+ this.name + '\\']; '+\n                           '    obj.editChange.call(obj, this, '+ changeInd +', '+ col_ind +', event); ' +\n                           '\">';\n                }\n                if (!this.show.recordTitles) {\n                    var data = '<div style=\"'+ addStyle +'\">'+ data +'</div>';\n                } else {\n                    // title overwrite\n                    var title = String(data).replace(/\"/g, \"''\");\n                    if (typeof col.title != 'undefined') {\n                        if (typeof col.title == 'function') title = col.title.call(this, record, ind, col_ind);\n                        if (typeof col.title == 'string')   title = col.title;\n                    }\n                    var data = '<div title=\"'+ w2utils.stripTags(title) +'\" style=\"'+ addStyle +'\">'+ data +'</div>';\n                }\n            }\n            if (data == null || typeof data == 'undefined') data = '';\n            return data;\n        },\n\n        getCellValue: function (ind, col_ind, summary) {\n            var col    = this.columns[col_ind];\n            var record = (summary !== true ? this.records[ind] : this.summary[ind]);\n            var data   = this.parseField(record, col.field);\n            if (record.changes && typeof record.changes[col.field] != 'undefined') data = record.changes[col.field];\n            if (data == null || typeof data == 'undefined') data = '';\n            return data;\n        },\n\n        getFooterHTML: function () {\n            return '<div>'+\n                '    <div class=\"w2ui-footer-left\"></div>'+\n                '    <div class=\"w2ui-footer-right\"></div>'+\n                '    <div class=\"w2ui-footer-center\"></div>'+\n                '</div>';\n        },\n\n        status: function (msg) {\n            if (typeof msg != 'undefined') {\n                $('#grid_'+ this.name +'_footer').find('.w2ui-footer-left').html(msg);\n            } else {\n                // show number of selected\n                var msgLeft = '';\n                var sel = this.getSelection();\n                if (sel.length > 0) {\n                    msgLeft = String(sel.length).replace(/(\\d)(?=(\\d\\d\\d)+(?!\\d))/g, \"$1,\") + ' ' + w2utils.lang('selected');\n                    var tmp = sel[0];\n                    if (typeof tmp == 'object') tmp = tmp.recid + ', '+ w2utils.lang('Column') +': '+ tmp.column;\n                    if (sel.length == 1) msgLeft = w2utils.lang('Record ID') + ': '+ tmp + ' ';\n                }\n                $('#grid_'+ this.name +'_footer .w2ui-footer-left').html(msgLeft);\n                // toolbar\n                if (sel.length == 1) this.toolbar.enable('w2ui-edit'); else this.toolbar.disable('w2ui-edit');\n                if (sel.length >= 1) this.toolbar.enable('w2ui-delete'); else this.toolbar.disable('w2ui-delete');\n            }\n        },\n\n        lock: function (msg, showSpinner) {\n            var box  = $(this.box).find('> div:first-child');\n            var args = Array.prototype.slice.call(arguments, 0);\n            args.unshift(box);\n            setTimeout(function () { w2utils.lock.apply(window, args); }, 10);\n        },\n\n        unlock: function () {\n            var box = this.box;\n            setTimeout(function () { w2utils.unlock(box); }, 25); // needed timer so if server fast, it will not flash\n        },\n\n        stateSave: function (returnOnly) {\n            if (!localStorage) return null;\n            var state = {\n                columns     : [],\n                show        : $.extend({}, this.show),\n                last        : {\n                    search      : this.last.search,\n                    multi       : this.last.multi,\n                    logic       : this.last.logic,\n                    caption     : this.last.caption,\n                    field       : this.last.field,\n                    scrollTop   : this.last.scrollTop,\n                    scrollLeft  : this.last.scrollLeft\n                },\n                sortData    : [],\n                searchData  : []\n            };\n            for (var i in this.columns) {\n                var col = this.columns[i];\n                state.columns.push({\n                    field           : col.field,\n                    hidden          : col.hidden,\n                    size            : col.size,\n                    sizeCalculated  : col.sizeCalculated,\n                    sizeOriginal    : col.sizeOriginal,\n                    sizeType        : col.sizeType\n                });\n            }\n            for (var i in this.sortData) state.sortData.push($.extend({}, this.sortData[i]));\n            for (var i in this.searchData) state.searchData.push($.extend({}, this.searchData[i]));\n            // save into local storage\n            if (returnOnly !== true) {\n                // event before\n                var eventData = this.trigger({ phase: 'before', type: 'stateSave', target: this.name, state: state });\n                if (eventData.isCancelled === true) { if (typeof callBack == 'function') callBack({ status: 'error', message: 'Request aborted.' }); return; }\n                try {\n                    var savedState = $.parseJSON(localStorage.w2ui || '{}');\n                    if (!savedState) savedState = {};\n                    if (!savedState.states) savedState.states = {};\n                    savedState.states[this.name] = state;\n                    localStorage.w2ui = JSON.stringify(savedState);\n                } catch (e) {\n                    delete localStorage.w2ui;\n                    return null;\n                }\n                // event after\n                this.trigger($.extend(eventData, { phase: 'after' }));\n            }\n            return state;\n        },\n\n        stateRestore: function (newState) {\n            var obj = this;\n            if (!newState) {\n                // read it from local storage\n                try {\n                    if (!localStorage) return false;\n                    var tmp = $.parseJSON(localStorage.w2ui || '{}');\n                    if (!tmp) tmp = {};\n                    if (!tmp.states) tmp.states = {};\n                    newState = tmp.states[this.name];\n                } catch (e) {\n                    delete localStorage.w2ui;\n                    return null;\n                }\n            }\n            // event before\n            var eventData = this.trigger({ phase: 'before', type: 'stateRestore', target: this.name, state: newState });\n            if (eventData.isCancelled === true) { if (typeof callBack == 'function') callBack({ status: 'error', message: 'Request aborted.' }); return; }\n            // default behavior\n            if ($.isPlainObject(newState)) {\n                $.extend(this.show, newState.show);\n                $.extend(this.last, newState.last);\n                var sTop  = this.last.scrollTop;\n                var sLeft = this.last.scrollLeft;\n                for (var c in newState.columns) {\n                    var tmp = newState.columns[c];\n                    var col = this.getColumn(tmp.field);\n                    if (col) $.extend(col, tmp);\n                }\n                this.sortData.splice(0, this.sortData.length);\n                for (var c in newState.sortData) this.sortData.push(newState.sortData[c]);\n                this.searchData.splice(0, this.searchData.length);\n                for (var c in newState.searchData) this.searchData.push(newState.searchData[c]);\n                // apply sort and search\n                setTimeout(function () {\n                    // needs timeout as records need to be populated\n                    if (obj.sortData.length > 0) obj.localSort();\n                    if (obj.searchData.length > 0) obj.localSearch();\n                    obj.last.scrollTop  = sTop;\n                    obj.last.scrollLeft = sLeft;\n                    obj.refresh();\n                }, 1);\n            }\n            // event after\n            this.trigger($.extend(eventData, { phase: 'after' }));\n            return true;\n        },\n\n        stateReset: function () {\n            this.stateRestore(this.last.state);\n            // remove from local storage\n            if (localStorage) {\n                try {\n                    var tmp = $.parseJSON(localStorage.w2ui || '{}');\n                    if (tmp.states && tmp.states[this.name]) {\n                        delete tmp.states[this.name];\n                    }\n                    localStorage.w2ui = JSON.stringify(tmp);\n                } catch (e) {\n                    delete localStorage.w2ui;\n                    return null;\n                }                \n            }\n        },\n\n        parseField: function (obj, field) {\n            var val = '';\n            try { // need this to make sure no error in fields\n                val = obj;\n                var tmp = String(field).split('.');\n                for (var i in tmp) {\n                    val = val[tmp[i]];\n                }\n            } catch (event) {\n                val = '';\n            }\n            return val;\n        },\n\n        prepareData: function () {\n            // loops thru records and prepares date and time objects\n            for (var r in this.records) {\n                var rec = this.records[r];\n                for (var c in this.columns) {\n                    var column = this.columns[c];\n                    if (rec[column.field] == null || typeof column.render != 'string') continue;\n                    // number\n                    if (['number', 'int', 'float', 'money', 'currency', 'percent'].indexOf(column.render.split(':')[0])  != -1) {\n                        if (typeof rec[column.field] != 'number') rec[column.field] = parseFloat(rec[column.field]);\n                    }\n                    // date\n                    if (['date', 'age'].indexOf(column.render.split(':')[0]) != -1) {\n                        if (!rec[column.field + '_']) {\n                            var dt = rec[column.field];\n                            if (w2utils.isInt(dt)) dt = parseInt(dt);\n                            rec[column.field + '_'] = new Date(dt);\n                        }\n                    }\n                    // time\n                    if (['time'].indexOf(column.render) != -1) {\n                        if (w2utils.isTime(rec[column.field])) { // if string\n                            var tmp = w2utils.isTime(rec[column.field], true);\n                            var dt = new Date();\n                            dt.setHours(tmp.hours, tmp.minutes, (tmp.seconds ? tmp.seconds : 0), 0); // sets hours, min, sec, mills\n                            if (!rec[column.field + '_']) rec[column.field + '_'] = dt;\n                        } else { // if date object\n                            var tmp = rec[column.field];\n                            if (w2utils.isInt(tmp)) tmp = parseInt(tmp);\n                            var tmp = (tmp != null ? new Date(tmp) : new Date());\n                            var dt  = new Date();\n                            dt.setHours(tmp.getHours(), tmp.getMinutes(), tmp.getSeconds(), 0); // sets hours, min, sec, mills\n                            if (!rec[column.field + '_']) rec[column.field + '_'] = dt;\n                        }\n                    }\n                }\n            }\n        },\n\n        nextCell: function (col_ind, editable) {\n            var check = col_ind + 1;\n            if (this.columns.length == check) return null;\n            if (editable === true) {\n                var edit = this.columns[check].editable;\n                if (this.columns[check].hidden || typeof edit == 'undefined'\n                    || (edit && ['checkbox', 'check'].indexOf(edit.type) != -1)) return this.nextCell(check, editable);\n            }\n            return check;\n        },\n\n        prevCell: function (col_ind, editable) {\n            var check = col_ind - 1;\n            if (check < 0) return null;\n            if (editable === true) {\n                var edit = this.columns[check].editable;\n                if (this.columns[check].hidden || typeof edit == 'undefined'\n                    || (edit && ['checkbox', 'check'].indexOf(edit.type) != -1)) return this.prevCell(check, editable);\n            }\n            return check;\n        },\n\n        nextRow: function (ind) {\n            if ((ind + 1 < this.records.length && this.last.searchIds.length == 0) // if there are more records\n                    || (this.last.searchIds.length > 0 && ind < this.last.searchIds[this.last.searchIds.length-1])) {\n                ind++;\n                if (this.last.searchIds.length > 0) {\n                    while (true) {\n                        if ($.inArray(ind, this.last.searchIds) != -1 || ind > this.records.length) break;\n                        ind++;\n                    }\n                }\n                return ind;\n            } else {\n                return null;\n            }\n        },\n\n        prevRow: function (ind) {\n            if ((ind > 0 && this.last.searchIds.length == 0)  // if there are more records\n                    || (this.last.searchIds.length > 0 && ind > this.last.searchIds[0])) {\n                ind--;\n                if (this.last.searchIds.length > 0) {\n                    while (true) {\n                        if ($.inArray(ind, this.last.searchIds) != -1 || ind < 0) break;\n                        ind--;\n                    }\n                }\n                return ind;\n            } else {\n                return null;\n            }\n        }\n    };\n\n    $.extend(w2grid.prototype, w2utils.event);\n    w2obj.grid = w2grid;\n})();\n\n/************************************************************************\n*   Library: Web 2.0 UI for jQuery (using prototypical inheritance)\n*   - Following objects defined\n*        - w2layout        - layout widget\n*        - $().w2layout    - jQuery wrapper\n*   - Dependencies: jQuery, w2utils, w2toolbar, w2tabs\n*\n* == NICE TO HAVE ==\n*   - onResize for the panel\n*   - add more panel title positions (left=rotated, right=rotated, bottom)\n*   - bug: resizer is visible (and onHover) when panel is hidden.\n*   - bug: when you assign content before previous transition completed.\n*\n************************************************************************/\n\n(function () {\n    var w2layout = function (options) {\n        this.box     = null;        // DOM Element that holds the element\n        this.name    = null;        // unique name for w2ui\n        this.panels  = [];\n        this.tmp     = {};\n\n        this.padding = 1;        // panel padding\n        this.resizer = 4;        // resizer width or height\n        this.style   = '';\n\n        this.onShow         = null;\n        this.onHide         = null;\n        this.onResizing     = null;\n        this.onResizerClick = null;\n        this.onRender       = null;\n        this.onRefresh      = null;\n        this.onResize       = null;\n        this.onDestroy      = null;\n\n        $.extend(true, this, w2obj.layout, options);\n    };\n\n    /* @const */ var w2layout_panels = ['top', 'left', 'main', 'preview', 'right', 'bottom'];\n\n    // ====================================================\n    // -- Registers as a jQuery plugin\n\n    $.fn.w2layout = function(method) {\n        if (typeof method === 'object' || !method ) {\n            // check name parameter\n            if (!w2utils.checkName(method, 'w2layout')) return;\n            var panels = method.panels || [];\n            var object = new w2layout(method);\n            $.extend(object, { handlers: [], panels: [] });\n            // add defined panels\n            for (var p = 0, len = panels.length; p < len; p++) {\n                object.panels[p] = $.extend(true, {}, w2layout.prototype.panel, panels[p]);\n                if ($.isPlainObject(object.panels[p].tabs) || $.isArray(object.panels[p].tabs)) initTabs(object, panels[p].type);\n                if ($.isPlainObject(object.panels[p].toolbar) || $.isArray(object.panels[p].toolbar)) initToolbar(object, panels[p].type);\n            }\n            // add all other panels\n            for (var p1 in w2layout_panels) {\n                p1 = w2layout_panels[p1];\n                if (object.get(p1) !== null) continue;\n                object.panels.push($.extend(true, {}, w2layout.prototype.panel, { type: p1, hidden: (p1 !== 'main'), size: 50 }));\n            }\n            if ($(this).length > 0) {\n                object.render($(this)[0]);\n            }\n            w2ui[object.name] = object;\n            return object;\n\n        } else if (w2ui[$(this).attr('name')]) {\n            var obj = w2ui[$(this).attr('name')];\n            obj[method].apply(obj, Array.prototype.slice.call(arguments, 1));\n            return this;\n        } else {\n            console.log('ERROR: Method ' +  method + ' does not exist on jQuery.w2layout' );\n        }\n\n        function initTabs(object, panel, tabs) {\n            var pan = object.get(panel);\n            if (pan !== null && typeof tabs == 'undefined') tabs = pan.tabs;\n            if (pan === null || tabs === null) return false;\n            // instanciate tabs\n            if ($.isArray(tabs)) tabs = { tabs: tabs };\n            $().w2destroy(object.name + '_' + panel + '_tabs'); // destroy if existed\n            pan.tabs = $().w2tabs($.extend({}, tabs, { owner: object, name: object.name + '_' + panel + '_tabs' }));\n            pan.show.tabs = true;\n            return true;\n        }\n\n        function initToolbar(object, panel, toolbar) {\n            var pan = object.get(panel);\n            if (pan !== null && typeof toolbar == 'undefined') toolbar = pan.toolbar;\n            if (pan === null || toolbar === null) return false;\n            // instanciate toolbar\n            if ($.isArray(toolbar)) toolbar = { items: toolbar };\n            $().w2destroy(object.name + '_' + panel + '_toolbar'); // destroy if existed\n            pan.toolbar = $().w2toolbar($.extend({}, toolbar, { owner: object, name: object.name + '_' + panel + '_toolbar' }));\n            pan.show.toolbar = true;\n            return true;\n        }\n    };\n\n    // ====================================================\n    // -- Implementation of core functionality\n\n    w2layout.prototype = {\n        // default setting for a panel\n        panel: {\n            type      : null,        // left, right, top, bottom\n            title     : '',\n            size      : 100,        // width or height depending on panel name\n            minSize   : 20,\n            maxSize   : false,\n            hidden    : false,\n            resizable : false,\n            overflow  : 'auto',\n            style     : '',\n            content   : '',        // can be String or Object with .render(box) method\n            tabs      : null,\n            toolbar   : null,\n            width     : null,        // read only\n            height    : null,        // read only\n            show : {\n                toolbar : false,\n                tabs    : false\n            },\n            onRefresh : null,\n            onShow    : null,\n            onHide    : null\n        },\n\n        // alias for content\n        html: function (panel, data, transition) {\n            return this.content(panel, data, transition);\n        },\n\n        content: function (panel, data, transition) {\n            var obj = this;\n            var p = this.get(panel);\n            // if it is CSS panel\n            if (panel == 'css') {\n                $('#layout_'+ obj.name +'_panel_css').html('<style>'+ data +'</style>');\n                return true;\n            }\n            if (p === null) return false;\n            if (typeof data == 'undefined' || data === null) {\n                return p.content;\n            } else {\n                if (data instanceof jQuery) {\n                    console.log('ERROR: You can not pass jQuery object to w2layout.content() method');\n                    return false;\n                }\n                var pname     = '#layout_'+ this.name + '_panel_'+ p.type;\n                var current = $(pname + '> .w2ui-panel-content');\n                var panelTop = 0;\n                if (current.length > 0) {\n                    $(pname).scrollTop(0);\n                    panelTop = $(current).position().top;\n                }\n                if (p.content === '') {\n                    p.content = data;\n                    this.refresh(panel);\n                } else {\n                    p.content = data;\n                    if (!p.hidden) {\n                        if (transition !== null && transition !== '' && typeof transition != 'undefined') {\n                            // apply transition\n                            var div1 = $(pname + '> .w2ui-panel-content');\n                            div1.after('<div class=\"w2ui-panel-content new-panel\" style=\"'+ div1[0].style.cssText +'\"></div>');\n                            var div2 = $(pname + '> .w2ui-panel-content.new-panel');\n                            div1.css('top', panelTop);\n                            div2.css('top', panelTop);\n                            if (typeof data == 'object') {\n                                data.box = div2[0]; // do not do .render(box);\n                                data.render();\n                            } else {\n                                div2.html(data);\n                            }\n                            w2utils.transition(div1[0], div2[0], transition, function () {\n                                div1.remove();\n                                div2.removeClass('new-panel');\n                                div2.css('overflow', p.overflow);\n                                // IE Hack\n                                obj.resize();\n                                if (window.navigator.userAgent.indexOf('MSIE') != -1) setTimeout(function () { obj.resize(); }, 100);\n                            });\n                        }\n                    }\n                    this.refresh(panel);\n                }\n            }\n            // IE Hack\n            obj.resize();\n            if (window.navigator.userAgent.indexOf('MSIE') != -1) setTimeout(function () { obj.resize(); }, 100);\n            return true;\n        },\n\n        load: function (panel, url, transition, onLoad) {\n            var obj = this;\n            if (panel == 'css') {\n                $.get(url, function (data, status, xhr) { // should always be $.get as it is template\n                    obj.content(panel, xhr.responseText);\n                    if (onLoad) onLoad();\n                });\n                return true;\n            }\n            if (this.get(panel) !== null) {\n                $.get(url, function (data, status, xhr) { // should always be $.get as it is template\n                    obj.content(panel, xhr.responseText, transition);\n                    if (onLoad) onLoad();\n                    // IE Hack\n                    obj.resize();\n                    if (window.navigator.userAgent.indexOf('MSIE') != -1) setTimeout(function () { obj.resize(); }, 100);\n                });\n                return true;\n            }\n            return false;\n        },\n\n        sizeTo: function (panel, size) {\n            var obj = this;\n            var pan = obj.get(panel);\n            if (pan === null) return false;\n            // resize\n            $(obj.box).find(' > div > .w2ui-panel').css({\n                '-webkit-transition' : '.2s',\n                '-moz-transition'    : '.2s',\n                '-ms-transition'     : '.2s',\n                '-o-transition'      : '.2s'\n            });\n            setTimeout(function () {\n                obj.set(panel, { size: size });\n            }, 1);\n            // clean\n            setTimeout(function () {\n                $(obj.box).find(' > div > .w2ui-panel').css({\n                    '-webkit-transition' : '0s',\n                    '-moz-transition'    : '0s',\n                    '-ms-transition'     : '0s',\n                    '-o-transition'      : '0s'\n                });\n                obj.resize();\n            }, 500);\n            return true;\n        },\n\n        show: function (panel, immediate) {\n            var obj = this;\n            // event before\n            var eventData = this.trigger({ phase: 'before', type: 'show', target: panel, object: this.get(panel), immediate: immediate });\n            if (eventData.isCancelled === true) return;\n\n            var p = obj.get(panel);\n            if (p === null) return false;\n            p.hidden = false;\n            if (immediate === true) {\n                $('#layout_'+ obj.name +'_panel_'+panel).css({ 'opacity': '1' });\n                if (p.resizable) $('#layout_'+ obj.name +'_resizer_'+panel).show();\n                obj.trigger($.extend(eventData, { phase: 'after' }));\n                obj.resize();\n            } else {\n                if (p.resizable) $('#layout_'+ obj.name +'_resizer_'+panel).show();\n                // resize\n                $('#layout_'+ obj.name +'_panel_'+panel).css({ 'opacity': '0' });\n                $(obj.box).find(' > div > .w2ui-panel').css({\n                    '-webkit-transition' : '.2s',\n                    '-moz-transition'    : '.2s',\n                    '-ms-transition'     : '.2s',\n                    '-o-transition'      : '.2s'\n                });\n                setTimeout(function () { obj.resize(); }, 1);\n                // show\n                setTimeout(function() {\n                    $('#layout_'+ obj.name +'_panel_'+ panel).css({ 'opacity': '1' });\n                }, 250);\n                // clean\n                setTimeout(function () {\n                    $(obj.box).find(' > div > .w2ui-panel').css({\n                        '-webkit-transition' : '0s',\n                        '-moz-transition'    : '0s',\n                        '-ms-transition'     : '0s',\n                        '-o-transition'      : '0s'\n                    });\n                    obj.trigger($.extend(eventData, { phase: 'after' }));\n                    obj.resize();\n                }, 500);\n            }\n            return true;\n        },\n\n        hide: function (panel, immediate) {\n            var obj = this;\n            // event before\n            var eventData = this.trigger({ phase: 'before', type: 'hide', target: panel, object: this.get(panel), immediate: immediate });\n            if (eventData.isCancelled === true) return;\n\n            var p = obj.get(panel);\n            if (p === null) return false;\n            p.hidden = true;\n            if (immediate === true) {\n                $('#layout_'+ obj.name +'_panel_'+panel).css({ 'opacity': '0'    });\n                $('#layout_'+ obj.name +'_resizer_'+panel).hide();\n                obj.trigger($.extend(eventData, { phase: 'after' }));\n                obj.resize();\n            } else {\n                $('#layout_'+ obj.name +'_resizer_'+panel).hide();\n                // hide\n                $(obj.box).find(' > div > .w2ui-panel').css({\n                    '-webkit-transition' : '.2s',\n                    '-moz-transition'    : '.2s',\n                    '-ms-transition'     : '.2s',\n                    '-o-transition'      : '.2s'\n                });\n                $('#layout_'+ obj.name +'_panel_'+panel).css({ 'opacity': '0'    });\n                setTimeout(function () { obj.resize(); }, 1);\n                // clean\n                setTimeout(function () {\n                    $(obj.box).find(' > div > .w2ui-panel').css({\n                        '-webkit-transition' : '0s',\n                        '-moz-transition'    : '0s',\n                        '-ms-transition'     : '0s',\n                        '-o-transition'      : '0s'\n                    });\n                    obj.trigger($.extend(eventData, { phase: 'after' }));\n                    obj.resize();\n                }, 500);\n            }\n            return true;\n        },\n\n        toggle: function (panel, immediate) {\n            var p = this.get(panel);\n            if (p === null) return false;\n            if (p.hidden) return this.show(panel, immediate); else return this.hide(panel, immediate);\n        },\n\n        set: function (panel, options) {\n            var obj = this.get(panel, true);\n            if (obj === null) return false;\n            $.extend(this.panels[obj], options);\n            if (typeof options['content'] != 'undefined') this.refresh(panel); // refresh only when content changed\n            this.resize(); // resize is needed when panel size is changed\n            return true;\n        },\n\n        get: function (panel, returnIndex) {\n            for (var p in this.panels) {\n                if (this.panels[p].type == panel) {\n                    if (returnIndex === true) return p; else return this.panels[p];\n                }\n            }\n            return null;\n        },\n\n        el: function (panel) {\n            var el = $('#layout_'+ this.name +'_panel_'+ panel +'> .w2ui-panel-content');\n            if (el.length != 1) return null;\n            return el[0];\n        },\n\n        hideToolbar: function (panel) {\n            var pan = this.get(panel);\n            if (!pan) return;\n            pan.show.toolbar = false;\n            $('#layout_'+ this.name +'_panel_'+ panel +'> .w2ui-panel-toolbar').hide();\n            this.resize();\n        },\n\n        showToolbar: function (panel) {\n            var pan = this.get(panel);\n            if (!pan) return;\n            pan.show.toolbar = true;\n            $('#layout_'+ this.name +'_panel_'+ panel +'> .w2ui-panel-toolbar').show();\n            this.resize();\n        },\n\n        toggleToolbar: function (panel) {\n            var pan = this.get(panel);\n            if (!pan) return;\n            if (pan.show.toolbar) this.hideToolbar(panel); else this.showToolbar(panel);\n        },\n\n        hideTabs: function (panel) {\n            var pan = this.get(panel);\n            if (!pan) return;\n            pan.show.tabs = false;\n            $('#layout_'+ this.name +'_panel_'+ panel +'> .w2ui-panel-tabs').hide();\n            this.resize();\n        },\n\n        showTabs: function (panel) {\n            var pan = this.get(panel);\n            if (!pan) return;\n            pan.show.tabs = true;\n            $('#layout_'+ this.name +'_panel_'+ panel +'> .w2ui-panel-tabs').show();\n            this.resize();\n        },\n\n        toggleTabs: function (panel) {\n            var pan = this.get(panel);\n            if (!pan) return;\n            if (pan.show.tabs) this.hideTabs(panel); else this.showTabs(panel);\n        },\n\n        render: function (box) {\n            var obj = this;\n            // if (window.getSelection) window.getSelection().removeAllRanges(); // clear selection\n            var time = (new Date()).getTime();\n            // event before\n            var eventData = obj.trigger({ phase: 'before', type: 'render', target: obj.name, box: box });\n            if (eventData.isCancelled === true) return;\n\n            if (typeof box != 'undefined' && box !== null) {\n                if ($(obj.box).find('#layout_'+ obj.name +'_panel_main').length > 0) {\n                    $(obj.box)\n                        .removeAttr('name')\n                        .removeClass('w2ui-layout')\n                        .html('');\n                }\n                obj.box = box;\n            }\n            if (!obj.box) return false;\n            $(obj.box)\n                .attr('name', obj.name)\n                .addClass('w2ui-layout')\n                .html('<div></div>');\n            if ($(obj.box).length > 0) $(obj.box)[0].style.cssText += obj.style;\n            // create all panels\n            for (var p1 in w2layout_panels) {\n                p1 = w2layout_panels[p1];\n                var pan  = obj.get(p1);\n                var html =  '<div id=\"layout_'+ obj.name + '_panel_'+ p1 +'\" class=\"w2ui-panel\">'+\n                            '    <div class=\"w2ui-panel-title\"></div>'+\n                            '    <div class=\"w2ui-panel-tabs\"></div>'+\n                            '    <div class=\"w2ui-panel-toolbar\"></div>'+\n                            '    <div class=\"w2ui-panel-content\"></div>'+\n                            '</div>'+\n                            '<div id=\"layout_'+ obj.name + '_resizer_'+ p1 +'\" class=\"w2ui-resizer\"></div>';\n                $(obj.box).find(' > div').append(html);\n                // tabs are rendered in refresh()\n            }\n            $(obj.box).find(' > div')\n                .append('<div id=\"layout_'+ obj.name + '_panel_css\" style=\"position: absolute; top: 10000px;\"></div');\n            obj.refresh(); // if refresh is not called here, the layout will not be available right after initialization\n            // process event\n            obj.trigger($.extend(eventData, { phase: 'after' }));\n            // reinit events\n            setTimeout(function () { // needed this timeout to allow browser to render first if there are tabs or toolbar\n                initEvents();\n                obj.resize();\n            }, 0);\n            return (new Date()).getTime() - time;\n\n            function initEvents() {\n                obj.tmp.events = {\n                    resize : function (event) {\n                        w2ui[obj.name].resize();\n                    },\n                    resizeStart : resizeStart,\n                    mouseMove   : resizeMove,\n                    mouseUp     : resizeStop\n                };\n                $(window).on('resize', obj.tmp.events.resize);\n            }\n\n            function resizeStart(type, evnt) {\n                if (!obj.box) return;\n                if (!evnt) evnt = window.event;\n                if (!window.addEventListener) { window.document.attachEvent('onselectstart', function() { return false; } ); }\n                $(document).off('mousemove', obj.tmp.events.mouseMove).on('mousemove', obj.tmp.events.mouseMove);\n                $(document).off('mouseup', obj.tmp.events.mouseUp).on('mouseup', obj.tmp.events.mouseUp);\n                obj.tmp.resize = {\n                    type    : type,\n                    x       : evnt.screenX,\n                    y       : evnt.screenY,\n                    diff_x  : 0,\n                    diff_y  : 0,\n                    value   : 0\n                };\n                // lock all panels\n                for (var p1 in w2layout_panels) {\n                    p1 = w2layout_panels[p1];\n                    obj.lock(p1, { opacity: 0 });\n                }\n                if (type == 'left' || type == 'right') {\n                    obj.tmp.resize.value = parseInt($('#layout_'+ obj.name +'_resizer_'+ type)[0].style.left);\n                }\n                if (type == 'top' || type == 'preview' || type == 'bottom') {\n                    obj.tmp.resize.value = parseInt($('#layout_'+ obj.name +'_resizer_'+ type)[0].style.top);\n                }\n            }\n\n            function resizeStop(evnt) {\n                if (!obj.box) return;\n                if (!evnt) evnt = window.event;\n                if (!window.addEventListener) { window.document.attachEvent('onselectstart', function() { return false; } ); }\n                $(document).off('mousemove', obj.tmp.events.mouseMove);\n                $(document).off('mouseup', obj.tmp.events.mouseUp);\n                if (typeof obj.tmp.resize == 'undefined') return;\n                // unlock all panels\n                for (var p1 in w2layout_panels) {\n                    obj.unlock(w2layout_panels[p1]);\n                }\n                // set new size\n                if (obj.tmp.diff_x !== 0 || obj.tmp.resize.diff_y !== 0) { // only recalculate if changed\n                    var ptop    = obj.get('top');\n                    var pbottom = obj.get('bottom');\n                    var panel   = obj.get(obj.tmp.resize.type);\n                    var height  = parseInt($(obj.box).height());\n                    var width   = parseInt($(obj.box).width());\n                    var str     = String(panel.size);\n                    var ns, nd;\n                    switch (obj.tmp.resize.type) {\n                        case 'top':\n                            ns = parseInt(panel.sizeCalculated) + obj.tmp.resize.diff_y;\n                            nd = 0;\n                            break;\n                        case 'bottom':\n                            ns = parseInt(panel.sizeCalculated) - obj.tmp.resize.diff_y;\n                            nd = 0;\n                            break;\n                        case 'preview':\n                            ns = parseInt(panel.sizeCalculated) - obj.tmp.resize.diff_y;\n                            nd = (ptop && !ptop.hidden ? ptop.sizeCalculated : 0) +\n                                (pbottom && !pbottom.hidden ? pbottom.sizeCalculated : 0);\n                            break;\n                        case 'left':\n                            ns = parseInt(panel.sizeCalculated) + obj.tmp.resize.diff_x;\n                            nd = 0;\n                            break;\n                        case 'right':\n                            ns = parseInt(panel.sizeCalculated) - obj.tmp.resize.diff_x;\n                            nd = 0;\n                            break;\n                    }\n                    // set size\n                    if (str.substr(str.length-1) == '%') {\n                        panel.size = Math.floor(ns * 100 /\n                            (panel.type == 'left' || panel.type == 'right' ? width : height - nd) * 100) / 100 + '%';\n                    } else {\n                        panel.size = ns;\n                    }\n                    obj.resize();\n                }\n                $('#layout_'+ obj.name + '_resizer_'+ obj.tmp.resize.type).removeClass('active');\n                delete obj.tmp.resize;\n            }\n\n            function resizeMove(evnt) {\n                if (!obj.box) return;\n                if (!evnt) evnt = window.event;\n                if (typeof obj.tmp.resize == 'undefined') return;\n                var panel = obj.get(obj.tmp.resize.type);\n                // event before\n                var tmp = obj.tmp.resize;\n                var eventData = obj.trigger({ phase: 'before', type: 'resizing', target: obj.name, object: panel, originalEvent: evnt,\n                    panel: tmp ? tmp.type : 'all', diff_x: tmp ? tmp.diff_x : 0, diff_y: tmp ? tmp.diff_y : 0 });\n                if (eventData.isCancelled === true) return;\n\n                var p         = $('#layout_'+ obj.name + '_resizer_'+ tmp.type);\n                var resize_x  = (evnt.screenX - tmp.x);\n                var resize_y  = (evnt.screenY - tmp.y);\n                var mainPanel = obj.get('main');\n\n                if (!p.hasClass('active')) p.addClass('active');\n\n                switch (tmp.type) {\n                    case 'left':\n                        if (panel.minSize - resize_x > panel.width) {\n                            resize_x = panel.minSize - panel.width;\n                        }\n                        if (panel.maxSize && (panel.width + resize_x > panel.maxSize)) {\n                            resize_x = panel.maxSize - panel.width;\n                        }\n                        if (mainPanel.minSize + resize_x > mainPanel.width) {\n                            resize_x = mainPanel.width - mainPanel.minSize;\n                        }\n                        break;\n\n                    case 'right':\n                        if (panel.minSize + resize_x > panel.width) {\n                            resize_x = panel.width - panel.minSize;\n                        }\n                        if (panel.maxSize && (panel.width - resize_x > panel.maxSize)) {\n                            resize_x = panel.width - panel.maxSize;\n                        }\n                        if (mainPanel.minSize - resize_x > mainPanel.width) {\n                            resize_x = mainPanel.minSize - mainPanel.width;\n                        }\n                        break;\n\n                    case 'top':\n                        if (panel.minSize - resize_y > panel.height) {\n                            resize_y = panel.minSize - panel.height;\n                        }\n                        if (panel.maxSize && (panel.height + resize_y > panel.maxSize)) {\n                            resize_y = panel.maxSize - panel.height;\n                        }\n                        if (mainPanel.minSize + resize_y > mainPanel.height) {\n                            resize_y = mainPanel.height - mainPanel.minSize;\n                        }\n                        break;\n\n                    case 'preview':\n                    case 'bottom':\n                        if (panel.minSize + resize_y > panel.height) {\n                            resize_y = panel.height - panel.minSize;\n                        }\n                        if (panel.maxSize && (panel.height - resize_y > panel.maxSize)) {\n                            resize_y = panel.height - panel.maxSize;\n                        }\n                        if (mainPanel.minSize - resize_y > mainPanel.height) {\n                            resize_y = mainPanel.minSize - mainPanel.height;\n                        }\n                        break;\n                }\n                tmp.diff_x = resize_x;\n                tmp.diff_y = resize_y;\n\n                switch (tmp.type) {\n                    case 'top':\n                    case 'preview':\n                    case 'bottom':\n                        tmp.diff_x = 0;\n                        if (p.length > 0) p[0].style.top = (tmp.value + tmp.diff_y) + 'px';\n                        break;\n\n                    case 'left':\n                    case 'right':\n                        tmp.diff_y = 0;\n                        if (p.length > 0) p[0].style.left = (tmp.value + tmp.diff_x) + 'px';\n                        break;\n                }\n                // event after\n                obj.trigger($.extend(eventData, { phase: 'after' }));\n            }\n        },\n\n        refresh: function (panel) {\n            var obj = this;\n            // if (window.getSelection) window.getSelection().removeAllRanges(); // clear selection\n            if (typeof panel == 'undefined') panel = null;\n            var time = (new Date()).getTime();\n            // event before\n            var eventData = obj.trigger({ phase: 'before', type: 'refresh', target: (typeof panel != 'undefined' ? panel : obj.name), object: obj.get(panel) });\n            if (eventData.isCancelled === true) return;\n            // obj.unlock(panel);\n            if (typeof panel == 'string') {\n                var p = obj.get(panel);\n                if (p === null) return;\n                var pname = '#layout_'+ obj.name + '_panel_'+ p.type;\n                var rname = '#layout_'+ obj.name +'_resizer_'+ p.type;\n                // apply properties to the panel\n                $(pname).css({ display: p.hidden ? 'none' : 'block' });\n                if (p.resizable) $(rname).show(); else $(rname).hide();\n                // insert content\n                if (typeof p.content == 'object' && typeof p.content.render === 'function') {\n                    p.content.box = $(pname +'> .w2ui-panel-content')[0];\n                    setTimeout(function () {\n                        // need to remove unnecessary classes\n                        if ($(pname +'> .w2ui-panel-content').length > 0) {\n                            $(pname +'> .w2ui-panel-content')\n                                .removeClass()\n                                .removeAttr('name')\n                                .off('selectstart') // needed if previous was grid\n                                .addClass('w2ui-panel-content')\n                                .css('overflow', p.overflow)[0].style.cssText += ';' + p.style;\n                        }\n                        p.content.render(); // do not do .render(box);\n                    }, 1);\n                } else {\n                    // need to remove unnecessary classes\n                    if ($(pname +'> .w2ui-panel-content').length > 0) {\n                        $(pname +'> .w2ui-panel-content')\n                            .removeClass()\n                            .removeAttr('name')\n                            .off('selectstart') // needed if previous was grid\n                            .addClass('w2ui-panel-content')\n                            .html(p.content)\n                            .css('overflow', p.overflow)[0].style.cssText += ';' + p.style;\n                    }\n                }\n                // if there are tabs and/or toolbar - render it\n                var tmp = $(obj.box).find(pname +'> .w2ui-panel-tabs');\n                if (p.show.tabs) {\n                    if (tmp.find('[name='+ p.tabs.name +']').length === 0 && p.tabs !== null) tmp.w2render(p.tabs); else p.tabs.refresh();\n                } else {\n                    tmp.html('').removeClass('w2ui-tabs').hide();\n                }\n                tmp = $(obj.box).find(pname +'> .w2ui-panel-toolbar');\n                if (p.show.toolbar) {\n                    if (tmp.find('[name='+ p.toolbar.name +']').length === 0 && p.toolbar !== null) tmp.w2render(p.toolbar); else p.toolbar.refresh();\n                } else {\n                    tmp.html('').removeClass('w2ui-toolbar').hide();\n                }\n                // show title\n                tmp = $(obj.box).find(pname +'> .w2ui-panel-title');\n                if (p.title) {\n                    tmp.html(p.title).show();\n                } else {\n                    tmp.html('').hide();\n                }\n            } else {\n                if ($('#layout_'+ obj.name +'_panel_main').length == 0) {\n                    obj.render();\n                    return;\n                }\n                obj.resize();\n                // refresh all of them\n                for (var p1 in this.panels) { obj.refresh(this.panels[p1].type); }\n            }\n            obj.trigger($.extend(eventData, { phase: 'after' }));\n            return (new Date()).getTime() - time;\n        },\n\n        resize: function () {\n            // if (window.getSelection) window.getSelection().removeAllRanges();    // clear selection\n            if (!this.box) return false;\n            var time = (new Date()).getTime();\n            // event before\n            var tmp = this.tmp.resize;\n            var eventData = this.trigger({ phase: 'before', type: 'resize', target: this.name,\n                panel: tmp ? tmp.type : 'all', diff_x: tmp ? tmp.diff_x : 0, diff_y: tmp ? tmp.diff_y : 0  });\n            if (eventData.isCancelled === true) return;\n            if (this.padding < 0) this.padding = 0;\n\n            // layout itself\n            var width  = parseInt($(this.box).width());\n            var height = parseInt($(this.box).height());\n            $(this.box).find(' > div').css({\n                width    : width + 'px',\n                height    : height + 'px'\n            });\n            var obj = this;\n            // panels\n            var pmain   = this.get('main');\n            var pprev   = this.get('preview');\n            var pleft   = this.get('left');\n            var pright  = this.get('right');\n            var ptop    = this.get('top');\n            var pbottom = this.get('bottom');\n            var smain   = true; // main always on\n            var sprev   = (pprev !== null && pprev.hidden !== true ? true : false);\n            var sleft   = (pleft !== null && pleft.hidden !== true ? true : false);\n            var sright  = (pright !== null && pright.hidden !== true ? true : false);\n            var stop    = (ptop !== null && ptop.hidden !== true ? true : false);\n            var sbottom = (pbottom !== null && pbottom.hidden !== true ? true : false);\n            var l, t, w, h, e;\n            // calculate %\n            for (var p in w2layout_panels) {\n                p = w2layout_panels[p];\n                if (p === 'main') continue;\n                var tmp = this.get(p);\n                if (!tmp) continue;\n                var str = String(tmp.size || 0);\n                if (str.substr(str.length-1) == '%') {\n                    var tmph = height;\n                    if (tmp.type == 'preview') {\n                        tmph = tmph -\n                            (ptop && !ptop.hidden ? ptop.sizeCalculated : 0) -\n                            (pbottom && !pbottom.hidden ? pbottom.sizeCalculated : 0);\n                    }\n                    tmp.sizeCalculated = parseInt((tmp.type == 'left' || tmp.type == 'right' ? width : tmph) * parseFloat(tmp.size) / 100);\n                } else {\n                    tmp.sizeCalculated = parseInt(tmp.size);\n                }\n                tmp.sizeCalculated = Math.max(tmp.sizeCalculated, parseInt(tmp.minSize));\n            }\n            // top if any\n            if (ptop !== null && ptop.hidden !== true) {\n                l = 0;\n                t = 0;\n                w = width;\n                h = ptop.sizeCalculated;\n                $('#layout_'+ this.name +'_panel_top').css({\n                    'display': 'block',\n                    'left': l + 'px',\n                    'top': t + 'px',\n                    'width': w + 'px',\n                    'height': h + 'px'\n                }).show();\n                ptop.width  = w;\n                ptop.height = h;\n                // resizer\n                if (ptop.resizable) {\n                    t = ptop.sizeCalculated - (this.padding === 0 ? this.resizer : 0);\n                    h = (this.resizer > this.padding ? this.resizer : this.padding);\n                    $('#layout_'+ this.name +'_resizer_top').show().css({\n                        'display': 'block',\n                        'left': l + 'px',\n                        'top': t + 'px',\n                        'width': w + 'px',\n                        'height': h + 'px',\n                        'cursor': 'ns-resize'\n                    }).off('mousedown').on('mousedown', function (event) {\n                        // event before\n                        var eventData = obj.trigger({ phase: 'before', type: 'resizerClick', target: 'top', originalEvent: event });\n                        if (eventData.isCancelled === true) return;\n                        // default action\n                        w2ui[obj.name].tmp.events.resizeStart('top', event);\n                        // event after\n                        obj.trigger($.extend(eventData, { phase: 'after' }));\n                        return false;\n                    });\n                }\n            } else {\n                $('#layout_'+ this.name +'_panel_top').hide();\n            }\n            // left if any\n            if (pleft !== null && pleft.hidden !== true) {\n                l = 0;\n                t = 0 + (stop ? ptop.sizeCalculated + this.padding : 0);\n                w = pleft.sizeCalculated;\n                h = height - (stop ? ptop.sizeCalculated + this.padding : 0) -\n                        (sbottom ? pbottom.sizeCalculated + this.padding : 0);\n                e = $('#layout_'+ this.name +'_panel_left');\n                if (window.navigator.userAgent.indexOf('MSIE') != -1 && e.length > 0 && e[0].clientHeight < e[0].scrollHeight) w += 17; // IE hack\n                e.css({\n                    'display': 'block',\n                    'left': l + 'px',\n                    'top': t + 'px',\n                    'width': w + 'px',\n                    'height': h + 'px'\n                }).show();\n                pleft.width  = w;\n                pleft.height = h;\n                // resizer\n                if (pleft.resizable) {\n                    l = pleft.sizeCalculated - (this.padding === 0 ? this.resizer : 0);\n                    w = (this.resizer > this.padding ? this.resizer : this.padding);\n                    $('#layout_'+ this.name +'_resizer_left').show().css({\n                        'display': 'block',\n                        'left': l + 'px',\n                        'top': t + 'px',\n                        'width': w + 'px',\n                        'height': h + 'px',\n                        'cursor': 'ew-resize'\n                    }).off('mousedown').on('mousedown', function (event) {\n                        // event before\n                        var eventData = obj.trigger({ phase: 'before', type: 'resizerClick', target: 'left', originalEvent: event });\n                        if (eventData.isCancelled === true) return;\n                        // default action\n                        w2ui[obj.name].tmp.events.resizeStart('left', event);\n                        // event after\n                        obj.trigger($.extend(eventData, { phase: 'after' }));\n                        return false;\n                    });\n                }\n            } else {\n                $('#layout_'+ this.name +'_panel_left').hide();\n                $('#layout_'+ this.name +'_resizer_left').hide();\n            }\n            // right if any\n            if (pright !== null && pright.hidden !== true) {\n                l = width - pright.sizeCalculated;\n                t = 0 + (stop ? ptop.sizeCalculated + this.padding : 0);\n                w = pright.sizeCalculated;\n                h = height - (stop ? ptop.sizeCalculated + this.padding : 0) -\n                    (sbottom ? pbottom.sizeCalculated + this.padding : 0);\n                $('#layout_'+ this.name +'_panel_right').css({\n                    'display': 'block',\n                    'left': l + 'px',\n                    'top': t + 'px',\n                    'width': w + 'px',\n                    'height': h + 'px'\n                }).show();\n                pright.width  = w;\n                pright.height = h;\n                // resizer\n                if (pright.resizable) {\n                    l = l - this.padding;\n                    w = (this.resizer > this.padding ? this.resizer : this.padding);\n                    $('#layout_'+ this.name +'_resizer_right').show().css({\n                        'display': 'block',\n                        'left': l + 'px',\n                        'top': t + 'px',\n                        'width': w + 'px',\n                        'height': h + 'px',\n                        'cursor': 'ew-resize'\n                    }).off('mousedown').on('mousedown', function (event) {\n                        // event before\n                        var eventData = obj.trigger({ phase: 'before', type: 'resizerClick', target: 'right', originalEvent: event });\n                        if (eventData.isCancelled === true) return;\n                        // default action\n                        w2ui[obj.name].tmp.events.resizeStart('right', event);\n                        // event after\n                        obj.trigger($.extend(eventData, { phase: 'after' }));\n                        return false;\n                    });\n                }\n            } else {\n                $('#layout_'+ this.name +'_panel_right').hide();\n            }\n            // bottom if any\n            if (pbottom !== null && pbottom.hidden !== true) {\n                l = 0;\n                t = height - pbottom.sizeCalculated;\n                w = width;\n                h = pbottom.sizeCalculated;\n                $('#layout_'+ this.name +'_panel_bottom').css({\n                    'display': 'block',\n                    'left': l + 'px',\n                    'top': t + 'px',\n                    'width': w + 'px',\n                    'height': h + 'px'\n                }).show();\n                pbottom.width  = w;\n                pbottom.height = h;\n                // resizer\n                if (pbottom.resizable) {\n                    t = t - (this.padding === 0 ? 0 : this.padding);\n                    h = (this.resizer > this.padding ? this.resizer : this.padding);\n                    $('#layout_'+ this.name +'_resizer_bottom').show().css({\n                        'display': 'block',\n                        'left': l + 'px',\n                        'top': t + 'px',\n                        'width': w + 'px',\n                        'height': h + 'px',\n                        'cursor': 'ns-resize'\n                    }).off('mousedown').on('mousedown', function (event) {\n                        // event before\n                        var eventData = obj.trigger({ phase: 'before', type: 'resizerClick', target: 'bottom', originalEvent: event });\n                        if (eventData.isCancelled === true) return;\n                        // default action\n                        w2ui[obj.name].tmp.events.resizeStart('bottom', event);\n                        // event after\n                        obj.trigger($.extend(eventData, { phase: 'after' }));\n                        return false;\n                    });\n                }\n            } else {\n                $('#layout_'+ this.name +'_panel_bottom').hide();\n            }\n            // main - always there\n            l = 0 + (sleft ? pleft.sizeCalculated + this.padding : 0);\n            t = 0 + (stop ? ptop.sizeCalculated + this.padding : 0);\n            w = width  - (sleft ? pleft.sizeCalculated + this.padding : 0) -\n                (sright ? pright.sizeCalculated + this.padding: 0);\n            h = height - (stop ? ptop.sizeCalculated + this.padding : 0) -\n                (sbottom ? pbottom.sizeCalculated + this.padding : 0) -\n                (sprev ? pprev.sizeCalculated + this.padding : 0);\n            e = $('#layout_'+ this.name +'_panel_main');\n            if (window.navigator.userAgent.indexOf('MSIE') != -1 && e.length > 0 && e[0].clientHeight < e[0].scrollHeight) w += 17; // IE hack\n            e.css({\n                'display': 'block',\n                'left': l + 'px',\n                'top': t + 'px',\n                'width': w + 'px',\n                'height': h + 'px'\n            });\n            pmain.width  = w;\n            pmain.height = h;\n\n            // preview if any\n            if (pprev !== null && pprev.hidden !== true) {\n                l = 0 + (sleft ? pleft.sizeCalculated + this.padding : 0);\n                t = height - (sbottom ? pbottom.sizeCalculated + this.padding : 0) - pprev.sizeCalculated;\n                w = width  - (sleft ? pleft.sizeCalculated + this.padding : 0) -\n                    (sright ? pright.sizeCalculated + this.padding : 0);\n                h = pprev.sizeCalculated;\n                e = $('#layout_'+ this.name +'_panel_preview');\n                if (window.navigator.userAgent.indexOf('MSIE') != -1 && e.length > 0 && e[0].clientHeight < e[0].scrollHeight) w += 17; // IE hack\n                e.css({\n                    'display': 'block',\n                    'left': l + 'px',\n                    'top': t + 'px',\n                    'width': w + 'px',\n                    'height': h + 'px'\n                }).show();\n                pprev.width  = w;\n                pprev.height = h;\n                // resizer\n                if (pprev.resizable) {\n                    t = t - (this.padding === 0 ? 0 : this.padding);\n                    h = (this.resizer > this.padding ? this.resizer : this.padding);\n                    $('#layout_'+ this.name +'_resizer_preview').show().css({\n                        'display': 'block',\n                        'left': l + 'px',\n                        'top': t + 'px',\n                        'width': w + 'px',\n                        'height': h + 'px',\n                        'cursor': 'ns-resize'\n                    }).off('mousedown').on('mousedown', function (event) {\n                        // event before\n                        var eventData = obj.trigger({ phase: 'before', type: 'resizerClick', target: 'preview', originalEvent: event });\n                        if (eventData.isCancelled === true) return;\n                        // default action\n                        w2ui[obj.name].tmp.events.resizeStart('preview', event);\n                        // event after\n                        obj.trigger($.extend(eventData, { phase: 'after' }));\n                        return false;\n                    });\n                }\n            } else {\n                $('#layout_'+ this.name +'_panel_preview').hide();\n            }\n\n            // display tabs and toolbar if needed\n            for (var p1 in w2layout_panels) {\n                p1 = w2layout_panels[p1];\n                var pan = this.get(p1);\n                var tmp2 = '#layout_'+ this.name +'_panel_'+ p1 +' > .w2ui-panel-';\n                var tabHeight = 0;\n                if (pan) {\n                    if (pan.title) {\n                        tabHeight += w2utils.getSize($(tmp2 + 'title').css({ top: tabHeight + 'px', display: 'block' }), 'height');\n                    }\n                    if (pan.show.tabs) {\n                        if (pan.tabs !== null && w2ui[this.name +'_'+ p1 +'_tabs']) w2ui[this.name +'_'+ p1 +'_tabs'].resize();\n                        tabHeight += w2utils.getSize($(tmp2 + 'tabs').css({ top: tabHeight + 'px', display: 'block' }), 'height');\n                    }\n                    if (pan.show.toolbar) {\n                        if (pan.toolbar !== null && w2ui[this.name +'_'+ p1 +'_toolbar']) w2ui[this.name +'_'+ p1 +'_toolbar'].resize();\n                        tabHeight += w2utils.getSize($(tmp2 + 'toolbar').css({ top: tabHeight + 'px', display: 'block' }), 'height');\n                    }\n                }\n                $(tmp2 + 'content').css({ display: 'block' }).css({ top: tabHeight + 'px' });\n            }\n            // send resize to all objects\n            clearTimeout(this._resize_timer);\n            this._resize_timer = setTimeout(function () {\n                for (var e in w2ui) {\n                    if (typeof w2ui[e].resize == 'function') {\n                        // sent to all none-layouts\n                        if (w2ui[e].panels == 'undefined') w2ui[e].resize();\n                        // only send to nested layouts\n                        var parent = $(w2ui[e].box).parents('.w2ui-layout');\n                        if (parent.length > 0 && parent.attr('name') == obj.name) w2ui[e].resize();\n                    }\n                }\n            }, 100);\n            this.trigger($.extend(eventData, { phase: 'after' }));\n            return (new Date()).getTime() - time;\n        },\n\n        destroy: function () {\n            // event before\n            var eventData = this.trigger({ phase: 'before', type: 'destroy', target: this.name });\n            if (eventData.isCancelled === true) return;\n            if (typeof w2ui[this.name] == 'undefined') return false;\n            // clean up\n            if ($(this.box).find('#layout_'+ this.name +'_panel_main').length > 0) {\n                $(this.box)\n                    .removeAttr('name')\n                    .removeClass('w2ui-layout')\n                    .html('');\n            }\n            delete w2ui[this.name];\n            // event after\n            this.trigger($.extend(eventData, { phase: 'after' }));\n            if (this.tmp.events && this.tmp.events.resize) $(window).off('resize', this.tmp.events.resize);\n            return true;\n        },\n\n        lock: function (panel, msg, showSpinner) {\n            if (w2layout_panels.indexOf(panel) == -1) {\n                console.log('ERROR: First parameter needs to be the a valid panel name.');\n                return;\n            }\n            var args = Array.prototype.slice.call(arguments, 0);\n            args[0]  = '#layout_'+ this.name + '_panel_' + panel;\n            w2utils.lock.apply(window, args);\n        },\n\n        unlock: function (panel) {\n            if (w2layout_panels.indexOf(panel) == -1) {\n                console.log('ERROR: First parameter needs to be the a valid panel name.');\n                return;\n            }\n            var nm = '#layout_'+ this.name + '_panel_' + panel;\n            w2utils.unlock(nm);\n        }\n    };\n\n    $.extend(w2layout.prototype, w2utils.event);\n    w2obj.layout = w2layout;\n})();\n\n/************************************************************************\n*   Library: Web 2.0 UI for jQuery (using prototypical inheritance)\n*   - Following objects defined\n*        - w2popup      - popup widget\n*        - $().w2popup  - jQuery wrapper\n*   - Dependencies: jQuery, w2utils\n*\n* == NICE TO HAVE ==\n*   - transition should include title, body and buttons, not just body\n*\n************************************************************************/\n\nvar w2popup = {};\n\n(function () {\n\n    // ====================================================\n    // -- Registers as a jQuery plugin\n\n    $.fn.w2popup = function(method, options) {\n        if (typeof method === 'undefined') {\n            options = {};\n            method  = 'open';\n        }\n        if ($.isPlainObject(method)) {\n            options = method;\n            method  = 'open';\n        }\n        method = method.toLowerCase();\n        if (method === 'load' && typeof options === 'string') {\n            options = $.extend({ url: options }, arguments.length > 2 ? arguments[2] : {});\n        }\n        if (method === 'open' && options.url != null) method = 'load';\n        options = options || {};\n        // load options from markup\n        var dlgOptions = {};\n        if ($(this).length > 0) {\n            if ($(this).find('div[rel=title], div[rel=body], div[rel=buttons]').length > 0) {\n                if ($(this).find('div[rel=title]').length > 0) {\n                    dlgOptions['title'] = $(this).find('div[rel=title]').html();\n                }\n                if ($(this).find('div[rel=body]').length > 0) {\n                    dlgOptions['body']  = $(this).find('div[rel=body]').html();\n                    dlgOptions['style'] = $(this).find('div[rel=body]')[0].style.cssText;\n                }\n                if ($(this).find('div[rel=buttons]').length > 0) {\n                    dlgOptions['buttons'] = $(this).find('div[rel=buttons]').html();\n                }\n            } else {\n                dlgOptions['title'] = '&nbsp;';\n                dlgOptions['body']  = $(this).html();\n            }\n            if (parseInt($(this).css('width')) != 0)  dlgOptions['width']  = parseInt($(this).css('width'));\n            if (parseInt($(this).css('height')) != 0) dlgOptions['height'] = parseInt($(this).css('height'));\n        }\n        // show popup\n        return w2popup[method]($.extend({}, dlgOptions, options));\n    };\n\n    // ====================================================\n    // -- Implementation of core functionality (SINGELTON)\n\n    w2popup = {\n        defaults: {\n            title     : '',\n            body      : '',\n            buttons   : '',\n            style     : '',\n            color     : '#000',\n            opacity   : 0.4,\n            speed     : 0.3,\n            modal     : false,\n            maximized : false,\n            keyboard  : true,     // will close popup on esc if not modal\n            width     : 500,\n            height    : 300,\n            showClose : true,\n            showMax   : false,\n            transition: null\n        },\n        status    : 'closed',     // string that describes current status\n        handlers  : [],\n        onOpen    : null,\n        onClose   : null,\n        onMax     : null,\n        onMin     : null,\n        onToggle  : null,\n        onKeydown : null,\n\n        open: function (options) {\n            var obj = this;\n            if (w2popup.status == 'closing') {\n                setTimeout(function () { obj.open.call(obj, options); }, 100);\n                return;\n            }\n            // get old options and merge them\n            var old_options = $('#w2ui-popup').data('options');\n            var options = $.extend({}, this.defaults, old_options, { title: '', body : '', buttons: '' }, options, { maximized: false });\n            // need timer because popup might not be open\n            setTimeout(function () { $('#w2ui-popup').data('options', options); }, 100);\n            // if new - reset event handlers\n            if ($('#w2ui-popup').length == 0) {\n                w2popup.handlers  = [];\n                w2popup.onMax     = null;\n                w2popup.onMin     = null;\n                w2popup.onToggle  = null;\n                w2popup.onOpen    = null;\n                w2popup.onClose   = null;\n                w2popup.onKeydown = null;\n            }\n            if (options.onOpen)    w2popup.onOpen    = options.onOpen;\n            if (options.onClose)   w2popup.onClose   = options.onClose;\n            if (options.onMax)     w2popup.onMax     = options.onMax;\n            if (options.onMin)     w2popup.onMin     = options.onMin;\n            if (options.onToggle)  w2popup.onToggle  = options.onToggle;\n            if (options.onKeydown) w2popup.onKeydown = options.onKeydown;\n\n            if (window.innerHeight == undefined) {\n                var width  = document.documentElement.offsetWidth;\n                var height = document.documentElement.offsetHeight;\n                if (w2utils.engine === 'IE7') { width += 21; height += 4; }\n            } else {\n                var width  = window.innerWidth;\n                var height = window.innerHeight;\n            }\n            if (parseInt(width)  - 10 < parseInt(options.width))  options.width  = parseInt(width)  - 10;\n            if (parseInt(height) - 10 < parseInt(options.height)) options.height = parseInt(height) - 10;\n            var top  = parseInt(((parseInt(height) - parseInt(options.height)) / 2) * 0.6);\n            var left = parseInt((parseInt(width) - parseInt(options.width)) / 2);\n            // check if message is already displayed\n            if ($('#w2ui-popup').length == 0) {\n                // trigger event\n                var eventData = this.trigger({ phase: 'before', type: 'open', target: 'popup', options: options, present: false });\n                if (eventData.isCancelled === true) return;\n                w2popup.status = 'opening';\n                // output message\n                w2popup.lockScreen(options);\n                var btn = '';\n                if (options.showClose) {\n                    btn += '<div class=\"w2ui-msg-button w2ui-msg-close\" onmousedown=\"event.stopPropagation()\" onclick=\"w2popup.close()\">Close</div>';\n                }\n                if (options.showMax) {\n                    btn += '<div class=\"w2ui-msg-button w2ui-msg-max\" onmousedown=\"event.stopPropagation()\" onclick=\"w2popup.toggle()\">Max</div>';\n                }\n                var msg='<div id=\"w2ui-popup\" class=\"w2ui-popup\" style=\"opacity: 0; left: '+ left +'px; top: '+ top +'px;'+\n                        '     width: ' + parseInt(options.width) + 'px; height: ' + parseInt(options.height) + 'px; '+\n                        '    -webkit-transform: scale(0.8); -moz-transform: scale(0.8); -ms-transform: scale(0.8); -o-transform: scale(0.8); \"'+\n                        '>'+\n                        '   <div class=\"w2ui-msg-title\" style=\"'+ (options.title == '' ? 'display: none' : '') +'\">' + btn + options.title + '</div>'+\n                        '   <div class=\"w2ui-box1\" style=\"'+ (options.title == '' ? 'top: 0px !important;' : '') + \n                                    (options.buttons == '' ? 'bottom: 0px !important;' : '') + '\">'+\n                        '       <div class=\"w2ui-msg-body' + (!options.title != '' ? ' w2ui-msg-no-title' : '') + \n                                    (!options.buttons != '' ? ' w2ui-msg-no-buttons' : '') + '\" style=\"' + options.style + '\">' + options.body + '</div>'+\n                        '   </div>'+\n                        '   <div class=\"w2ui-box2\" style=\"' + (options.title == '' ? 'top: 0px !important;' : '') +\n                                    (options.buttons == '' ? 'bottom: 0px !important;' : '') + '\">'+\n                        '       <div class=\"w2ui-msg-body' + (!options.title != '' ? ' w2ui-msg-no-title' : '') + \n                                    (!options.buttons != '' ? ' w2ui-msg-no-buttons' : '') + '\" style=\"' + options.style + '\"></div>'+\n                        '       </div>'+\n                        '   <div class=\"w2ui-msg-buttons\" style=\"'+ (options.buttons == '' ? 'display: none' : '') +'\">' + options.buttons + '</div>'+\n                        '</div>';\n                $('body').append(msg);\n                // allow element to render\n                setTimeout(function () {\n                    $('#w2ui-popup .w2ui-box2').hide();\n                    $('#w2ui-popup').css({\n                        '-webkit-transition': options.speed + 's opacity, ' + options.speed + 's -webkit-transform',\n                        '-webkit-transform': 'scale(1)',\n                        '-moz-transition': options.speed + 's opacity, ' + options.speed + 's -moz-transform',\n                        '-moz-transform': 'scale(1)',\n                        '-ms-transition': options.speed + 's opacity, ' + options.speed + 's -ms-transform',\n                        '-ms-transform': 'scale(1)',\n                        '-o-transition': options.speed + 's opacity, ' + options.speed + 's -o-transform',\n                        '-o-transform': 'scale(1)',\n                        'opacity': '1'\n                    });\n                }, 1);\n                // clean transform\n                setTimeout(function () {\n                    $('#w2ui-popup').css({\n                        '-webkit-transform': '',\n                        '-moz-transform': '',\n                        '-ms-transform': '',\n                        '-o-transform': ''\n                    });\n                    // event after\n                    w2popup.status = 'open';\n                    setTimeout(function () {\n                        obj.trigger($.extend(eventData, { phase: 'after' }));\n                    }, 100);\n                }, options.speed * 1000);\n            } else {\n                // trigger event\n                var eventData = this.trigger({ phase: 'before', type: 'open', target: 'popup', options: options, present: true });\n                if (eventData.isCancelled === true) return;\n                // check if size changed\n                w2popup.status = 'opening';\n                if (typeof old_options == 'undefined' || old_options['width'] != options['width'] || old_options['height'] != options['height']) {\n                    w2popup.resize(options.width, options.height);\n                }\n                if (typeof old_options != 'undefined') {\n                    options.prevSize  = options.width + ':' + options.height;\n                    options.maximized = old_options.maximized;\n                }\n                // show new items\n                var body = $('#w2ui-popup .w2ui-box2 > .w2ui-msg-body').html(options.body);\n                if (body.length > 0) body[0].style.cssText = options.style;\n                if (options.buttons != '') {\n                    $('#w2ui-popup .w2ui-msg-buttons').show().html(options.buttons);\n                    $('#w2ui-popup .w2ui-msg-body').removeClass('w2ui-msg-no-buttons');\n                    $('#w2ui-popup .w2ui-box1, #w2ui-popup .w2ui-box2').css('bottom', '');\n                } else {\n                    $('#w2ui-popup .w2ui-msg-buttons').hide().html('');\n                    $('#w2ui-popup .w2ui-msg-body').addClass('w2ui-msg-no-buttons');\n                    $('#w2ui-popup .w2ui-box1, #w2ui-popup .w2ui-box2').css('bottom', '0px');\n                }\n                if (options.title != '') {\n                    $('#w2ui-popup .w2ui-msg-title').show().html(\n                          (options.showClose ? '<div class=\"w2ui-msg-button w2ui-msg-close\" onmousedown=\"event.stopPropagation()\" onclick=\"w2popup.close()\">Close</div>' : '') +\n                          (options.showMax ? '<div class=\"w2ui-msg-button w2ui-msg-max\" onmousedown=\"event.stopPropagation()\" onclick=\"w2popup.toggle()\">Max</div>' : '') +\n                          options.title);\n                    $('#w2ui-popup .w2ui-msg-body').removeClass('w2ui-msg-no-title');\n                    $('#w2ui-popup .w2ui-box1, #w2ui-popup .w2ui-box2').css('top', '');\n                } else {\n                    $('#w2ui-popup .w2ui-msg-title').hide().html('');\n                    $('#w2ui-popup .w2ui-msg-body').addClass('w2ui-msg-no-title');\n                    $('#w2ui-popup .w2ui-box1, #w2ui-popup .w2ui-box2').css('top', '0px');\n                }\n                // transition\n                var div_old = $('#w2ui-popup .w2ui-box1')[0];\n                var div_new = $('#w2ui-popup .w2ui-box2')[0];\n                w2utils.transition(div_old, div_new, options.transition);\n                div_new.className = 'w2ui-box1';\n                div_old.className = 'w2ui-box2';\n                $(div_new).addClass('w2ui-current-box');\n                // remove max state\n                $('#w2ui-popup').data('prev-size', null);\n                // call event onChange\n                setTimeout(function () {\n                    w2popup.status = 'open';\n                    obj.trigger($.extend(eventData, { phase: 'after' }));\n                }, 100);\n            }\n            // save new options\n            options._last_w2ui_name = w2utils.keyboard.active();\n            w2utils.keyboard.active(null);\n            // keyboard events\n            if (options.keyboard) $(document).on('keydown', this.keydown);\n\n            // initialize move\n            var tmp = {\n                resizing : false,\n                mvMove   : mvMove,\n                mvStop   : mvStop\n            };\n            $('#w2ui-popup .w2ui-msg-title').on('mousedown', function (event) { mvStart(event); })\n\n            // handlers\n            function mvStart(evnt) {\n                if (!evnt) evnt = window.event;\n                if (!window.addEventListener) { window.document.attachEvent('onselectstart', function() { return false; } ); }\n                w2popup.status = 'moving';\n                tmp.resizing = true;\n                tmp.x = evnt.screenX;\n                tmp.y = evnt.screenY;\n                tmp.pos_x = $('#w2ui-popup').position().left;\n                tmp.pos_y = $('#w2ui-popup').position().top;\n                w2popup.lock({ opacity: 0 });\n                $(document).on('mousemove', tmp.mvMove);\n                $(document).on('mouseup', tmp.mvStop);\n                if (evnt.stopPropagation) evnt.stopPropagation(); else evnt.cancelBubble = true;\n                if (evnt.preventDefault) evnt.preventDefault(); else return false;\n            }\n\n            function mvMove(evnt) {\n                if (tmp.resizing != true) return;\n                if (!evnt) evnt = window.event;\n                tmp.div_x = evnt.screenX - tmp.x;\n                tmp.div_y = evnt.screenY - tmp.y;\n                $('#w2ui-popup').css({\n                    '-webkit-transition': 'none',\n                    '-webkit-transform': 'translate3d('+ tmp.div_x +'px, '+ tmp.div_y +'px, 0px)',\n                    '-moz-transition': 'none',\n                    '-moz-transform': 'translate('+ tmp.div_x +'px, '+ tmp.div_y +'px)',\n                    '-ms-transition': 'none',\n                    '-ms-transform': 'translate('+ tmp.div_x +'px, '+ tmp.div_y +'px)',\n                    '-o-transition': 'none',\n                    '-o-transform': 'translate('+ tmp.div_x +'px, '+ tmp.div_y +'px)'\n                });\n            }\n\n            function mvStop(evnt) {\n                if (tmp.resizing != true) return;\n                if (!evnt) evnt = window.event;\n                w2popup.status = 'open';\n                tmp.div_x = (evnt.screenX - tmp.x);\n                tmp.div_y = (evnt.screenY - tmp.y);\n                $('#w2ui-popup').css({\n                    'left': (tmp.pos_x + tmp.div_x) + 'px',\n                    'top':    (tmp.pos_y  + tmp.div_y) + 'px',\n                    '-webkit-transition': 'none',\n                    '-webkit-transform': 'translate3d(0px, 0px, 0px)',\n                    '-moz-transition': 'none',\n                    '-moz-transform': 'translate(0px, 0px)',\n                    '-ms-transition': 'none',\n                    '-ms-transform': 'translate(0px, 0px)',\n                    '-o-transition': 'none',\n                    '-o-transform': 'translate(0px, 0px)'\n                });\n                tmp.resizing = false;\n                $(document).off('mousemove', tmp.mvMove);\n                $(document).off('mouseup', tmp.mvStop);\n                w2popup.unlock();\n            }\n            return this;\n        },\n\n        keydown: function (event) {\n            var options = $('#w2ui-popup').data('options');\n            if (!options || !options.keyboard) return;\n            // trigger event\n            var eventData = w2popup.trigger({ phase: 'before', type: 'keydown', target: 'popup', options: options, originalEvent: event });\n            if (eventData.isCancelled === true) return;\n            // default behavior\n            switch (event.keyCode) {\n                case 27:\n                    event.preventDefault();\n                    if ($('#w2ui-popup .w2ui-popup-message').length > 0) w2popup.message(); else w2popup.close();\n                    break;\n            }\n            // event after\n            w2popup.trigger($.extend(eventData, { phase: 'after'}));\n        },\n\n        close: function (options) {\n            var obj = this;\n            var options = $.extend({}, $('#w2ui-popup').data('options'), options);\n            if ($('#w2ui-popup').length == 0) return;\n            // trigger event\n            var eventData = this.trigger({ phase: 'before', type: 'close', target: 'popup', options: options });\n            if (eventData.isCancelled === true) return;\n            // default behavior\n            w2popup.status = 'closing';\n            $('#w2ui-popup').css({\n                '-webkit-transition': options.speed + 's opacity, ' + options.speed + 's -webkit-transform',\n                '-webkit-transform': 'scale(0.9)',\n                '-moz-transition': options.speed + 's opacity, ' + options.speed + 's -moz-transform',\n                '-moz-transform': 'scale(0.9)',\n                '-ms-transition': options.speed + 's opacity, ' + options.speed + 's -ms-transform',\n                '-ms-transform': 'scale(0.9)',\n                '-o-transition': options.speed + 's opacity, ' + options.speed + 's -o-transform',\n                '-o-transform': 'scale(0.9)',\n                'opacity': '0'\n            });\n            w2popup.unlockScreen(options);\n            setTimeout(function () {\n                $('#w2ui-popup').remove();\n                w2popup.status = 'closed';\n                // event after\n                obj.trigger($.extend(eventData, { phase: 'after'}));\n            }, options.speed * 1000);\n            // restore active\n            w2utils.keyboard.active(options._last_w2ui_name);\n            // remove keyboard events\n            if (options.keyboard) $(document).off('keydown', this.keydown);\n        },\n\n        toggle: function () {\n            var obj     = this;\n            var options = $('#w2ui-popup').data('options');\n            // trigger event\n            var eventData = this.trigger({ phase: 'before', type: 'toggle', target: 'popup', options: options });\n            if (eventData.isCancelled === true) return;\n            // defatul action\n            if (options.maximized === true) w2popup.min(); else w2popup.max();\n            // event after\n            setTimeout(function () {\n                obj.trigger($.extend(eventData, { phase: 'after'}));\n            }, (options.speed * 1000) + 50);\n        },\n\n        max: function () {\n            var obj = this;\n            var options = $('#w2ui-popup').data('options');\n            if (options.maximized === true) return;\n            // trigger event\n            var eventData = this.trigger({ phase: 'before', type: 'max', target: 'popup', options: options });\n            if (eventData.isCancelled === true) return;\n            // default behavior\n            w2popup.status   = 'resizing';\n            options.prevSize = $('#w2ui-popup').css('width') + ':' + $('#w2ui-popup').css('height');\n            // do resize\n            w2popup.resize(10000, 10000, function () {\n                w2popup.status    = 'open';\n                options.maximized = true;\n                obj.trigger($.extend(eventData, { phase: 'after'}));\n            });\n        },\n\n        min: function () {\n            var obj = this;\n            var options = $('#w2ui-popup').data('options');\n            if (options.maximized !== true) return;\n            var size = options.prevSize.split(':');\n            // trigger event\n            var eventData = this.trigger({ phase: 'before', type: 'min', target: 'popup', options: options });\n            if (eventData.isCancelled === true) return;\n            // default behavior\n            w2popup.status = 'resizing';\n            // do resize\n            w2popup.resize(size[0], size[1], function () {\n                w2popup.status = 'open';\n                options.maximized = false;\n                options.prevSize  = null;\n                obj.trigger($.extend(eventData, { phase: 'after'}));\n            });\n        },\n\n        get: function () {\n            return $('#w2ui-popup').data('options');\n        },\n\n        set: function (options) {\n            w2popup.open(options);\n        },\n\n        clear: function() {\n            $('#w2ui-popup .w2ui-msg-title').html('');\n            $('#w2ui-popup .w2ui-msg-body').html('');\n            $('#w2ui-popup .w2ui-msg-buttons').html('');\n        },\n\n        reset: function () {\n            w2popup.open(w2popup.defaults);\n        },\n\n        load: function (options) {\n            w2popup.status = 'loading';\n            if (String(options.url) == 'undefined') {\n                console.log('ERROR: The url parameter is empty.');\n                return;\n            }\n            var tmp = String(options.url).split('#');\n            var url = tmp[0];\n            var selector = tmp[1];\n            if (String(options) == 'undefined') options = {};\n            // load url\n            var html = $('#w2ui-popup').data(url);\n            if (typeof html != 'undefined' && html != null) {\n                popup(html, selector);\n            } else {\n                $.get(url, function (data, status, obj) { // should always be $.get as it is template\n                    popup(obj.responseText, selector);\n                    $('#w2ui-popup').data(url, obj.responseText); // remember for possible future purposes\n                });\n            }\n            function popup(html, selector) {\n                delete options.url;\n                $('body').append('<div id=\"w2ui-tmp\" style=\"display: none\">' + html + '</div>');\n                if (typeof selector != 'undefined' && $('#w2ui-tmp #'+selector).length > 0) {\n                    $('#w2ui-tmp #' + selector).w2popup(options);\n                } else {\n                    $('#w2ui-tmp > div').w2popup(options);\n                }\n                // link styles\n                if ($('#w2ui-tmp > style').length > 0) {\n                    var style = $('<div>').append($('#w2ui-tmp > style').clone()).html();\n                    if ($('#w2ui-popup #div-style').length == 0) {\n                        $('#w2ui-popup').append('<div id=\"div-style\" style=\"position: absolute; left: -100; width: 1px\"></div>');\n                    }\n                    $('#w2ui-popup #div-style').html(style);\n                }\n                $('#w2ui-tmp').remove();\n            }\n        },\n\n        message: function (options) {\n            $().w2tag(); // hide all tags\n            if (!options) options = { width: 200, height: 100 };\n            if (parseInt(options.width) < 10)  options.width  = 10;\n            if (parseInt(options.height) < 10) options.height = 10;\n            if (typeof options.hideOnClick == 'undefined') options.hideOnClick = false;\n            var poptions = $('#w2ui-popup').data('options') || {};\n            if (typeof options.width == 'undefined' || options.width > poptions.width - 10) options.width = poptions.width - 10;\n            if (typeof options.height == 'undefined' || options.height > poptions.height - 40) options.height = poptions.height - 40; // title is 30px or so\n\n            var head     = $('#w2ui-popup .w2ui-msg-title');\n            var pwidth   = parseInt($('#w2ui-popup').width());\n            var msgCount = $('#w2ui-popup .w2ui-popup-message').length;\n            // remove message\n            if ($.trim(options.html) == '') {\n                $('#w2ui-popup #w2ui-message'+ (msgCount-1)).css('z-Index', 250);\n                var options = $('#w2ui-popup #w2ui-message'+ (msgCount-1)).data('options') || {};\n                $('#w2ui-popup #w2ui-message'+ (msgCount-1)).remove();\n                if (typeof options.onClose == 'function') options.onClose();\n                if (msgCount == 1) {\n                    w2popup.unlock();\n                } else {\n                    $('#w2ui-popup #w2ui-message'+ (msgCount-2)).show();\n                }\n            } else {\n                // hide previous messages\n                $('#w2ui-popup .w2ui-popup-message').hide();\n                // add message\n                $('#w2ui-popup .w2ui-box1')\n                    .before('<div id=\"w2ui-message' + msgCount + '\" class=\"w2ui-popup-message\" style=\"display: none; ' +\n                                (head.length == 0 ? 'top: 0px;' : 'top: ' + w2utils.getSize(head, 'height') + 'px;') +\n                                (typeof options.width  != 'undefined' ? 'width: ' + options.width + 'px; left: ' + ((pwidth - options.width) / 2) + 'px;' : 'left: 10px; right: 10px;') +\n                                (typeof options.height != 'undefined' ? 'height: ' + options.height + 'px;' : 'bottom: 6px;') +\n                                '-webkit-transition: .3s; -moz-transition: .3s; -ms-transition: .3s; -o-transition: .3s;\"' +\n                                (options.hideOnClick === true ? 'onclick=\"w2popup.message();\"' : '') + '>' +\n                            '</div>');\n                $('#w2ui-popup #w2ui-message'+ msgCount).data('options', options);\n                var display = $('#w2ui-popup #w2ui-message'+ msgCount).css('display');\n                $('#w2ui-popup #w2ui-message'+ msgCount).css({\n                    '-webkit-transform': (display == 'none' ? 'translateY(-' + options.height + 'px)' : 'translateY(0px)'),\n                    '-moz-transform': (display == 'none' ? 'translateY(-' + options.height + 'px)' : 'translateY(0px)'),\n                    '-ms-transform': (display == 'none' ? 'translateY(-' + options.height + 'px)' : 'translateY(0px)'),\n                    '-o-transform': (display == 'none' ? 'translateY(-' + options.height + 'px)' : 'translateY(0px)')\n                });\n                if (display == 'none') {\n                    $('#w2ui-popup #w2ui-message'+ msgCount).show().html(options.html);\n                    // timer needs to animation\n                    setTimeout(function () {\n                        $('#w2ui-popup #w2ui-message'+ msgCount).css({\n                            '-webkit-transform': (display == 'none' ? 'translateY(0px)' : 'translateY(-' + options.height + 'px)'),\n                            '-moz-transform': (display == 'none' ? 'translateY(0px)' : 'translateY(-' + options.height + 'px)'),\n                            '-ms-transform': (display == 'none' ? 'translateY(0px)' : 'translateY(-' + options.height + 'px)'),\n                            '-o-transform': (display == 'none' ? 'translateY(0px)' : 'translateY(-' + options.height + 'px)')\n                        });\n                    }, 1);\n                    // timer for lock\n                    setTimeout(function() {\n                        $('#w2ui-popup #w2ui-message'+ msgCount).css({\n                            '-webkit-transition': '0s',    '-moz-transition': '0s', '-ms-transition': '0s', '-o-transition': '0s',\n                            'z-Index': 1500\n                        }); // has to be on top of lock\n                        if (msgCount == 0) w2popup.lock();\n                        if (typeof options.onOpen == 'function') options.onOpen();\n                    }, 300);\n                }\n            }\n        },\n\n        lock: function (msg, showSpinner) {\n            var args = Array.prototype.slice.call(arguments, 0);\n            args.unshift($('#w2ui-popup'));\n            w2utils.lock.apply(window, args);\n        },\n\n        unlock: function () {\n            w2utils.unlock($('#w2ui-popup'));\n        },\n\n        // --- INTERNAL FUNCTIONS\n\n        lockScreen: function (options) {\n            if ($('#w2ui-lock').length > 0) return false;\n            if (typeof options == 'undefined') options = $('#w2ui-popup').data('options');\n            if (typeof options == 'undefined') options = {};\n            options = $.extend({}, w2popup.defaults, options);\n            // show element\n            $('body').append('<div id=\"w2ui-lock\" ' +\n                '    onmousewheel=\"if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true; if (event.preventDefault) event.preventDefault(); else return false;\"'+\n                '    style=\"position: ' + (w2utils.engine == 'IE5' ? 'absolute' : 'fixed') + '; z-Index: 1199; left: 0px; top: 0px; ' +\n                '           padding: 0px; margin: 0px; background-color: ' + options.color + '; width: 100%; height: 100%; opacity: 0;\"></div>');\n            // lock screen\n            setTimeout(function () {\n                $('#w2ui-lock').css({\n                    '-webkit-transition': options.speed + 's opacity',\n                    '-moz-transition': options.speed + 's opacity',\n                    '-ms-transition': options.speed + 's opacity',\n                    '-o-transition': options.speed + 's opacity',\n                    'opacity': options.opacity\n                });\n            }, 1);\n            // add events\n            if (options.modal == true) {\n                $('#w2ui-lock').on('mousedown', function () {\n                    $('#w2ui-lock').css({\n                        '-webkit-transition': '.1s',\n                        '-moz-transition': '.1s',\n                        '-ms-transition': '.1s',\n                        '-o-transition': '.1s',\n                        'opacity': '0.6'\n                    });\n                    // if (window.getSelection) window.getSelection().removeAllRanges();\n                });\n                $('#w2ui-lock').on('mouseup', function () {\n                    setTimeout(function () {\n                        $('#w2ui-lock').css({\n                            '-webkit-transition': '.1s',\n                            '-moz-transition': '.1s',\n                            '-ms-transition': '.1s',\n                            '-o-transition': '.1s',\n                            'opacity': options.opacity\n                        });\n                    }, 100);\n                    // if (window.getSelection) window.getSelection().removeAllRanges();\n                });\n            } else {\n                $('#w2ui-lock').on('mouseup', function () { w2popup.close(); });\n            }\n            return true;\n        },\n\n        unlockScreen: function (options) {\n            if ($('#w2ui-lock').length == 0) return false;\n            if (typeof options == 'undefined') options = $('#w2ui-popup').data('options');\n            if (typeof options == 'undefined') options = {};\n            options = $.extend({}, w2popup.defaults, options);\n            $('#w2ui-lock').css({\n                '-webkit-transition': options.speed + 's opacity',\n                '-moz-transition': options.speed + 's opacity',\n                '-ms-transition': options.speed + 's opacity',\n                '-o-transition': options.speed + 's opacity',\n                'opacity': 0\n            });\n            setTimeout(function () {\n                $('#w2ui-lock').remove();\n            }, options.speed * 1000);\n            return true;\n        },\n\n        resize: function (width, height, callBack) {\n            var options = $('#w2ui-popup').data('options');\n            // calculate new position\n            if (parseInt($(window).width())  - 10 < parseInt(width))  width  = parseInt($(window).width())  - 10;\n            if (parseInt($(window).height()) - 10 < parseInt(height)) height = parseInt($(window).height()) - 10;\n            var top  = ((parseInt($(window).height()) - parseInt(height)) / 2) * 0.8;\n            var left = (parseInt($(window).width()) - parseInt(width)) / 2;\n            // resize there\n            $('#w2ui-popup').css({\n                '-webkit-transition': options.speed + 's width, ' + options.speed + 's height, ' + options.speed + 's left, ' + options.speed + 's top',\n                '-moz-transition': options.speed + 's width, ' + options.speed + 's height, ' + options.speed + 's left, ' + options.speed + 's top',\n                '-ms-transition': options.speed + 's width, ' + options.speed + 's height, ' + options.speed + 's left, ' + options.speed + 's top',\n                '-o-transition': options.speed + 's width, ' + options.speed + 's height, ' + options.speed + 's left, ' + options.speed + 's top',\n                'top': top,\n                'left': left,\n                'width': width,\n                'height': height\n            });\n            setTimeout(function () {\n                options.width  = width;\n                options.height = height;\n                if (typeof callBack == 'function') callBack();\n            }, (options.speed * 1000) + 50); // give extra 50 ms\n        }\n    }\n\n    // merge in event handling\n    $.extend(w2popup, w2utils.event);\n\n})();\n\n// ============================================\n// --- Common dialogs\n\nvar w2alert = function (msg, title, callBack) {\n    if (title == null) title = w2utils.lang('Notification');\n    if ($('#w2ui-popup').length > 0 && w2popup.status != 'closing') {\n        w2popup.message({\n            width   : 400,\n            height  : 170,\n            html    : '<div style=\"position: absolute; top: 0px; left: 0px; right: 0px; bottom: 45px; overflow: auto\">' +\n                      '        <div class=\"w2ui-centered\" style=\"font-size: 13px;\">' + msg + '</div>' +\n                      '</div>' +\n                      '<div style=\"position: absolute; bottom: 7px; left: 0px; right: 0px; text-align: center; padding: 5px\">' +\n                      '        <button onclick=\"w2popup.message();\" class=\"w2ui-popup-btn btn\">' + w2utils.lang('Ok') + '</button>' +\n                      '</div>',\n            onClose : function () {\n                if (typeof callBack == 'function') callBack();\n            }\n        });\n    } else {\n        w2popup.open({\n            width     : 450,\n            height    : 220,\n            showMax   : false,\n            showClose : false,\n            title     : title,\n            body      : '<div class=\"w2ui-centered\" style=\"font-size: 13px;\">' + msg + '</div>',\n            buttons   : '<button onclick=\"w2popup.close();\" class=\"w2ui-popup-btn btn\">' + w2utils.lang('Ok') + '</button>',\n            onClose   : function () {\n                if (typeof callBack == 'function') callBack();\n            }\n        });\n    }\n};\n\nvar w2confirm = function (msg, title, callBack) {\n    var options  = {};\n    var defaults = {\n        msg         : '',\n        title       : w2utils.lang('Confirmation'),\n        width       : ($('#w2ui-popup').length > 0 ? 400 : 450),\n        height      : ($('#w2ui-popup').length > 0 ? 170 : 220),\n        yes_text    : 'Yes',\n        yes_class   : '',\n        yes_style   : '',\n        yes_callBack: null,\n        no_text     : 'No',\n        no_class    : '',\n        no_style    : '',\n        no_callBack : null,\n        callBack    : null\n    };\n    if (arguments.length == 1 && typeof msg == 'object') {\n        $.extend(options, defaults, msg);\n    } else {\n        if (typeof title == 'function') {\n            $.extend(options, defaults, {\n                msg     : msg,\n                callBack: title\n            })            \n        } else {\n            $.extend(options, defaults, {\n                msg     : msg,\n                title   : title, \n                callBack: callBack\n            })            \n        }\n    }\n    if ($('#w2ui-popup').length > 0 && w2popup.status != 'closing') {\n        if (options.width > w2popup.get().width) options.width = w2popup.get().width;\n        if (options.height > (w2popup.get().height - 50)) options.height = w2popup.get().height - 50;\n          w2popup.message({\n            width   : options.width,\n            height  : options.height,\n            html    : '<div style=\"position: absolute; top: 0px; left: 0px; right: 0px; bottom: 40px; overflow: auto\">' +\n                      '        <div class=\"w2ui-centered\" style=\"font-size: 13px;\">' + options.msg + '</div>' +\n                      '</div>' +\n                      '<div style=\"position: absolute; bottom: 7px; left: 0px; right: 0px; text-align: center; padding: 5px\">' +\n                      '        <button id=\"Yes\" class=\"w2ui-popup-btn btn '+ options.yes_class +'\" style=\"'+ options.yes_style +'\">' + w2utils.lang(options.yes_text) + '</button>' +\n                      '        <button id=\"No\" class=\"w2ui-popup-btn btn '+ options.no_class +'\" style=\"'+ options.no_style +'\">' + w2utils.lang(options.no_text) + '</button>' +\n                      '</div>',\n            onOpen: function () {\n                $('#w2ui-popup .w2ui-popup-message .btn').on('click', function (event) {\n                    w2popup.message();\n                    if (typeof options.callBack == 'function') options.callBack(event.target.id);\n                    if (event.target.id == 'Yes' && typeof options.yes_callBack == 'function') options.yes_callBack();\n                    if (event.target.id == 'No'  && typeof options.no_callBack == 'function') options.no_callBack();\n                });\n            },\n            onKeydown: function (event) {\n                switch (event.originalEvent.keyCode) {\n                    case 13: // enter\n                        if (typeof options.callBack == 'function') options.callBack('Yes');\n                        if (typeof options.yes_callBack == 'function') options.yes_callBack();\n                        w2popup.message();\n                        break\n                    case 27: // esc\n                        if (typeof options.callBack == 'function') options.callBack('No');\n                        if (typeof options.no_callBack == 'function') options.no_callBack();\n                        w2popup.message();\n                        break\n                }\n            }\n        });\n\n    } else {\n\n        if (!w2utils.isInt(options.height)) options.height = options.height + 50;\n        w2popup.open({\n            width      : options.width,\n            height     : options.height,\n            title      : options.title,\n            modal      : true,\n            showClose  : false,\n            body       : '<div class=\"w2ui-centered\" style=\"font-size: 13px;\">' + options.msg + '</div>',\n            buttons    : '<button id=\"Yes\" class=\"w2ui-popup-btn btn '+ options.yes_class +'\" style=\"'+ options.yes_style +'\">'+ w2utils.lang(options.yes_text) +'</button>'+\n                         '<button id=\"No\" class=\"w2ui-popup-btn btn '+ options.no_class +'\" style=\"'+ options.no_style +'\">'+ w2utils.lang(options.no_text) +'</button>',\n            onOpen: function (event) {\n                event.onComplete = function () {\n                    $('#w2ui-popup .w2ui-popup-btn').on('click', function (event) {\n                        w2popup.close();\n                        if (typeof options.callBack == 'function') options.callBack(event.target.id);\n                        if (event.target.id == 'Yes' && typeof options.yes_callBack == 'function') options.yes_callBack();\n                        if (event.target.id == 'No'  && typeof options.no_callBack == 'function') options.no_callBack();\n                    });\n                }\n            },\n            onKeydown: function (event) {\n                switch (event.originalEvent.keyCode) {\n                    case 13: // enter\n                        if (typeof options.callBack == 'function') options.callBack('Yes');\n                        if (typeof options.yes_callBack == 'function') options.yes_callBack();\n                        w2popup.close();\n                        break\n                    case 27: // esc\n                        if (typeof options.callBack == 'function') options.callBack('No');\n                        if (typeof options.no_callBack == 'function') options.no_callBack();\n                        w2popup.close();\n                        break\n                }\n            }\n        });\n    }\n\n    return {\n        yes: function (fun) {\n            options.yes_callBack = fun;\n            return this;\n        },\n        no: function (fun) {\n            options.no_callBack = fun;\n            return this;\n        }\n    };\n};\n/************************************************************************\n*   Library: Web 2.0 UI for jQuery (using prototypical inheritance)\n*   - Following objects defined\n*        - w2tabs        - tabs widget\n*        - $().w2tabs    - jQuery wrapper\n*   - Dependencies: jQuery, w2utils\n*\n* == NICE TO HAVE ==\n*   - on overflow display << >>\n*\n************************************************************************/\n\n(function () {\n    var w2tabs = function (options) {\n        this.box       = null;      // DOM Element that holds the element\n        this.name      = null;      // unique name for w2ui\n        this.active    = null;\n        this.tabs      = [];\n        this.routeData = {};        // data for dynamic routes\n        this.right     = '';\n        this.style     = '';\n        this.onClick   = null;\n        this.onClose   = null;\n        this.onRender  = null;\n        this.onRefresh = null;\n        this.onResize  = null;\n        this.onDestroy = null;\n\n        $.extend(this, { handlers: [] });\n        $.extend(true, this, w2obj.tabs, options);\n    };\n\n    // ====================================================\n    // -- Registers as a jQuery plugin\n\n    $.fn.w2tabs = function(method) {\n        if (typeof method === 'object' || !method ) {\n            // check name parameter\n            if (!w2utils.checkName(method, 'w2tabs')) return;\n            // extend tabs\n            var tabs   = method.tabs || [];\n            var object = new w2tabs(method);\n            for (var i = 0; i < tabs.length; i++) {\n                object.tabs[i] = $.extend({}, w2tabs.prototype.tab, tabs[i]);\n            }\n            if ($(this).length !== 0) {\n                object.render($(this)[0]);\n            }\n            // register new object\n            w2ui[object.name] = object;\n            return object;\n        } else if (w2ui[$(this).attr('name')]) {\n            var obj = w2ui[$(this).attr('name')];\n            obj[method].apply(obj, Array.prototype.slice.call(arguments, 1));\n            return this;\n        } else {\n            console.log('ERROR: Method ' +  method + ' does not exist on jQuery.w2tabs' );\n            return undefined;\n        }\n    };\n\n    // ====================================================\n    // -- Implementation of core functionality\n\n    w2tabs.prototype = {\n        tab : {\n            id        : null,        // command to be sent to all event handlers\n            text      : '',\n            route     : null,\n            hidden    : false,\n            disabled  : false,\n            closable  : false,\n            hint      : '',\n            onClick   : null,\n            onRefresh : null,\n            onClose   : null\n        },\n\n        add: function (tab) {\n            return this.insert(null, tab);\n        },\n\n        insert: function (id, tab) {\n            if (!$.isArray(tab)) tab = [tab];\n            // assume it is array\n            for (var i = 0; i < tab.length; i++) {\n                // checks\n                if (typeof tab[i].id === 'undefined') {\n                    console.log('ERROR: The parameter \"id\" is required but not supplied. (obj: '+ this.name +')');\n                    return;\n                }\n                if (!w2utils.checkUniqueId(tab[i].id, this.tabs, 'tabs', this.name)) return;\n                // add tab\n                var newTab = $.extend({}, w2tabs.prototype.tab, tab[i]);\n                if (id === null || typeof id === 'undefined') {\n                    this.tabs.push(newTab);\n                } else {\n                    var middle = this.get(id, true);\n                    this.tabs = this.tabs.slice(0, middle).concat([newTab], this.tabs.slice(middle));\n                }\n                this.refresh(tab[i].id);\n            }\n        },\n\n        remove: function () {\n            var removed = 0;\n            for (var a = 0; a < arguments.length; a++) {\n                var tab = this.get(arguments[a]);\n                if (!tab) return false;\n                removed++;\n                // remove from array\n                this.tabs.splice(this.get(tab.id, true), 1);\n                // remove from screen\n                $(this.box).find('#tabs_'+ this.name +'_tab_'+ w2utils.escapeId(tab.id)).remove();\n            }\n            return removed;\n        },\n\n        select: function (id) {\n            if (this.active == id || this.get(id) === null) return false;\n            this.active = id;\n            this.refresh();\n            return true;\n        },\n\n        set: function (id, tab) {\n            var index = this.get(id, true);\n            if (index === null) return false;\n            $.extend(this.tabs[index], tab);\n            this.refresh(id);\n            return true;\n        },\n\n        get: function (id, returnIndex) {\n            if (arguments.length === 0) {\n                var all = [];\n                for (var i1 = 0; i1 < this.tabs.length; i1++) {\n                    if (this.tabs[i1].id != null) {\n                        all.push(this.tabs[i1].id);\n                    }\n                }\n                return all;\n            } else {\n                for (var i2 = 0; i2 < this.tabs.length; i2++) {\n                    if (this.tabs[i2].id == id) { // need to be == since id can be numeric\n                        return (returnIndex === true ? i2 : this.tabs[i2]);\n                    }\n                }\n            }\n            return null;\n        },\n\n        show: function () {\n            var obj   = this;\n            var shown = 0;\n            var tmp   = [];\n            for (var a = 0; a < arguments.length; a++) {\n                var tab = this.get(arguments[a]);\n                if (!tab || tab.hidden === false) continue;\n                shown++;\n                tab.hidden = false;\n                tmp.push(tab.id);\n            }\n            setTimeout(function () { for (var t in tmp) obj.refresh(tmp[t]); }, 15); // needs timeout \n            return shown;\n        },\n\n        hide: function () {\n            var obj   = this;\n            var hidden= 0;\n            var tmp   = [];\n            for (var a = 0; a < arguments.length; a++) {\n                var tab = this.get(arguments[a]);\n                if (!tab || tab.hidden === true) continue;\n                hidden++;\n                tab.hidden = true;\n                tmp.push(tab.id);\n            }\n            setTimeout(function () { for (var t in tmp) obj.refresh(tmp[t]); }, 15); // needs timeout \n            return hidden;\n        },\n\n        enable: function () {\n            var obj   = this;\n            var enabled = 0;\n            var tmp   = [];\n            for (var a = 0; a < arguments.length; a++) {\n                var tab = this.get(arguments[a]);\n                if (!tab || tab.disabled === false) continue;\n                enabled++;\n                tab.disabled = false;\n                tmp.push(tab.id);\n            }\n            setTimeout(function () { for (var t in tmp) obj.refresh(tmp[t]); }, 15); // needs timeout \n            return enabled;\n        },\n\n        disable: function () {\n            var obj   = this;\n            var disabled = 0;\n            var tmp   = [];\n            for (var a = 0; a < arguments.length; a++) {\n                var tab = this.get(arguments[a]);\n                if (!tab || tab.disabled === true) continue;\n                disabled++;\n                tab.disabled = true;\n                tmp.push(tab.id);\n            }\n            setTimeout(function () { for (var t in tmp) obj.refresh(tmp[t]); }, 15); // needs timeout \n            return disabled;\n        },\n\n        refresh: function (id) {\n            var time = (new Date()).getTime();\n            // if (window.getSelection) window.getSelection().removeAllRanges(); // clear selection\n            // event before\n            var eventData = this.trigger({ phase: 'before', type: 'refresh', target: (typeof id !== 'undefined' ? id : this.name), object: this.get(id) });\n            if (eventData.isCancelled === true) return;\n            if (typeof id === 'undefined') {\n                // refresh all\n                for (var i = 0; i < this.tabs.length; i++) this.refresh(this.tabs[i].id);\n            } else {\n                // create or refresh only one item\n                var tab = this.get(id);\n                if (tab === null) return false;\n                if (typeof tab.caption !== 'undefined') tab.text = tab.caption;\n\n                var jq_el   = $(this.box).find('#tabs_'+ this.name +'_tab_'+ w2utils.escapeId(tab.id));\n                var tabHTML = (tab.closable ? '<div class=\"w2ui-tab-close\" onclick=\"w2ui[\\''+ this.name +'\\'].animateClose(\\''+ tab.id +'\\', event);\"></div>' : '') +\n                    '    <div class=\"w2ui-tab'+ (this.active === tab.id ? ' active' : '') + (tab.closable ? ' closable' : '') +'\" '+\n                    '        title=\"'+ (typeof tab.hint !== 'undefined' ? tab.hint : '') +'\"'+\n                    '        onclick=\"w2ui[\\''+ this.name +'\\'].click(\\''+ tab.id +'\\', event);\">' + tab.text + '</div>';\n                if (jq_el.length === 0) {\n                    // does not exist - create it\n                    var addStyle = '';\n                    if (tab.hidden) { addStyle += 'display: none;'; }\n                    if (tab.disabled) { addStyle += 'opacity: 0.2; -moz-opacity: 0.2; -webkit-opacity: 0.2; -o-opacity: 0.2; filter:alpha(opacity=20);'; }\n                    var html = '<td id=\"tabs_'+ this.name + '_tab_'+ tab.id +'\" style=\"'+ addStyle +'\" valign=\"middle\">'+ tabHTML + '</td>';\n                    if (this.get(id, true) !== this.tabs.length-1 && $(this.box).find('#tabs_'+ this.name +'_tab_'+ w2utils.escapeId(this.tabs[parseInt(this.get(id, true))+1].id)).length > 0) {\n                        $(this.box).find('#tabs_'+ this.name +'_tab_'+ w2utils.escapeId(this.tabs[parseInt(this.get(id, true))+1].id)).before(html);\n                    } else {\n                        $(this.box).find('#tabs_'+ this.name +'_right').before(html);\n                    }\n                } else {\n                    // refresh\n                    jq_el.html(tabHTML);\n                    if (tab.hidden) { jq_el.css('display', 'none'); }\n                    else { jq_el.css('display', ''); }\n                    if (tab.disabled) { jq_el.css({ 'opacity': '0.2', '-moz-opacity': '0.2', '-webkit-opacity': '0.2', '-o-opacity': '0.2', 'filter': 'alpha(opacity=20)' }); }\n                    else { jq_el.css({ 'opacity': '1', '-moz-opacity': '1', '-webkit-opacity': '1', '-o-opacity': '1', 'filter': 'alpha(opacity=100)' }); }\n                }\n            }\n            // right html\n            $('#tabs_'+ this.name +'_right').html(this.right);\n            // event after\n            this.trigger($.extend(eventData, { phase: 'after' }));\n            return (new Date()).getTime() - time;\n        },\n\n        render: function (box) {\n            var time = (new Date()).getTime();\n            // event before\n            var eventData = this.trigger({ phase: 'before', type: 'render', target: this.name, box: box });\n            if (eventData.isCancelled === true) return;\n            // default action\n            // if (window.getSelection) window.getSelection().removeAllRanges(); // clear selection\n            if (typeof box !== 'undefined' && box !== null) {\n                if ($(this.box).find('> table #tabs_'+ this.name + '_right').length > 0) {\n                    $(this.box)\n                        .removeAttr('name')\n                        .removeClass('w2ui-reset w2ui-tabs')\n                        .html('');\n                }\n                this.box = box;\n            }\n            if (!this.box) return false;\n            // render all buttons\n            var html =    '<table cellspacing=\"0\" cellpadding=\"1\" width=\"100%\">'+\n                        '    <tr><td width=\"100%\" id=\"tabs_'+ this.name +'_right\" align=\"right\">'+ this.right +'</td></tr>'+\n                        '</table>';\n            $(this.box)\n                .attr('name', this.name)\n                .addClass('w2ui-reset w2ui-tabs')\n                .html(html);\n            if ($(this.box).length > 0) $(this.box)[0].style.cssText += this.style;\n            // event after\n            this.trigger($.extend(eventData, { phase: 'after' }));\n            this.refresh();\n            return (new Date()).getTime() - time;\n        },\n\n        resize: function () {\n            var time = (new Date()).getTime();\n            // event before\n            var eventData = this.trigger({ phase: 'before', type: 'resize', target: this.name });\n            if (eventData.isCancelled === true) return;\n\n            // intentionaly blank\n\n            // event after\n            this.trigger($.extend(eventData, { phase: 'after' }));\n            return (new Date()).getTime() - time;\n        },\n\n        destroy: function () {\n            // event before\n            var eventData = this.trigger({ phase: 'before', type: 'destroy', target: this.name });\n            if (eventData.isCancelled === true) return;\n            // clean up\n            if ($(this.box).find('> table #tabs_'+ this.name + '_right').length > 0) {\n                $(this.box)\n                    .removeAttr('name')\n                    .removeClass('w2ui-reset w2ui-tabs')\n                    .html('');\n            }\n            delete w2ui[this.name];\n            // event after\n            this.trigger($.extend(eventData, { phase: 'after' }));\n        },\n\n        // ===================================================\n        // -- Internal Event Handlers\n\n        click: function (id, event) {\n            var tab = this.get(id);\n            if (tab === null || tab.disabled) return false;\n            // event before\n            var eventData = this.trigger({ phase: 'before', type: 'click', target: id, tab: tab, object: tab, originalEvent: event });\n            if (eventData.isCancelled === true) return;\n            // default action\n            $(this.box).find('#tabs_'+ this.name +'_tab_'+ w2utils.escapeId(this.active) +' .w2ui-tab').removeClass('active');\n            this.active = tab.id;\n            // route processing\n            if (tab.route) {\n                var route = String('/'+ tab.route).replace(/\\/{2,}/g, '/');\n                var info  = w2utils.parseRoute(route);\n                if (info.keys.length > 0) {\n                    for (var k = 0; k < info.keys.length; k++) {\n                        if (this.routeData[info.keys[k].name] == null) continue;\n                        route = route.replace((new RegExp(':'+ info.keys[k].name, 'g')), this.routeData[info.keys[k].name]);\n                    }\n                }\n                setTimeout(function () { window.location.hash = route; }, 1);\n            }\n            // event after\n            this.trigger($.extend(eventData, { phase: 'after' }));\n            this.refresh(id);\n        },\n\n        animateClose: function(id, event) {\n            var tab = this.get(id);\n            if (tab === null || tab.disabled) return false;\n            // event before\n            var eventData = this.trigger({ phase: 'before', type: 'close', target: id, object: this.get(id), originalEvent: event });\n            if (eventData.isCancelled === true) return;\n            // default action\n            var obj = this;\n            $(this.box).find('#tabs_'+ this.name +'_tab_'+ w2utils.escapeId(tab.id)).css({\n                '-webkit-transition': '.2s',\n                '-moz-transition': '2s',\n                '-ms-transition': '.2s',\n                '-o-transition': '.2s',\n                opacity: '0' });\n            setTimeout(function () {\n                var width = $(obj.box).find('#tabs_'+ obj.name +'_tab_'+ w2utils.escapeId(tab.id)).width();\n                $(obj.box).find('#tabs_'+ obj.name +'_tab_'+ w2utils.escapeId(tab.id))\n                    .html('<div style=\"width: '+ width +'px; -webkit-transition: .2s; -moz-transition: .2s; -ms-transition: .2s; -o-transition: .2s\"></div>');\n                setTimeout(function () {\n                    $(obj.box).find('#tabs_'+ obj.name +'_tab_'+ w2utils.escapeId(tab.id)).find(':first-child').css({ 'width': '0px' });\n                }, 50);\n            }, 200);\n            setTimeout(function () {\n                obj.remove(id);\n            }, 450);\n            // event before\n            this.trigger($.extend(eventData, { phase: 'after' }));\n            this.refresh();\n        },\n\n        animateInsert: function(id, tab) {\n            if (this.get(id) === null) return;\n            if (!$.isPlainObject(tab)) return;\n            // check for unique\n            if (!w2utils.checkUniqueId(tab.id, this.tabs, 'tabs', this.name)) return;\n            // insert simple div\n            var jq_el   = $(this.box).find('#tabs_'+ this.name +'_tab_'+ w2utils.escapeId(tab.id));\n            if (jq_el.length !== 0) return; // already exists\n            // measure width\n            if (typeof tab.caption !== 'undefined') tab.text = tab.caption;\n            var tmp = '<div id=\"_tmp_tabs\" class=\"w2ui-reset w2ui-tabs\" style=\"position: absolute; top: -1000px;\">'+\n                '<table cellspacing=\"0\" cellpadding=\"1\" width=\"100%\"><tr>'+\n                '<td id=\"_tmp_simple_tab\" style=\"\" valign=\"middle\">'+\n                    (tab.closable ? '<div class=\"w2ui-tab-close\"></div>' : '') +\n                '    <div class=\"w2ui-tab '+ (this.active === tab.id ? 'active' : '') +'\">'+ tab.text +'</div>'+\n                '</td></tr></table>'+\n                '</div>';\n            $('body').append(tmp);\n            // create dummy element\n            var tabHTML = '<div style=\"width: 1px; -webkit-transition: 0.2s; -moz-transition: 0.2s; -ms-transition: 0.2s; -o-transition: 0.2s;\">&nbsp;</div>';\n            var addStyle = '';\n            if (tab.hidden) { addStyle += 'display: none;'; }\n            if (tab.disabled) { addStyle += 'opacity: 0.2; -moz-opacity: 0.2; -webkit-opacity: 0.2; -o-opacity: 0.2; filter:alpha(opacity=20);'; }\n            var html = '<td id=\"tabs_'+ this.name +'_tab_'+ tab.id +'\" style=\"'+ addStyle +'\" valign=\"middle\">'+ tabHTML +'</td>';\n            if (this.get(id, true) !== this.tabs.length && $(this.box).find('#tabs_'+ this.name +'_tab_'+ w2utils.escapeId(this.tabs[parseInt(this.get(id, true))].id)).length > 0) {\n                $(this.box).find('#tabs_'+ this.name +'_tab_'+ w2utils.escapeId(this.tabs[parseInt(this.get(id, true))].id)).before(html);\n            } else {\n                $(this.box).find('#tabs_'+ this.name +'_right').before(html);\n            }\n            // -- move\n            var obj = this;\n            setTimeout(function () {\n                var width = $('#_tmp_simple_tab').width();\n                $('#_tmp_tabs').remove();\n                $('#tabs_'+ obj.name +'_tab_'+ w2utils.escapeId(tab.id) +' > div').css('width', width+'px');\n            }, 1);\n            setTimeout(function () {\n                // insert for real\n                obj.insert(id, tab);\n            }, 200);\n        }\n    };\n\n    $.extend(w2tabs.prototype, w2utils.event);\n    w2obj.tabs = w2tabs;\n})();\n\n\n/************************************************************************\n*   Library: Web 2.0 UI for jQuery (using prototypical inheritance)\n*   - Following objects defined\n*        - w2toolbar        - toolbar widget\n*        - $().w2toolbar    - jQuery wrapper\n*   - Dependencies: jQuery, w2utils\n*\n* == NICE TO HAVE ==\n*   - on overflow display << >>\n*   - verticle toolbar\n*\n************************************************************************/\n\n(function () {\n    var w2toolbar = function (options) {\n        this.box       = null;      // DOM Element that holds the element\n        this.name      = null;      // unique name for w2ui\n        this.routeData = {};        // data for dynamic routes\n        this.items     = [];\n        this.right     = '';        // HTML text on the right of toolbar\n        this.onClick   = null;\n        this.onRender  = null;\n        this.onRefresh = null;\n        this.onResize  = null;\n        this.onDestroy = null;\n\n        $.extend(true, this, w2obj.toolbar, options);\n    };\n\n    // ====================================================\n    // -- Registers as a jQuery plugin\n\n    $.fn.w2toolbar = function(method) {\n        if (typeof method === 'object' || !method ) {\n            // check name parameter\n            if (!w2utils.checkName(method, 'w2toolbar')) return;\n            // extend items\n            var items = method.items || [];\n            var object = new w2toolbar(method);\n            $.extend(object, { items: [], handlers: [] });\n            for (var i = 0; i < items.length; i++) {\n                object.items[i] = $.extend({}, w2toolbar.prototype.item, items[i]);\n            }\n            if ($(this).length !== 0) {\n                object.render($(this)[0]);\n            }\n            // register new object\n            w2ui[object.name] = object;\n            return object;\n\n        } else if (w2ui[$(this).attr('name')]) {\n            var obj = w2ui[$(this).attr('name')];\n            obj[method].apply(obj, Array.prototype.slice.call(arguments, 1));\n            return this;\n        } else {\n            console.log('ERROR: Method ' +  method + ' does not exist on jQuery.w2toolbar' );\n        }\n    };\n\n    // ====================================================\n    // -- Implementation of core functionality\n\n    w2toolbar.prototype = {\n        item: {\n            id       : null,        // command to be sent to all event handlers\n            type     : 'button',    // button, check, radio, drop, menu, break, html, spacer\n            text     : '',\n            route    : null,        // if not null, it is route to go\n            html     : '',\n            img      : null,\n            icon     : null,\n            count    : null,\n            hidden   : false,\n            disabled : false,\n            checked  : false,       // used for radio buttons\n            arrow    : true,        // arrow down for drop/menu types\n            hint     : '',\n            group    : null,        // used for radio buttons\n            items    : null,        // for type menu it is an array of items in the menu\n            overlay  : {},\n            onClick  : null\n        },\n\n        add: function (items) {\n            this.insert(null, items);\n        },\n\n        insert: function (id, items) {\n            if (!$.isArray(items)) items = [items];\n            for (var o = 0; o < items.length; o++) {\n                // checks\n                if (typeof items[o].type === 'undefined') {\n                    console.log('ERROR: The parameter \"type\" is required but not supplied in w2toolbar.add() method.');\n                    return;\n                }\n                if ($.inArray(String(items[o].type), ['button', 'check', 'radio', 'drop', 'menu', 'break', 'html', 'spacer']) === -1) {\n                    console.log('ERROR: The parameter \"type\" should be one of the following [button, check, radio, drop, menu, break, html, spacer] '+\n                            'in w2toolbar.add() method.');\n                    return;\n                }\n                if (typeof items[o].id === 'undefined') {\n                    console.log('ERROR: The parameter \"id\" is required but not supplied in w2toolbar.add() method.');\n                    return;\n                }\n                if (!w2utils.checkUniqueId(items[o].id, this.items, 'toolbar items', this.name)) return;\n                // add item\n                var it = $.extend({}, w2toolbar.prototype.item, items[o]);\n                if (id == null) {\n                    this.items.push(it);\n                } else {\n                    var middle = this.get(id, true);\n                    this.items = this.items.slice(0, middle).concat([it], this.items.slice(middle));\n                }\n                this.refresh(it.id);\n            }\n        },\n\n        remove: function () {\n            var removed = 0;\n            for (var a = 0; a < arguments.length; a++) {\n                var it = this.get(arguments[a]);\n                if (!it) continue;\n                removed++;\n                // remove from screen\n                $(this.box).find('#tb_'+ this.name +'_item_'+ w2utils.escapeId(it.id)).remove();\n                // remove from array\n                var ind = this.get(it.id, true);\n                if (ind) this.items.splice(ind, 1);\n            }\n            return removed;\n        },\n\n        set: function (id, item) {\n            var index = this.get(id, true);\n            if (index === null) return false;\n            $.extend(this.items[index], item);\n            this.refresh(id);\n            return true;\n        },\n\n        get: function (id, returnIndex) {\n            if (arguments.length === 0) {\n                var all = [];\n                for (var i1 = 0; i1 < this.items.length; i1++) if (this.items[i1].id !== null) all.push(this.items[i1].id);\n                return all;\n            }\n            for (var i2 = 0; i2 < this.items.length; i2++) {\n                if (this.items[i2].id === id) {\n                    if (returnIndex === true) return i2; else return this.items[i2];\n                }\n            }\n            return null;\n        },\n\n        show: function () {\n            var obj   = this;\n            var items = 0;\n            var tmp   = [];\n            for (var a = 0; a < arguments.length; a++) {\n                var it = this.get(arguments[a]);\n                if (!it) continue;\n                items++;\n                it.hidden = false;\n                tmp.push(it.id);\n            }\n            setTimeout(function () { for (var t in tmp) obj.refresh(tmp[t]); }, 15); // needs timeout \n            return items;\n        },\n\n        hide: function () {\n            var obj   = this;\n            var items = 0;\n            var tmp   = [];\n            for (var a = 0; a < arguments.length; a++) {\n                var it = this.get(arguments[a]);\n                if (!it) continue;\n                items++;\n                it.hidden = true;\n                tmp.push(it.id);\n            }\n            setTimeout(function () { for (var t in tmp) obj.refresh(tmp[t]); }, 15); // needs timeout \n            return items;\n        },\n\n        enable: function () {\n            var obj   = this;\n            var items = 0;\n            var tmp   = [];\n            for (var a = 0; a < arguments.length; a++) {\n                var it = this.get(arguments[a]);\n                if (!it) continue;\n                items++;\n                it.disabled = false;\n                tmp.push(it.id);\n            }\n            setTimeout(function () { for (var t in tmp) obj.refresh(tmp[t]); }, 15); // needs timeout \n            return items;\n        },\n\n        disable: function () {\n            var obj   = this;\n            var items = 0;\n            var tmp   = [];\n            for (var a = 0; a < arguments.length; a++) {\n                var it = this.get(arguments[a]);\n                if (!it) continue;\n                items++;\n                it.disabled = true;\n                tmp.push(it.id);\n            }\n            setTimeout(function () { for (var t in tmp) obj.refresh(tmp[t]); }, 15); // needs timeout \n            return items;\n        },\n\n        check: function () {\n            var obj   = this;\n            var items = 0;\n            var tmp   = [];\n            for (var a = 0; a < arguments.length; a++) {\n                var it = this.get(arguments[a]);\n                if (!it) continue;\n                items++;\n                it.checked = true;\n                tmp.push(it.id);\n            }\n            setTimeout(function () { for (var t in tmp) obj.refresh(tmp[t]); }, 15); // needs timeout \n            return items;\n        },\n\n        uncheck: function () {\n            var obj   = this;\n            var items = 0;\n            var tmp   = [];\n            for (var a = 0; a < arguments.length; a++) {\n                var it = this.get(arguments[a]);\n                if (!it) continue;\n                items++;\n                it.checked = false;\n                tmp.push(it.id);\n            }\n            setTimeout(function () { for (var t in tmp) obj.refresh(tmp[t]); }, 15); // needs timeout \n            return items;\n        },\n\n        render: function (box) {\n            var time = (new Date()).getTime();\n            // event before\n            var eventData = this.trigger({ phase: 'before', type: 'render', target: this.name, box: box });\n            if (eventData.isCancelled === true) return;\n\n            if (box != null) {\n                if ($(this.box).find('> table #tb_'+ this.name + '_right').length > 0) {\n                    $(this.box)\n                        .removeAttr('name')\n                        .removeClass('w2ui-reset w2ui-toolbar')\n                        .html('');\n                }\n                this.box = box;\n            }\n            if (!this.box) return;\n            // render all buttons\n            var html = '<table cellspacing=\"0\" cellpadding=\"0\" width=\"100%\">'+\n                       '<tr>';\n            for (var i = 0; i < this.items.length; i++) {\n                var it = this.items[i];\n                if (it.id == null) it.id = \"item_\" + i;\n                if (it === null)  continue;\n                if (it.type === 'spacer') {\n                    html += '<td width=\"100%\" id=\"tb_'+ this.name +'_item_'+ it.id +'\" align=\"right\"></td>';\n                } else {\n                    html += '<td id=\"tb_'+ this.name + '_item_'+ it.id +'\" style=\"'+ (it.hidden ? 'display: none' : '') +'\" '+\n                            '    class=\"'+ (it.disabled ? 'disabled' : '') +'\" valign=\"middle\">'+ this.getItemHTML(it) +\n                            '</td>';\n                }\n            }\n            html += '<td width=\"100%\" id=\"tb_'+ this.name +'_right\" align=\"right\">'+ this.right +'</td>';\n            html += '</tr>'+\n                    '</table>';\n            $(this.box)\n                .attr('name', this.name)\n                .addClass('w2ui-reset w2ui-toolbar')\n                .html(html);\n            if ($(this.box).length > 0) $(this.box)[0].style.cssText += this.style;\n            // event after\n            this.trigger($.extend(eventData, { phase: 'after' }));\n            return (new Date()).getTime() - time;\n        },\n\n        refresh: function (id) {\n            var time = (new Date()).getTime();\n            // event before\n            var eventData = this.trigger({ phase: 'before', type: 'refresh', target: (typeof id !== 'undefined' ? id : this.name), item: this.get(id) });\n            if (eventData.isCancelled === true) return;\n\n            if (id == null) {\n                // refresh all\n                for (var i = 0; i < this.items.length; i++) {\n                    var it1 = this.items[i];\n                    if (it1.id == null) it1.id = \"item_\" + i;\n                    this.refresh(it1.id);\n                }\n            }\n            // create or refresh only one item\n            var it = this.get(id);\n            if (it === null) return false;\n\n            var el = $(this.box).find('#tb_'+ this.name +'_item_'+ w2utils.escapeId(it.id));\n            var html  = this.getItemHTML(it);\n            if (el.length === 0) {\n                // does not exist - create it\n                if (it.type === 'spacer') {\n                    html = '<td width=\"100%\" id=\"tb_'+ this.name +'_item_'+ it.id +'\" align=\"right\"></td>';\n                } else {\n                    html = '<td id=\"tb_'+ this.name + '_item_'+ it.id +'\" style=\"'+ (it.hidden ? 'display: none' : '') +'\" '+\n                        '    class=\"'+ (it.disabled ? 'disabled' : '') +'\" valign=\"middle\">'+ html +\n                        '</td>';\n                }\n                if (this.get(id, true) === this.items.length-1) {\n                    $(this.box).find('#tb_'+ this.name +'_right').before(html);\n                } else {\n                    $(this.box).find('#tb_'+ this.name +'_item_'+ w2utils.escapeId(this.items[parseInt(this.get(id, true))+1].id)).before(html);\n                }\n            } else {\n                // refresh\n                el.html(html);\n                if (it.hidden) { el.css('display', 'none'); } else { el.css('display', ''); }\n                if (it.disabled) { el.addClass('disabled'); } else { el.removeClass('disabled'); }\n            }\n            // event after\n            this.trigger($.extend(eventData, { phase: 'after' }));\n            return (new Date()).getTime() - time;\n        },\n\n        resize: function () {\n            var time = (new Date()).getTime();\n            // event before\n            var eventData = this.trigger({ phase: 'before', type: 'resize', target: this.name });\n            if (eventData.isCancelled === true) return;\n\n            // intentionaly blank\n\n            // event after\n            this.trigger($.extend(eventData, { phase: 'after' }));\n            return (new Date()).getTime() - time;\n        },\n\n        destroy: function () {\n            // event before\n            var eventData = this.trigger({ phase: 'before', type: 'destroy', target: this.name });\n            if (eventData.isCancelled === true) return;\n            // clean up\n            if ($(this.box).find('> table #tb_'+ this.name + '_right').length > 0) {\n                $(this.box)\n                    .removeAttr('name')\n                    .removeClass('w2ui-reset w2ui-toolbar')\n                    .html('');\n            }\n            $(this.box).html('');\n            delete w2ui[this.name];\n            // event after\n            this.trigger($.extend(eventData, { phase: 'after' }));\n        },\n\n        // ========================================\n        // --- Internal Functions\n\n        getItemHTML: function (item) {\n            var html = '';\n\n            if (typeof item.caption !== 'undefined') item.text = item.caption;\n            if (typeof item.hint === 'undefined') item.hint = '';\n            if (typeof item.text === 'undefined') item.text = '';\n\n            switch (item.type) {\n                case 'menu':\n                case 'button':\n                case 'check':\n                case 'radio':\n                case 'drop':\n                    var img = '<td>&nbsp;</td>';\n                    if (item.img)  img = '<td><div class=\"w2ui-tb-image w2ui-icon '+ item.img +'\"></div></td>';\n                    if (item.icon) img = '<td><div class=\"w2ui-tb-image\"><span class=\"'+ item.icon +'\"></span></div></td>';\n                    html += '<table cellpadding=\"0\" cellspacing=\"0\" title=\"'+ item.hint +'\" class=\"w2ui-button '+ (item.checked ? 'checked' : '') +'\" '+\n                            '       onclick     = \"var el=w2ui[\\''+ this.name + '\\']; if (el) el.click(\\''+ item.id +'\\', event);\" '+\n                            '       onmouseover = \"' + (!item.disabled ? \"$(this).addClass('over');\" : \"\") + '\"'+\n                            '       onmouseout  = \"' + (!item.disabled ? \"$(this).removeClass('over').removeClass('down');\" : \"\") + '\"'+\n                            '       onmousedown = \"' + (!item.disabled ? \"$(this).addClass('down');\" : \"\") + '\"'+\n                            '       onmouseup   = \"' + (!item.disabled ? \"$(this).removeClass('down');\" : \"\") + '\"'+\n                            '>'+\n                            '<tr><td>'+\n                            '  <table cellpadding=\"1\" cellspacing=\"0\">'+\n                            '  <tr>' +\n                                    img +\n                                    (item.text !== '' ? '<td class=\"w2ui-tb-caption\" nowrap>'+ item.text +'</td>' : '') +\n                                    (item.count != null ? '<td class=\"w2ui-tb-count\" nowrap><span>'+ item.count +'</span></td>' : '') +\n                                    (((item.type === 'drop' || item.type === 'menu') && item.arrow !== false) ?\n                                        '<td class=\"w2ui-tb-down\" nowrap><div></div></td>' : '') +\n                            '  </tr></table>'+\n                            '</td></tr></table>';\n                    break;\n\n                case 'break':\n                    html +=    '<table cellpadding=\"0\" cellspacing=\"0\"><tr>'+\n                            '    <td><div class=\"w2ui-break\">&nbsp;</div></td>'+\n                            '</tr></table>';\n                    break;\n\n                case 'html':\n                    html +=    '<table cellpadding=\"0\" cellspacing=\"0\"><tr>'+\n                            '    <td nowrap>' + item.html + '</td>'+\n                            '</tr></table>';\n                    break;\n            }\n\n            var newHTML = '';\n            if (typeof item.onRender === 'function') newHTML = item.onRender.call(this, item.id, html);\n            if (typeof this.onRender === 'function') newHTML = this.onRender(item.id, html);\n            if (newHTML !== '' && newHTML != null) html = newHTML;\n            return html;\n        },\n\n        menuClick: function (event) {\n            var obj = this;\n            if (event.item && !event.item.disabled) {\n                // event before\n                var eventData = this.trigger({ phase: 'before', type: 'click', target: event.item.id + ':' + event.subItem.id, item: event.item,\n                    subItem: event.subItem, originalEvent: event.originalEvent });\n                if (eventData.isCancelled === true) return;\n\n                // route processing\n                var it = event.subItem;\n                if (it.route) {\n                    var route = String('/'+ it.route).replace(/\\/{2,}/g, '/');\n                    var info  = w2utils.parseRoute(route);\n                    if (info.keys.length > 0) {\n                        for (var k = 0; k < info.keys.length; k++) {\n                            if (obj.routeData[info.keys[k].name] == null) continue;\n                            route = route.replace((new RegExp(':'+ info.keys[k].name, 'g')), this.routeData[info.keys[k].name]);\n                        }\n                    }\n                    setTimeout(function () { window.location.hash = route; }, 1);\n                }\n\n                // event after\n                this.trigger($.extend(eventData, { phase: 'after' }));\n            }\n        },\n\n        click: function (id, event) {\n            var obj = this;\n            var it  = this.get(id);\n            if (it && !it.disabled) {\n                // event before\n                var eventData = this.trigger({ phase: 'before', type: 'click', target: (typeof id !== 'undefined' ? id : this.name),\n                    item: it, object: it, originalEvent: event });\n                if (eventData.isCancelled === true) return;\n\n                var btn = $('#tb_'+ this.name +'_item_'+ w2utils.escapeId(it.id) +' table.w2ui-button');\n                btn.removeClass('down');\n\n                if (it.type === 'radio') {\n                    for (var i = 0; i < this.items.length; i++) {\n                        var itt = this.items[i];\n                        if (itt == null || itt.id === it.id || itt.type !== 'radio') continue;\n                        if (itt.group === it.group && itt.checked) {\n                            itt.checked = false;\n                            this.refresh(itt.id);\n                        }\n                    }\n                    it.checked = true;\n                    btn.addClass('checked');\n                }\n\n                if (it.type === 'drop' || it.type === 'menu') {\n                    if (it.checked) {\n                        // if it was already checked, second click will hide it\n                        it.checked = false;\n                    } else {\n                        // show overlay\n                        setTimeout(function () {\n                            var el = $('#tb_'+ obj.name +'_item_'+ w2utils.escapeId(it.id));\n                            if (!$.isPlainObject(it.overlay)) it.overlay = {};\n                            var left = (el.width() - 50) / 2;\n                            if (left > 19) left = 19;\n                            if (it.type === 'drop') {\n                                el.w2overlay(it.html, $.extend({ left: left, top: 3 }, it.overlay));\n                            }\n                            if (it.type === 'menu') {\n                                el.w2menu(it.items, $.extend({ left: left, top: 3 }, it.overlay, {\n                                    select: function (event) {\n                                        obj.menuClick({ item: it, subItem: event.item, originalEvent: event.originalEvent });\n                                        hideDrop();\n                                    }\n                                }));\n                            }\n                            // window.click to hide it\n                            $(document).on('click', hideDrop);\n                            function hideDrop() {\n                                $(document).off('click', hideDrop);\n                                it.checked = false;\n                                btn.removeClass('checked');\n                            }\n                        }, 1);\n                    }\n                }\n\n                if (it.type === 'check' || it.type === 'drop' || it.type === 'menu') {\n                    it.checked = !it.checked;\n                    if (it.checked) {\n                        btn.addClass('checked');\n                    } else {\n                        btn.removeClass('checked');\n                    }\n                }\n                // route processing\n                if (it.route) {\n                    var route = String('/'+ it.route).replace(/\\/{2,}/g, '/');\n                    var info  = w2utils.parseRoute(route);\n                    if (info.keys.length > 0) {\n                        for (var k = 0; k < info.keys.length; k++) {\n                            route = route.replace((new RegExp(':'+ info.keys[k].name, 'g')), this.routeData[info.keys[k].name]);\n                        }\n                    }\n                    setTimeout(function () { window.location.hash = route; }, 1);\n                }\n                // event after\n                this.trigger($.extend(eventData, { phase: 'after' }));\n            }\n        }\n    };\n\n    $.extend(w2toolbar.prototype, w2utils.event);\n    w2obj.toolbar = w2toolbar;\n})();\n\n\n/************************************************************************\n*   Library: Web 2.0 UI for jQuery (using prototypical inheritance)\n*   - Following objects defined\n*        - w2sidebar        - sidebar widget\n*        - $().w2sidebar    - jQuery wrapper\n*   - Dependencies: jQuery, w2utils\n*\n* == NICE TO HAVE ==\n*   - return ids of all subitems\n*   - add find() method to find nodes by a specific criteria (I want all nodes for exampe)\n*   - dbl click should be like it is in grid (with timer not HTML dbl click event)\n*   - reorder with grag and drop\n*   - add route property that would navigate to a #route\n*   - node.style is missleading - should be there to apply color for example\n*\n************************************************************************/\n\n(function () {\n    var w2sidebar = function (options) {\n        this.name          = null;\n        this.box           = null;\n        this.sidebar       = null;\n        this.parent        = null;\n        this.nodes         = [];        // Sidebar child nodes\n        this.menu          = [];\n        this.routeData     = {};        // data for dynamic routes\n        this.selected      = null;      // current selected node (readonly)\n        this.img           = null;\n        this.icon          = null;\n        this.style         = '';\n        this.topHTML       = '';\n        this.bottomHTML    = '';\n        this.keyboard      = true;\n        this.onClick       = null;      // Fire when user click on Node Text\n        this.onDblClick    = null;      // Fire when user dbl clicks\n        this.onContextMenu = null;\n        this.onMenuClick   = null;      // when context menu item selected\n        this.onExpand      = null;      // Fire when node Expands\n        this.onCollapse    = null;      // Fire when node Colapses\n        this.onKeydown     = null;\n        this.onRender      = null;\n        this.onRefresh     = null;\n        this.onResize      = null;\n        this.onDestroy     = null;\n\n        $.extend(true, this, w2obj.sidebar, options);\n    };\n\n    // ====================================================\n    // -- Registers as a jQuery plugin\n\n    $.fn.w2sidebar = function(method) {\n        if (typeof method === 'object' || !method ) {\n            // check name parameter\n            if (!w2utils.checkName(method, 'w2sidebar')) return;\n            // extend items\n            var nodes  = method.nodes;\n            var object = new w2sidebar(method);\n            $.extend(object, { handlers: [], nodes: [] });\n            if (typeof nodes != 'undefined') {\n                object.add(object, nodes);\n            }\n            if ($(this).length !== 0) {\n                object.render($(this)[0]);\n            }\n            object.sidebar = object;\n            // register new object\n            w2ui[object.name] = object;\n            return object;\n\n        } else if (w2ui[$(this).attr('name')]) {\n            var obj = w2ui[$(this).attr('name')];\n            obj[method].apply(obj, Array.prototype.slice.call(arguments, 1));\n            return this;\n        } else {\n            console.log('ERROR: Method ' +  method + ' does not exist on jQuery.w2sidebar' );\n        }\n    };\n\n    // ====================================================\n    // -- Implementation of core functionality\n\n    w2sidebar.prototype = {\n\n        node: {\n            id              : null,\n            text            : '',\n            count           : null,\n            img             : null,\n            icon            : null,\n            nodes           : [],\n            style           : '',            // additional style for subitems\n            route           : null,\n            selected        : false,\n            expanded        : false,\n            hidden          : false,\n            disabled        : false,\n            group           : false,        // if true, it will build as a group\n            groupShowHide   : true,\n            plus            : false,        // if true, plus will be shown even if there is no sub nodes\n            // events\n            onClick         : null,\n            onDblClick      : null,\n            onContextMenu   : null,\n            onExpand        : null,\n            onCollapse      : null,\n            // internal\n            parent          : null,    // node object\n            sidebar         : null\n        },\n\n        add: function (parent, nodes) {\n            if (arguments.length == 1) {\n                // need to be in reverse order\n                nodes  = arguments[0];\n                parent = this;\n            }\n            if (typeof parent == 'string') parent = this.get(parent);\n            return this.insert(parent, null, nodes);\n        },\n\n        insert: function (parent, before, nodes) {\n            var txt, ind, tmp, node, nd;\n            if (arguments.length == 2) {\n                // need to be in reverse order\n                nodes  = arguments[1];\n                before = arguments[0];\n                ind    = this.get(before);\n                if (ind === null) {\n                    if (!$.isArray(nodes)) nodes = [nodes];\n                    txt = (nodes[0].caption != null ? nodes[0].caption : nodes[0].text);\n                    console.log('ERROR: Cannot insert node \"'+ txt +'\" because cannot find node \"'+ before +'\" to insert before.');\n                    return null;\n                }\n                parent = this.get(before).parent;\n            }\n            if (typeof parent == 'string') parent = this.get(parent);\n            if (!$.isArray(nodes)) nodes = [nodes];\n            for (var o in nodes) {\n                node = nodes[o];\n                if (typeof node.id == null) {\n                    txt = (node.caption != null ? node.caption : node.text);\n                    console.log('ERROR: Cannot insert node \"'+ txt +'\" because it has no id.');\n                    continue;\n                }\n                if (this.get(this, node.id) !== null) {\n                    txt = (node.caption != null ? node.caption : node.text);\n                    console.log('ERROR: Cannot insert node with id='+ node.id +' (text: '+ txt + ') because another node with the same id already exists.');\n                    continue;\n                }\n                tmp = $.extend({}, w2sidebar.prototype.node, node);\n                tmp.sidebar = this;\n                tmp.parent  = parent;\n                nd = tmp.nodes || [];\n                tmp.nodes = []; // very important to re-init empty nodes array\n                if (before === null) { // append to the end\n                    parent.nodes.push(tmp);\n                } else {\n                    ind = this.get(parent, before, true);\n                    if (ind === null) {\n                        txt = (node.caption != null ? node.caption : node.text);\n                        console.log('ERROR: Cannot insert node \"'+ txt +'\" because cannot find node \"'+ before +'\" to insert before.');\n                        return null;\n                }\n                    parent.nodes.splice(ind, 0, tmp);\n                }\n                if (nd.length > 0) {\n                    this.insert(tmp, null, nd);\n                }\n            }\n            this.refresh(parent.id);\n            return tmp;\n        },\n\n        remove: function () { // multiple arguments\n            var deleted = 0;\n            var tmp;\n            for (var a = 0; a < arguments.length; a++) {\n                tmp = this.get(arguments[a]);\n                if (tmp === null) continue;\n                if (this.selected !== null && this.selected === tmp.id) {\n                    this.selected = null;\n                }\n                var ind  = this.get(tmp.parent, arguments[a], true);\n                if (ind === null) continue;\n                if (tmp.parent.nodes[ind].selected)    tmp.sidebar.unselect(tmp.id);\n                tmp.parent.nodes.splice(ind, 1);\n                deleted++;\n            }\n            if (deleted > 0 && arguments.length == 1) this.refresh(tmp.parent.id); else this.refresh();\n            return deleted;\n        },\n\n        set: function (parent, id, node) {\n            if (arguments.length == 2) {\n                // need to be in reverse order\n                node    = id;\n                id        = parent;\n                parent    = this;\n            }\n            // searches all nested nodes\n            if (typeof parent == 'string') parent = this.get(parent);\n            if (parent.nodes == null) return null;\n            for (var i = 0; i < parent.nodes.length; i++) {\n                if (parent.nodes[i].id === id) {\n                    // make sure nodes inserted correctly\n                    var nodes = node.nodes;\n                    $.extend(parent.nodes[i], node, { nodes: [] });\n                    if (nodes != null) {\n                        this.add(parent.nodes[i], nodes);\n                    }\n                    this.refresh(id);\n                    return true;\n                } else {\n                    var rv = this.set(parent.nodes[i], id, node);\n                    if (rv) return true;\n                }\n            }\n            return false;\n        },\n\n        get: function (parent, id, returnIndex) { // can be just called get(id) or get(id, true)\n            if (arguments.length === 0) {\n                var all = [];\n                var tmp = this.find({});\n                for (var t = 0; t < tmp.length; t++) {\n                    if (tmp[t].id != null) all.push(tmp[t].id);\n                }\n                return all;\n            } else {\n                if (arguments.length == 1 || (arguments.length == 2 && id === true) ) {\n                    // need to be in reverse order\n                    returnIndex    = id;\n                    id            = parent;\n                    parent        = this;\n                }\n                // searches all nested nodes\n                if (typeof parent == 'string') parent = this.get(parent);\n                if (parent.nodes == null) return null;\n                for (var i = 0; i < parent.nodes.length; i++) {\n                    if (parent.nodes[i].id == id) {\n                        if (returnIndex === true) return i; else return parent.nodes[i];\n                    } else {\n                        var rv = this.get(parent.nodes[i], id, returnIndex);\n                        if (rv || rv === 0) return rv;\n                    }\n                }\n                return null;\n            }\n        },\n\n        find: function (parent, params, results) { // can be just called find({ selected: true })\n            if (arguments.length == 1) {\n                // need to be in reverse order\n                params = parent;\n                parent = this;\n            }\n            if (!results) results = [];\n            // searches all nested nodes\n            if (typeof parent == 'string') parent = this.get(parent);\n            if (parent.nodes == null) return results;\n            for (var i = 0; i < parent.nodes.length; i++) {\n                var match = true;\n                for (var prop in params) {\n                    if (parent.nodes[i][prop] != params[prop]) match = false;\n                }\n                if (match) results.push(parent.nodes[i]);\n                if (parent.nodes[i].nodes.length > 0) results = this.find(parent.nodes[i], params, results);\n            }\n            return results;\n        },\n\n        hide: function () { // multiple arguments\n            var hidden = 0;\n            for (var a = 0; a < arguments.length; a++) {\n                var tmp = this.get(arguments[a]);\n                if (tmp === null) continue;\n                tmp.hidden = true;\n                hidden++;\n            }\n            if (arguments.length == 1) this.refresh(arguments[0]); else this.refresh();\n            return hidden;\n        },\n\n        show: function () { // multiple arguments\n            var shown = 0;\n            for (var a = 0; a < arguments.length; a++) {\n                var tmp = this.get(arguments[a]);\n                if (tmp === null) continue;\n                tmp.hidden = false;\n                shown++;\n            }\n            if (arguments.length == 1) this.refresh(arguments[0]); else this.refresh();\n            return shown;\n        },\n\n        disable: function () { // multiple arguments\n            var disabled = 0;\n            for (var a = 0; a < arguments.length; a++) {\n                var tmp = this.get(arguments[a]);\n                if (tmp === null) continue;\n                tmp.disabled = true;\n                if (tmp.selected) this.unselect(tmp.id);\n                disabled++;\n            }\n            if (arguments.length == 1) this.refresh(arguments[0]); else this.refresh();\n            return disabled;\n        },\n\n        enable: function () { // multiple arguments\n            var enabled = 0;\n            for (var a = 0; a < arguments.length; a++) {\n                var tmp = this.get(arguments[a]);\n                if (tmp === null) continue;\n                tmp.disabled = false;\n                enabled++;\n            }\n            if (arguments.length == 1) this.refresh(arguments[0]); else this.refresh();\n            return enabled;\n        },\n\n        select: function (id) {\n            var new_node = this.get(id);\n            if (!new_node) return false;\n            if (this.selected == id && new_node.selected) return false;\n            this.unselect(this.selected);\n            $(this.box).find('#node_'+ w2utils.escapeId(id))\n                .addClass('w2ui-selected')\n                .find('.w2ui-icon').addClass('w2ui-icon-selected');\n            new_node.selected = true;\n            this.selected = id;\n            return true;\n        },\n\n        unselect: function (id) {\n            var current = this.get(id);\n            if (!current) return false;\n            current.selected = false;\n            $(this.box).find('#node_'+ w2utils.escapeId(id))\n                .removeClass('w2ui-selected')\n                .find('.w2ui-icon').removeClass('w2ui-icon-selected');\n            if (this.selected == id) this.selected = null;\n            return true;\n        },\n\n        toggle: function(id) {\n            var nd = this.get(id);\n            if (nd === null) return false;\n            if (nd.plus) {\n                this.set(id, { plus: false });\n                this.expand(id);\n                this.refresh(id);\n                return;\n            }\n            if (nd.nodes.length === 0) return false;\n            if (this.get(id).expanded) return this.collapse(id); else return this.expand(id);\n        },\n\n        collapse: function (id) {\n            var obj = this;\n            var nd  = this.get(id);\n            // event before\n            var eventData = this.trigger({ phase: 'before', type: 'collapse', target: id, object: nd });\n            if (eventData.isCancelled === true) return;\n            // default action\n            $(this.box).find('#node_'+ w2utils.escapeId(id) +'_sub').slideUp(200);\n            $(this.box).find('#node_'+ w2utils.escapeId(id) +' .w2ui-node-dots:first-child').html('<div class=\"w2ui-expand\">+</div>');\n            nd.expanded = false;\n            // event after\n            this.trigger($.extend(eventData, { phase: 'after' }));\n            setTimeout(function () { obj.refresh(id); }, 200);\n            return true;\n        },\n\n        collapseAll: function (parent) {\n            if (typeof parent == 'undefined') parent = this;\n            if (typeof parent == 'string') parent = this.get(parent);\n            if (parent.nodes == null) return false;\n            for (var i = 0; i < parent.nodes.length; i++) {\n                if (parent.nodes[i].expanded === true) parent.nodes[i].expanded = false;\n                if (parent.nodes[i].nodes && parent.nodes[i].nodes.length > 0) this.collapseAll(parent.nodes[i]);\n            }\n            this.refresh(parent.id);\n            return true;\n        },\n\n        expand: function (id) {\n            var obj = this;\n            var nd  = this.get(id);\n            // event before\n            var eventData = this.trigger({ phase: 'before', type: 'expand', target: id, object: nd });\n            if (eventData.isCancelled === true) return;\n            // default action\n            $(this.box).find('#node_'+ w2utils.escapeId(id) +'_sub').slideDown(200);\n            $(this.box).find('#node_'+ w2utils.escapeId(id) +' .w2ui-node-dots:first-child').html('<div class=\"w2ui-expand\">-</div>');\n            nd.expanded = true;\n            // event after\n            this.trigger($.extend(eventData, { phase: 'after' }));\n            setTimeout(function () { obj.refresh(id); }, 200);\n            return true;\n        },\n\n        expandAll: function (parent) {\n            if (typeof parent == 'undefined') parent = this;\n            if (typeof parent == 'string') parent = this.get(parent);\n            if (parent.nodes == null) return false;\n            for (var i = 0; i < parent.nodes.length; i++) {\n                if (parent.nodes[i].expanded === false) parent.nodes[i].expanded = true;\n                if (parent.nodes[i].nodes && parent.nodes[i].nodes.length > 0) this.collapseAll(parent.nodes[i]);\n            }\n            this.refresh(parent.id);\n        },\n\n        expandParents: function (id) {\n            var node = this.get(id);\n            if (node === null) return false;\n            if (node.parent) {\n                node.parent.expanded = true;\n                this.expandParents(node.parent.id);\n            }\n            this.refresh(id);\n            return true;\n        },\n\n        click: function (id, event) {\n            var obj = this;\n            var nd  = this.get(id);\n            if (nd === null) return;\n            if (nd.disabled || nd.group) return; // should click event if already selected\n            // unselect all previsously\n            $(obj.box).find('.w2ui-node.w2ui-selected').each(function (index, el) {\n                var oldID     = $(el).attr('id').replace('node_', '');\n                var oldNode = obj.get(oldID);\n                if (oldNode != null) oldNode.selected = false;\n                $(el).removeClass('w2ui-selected').find('.w2ui-icon').removeClass('w2ui-icon-selected');\n            });\n            // select new one\n            var newNode = $(obj.box).find('#node_'+ w2utils.escapeId(id));\n            var oldNode = $(obj.box).find('#node_'+ w2utils.escapeId(obj.selected));\n            newNode.addClass('w2ui-selected').find('.w2ui-icon').addClass('w2ui-icon-selected');\n            // need timeout to allow rendering\n            setTimeout(function () {\n                // event before\n                var eventData = obj.trigger({ phase: 'before', type: 'click', target: id, originalEvent: event, node: nd, object: nd });\n                if (eventData.isCancelled === true) {\n                    // restore selection\n                    newNode.removeClass('w2ui-selected').find('.w2ui-icon').removeClass('w2ui-icon-selected');\n                    oldNode.addClass('w2ui-selected').find('.w2ui-icon').addClass('w2ui-icon-selected');\n                    return;\n                }\n                // default action\n                if (oldNode !== null) oldNode.selected = false;\n                obj.get(id).selected = true;\n                obj.selected = id;\n                // route processing\n                if (nd.route) {\n                    var route = String('/'+ nd.route).replace(/\\/{2,}/g, '/');\n                    var info  = w2utils.parseRoute(route);\n                    if (info.keys.length > 0) {\n                        for (var k = 0; k < info.keys.length; k++) {\n                            if (obj.routeData[info.keys[k].name] == null) continue;\n                            route = route.replace((new RegExp(':'+ info.keys[k].name, 'g')), obj.routeData[info.keys[k].name]);\n                        }\n                    }\n                    setTimeout(function () { window.location.hash = route; }, 1);\n                }\n                // event after\n                obj.trigger($.extend(eventData, { phase: 'after' }));\n            }, 1);\n        },\n\n        keydown: function (event) {\n            var obj = this;\n            var nd  = obj.get(obj.selected);\n            if (!nd || obj.keyboard !== true) return;\n            // trigger event\n            var eventData = obj.trigger({ phase: 'before', type: 'keydown', target: obj.name, originalEvent: event });\n            if (eventData.isCancelled === true) return;\n            // default behaviour\n            if (event.keyCode == 13 || event.keyCode == 32) { // enter or space\n                if (nd.nodes.length > 0) obj.toggle(obj.selected);\n            }\n            if (event.keyCode == 37) { // left\n                if (nd.nodes.length > 0 && nd.expanded) {\n                    obj.collapse(obj.selected);\n                } else {\n                    selectNode(nd.parent);\n                    if (!nd.parent.group) obj.collapse(nd.parent.id);\n                }\n            }\n            if (event.keyCode == 39) { // right\n                if ((nd.nodes.length > 0 || nd.plus) && !nd.expanded) obj.expand(obj.selected);\n            }\n            if (event.keyCode == 38) { // up\n                selectNode(neighbor(nd, prev));\n            }\n            if (event.keyCode == 40) { // down\n                selectNode(neighbor(nd, next));\n            }\n            // cancel event if needed\n            if ($.inArray(event.keyCode, [13, 32, 37, 38, 39, 40]) != -1) {\n                if (event.preventDefault) event.preventDefault();\n                if (event.stopPropagation) event.stopPropagation();\n            }\n            // event after\n            obj.trigger($.extend(eventData, { phase: 'after' }));\n\n            function selectNode (node, event) {\n                if (node !== null && !node.hidden && !node.disabled && !node.group) {\n                    obj.click(node.id, event);\n                    setTimeout(function () { obj.scrollIntoView(); }, 50);\n                }\n            }\n\n            function neighbor (node, neighborFunc) {\n                node = neighborFunc(node);\n                while (node !== null && (node.hidden || node.disabled)) {\n                    if (node.group) break; else node = neighborFunc(node);\n                }\n                return node;\n            }\n\n            function next (node, noSubs) {\n                if (node === null) return null;\n                var parent   = node.parent;\n                var ind      = obj.get(node.id, true);\n                var nextNode = null;\n                // jump inside\n                if (node.expanded && node.nodes.length > 0 && noSubs !== true) {\n                    var t = node.nodes[0];\n                    if (t.hidden || t.disabled || t.group) nextNode = next(t); else nextNode = t;\n                } else {\n                    if (parent && ind + 1 < parent.nodes.length) {\n                        nextNode = parent.nodes[ind + 1];\n                    } else {\n                        nextNode = next(parent, true); // jump to the parent\n                    }\n                }\n                if (nextNode !== null && (nextNode.hidden || nextNode.disabled || nextNode.group)) nextNode = next(nextNode);\n                return nextNode;\n            }\n\n            function prev (node) {\n                if (node === null) return null;\n                var parent   = node.parent;\n                var ind      = obj.get(node.id, true);\n                var prevNode = (ind > 0) ? lastChild(parent.nodes[ind - 1]) : parent;\n                if (prevNode !== null && (prevNode.hidden || prevNode.disabled || prevNode.group)) prevNode = prev(prevNode);\n                return prevNode;\n            }\n\n            function lastChild (node) {\n                if (node.expanded && node.nodes.length > 0) {\n                    var t = node.nodes[node.nodes.length - 1];\n                    if (t.hidden || t.disabled || t.group) return prev(t); else return lastChild(t);\n                }\n                return node;\n            }\n        },\n\n        scrollIntoView: function (id) {\n            if (typeof id == 'undefined') id = this.selected;\n            var nd = this.get(id);\n            if (nd === null) return;\n            var body   = $(this.box).find('.w2ui-sidebar-div');\n            var item   = $(this.box).find('#node_'+ w2utils.escapeId(id));\n            var offset = item.offset().top - body.offset().top;\n            if (offset + item.height() > body.height()) {\n                body.animate({ 'scrollTop': body.scrollTop() + body.height() / 1.3 }, 250, 'linear');\n            }\n            if (offset <= 0) {\n                body.animate({ 'scrollTop': body.scrollTop() - body.height() / 1.3 }, 250, 'linear');\n            }\n        },\n\n        dblClick: function (id, event) {\n            // if (window.getSelection) window.getSelection().removeAllRanges(); // clear selection\n            var nd = this.get(id);\n            // event before\n            var eventData = this.trigger({ phase: 'before', type: 'dblClick', target: id, originalEvent: event, object: nd });\n            if (eventData.isCancelled === true) return;\n            // default action\n            this.toggle(id);\n            // event after\n            this.trigger($.extend(eventData, { phase: 'after' }));\n        },\n\n        contextMenu: function (id, event) {\n            var obj = this;\n            var nd  = obj.get(id);\n            if (id != obj.selected) obj.click(id);\n            // need timeout to allow click to finish first\n            setTimeout(function () {\n                // event before\n                var eventData = obj.trigger({ phase: 'before', type: 'contextMenu', target: id, originalEvent: event, object: nd });\n                if (eventData.isCancelled === true) return;\n                // default action\n                if (nd.group || nd.disabled) return;\n                if (obj.menu.length > 0) {\n                    $(obj.box).find('#node_'+ w2utils.escapeId(id))\n                        .w2menu(obj.menu, {\n                            left    : (event ? event.offsetX || event.pageX : 50) - 25,\n                            onSelect: function (event) { \n                                obj.menuClick(id, parseInt(event.index), event.originalEvent); \n                            }\n                        }\n                    );\n                }\n                // event after\n                obj.trigger($.extend(eventData, { phase: 'after' }));\n            }, 150); // need timer 150 for FF\n        },\n\n        menuClick: function (itemId, index, event) {\n            var obj = this;\n            // event before\n            var eventData = obj.trigger({ phase: 'before', type: 'menuClick', target: itemId, originalEvent: event, menuIndex: index, menuItem: obj.menu[index] });\n            if (eventData.isCancelled === true) return;\n            // default action\n            // -- empty\n            // event after\n            obj.trigger($.extend(eventData, { phase: 'after' }));\n        },\n\n        render: function (box) {\n            var time = (new Date()).getTime();\n            // event before\n            var eventData = this.trigger({ phase: 'before', type: 'render', target: this.name, box: box });\n            if (eventData.isCancelled === true) return;\n            // default action\n            if (typeof box != 'undefined' && box !== null) {\n                if ($(this.box).find('> div > div.w2ui-sidebar-div').length > 0) {\n                    $(this.box)\n                        .removeAttr('name')\n                        .removeClass('w2ui-reset w2ui-sidebar')\n                        .html('');\n                }\n                this.box = box;\n            }\n            if (!this.box) return;\n            $(this.box)\n                .attr('name', this.name)\n                .addClass('w2ui-reset w2ui-sidebar')\n                .html('<div>'+\n                        '<div class=\"w2ui-sidebar-top\"></div>' +\n                        '<div class=\"w2ui-sidebar-div\"></div>'+\n                        '<div class=\"w2ui-sidebar-bottom\"></div>'+\n                    '</div>'\n                );\n            $(this.box).find('> div').css({\n                width    : $(this.box).width() + 'px',\n                height: $(this.box).height() + 'px'\n            });\n            if ($(this.box).length > 0) $(this.box)[0].style.cssText += this.style;\n            // adjust top and bottom\n            if (this.topHTML !== '') {\n                $(this.box).find('.w2ui-sidebar-top').html(this.topHTML);\n                $(this.box).find('.w2ui-sidebar-div')\n                    .css('top', $(this.box).find('.w2ui-sidebar-top').height() + 'px');\n            }\n            if (this.bottomHTML !== '') {\n                $(this.box).find('.w2ui-sidebar-bottom').html(this.bottomHTML);\n                $(this.box).find('.w2ui-sidebar-div')\n                    .css('bottom', $(this.box).find('.w2ui-sidebar-bottom').height() + 'px');\n            }\n            // event after\n            this.trigger($.extend(eventData, { phase: 'after' }));\n            // ---\n            this.refresh();\n            return (new Date()).getTime() - time;\n        },\n\n        refresh: function (id) {\n            var time = (new Date()).getTime();\n            // if (window.getSelection) window.getSelection().removeAllRanges(); // clear selection\n            // event before\n            var eventData = this.trigger({ phase: 'before', type: 'refresh', target: (typeof id != 'undefined' ? id : this.name) });\n            if (eventData.isCancelled === true) return;\n            // adjust top and bottom\n            if (this.topHTML !== '') {\n                $(this.box).find('.w2ui-sidebar-top').html(this.topHTML);\n                $(this.box).find('.w2ui-sidebar-div')\n                    .css('top', $(this.box).find('.w2ui-sidebar-top').height() + 'px');\n            }\n            if (this.bottomHTML !== '') {\n                $(this.box).find('.w2ui-sidebar-bottom').html(this.bottomHTML);\n                $(this.box).find('.w2ui-sidebar-div')\n                    .css('bottom', $(this.box).find('.w2ui-sidebar-bottom').height() + 'px');\n            }\n            // default action\n            $(this.box).find('> div').css({\n                width : $(this.box).width() + 'px',\n                height: $(this.box).height() + 'px'\n            });\n            var obj = this;\n            var node, nd;\n            var nm;\n            if (typeof id == 'undefined') {\n                node = this;\n                nm   = '.w2ui-sidebar-div';\n            } else {\n                node = this.get(id);\n                if (node === null) return;\n                nm   = '#node_'+ w2utils.escapeId(node.id) + '_sub';\n            }\n            var nodeHTML;\n            if (node !== this) {\n                var tmp    = '#node_'+ w2utils.escapeId(node.id);\n                nodeHTML    = getNodeHTML(node);\n                $(this.box).find(tmp).before('<div id=\"sidebar_'+ this.name + '_tmp\"></div>');\n                $(this.box).find(tmp).remove();\n                $(this.box).find(nm).remove();\n                $('#sidebar_'+ this.name + '_tmp').before(nodeHTML);\n                $('#sidebar_'+ this.name + '_tmp').remove();\n            }\n            // refresh sub nodes\n            $(this.box).find(nm).html('');\n            for (var i = 0; i < node.nodes.length; i++) {\n                nd = node.nodes[i];\n                nodeHTML = getNodeHTML(nd);\n                $(this.box).find(nm).append(nodeHTML);\n                if (nd.nodes.length !== 0) { this.refresh(nd.id); }\n            }\n            // event after\n            this.trigger($.extend(eventData, { phase: 'after' }));\n            return (new Date()).getTime() - time;\n\n            function getNodeHTML(nd) {\n                var html = '';\n                var img  = nd.img;\n                if (img === null) img = this.img;\n                var icon = nd.icon;\n                if (icon === null) icon = this.icon;\n                // -- find out level\n                var tmp   = nd.parent;\n                var level = 0;\n                while (tmp && tmp.parent !== null) {\n                    if (tmp.group) level--;\n                    tmp = tmp.parent;\n                    level++;\n                }\n                if (typeof nd.caption != 'undefined') nd.text = nd.caption;\n                if (nd.group) {\n                    html =\n                        '<div class=\"w2ui-node-group\"  id=\"node_'+ nd.id +'\"'+\n                        '        onclick=\"w2ui[\\''+ obj.name +'\\'].toggle(\\''+ nd.id +'\\')\"'+\n                        '        onmouseout=\"$(this).find(\\'span:nth-child(1)\\').css(\\'color\\', \\'transparent\\')\" '+\n                        '        onmouseover=\"$(this).find(\\'span:nth-child(1)\\').css(\\'color\\', \\'inherit\\')\">'+\n                        (nd.groupShowHide ? '<span>'+ (!nd.hidden && nd.expanded ? w2utils.lang('Hide') : w2utils.lang('Show')) +'</span>' : '<span></span>') +\n                        '    <span>'+ nd.text +'</span>'+\n                        '</div>'+\n                        '<div class=\"w2ui-node-sub\" id=\"node_'+ nd.id +'_sub\" style=\"'+ nd.style +';'+ (!nd.hidden && nd.expanded ? '' : 'display: none;') +'\"></div>';\n                } else {\n                    if (nd.selected && !nd.disabled) obj.selected = nd.id;\n                    tmp = '';\n                    if (img) tmp = '<div class=\"w2ui-node-image w2ui-icon '+ img +    (nd.selected && !nd.disabled ? \" w2ui-icon-selected\" : \"\") +'\"></div>';\n                    if (icon) tmp = '<div class=\"w2ui-node-image\"><span class=\"'+ icon +'\"></span></div>';\n                    html =\n                    '<div class=\"w2ui-node '+ (nd.selected ? 'w2ui-selected' : '') +' '+ (nd.disabled ? 'w2ui-disabled' : '') +'\" id=\"node_'+ nd.id +'\" style=\"'+ (nd.hidden ? 'display: none;' : '') +'\"'+\n                        '    ondblclick=\"w2ui[\\''+ obj.name +'\\'].dblClick(\\''+ nd.id +'\\', event);\"'+\n                        '    oncontextmenu=\"w2ui[\\''+ obj.name +'\\'].contextMenu(\\''+ nd.id +'\\', event); '+\n                        '        if (event.preventDefault) event.preventDefault();\"'+\n                        '    onClick=\"w2ui[\\''+ obj.name +'\\'].click(\\''+ nd.id +'\\', event); \">'+\n                        '<table cellpadding=\"0\" cellspacing=\"0\" style=\"margin-left:'+ (level*18) +'px; padding-right:'+ (level*18) +'px\"><tr>'+\n                        '<td class=\"w2ui-node-dots\" nowrap onclick=\"w2ui[\\''+ obj.name +'\\'].toggle(\\''+ nd.id +'\\'); '+\n                        '        if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;\">'+\n                        '    <div class=\"w2ui-expand\">'    + (nd.nodes.length > 0 ? (nd.expanded ? '-' : '+') : (nd.plus ? '+' : '')) + '</div>' +\n                        '</td>'+\n                        '<td class=\"w2ui-node-data\" nowrap>'+\n                            tmp +\n                            (nd.count || nd.count === 0 ? '<div class=\"w2ui-node-count\">'+ nd.count +'</div>' : '') +\n                            '<div class=\"w2ui-node-caption\">'+ nd.text +'</div>'+\n                        '</td>'+\n                        '</tr></table>'+\n                    '</div>'+\n                    '<div class=\"w2ui-node-sub\" id=\"node_'+ nd.id +'_sub\" style=\"'+ nd.style +';'+ (!nd.hidden && nd.expanded ? '' : 'display: none;') +'\"></div>';\n                }\n                return html;\n            }\n        },\n\n        resize: function () {\n            var time = (new Date()).getTime();\n            // if (window.getSelection) window.getSelection().removeAllRanges(); // clear selection\n            // event before\n            var eventData = this.trigger({ phase: 'before', type: 'resize', target: this.name });\n            if (eventData.isCancelled === true) return;\n            // default action\n            $(this.box).css('overflow', 'hidden');    // container should have no overflow\n            //$(this.box).find('.w2ui-sidebar-div').css('overflow', 'hidden');\n            $(this.box).find('> div').css({\n                width        : $(this.box).width() + 'px',\n                height    : $(this.box).height() + 'px'\n            });\n            //$(this.box).find('.w2ui-sidebar-div').css('overflow', 'auto');\n            // event after\n            this.trigger($.extend(eventData, { phase: 'after' }));\n            return (new Date()).getTime() - time;\n        },\n\n        destroy: function () {\n            // event before\n            var eventData = this.trigger({ phase: 'before', type: 'destroy', target: this.name });\n            if (eventData.isCancelled === true) return;\n            // clean up\n            if ($(this.box).find('> div > div.w2ui-sidebar-div').length > 0) {\n                $(this.box)\n                    .removeAttr('name')\n                    .removeClass('w2ui-reset w2ui-sidebar')\n                    .html('');\n            }\n            delete w2ui[this.name];\n            // event after\n            this.trigger($.extend(eventData, { phase: 'after' }));\n        },\n\n        lock: function (msg, showSpinner) {\n            var box = $(this.box).find('> div:first-child');\n            var args = Array.prototype.slice.call(arguments, 0);\n            args.unshift(box);\n            w2utils.lock.apply(window, args);\n        },\n\n        unlock: function () {\n            w2utils.unlock(this.box);\n        }\n    };\n\n    $.extend(w2sidebar.prototype, w2utils.event);\n    w2obj.sidebar = w2sidebar;\n})();\n\n/************************************************************************\n*   Library: Web 2.0 UI for jQuery (using prototypical inheritance)\n*   - Following objects defined\n*        - w2field        - various field controls\n*        - $().w2field    - jQuery wrapper\n*   - Dependencies: jQuery, w2utils\n*\n* == NICE TO HAVE ==\n*   - upload (regular files)\n*   - BUG with prefix/postfix and arrows (test in different contexts)\n*   - prefix and suffix are slow (100ms or so)\n*   - multiple date selection\n*   - month selection, year selections\n*   - arrows no longer work (for int)\n*   - form to support custom types\n*   - bug: if input is hidden and then enum is applied, then when it becomes visible, it will be 110px\n*\n************************************************************************/\n\n(function ($) {\n\n    var w2field = function (options) {\n        // public properties\n        this.el          = null\n        this.helpers     = {}; // object or helper elements\n        this.type        = options.type || 'text';\n        this.options     = $.extend(true, {}, options);\n        this.onSearch    = options.onSearch    || null;\n        this.onRequest   = options.onRequest   || null;\n        this.onLoad      = options.onLoad      || null;\n        this.onError     = options.onError     || null;\n        this.onClick     = options.onClick     || null;\n        this.onAdd       = options.onAdd       || null;\n        this.onNew       = options.onNew       || null;\n        this.onRemove    = options.onRemove    || null;\n        this.onMouseOver = options.onMouseOver || null;\n        this.onMouseOut  = options.onMouseOut  || null;\n        this.onIconClick = options.onIconClick || null;\n        this.tmp         = {}; // temp object\n        // clean up some options\n        delete this.options.type;\n        delete this.options.onSearch;\n        delete this.options.onRequest;\n        delete this.options.onLoad;\n        delete this.options.onError;\n        delete this.options.onClick;\n        delete this.options.onMouseOver;\n        delete this.options.onMouseOut;\n        delete this.options.onIconClick;\n        // extend with defaults\n        $.extend(true, this, w2obj.field);\n    };\n\n    // ====================================================\n    // -- Registers as a jQuery plugin\n\n    $.fn.w2field = function (method, options) {\n        // call direct\n        if (this.length == 0) {\n            var pr = w2field.prototype;\n            if (pr[method]) {\n                return pr[method].apply(pr, Array.prototype.slice.call(arguments, 1));\n            }\n        } else {\n            // if without arguments - return the object\n            if (arguments.length == 0) {\n                var obj = $(this).data('w2field');\n                return obj;\n            }\n            if (typeof method == 'string' && typeof options == 'object') {\n                method = $.extend(true, {}, options, { type: method });\n            }\n            if (typeof method == 'string' && typeof options == 'undefined') {\n                method = { type: method };\n            }\n            method.type = String(method.type).toLowerCase();\n            return this.each(function (index, el) {\n                var obj = $(el).data('w2field');\n                // if object is not defined, define it\n                if (typeof obj == 'undefined') {\n                    var obj = new w2field(method);\n                    $.extend(obj, { handlers: [] });\n                    if (el) obj.el = $(el)[0];\n                    obj.init();\n                    $(el).data('w2field', obj);\n                    return obj;\n                } else { // fully re-init\n                    obj.clear();\n                    if (method.type == 'clear') return;\n                    var obj = new w2field(method);\n                    $.extend(obj, { handlers: [] });\n                    if (el) obj.el = $(el)[0];\n                    obj.init();\n                    $(el).data('w2field', obj);\n                    return obj;\n                }\n                return null;\n            });\n        }\n    }\n\n    // ====================================================\n    // -- Implementation of core functionality\n\n    /*     To add custom types\n        $().w2field('addType', 'myType', function (options) {\n            $(this.el).on('keypress', function (event) {\n                if (event.metaKey || event.ctrlKey || event.altKey\n                    || (event.charCode != event.keyCode && event.keyCode > 0)) return;\n                var ch = String.fromCharCode(event.charCode);\n                if (ch != 'a' && ch != 'b' && ch != 'c') {\n                    if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;\n                    return false;\n                }\n            });\n            $(this.el).on('blur', function (event)  { // keyCode & charCode differ in FireFox\n                var ch = this.value;\n                if (ch != 'a' && ch != 'b' && ch != 'c') {\n                    $(this).w2tag(w2utils.lang(\"Not a single charecter from the set of 'abc'\"));\n                }\n            });\n        });\n    */\n\n    w2field.prototype = {\n\n        custom: {},  // map of custom types\n\n        pallete: [\n            ['000000', '444444', '666666', '999999', 'CCCCCC', 'EEEEEE', 'F3F3F3', 'FFFFFF'],\n            ['FF011B', 'FF9838', 'FFFD59', '01FD55', '00FFFE', '0424F3', '9B24F4', 'FF21F5'],\n            ['F4CCCC', 'FCE5CD', 'FFF2CC', 'D9EAD3', 'D0E0E3', 'CFE2F3', 'D9D1E9', 'EAD1DC'],\n            ['EA9899', 'F9CB9C', 'FEE599', 'B6D7A8', 'A2C4C9', '9FC5E8', 'B4A7D6', 'D5A6BD'],\n            ['E06666', 'F6B26B', 'FED966', '93C47D', '76A5AF', '6FA8DC', '8E7CC3', 'C27BA0'],\n            ['CC0814', 'E69138', 'F1C232', '6AA84F', '45818E', '3D85C6', '674EA7', 'A54D79'],\n            ['99050C', 'B45F17', 'BF901F', '37761D', '124F5C', '0A5394', '351C75', '741B47'],\n            ['660205', '783F0B', '7F6011', '274E12', '0C343D', '063762', '20124D', '4C1030']\n        ],\n\n        addType: function (type, handler) {\n            type = String(type).toLowerCase();\n            this.custom[type] = handler;\n            return true;\n        },\n\n        removeType: function (type) {\n            type = String(type).toLowerCase();\n            if (!this.custom[type]) return false;\n            delete this.custom[type];\n            return true\n        },\n\n        init: function () {\n            var obj     = this;\n            var options = this.options;\n            var defaults;\n\n            // Custom Types\n            if (typeof this.custom[this.type] == 'function') {\n                this.custom[this.type].call(this, options);\n                return;\n            }\n            // only for INPUT or TEXTAREA\n            if (['INPUT', 'TEXTAREA'].indexOf(this.el.tagName) == -1) {\n                console.log('ERROR: w2field could only be applied to INPUT or TEXTAREA.', this.el);\n                return;\n            }\n\n            switch (this.type) {\n                case 'text':\n                case 'int':\n                case 'float':\n                case 'money':\n                case 'currency':\n                case 'percent':\n                case 'alphanumeric':\n                case 'hex':\n                    defaults = {\n                        min                : null,\n                        max                : null,\n                        step               : 1,\n                        placeholder        : '',\n                        autoFormat         : true,\n                        currencyPrefix     : w2utils.settings.currencyPrefix,\n                        currencySuffix     : w2utils.settings.currencySuffix,\n                        currencyPrecision  : w2utils.settings.currencyPrecision,\n                        decimalSymbol      : w2utils.settings.decimalSymbol,\n                        groupSymbol        : w2utils.settings.groupSymbol,\n                        arrows             : false,\n                        keyboard           : true,\n                        precision          : null,\n                        silent             : true,\n                        prefix             : '',\n                        suffix             : ''\n                    };\n                    this.options = $.extend(true, {}, defaults, options);\n                    options = this.options; // since object is re-created, need to re-assign\n                    options.numberRE  = new RegExp('['+ options.groupSymbol + ']', 'g');\n                    options.moneyRE   = new RegExp('['+ options.currencyPrefix + options.currencySuffix + options.groupSymbol +']', 'g');\n                    options.percentRE = new RegExp('['+ options.groupSymbol + '%]', 'g');\n                    // no keyboard support needed\n                    if (['text', 'alphanumeric', 'hex'].indexOf(this.type) != -1) {\n                        options.arrows   = false;\n                        options.keyboard = false;\n                    }\n                    this.addPrefix(); // only will add if needed\n                    this.addSuffix();\n                    if ($(this.el).attr('placeholder') && options.placeholder == '') options.placeholder = $(this.el).attr('placeholder');\n                    $(this.el).attr('placeholder', options.placeholder);\n                    break;\n\n                case 'color':\n                    defaults = {\n                        prefix      : '#',\n                        suffix      : '<div style=\"width: '+ (parseInt($(this.el).css('font-size')) || 12) +'px\">&nbsp;</div>',\n                        placeholder : '',\n                        arrows      : false,\n                        keyboard    : false\n                    };\n                    $.extend(options, defaults);\n                    this.addPrefix();    // only will add if needed\n                    this.addSuffix();    // only will add if needed\n                    // additional checks\n                    $(this.el).attr('maxlength', 6);\n                    if ($(this.el).val() != '') setTimeout(function () { $(obj.el).change(); }, 1);\n                    if ($(this.el).attr('placeholder') && options.placeholder == '') options.placeholder = $(this.el).attr('placeholder');\n                    $(this.el).attr('placeholder', options.placeholder);\n                    break;\n\n                case 'date':\n                    defaults = {\n                        format      : w2utils.settings.date_format, // date format\n                        placeholder : '',\n                        keyboard    : true,\n                        silent      : true,\n                        start       : '',       // string or jquery object\n                        end         : '',       // string or jquery object\n                        blocked     : {},       // { '4/11/2011': 'yes' }\n                        colored     : {}        // { '4/11/2011': 'red:white' }\n                    };\n                    this.options = $.extend(true, {}, defaults, options);\n                    options = this.options; // since object is re-created, need to re-assign\n                    if ($(this.el).attr('placeholder') && options.placeholder == '') options.placeholder = $(this.el).attr('placeholder');\n                    $(this.el).attr('placeholder', options.placeholder ? options.placeholder : options.format);\n                    break;\n\n                case 'time':\n                    defaults = {\n                        format      : w2utils.settings.time_format,\n                        placeholder : '',\n                        keyboard    : true,\n                        silent      : true,\n                        start       : '',\n                        end         : ''\n                    };\n                    this.options = $.extend(true, {}, defaults, options);\n                    options = this.options; // since object is re-created, need to re-assign\n                    if ($(this.el).attr('placeholder') && options.placeholder == '') options.placeholder = $(this.el).attr('placeholder');\n                    $(this.el).attr('placeholder', options.placeholder ? options.placeholder : (options.format == 'h12' ? 'hh:mi pm' : 'hh:mi'));\n                    break;\n\n                case 'datetime':\n                    break;\n\n                case 'list':\n                case 'combo':\n                    defaults = {\n                        items           : [],\n                        selected        : {},\n                        placeholder     : '',\n                        url             : null,         // url to pull data from\n                        postData        : {},\n                        minLength       : 1,\n                        cacheMax        : 250,\n                        maxDropHeight   : 350,          // max height for drop down menu\n                        match           : 'begins',     // ['contains', 'is', 'begins', 'ends']\n                        silent          : true,\n                        icon            : null,\n                        iconStyle       : '',\n                        onSearch        : null,         // when search needs to be performed\n                        onRequest       : null,         // when request is submitted\n                        onLoad          : null,         // when data is received\n                        onError         : null,         // when data fails to load due to server error or other failure modes\n                        onIconClick     : null,\n                        renderDrop      : null,         // render function for drop down item\n                        prefix          : '',\n                        suffix          : '',\n                        openOnFocus     : false,        // if to show overlay onclick or when typing\n                        markSearch      : false\n                    };\n                    options.items = this.normMenu(options.items); // need to be first\n                    if (this.type == 'list') {\n                        // defaults.search = (options.items && options.items.length >= 10 ? true : false);\n                        defaults.openOnFocus = true;\n                        defaults.suffix = '<div class=\"arrow-down\" style=\"margin-top: '+ ((parseInt($(this.el).height()) - 6) / 2) +'px;\"></div>';\n                        $(this.el).addClass('w2ui-select');\n                        // if simple value - look it up\n                        if (!$.isPlainObject(options.selected)) {\n                            for (var i in options.items) {\n                                var item = options.items[i];\n                                if (item && item.id == options.selected) {\n                                    options.selected = $.extend(true, {}, item);\n                                    break;\n                                }\n                            }\n                        }\n                    }\n                    options = $.extend({}, defaults, options, {\n                        align   : 'both',      // same width as control\n                        altRows : true         // alternate row color\n                    });\n                    this.options = options;\n                    if (!$.isPlainObject(options.selected)) options.selected = {};\n                    $(this.el).data('selected', options.selected);\n                    if (options.url) this.request(0);\n                    if (this.type == 'list') this.addFocus();\n                    this.addPrefix();\n                    this.addSuffix();\n                    setTimeout(function () { obj.refresh(); }, 10); // need this for icon refresh\n                    if ($(this.el).attr('placeholder') && options.placeholder == '') options.placeholder = $(this.el).attr('placeholder');\n                    $(this.el).attr('placeholder', options.placeholder).attr('autocomplete', 'off');\n                    if (typeof options.selected.text != 'undefined') $(this.el).val(options.selected.text);\n                    break;\n\n                case 'enum':\n                    defaults = {\n                        items           : [],\n                        selected        : [],\n                        placeholder     : '',\n                        max             : 0,             // max number of selected items, 0 - unlim\n                        url             : null,          // not implemented\n                        postData        : {},\n                        minLength       : 1, \n                        cacheMax        : 250,\n                        maxWidth        : 250,           // max width for a single item\n                        maxHeight       : 350,           // max height for input control to grow\n                        maxDropHeight   : 350,           // max height for drop down menu\n                        match           : 'contains',    // ['contains', 'is', 'begins', 'ends']\n                        silent          : true,\n                        openOnFocus     : false,         // if to show overlay onclick or when typing\n                        markSearch      : true,\n                        renderDrop      : null,          // render function for drop down item\n                        renderItem      : null,          // render selected item\n                        style           : '',            // style for container div\n                        onSearch        : null,          // when search needs to be performed\n                        onRequest       : null,          // when request is submitted\n                        onLoad          : null,          // when data is received\n                        onError         : null,          // when data fails to load due to server error or other failure modes\n                        onClick         : null,          // when an item is clicked\n                        onAdd           : null,          // when an item is added\n                        onNew           : null,          // when new item should be added\n                        onRemove        : null,          // when an item is removed\n                        onMouseOver     : null,          // when an item is mouse over\n                        onMouseOut      : null           // when an item is mouse out\n                    };\n                    options = $.extend({}, defaults, options, {\n                        align    : 'both',    // same width as control\n                        suffix   : '',\n                        altRows  : true       // alternate row color\n                    });\n                    options.items      = this.normMenu(options.items);\n                    options.selected = this.normMenu(options.selected);\n                    this.options = options;\n                    if (!$.isArray(options.selected)) options.selected = [];\n                    $(this.el).data('selected', options.selected);\n                    if (options.url) this.request(0);\n                    this.addSuffix();\n                    this.addMulti();\n                    break;\n\n                case 'file':\n                    defaults = {\n                        selected      : [],\n                        placeholder   : w2utils.lang('Attach files by dragging and dropping or Click to Select'),\n                        max           : 0,\n                        maxSize       : 0,        // max size of all files, 0 - unlim\n                        maxFileSize   : 0,        // max size of a single file, 0 -unlim\n                        maxWidth      : 250,      // max width for a single item\n                        maxHeight     : 350,      // max height for input control to grow\n                        maxDropHeight : 350,      // max height for drop down menu\n                        silent        : true,\n                        renderItem    : null,     // render selected item\n                        style         : '',       // style for container div\n                        onClick       : null,     // when an item is clicked\n                        onAdd         : null,     // when an item is added\n                        onRemove      : null,     // when an item is removed\n                        onMouseOver   : null,     // when an item is mouse over\n                        onMouseOut    : null      // when an item is mouse out\n                    };\n                    options = $.extend({}, defaults, options, {\n                        align         : 'both',   // same width as control\n                        altRows        : true     // alternate row color\n                    });\n                    this.options = options;\n                    if (!$.isArray(options.selected)) options.selected = [];\n                    $(this.el).data('selected', options.selected);\n                    if ($(this.el).attr('placeholder')) options.placeholder = $(this.el).attr('placeholder');\n                    this.addMulti();\n                    break;\n            }\n            // attach events\n            this.tmp = {\n                onChange    : function (event) { obj.change.call(obj, event) },\n                onClick     : function (event) { obj.click.call(obj, event) },\n                onFocus     : function (event) { obj.focus.call(obj, event) },\n                onBlur      : function (event) { obj.blur.call(obj, event) },\n                onKeydown   : function (event) { obj.keyDown.call(obj, event) },\n                onKeyup     : function (event) { obj.keyUp.call(obj, event) },\n                onKeypress  : function (event) { obj.keyPress.call(obj, event) }\n            }\n            $(this.el)\n                .addClass('w2field')\n                .data('w2field', this)\n                .on('change',   this.tmp.onChange)\n                .on('click',    this.tmp.onClick)         // ignore click because it messes overlays\n                .on('focus',    this.tmp.onFocus)\n                .on('blur',     this.tmp.onBlur)\n                .on('keydown',  this.tmp.onKeydown)\n                .on('keyup',    this.tmp.onKeyup)\n                .on('keypress', this.tmp.onKeypress)\n                .css({\n                    'box-sizing'         : 'border-box',\n                    '-webkit-box-sizing' : 'border-box',\n                    '-moz-box-sizing'    : 'border-box',\n                    '-ms-box-sizing'     : 'border-box',\n                    '-o-box-sizing'      : 'border-box'\n                });\n            // format initial value\n            this.change($.Event('change'));\n        },\n\n        clear: function () {\n            var obj        = this;\n            var options    = this.options;\n            // if money then clear value\n            if (['money', 'currency'].indexOf(this.type) != -1) {\n                $(this.el).val($(this.el).val().replace(options.moneyRE, ''));\n            }\n            if (this.type == 'percent') {\n                $(this.el).val($(this.el).val().replace(/%/g, ''));\n            }\n            if (this.type == 'color') {\n                $(this.el).removeAttr('maxlength');\n            }\n            if (this.type == 'list') {\n                $(this.el).removeClass('w2ui-select');\n            }\n            if (['date', 'time'].indexOf(this.type) != -1) {\n                if ($(this.el).attr('placeholder') == options.format) $(this.el).attr('placeholder', '');\n            }\n            this.type = 'clear';\n            var tmp = $(this.el).data('tmp');\n            if (!this.tmp) return;\n            // restore paddings\n            if (typeof tmp != 'undefined') {\n                if (tmp && tmp['old-padding-left'])  $(this.el).css('padding-left',  tmp['old-padding-left']);\n                if (tmp && tmp['old-padding-right']) $(this.el).css('padding-right', tmp['old-padding-right']);\n            }\n            // remove events and data\n            $(this.el)\n                .val(this.clean($(this.el).val()))\n                .removeClass('w2field')\n                .removeData() // removes all attached data\n                .off('change',   this.tmp.onChange)\n                .off('click',    this.tmp.onClick)\n                .off('focus',    this.tmp.onFocus)\n                .off('blur',     this.tmp.onBlur)\n                .off('keydown',  this.tmp.onKeydown)\n                .off('keyup',    this.tmp.onKeyup)\n                .off('keypress', this.tmp.onKeypress);\n            // remove helpers\n            for (var h in this.helpers) $(this.helpers[h]).remove();\n            this.helpers = {};\n        },\n\n        refresh: function () {\n            var obj       = this;\n            var options   = this.options;\n            var selected  = $(this.el).data('selected');\n            var time      = (new Date()).getTime();\n            // enum\n            if (['list'].indexOf(this.type) != -1) {\n                $(obj.el).parent().css('white-space', 'nowrap'); // needs this for arrow alway to appear on the right side\n                // hide focus and show text\n                if (obj.helpers.prefix) obj.helpers.prefix.hide();\n                setTimeout(function () {\n                    if (!obj.helpers.focus) return;\n                    // if empty show no icon\n                    if (!$.isEmptyObject(selected) && options.icon) {\n                        options.prefix = '<span class=\"w2ui-icon '+ options.icon +'\"style=\"cursor: pointer; font-size: 14px;' + \n                                         ' display: inline-block; margin-top: -1px; color: #7F98AD;'+ options.iconStyle +'\">'+\n                            '</span>';\n                        obj.addPrefix();                        \n                    } else {\n                        options.prefix = '';\n                        obj.addPrefix();\n                    }\n                    // focus helpder\n                    var focus = obj.helpers.focus.find('input');\n                    if ($(focus).val() == '') {\n                        $(focus).css('opacity', 0).prev().css('opacity', 0);\n                        $(obj.el).val(selected && selected.text != null ? selected.text : '');\n                        $(obj.el).attr('placeholder', options.placeholder || '');\n                    } else {\n                        $(focus).css('opacity', 1).prev().css('opacity', 1);\n                        $(obj.el).val('');\n                        $(obj.el).removeAttr('placeholder');\n                        setTimeout(function () {\n                            if (obj.helpers.prefix) obj.helpers.prefix.hide(); \n                            var tmp = 'position: absolute; opacity: 0; margin: 4px 0px 0px 2px; background-position: left !important;';\n                            if (options.icon) {\n                                $(focus).css('margin-left', '17px');\n                                $(obj.helpers.focus).find('.icon-search').attr('style', tmp + 'width: 11px !important; opacity: 1');\n                            } else {\n                                $(focus).css('margin-left', '0px');\n                                $(obj.helpers.focus).find('.icon-search').attr('style', tmp + 'width: 0px !important; opacity: 0');\n                            }\n                        }, 1);\n                    }\n                    // if readonly or disabled\n                    if ($(obj.el).prop('readonly') || $(obj.el).prop('disabled')) {\n                        setTimeout(function () { \n                            $(obj.helpers.prefix).css('opacity', '0.6'); \n                            $(obj.helpers.suffix).css('opacity', '0.6');\n                        }, 1);\n                    } else {\n                        setTimeout(function () { \n                            $(obj.helpers.prefix).css('opacity', '1'); \n                            $(obj.helpers.suffix).css('opacity', '1');\n                        }, 1);\n                    }\n                }, 1);\n            }\n            if (['enum', 'file'].indexOf(this.type) != -1) {\n                var html = '';\n                for (var s in selected) {\n                    var it  = selected[s];\n                    var ren = '';\n                    if (typeof options.renderItem == 'function') {\n                        ren = options.renderItem(it, s, '<div class=\"w2ui-list-remove\" title=\"'+ w2utils.lang('Remove') +'\" index=\"'+ s +'\">&nbsp;&nbsp;</div>');\n                    } else {\n                        ren = '<div class=\"w2ui-list-remove\" title=\"'+ w2utils.lang('Remove') +'\" index=\"'+ s +'\">&nbsp;&nbsp;</div>'+\n                              (obj.type == 'enum' ? it.text : it.name + '<span class=\"file-size\"> - '+ w2utils.size(it.size) +'</span>');\n                    }\n                    html += '<li index=\"'+ s +'\" style=\"max-width: '+ parseInt(options.maxWidth) + 'px; '+ (it.style ? it.style : '') +'\">'+\n                            ren +'</li>';\n                }\n                var div = obj.helpers.multi;\n                var ul  = div.find('ul');\n                div.attr('style', div.attr('style') + ';' + options.style);\n                if ($(obj.el).prop('readonly') || $(obj.el).prop('disabled')) {\n                    div.addClass('w2ui-readonly'); \n                    div.css('pointer-events', 'none').find('li').css('opacity', '0.6');\n                    $(obj.helpers.multi).find('input').prop('readonly', true);                    \n                } else {\n                    div.removeClass('w2ui-readonly');\n                    div.css('pointer-events', 'auto').find('li').css('opacity', '1');\n                    $(obj.helpers.multi).find('input').prop('readonly', false);\n                }\n                // celan\n                div.find('.w2ui-enum-placeholder').remove();\n                ul.find('li').not('li.nomouse').remove();\n                // add new list\n                if (html != '') {\n                    ul.prepend(html);\n                } else if (typeof options.placeholder != 'undefined') {\n                    var style =\n                        'padding-top: ' + $(this.el).css('padding-top') + ';'+\n                        'padding-left: ' + $(this.el).css('padding-left') + '; ' +\n                        'box-sizing: ' + $(this.el).css('box-sizing') + '; ' +\n                        'line-height: ' + $(this.el).css('line-height') + '; ' +\n                        'font-size: ' + $(this.el).css('font-size') + '; ' +\n                        'font-family: ' + $(this.el).css('font-family') + '; ';\n                    div.prepend('<div class=\"w2ui-enum-placeholder\" style=\"'+ style +'\">'+ options.placeholder + '</div>');\n                }\n                // ITEMS events\n                div.find('li')\n                    .data('mouse', 'out')\n                    .on('click', function (event) {\n                        var item = selected[$(event.target).attr('index')];\n                        if ($(event.target).hasClass('nomouse')) return;\n                        event.stopPropagation();\n                        // trigger event\n                        var eventData = obj.trigger({ phase: 'before', type: 'click', target: obj.el, originalEvent: event.originalEvent, item: item });\n                        if (eventData.isCancelled === true) return;\n                        // default behavior\n                        if ($(event.target).hasClass('w2ui-list-remove')) {\n                            if ($(obj.el).attr('readonly') || $(obj.el).attr('disabled')) return;\n                            // trigger event\n                            var eventData = obj.trigger({ phase: 'before', type: 'remove', target: obj.el, originalEvent: event.originalEvent, item: item });\n                            if (eventData.isCancelled === true) return;\n                            // default behavior\n                            $().w2overlay();\n                            selected.splice($(event.target).attr('index'), 1);\n                            $(obj.el).trigger('change');\n                            $(event.target).parent().fadeOut('fast');\n                            setTimeout(function () {\n                                obj.refresh();\n                                // event after\n                                obj.trigger($.extend(eventData, { phase: 'after' }));\n                            }, 300);\n                        }\n                        if (obj.type == 'file' && !$(event.target).hasClass('w2ui-list-remove')) {\n                            var preview = '';\n                            if ((/image/i).test(item.type)) { // image\n                                preview = '<div style=\"padding: 3px;\">'+\n                                    '    <img src=\"'+ (item.content ? 'data:'+ item.type +';base64,'+ item.content : '') +'\" style=\"max-width: 300px;\" '+\n                                    '        onload=\"var w = $(this).width(); var h = $(this).height(); '+\n                                    '            if (w < 300 & h < 300) return; '+\n                                    '            if (w >= h && w > 300) $(this).width(300);'+\n                                    '            if (w < h && h > 300) $(this).height(300);\"'+\n                                    '        onerror=\"this.style.display = \\'none\\'\"'+\n                                    '    >'+\n                                    '</div>';\n                            }\n                            var td1 = 'style=\"padding: 3px; text-align: right; color: #777;\"';\n                            var td2 = 'style=\"padding: 3px\"';\n                            preview += '<div style=\"padding: 8px;\">'+\n                                '    <table cellpadding=\"2\">'+\n                                '    <tr><td '+ td1 +'>'+ w2utils.lang('Name') +':</td><td '+ td2 +'>'+ item.name +'</td></tr>'+\n                                '    <tr><td '+ td1 +'>'+ w2utils.lang('Size') +':</td><td '+ td2 +'>'+ w2utils.size(item.size) +'</td></tr>'+\n                                '    <tr><td '+ td1 +'>'+ w2utils.lang('Type') +':</td><td '+ td2 +'>' +\n                                '        <span style=\"width: 200px; display: block-inline; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;\">'+ item.type +'</span>'+\n                                '    </td></tr>'+\n                                '    <tr><td '+ td1 +'>'+ w2utils.lang('Modified') +':</td><td '+ td2 +'>'+ w2utils.date(item.modified) +'</td></tr>'+\n                                '    </table>'+\n                                '</div>';\n                                $(event.target).w2overlay(preview);\n                        }\n                        // event after\n                        obj.trigger($.extend(eventData, { phase: 'after' }));\n                    })\n                    .on('mouseover', function (event) {\n                        var tmp = event.target;\n                        if (tmp.tagName != 'LI') tmp = tmp.parentNode;\n                        if ($(tmp).hasClass('nomouse')) return;\n                        if ($(tmp).data('mouse') == 'out') {\n                            var item = selected[$(tmp).attr('index')];\n                            // trigger event\n                            var eventData = obj.trigger({ phase: 'before', type: 'mouseOver', target: obj.el, originalEvent: event.originalEvent, item: item });\n                            if (eventData.isCancelled === true) return;\n                            // event after\n                            obj.trigger($.extend(eventData, { phase: 'after' }));\n                        }\n                        $(tmp).data('mouse', 'over');\n                    })\n                    .on('mouseout', function (event) {\n                        var tmp = event.target;\n                        if (tmp.tagName != 'LI') tmp = tmp.parentNode;\n                        if ($(tmp).hasClass('nomouse')) return;\n                        $(tmp).data('mouse', 'leaving');\n                        setTimeout(function () {\n                            if ($(tmp).data('mouse') == 'leaving') {\n                                $(tmp).data('mouse', 'out');\n                                var item = selected[$(tmp).attr('index')];\n                                // trigger event\n                                var eventData = obj.trigger({ phase: 'before', type: 'f', target: obj.el, originalEvent: event.originalEvent, item: item });\n                                if (eventData.isCancelled === true) return;\n                                // event after\n                                obj.trigger($.extend(eventData, { phase: 'after' }));\n                            }\n                        }, 0);\n                    });\n                // adjust height\n                $(this.el).height('auto');\n                var cntHeight = $(div).find('> div').height() + w2utils.getSize(div, '+height') * 2;\n                if (cntHeight < 26) cntHeight = 26;\n                if (cntHeight > options.maxHeight) cntHeight = options.maxHeight;\n                if (div.length > 0) div[0].scrollTop = 1000;\n                var inpHeight = w2utils.getSize($(this.el), 'height') - 2;\n                if (inpHeight > cntHeight) cntHeight = inpHeight\n                $(div).css({ 'height': cntHeight + 'px', overflow: (cntHeight == options.maxHeight ? 'auto' : 'hidden') });\n                if (cntHeight < options.maxHeight) $(div).prop('scrollTop', 0);\n                $(this.el).css({ 'height' : (cntHeight + 2) + 'px' });\n            }\n            return (new Date()).getTime() - time;\n        },\n\n        reset: function () {\n            var obj  = this;\n            var type = this.type;\n            this.clear();\n            this.type = type;\n            this.init();\n        },\n\n        clean: function (val) {\n            var options = this.options;\n            val = String(val).trim();\n            // clean\n            if (['int', 'float', 'money', 'currency', 'percent'].indexOf(this.type) != -1) {\n                if (typeof val == 'string') val = val.replace(options.decimalSymbol, '.');\n                if (options.autoFormat && ['money', 'currency'].indexOf(this.type) != -1) val = String(val).replace(options.moneyRE, '');\n                if (options.autoFormat && this.type == 'percent') val = String(val).replace(options.percentRE, '');\n                if (options.autoFormat && ['int', 'float'].indexOf(this.type) != -1) val = String(val).replace(options.numberRE, '');\n                if (parseFloat(val) == val) {\n                    if (options.min !== null && val < options.min) { val = options.min; $(this.el).val(options.min); }\n                    if (options.max !== null && val > options.max) { val = options.max; $(this.el).val(options.max); }\n                }\n                if (val !== '' && w2utils.isFloat(val)) val = Number(val); else val = '';\n            }\n            return val;\n        },\n\n        format: function (val) {\n            var options = this.options;\n            // autoformat numbers or money\n            if (options.autoFormat && val != '') {\n                switch (this.type) {\n                    case 'money':\n                    case 'currency':\n                        val = w2utils.formatNumber(Number(val).toFixed(options.currencyPrecision), options.groupSymbol);\n                        if (val != '') val = options.currencyPrefix + val + options.currencySuffix;\n                        break;\n                    case 'percent':\n                        val = w2utils.formatNumber(options.precision ? Number(val).toFixed(options.precision) : val, options.groupSymbol);\n                        if (val != '') val += '%';\n                        break;\n                    case 'float':\n                        val = w2utils.formatNumber(options.precision ? Number(val).toFixed(options.precision) : val, options.groupSymbol);\n                        break;\n                    case 'int':\n                        val = w2utils.formatNumber(val, options.groupSymbol);\n                        break;\n                }\n            }\n            return val;\n        },\n\n        change: function (event) {\n            var obj     = this;\n            var options = obj.options;\n            // numeric\n            if (['int', 'float', 'money', 'currency', 'percent'].indexOf(this.type) != -1) {\n                // check max/min\n                var val     =  $(this.el).val();\n                var new_val = this.format(this.clean($(this.el).val()));\n                // if was modified\n                if (val != '' && val != new_val) {\n                    $(this.el).val(new_val).change();\n                    // cancel event\n                    event.stopPropagation();\n                    event.preventDefault();\n                    return false;\n                }\n            }\n            // color\n            if (this.type == 'color') {\n                var color = '#' + $(this.el).val();\n                if ($(this.el).val().length != 6 && $(this.el).val().length != 3) color = '';\n                $(this.el).next().find('div').css('background-color', color);\n                if ($(obj.el).is(':focus')) this.updateOverlay();\n            }\n            // list, enum\n            if (['list', 'enum', 'file'].indexOf(this.type) != -1) {\n                obj.refresh();\n                // need time out to show icon indent properly\n                setTimeout(function () { obj.refresh(); }, 5); \n            }\n            // date, time\n            if (['date', 'time'].indexOf(this.type) != -1) {\n                // convert linux timestamps\n                var tmp = parseInt(obj.el.value);\n                if (w2utils.isInt(obj.el.value) && tmp > 3000) {\n                    if (this.type == 'time') $(obj.el).val(w2utils.formatTime(new Date(tmp), options.format)).change();\n                    if (this.type == 'date') $(obj.el).val(w2utils.formatDate(new Date(tmp), options.format)).change();\n                }\n            }\n        },\n\n        click: function (event) {\n            event.stopPropagation();\n            // lists\n            if (['list', 'combo', 'enum'].indexOf(this.type) != -1) {\n                if (!$(this.el).is(':focus')) this.focus(event);\n            }\n            // other fields with drops\n            if (['date', 'time', 'color'].indexOf(this.type) != -1) {\n                this.updateOverlay();\n            }\n        },\n\n        focus: function (event) {\n            var obj     = this;\n            var options = this.options;\n            // color, date, time\n            if (['color', 'date', 'time'].indexOf(obj.type) !== -1) {\n                if ($(obj.el).attr('readonly') || $(obj.el).attr('disabled')) return;\n                if ($(\"#w2ui-overlay\").length > 0) $('#w2ui-overlay')[0].hide();\n                setTimeout(function () { obj.updateOverlay(); }, 150);\n            }\n            // menu\n            if (['list', 'combo', 'enum'].indexOf(obj.type) != -1) {\n                if ($(obj.el).attr('readonly') || $(obj.el).attr('disabled')) return;\n                if ($(\"#w2ui-overlay\").length > 0) $('#w2ui-overlay')[0].hide();\n                setTimeout(function () {\n                    if (obj.type == 'list' && $(obj.el).is(':focus')) {\n                        $(obj.helpers.focus).find('input').focus();\n                        return;\n                    }\n                    obj.search();\n                    setTimeout(function () { obj.updateOverlay(); }, 1);\n                }, 1);\n            }\n            // file\n            if (obj.type == 'file') {\n                $(obj.helpers.multi).css({ 'outline': 'auto 5px #7DB4F3', 'outline-offset': '-2px' });\n            }\n        },\n\n        blur: function (event) {\n            var obj     = this;\n            var options = obj.options;\n            var val     = $(obj.el).val().trim();\n            // hide overlay\n            if (['color', 'date', 'time', 'list', 'combo', 'enum'].indexOf(obj.type) != -1) {\n                if ($(\"#w2ui-overlay\").length > 0) $('#w2ui-overlay')[0].hide();\n            }\n            if (['int', 'float', 'money', 'currency', 'percent'].indexOf(obj.type) != -1) {\n                if (val !== '' && !obj.checkType(val)) {\n                    $(obj.el).val('').change();\n                    if (options.silent === false) {\n                        $(obj.el).w2tag('Not a valid number');\n                        setTimeout(function () { $(obj.el).w2tag(''); }, 3000);\n                    }\n                }\n            }\n            // date or time\n            if (['date', 'time'].indexOf(obj.type) != -1) {\n                // check if in range\n                if (val !== '' && !obj.inRange(obj.el.value)) {\n                    $(obj.el).val('').removeData('selected').change();\n                    if (options.silent === false) {\n                        $(obj.el).w2tag('Not in range');\n                        setTimeout(function () { $(obj.el).w2tag(''); }, 3000);\n                    }\n                } else {\n                    if (obj.type == 'date' && val !== '' && !w2utils.isDate(obj.el.value, options.format)) {\n                        $(obj.el).val('').removeData('selected').change();\n                        if (options.silent === false) {\n                            $(obj.el).w2tag('Not a valid date');\n                            setTimeout(function () { $(obj.el).w2tag(''); }, 3000);\n                        }\n                    }\n                    if (obj.type == 'time' && val !== '' && !w2utils.isTime(obj.el.value)) {\n                        $(obj.el).val('').removeData('selected').change();\n                        if (options.silent === false) {\n                            $(obj.el).w2tag('Not a valid time');\n                            setTimeout(function () { $(obj.el).w2tag(''); }, 3000);\n                        }\n                    }\n                }\n            }\n            // clear search input\n            if (obj.type == 'enum') {\n                $(obj.helpers.multi).find('input').val('').width(20);\n            }\n            // file\n            if (obj.type == 'file') {\n                $(obj.helpers.multi).css({ 'outline': 'none' });\n            }\n        },\n\n        keyPress: function (event) {\n            var obj     = this;\n            var options = obj.options;\n            // ignore wrong pressed key\n            if (['int', 'float', 'money', 'currency', 'percent', 'hex', 'color', 'alphanumeric'].indexOf(obj.type) != -1) {\n                // keyCode & charCode differ in FireFox\n                if (event.metaKey || event.ctrlKey || event.altKey || (event.charCode != event.keyCode && event.keyCode > 0)) return;\n                var ch = String.fromCharCode(event.charCode);\n                if (!obj.checkType(ch, true) && event.keyCode != 13) {\n                    event.preventDefault();\n                    if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;\n                    return false;\n                }\n            }\n            // update date popup\n            if (['date', 'time'].indexOf(obj.type) != -1) {\n                setTimeout(function () { obj.updateOverlay(); }, 1);\n            }\n        },\n\n        keyDown: function (event, extra) {\n            var obj     = this;\n            var options = obj.options;\n            var key     = event.keyCode || (extra && extra.keyCode);\n            // numeric\n            if (['int', 'float', 'money', 'currency', 'percent'].indexOf(obj.type) != -1) {\n                if (!options.keyboard || $(obj.el).attr('readonly')) return;\n                var cancel = false;\n                var val = parseFloat($(obj.el).val().replace(options.moneyRE, '')) || 0;\n                var inc = options.step;\n                if (event.ctrlKey || event.metaKey) inc = 10;\n                switch (key) {\n                    case 38: // up\n                        if (event.shiftKey) break; // no action if shift key is pressed\n                        $(obj.el).val((val + inc <= options.max || options.max === null ? Number((val + inc).toFixed(12)) : options.max)).change();\n                        cancel = true;\n                        break;\n                    case 40: // down\n                        if (event.shiftKey) break; // no action if shift key is pressed\n                        $(obj.el).val((val - inc >= options.min || options.min === null ? Number((val - inc).toFixed(12)) : options.min)).change();\n                        cancel = true;\n                        break;\n                }\n                if (cancel) {\n                    event.preventDefault();\n                    setTimeout(function () {\n                        // set cursor to the end\n                        obj.el.setSelectionRange(obj.el.value.length, obj.el.value.length);\n                    }, 0);\n                }\n            }\n            // date\n            if (obj.type == 'date') {\n                if (!options.keyboard || $(obj.el).attr('readonly')) return;\n                var cancel  = false;\n                var daymil  = 24*60*60*1000;\n                var inc        = 1;\n                if (event.ctrlKey || event.metaKey) inc = 10;\n                var dt = w2utils.isDate($(obj.el).val(), options.format, true);\n                if (!dt) { dt = new Date(); daymil = 0; }\n                switch (key) {\n                    case 38: // up\n                        if (event.shiftKey) break; // no action if shift key is pressed\n                        var newDT = w2utils.formatDate(dt.getTime() + daymil, options.format);\n                        if (inc == 10) newDT = w2utils.formatDate(new Date(dt.getFullYear(), dt.getMonth()+1, dt.getDate()), options.format);\n                        $(obj.el).val(newDT).change();\n                        cancel = true;\n                        break;\n                    case 40: // down\n                        if (event.shiftKey) break; // no action if shift key is pressed\n                        var newDT = w2utils.formatDate(dt.getTime() - daymil, options.format);\n                        if (inc == 10) newDT = w2utils.formatDate(new Date(dt.getFullYear(), dt.getMonth()-1, dt.getDate()), options.format);\n                        $(obj.el).val(newDT).change();\n                        cancel = true;\n                        break;\n                }\n                if (cancel) {\n                    event.preventDefault();\n                    setTimeout(function () {\n                        // set cursor to the end\n                        obj.el.setSelectionRange(obj.el.value.length, obj.el.value.length);\n                        obj.updateOverlay();\n                    }, 0);\n                }\n            }\n            // time\n            if (obj.type == 'time') {\n                if (!options.keyboard || $(obj.el).attr('readonly')) return;\n                var cancel  = false;\n                var inc     = (event.ctrlKey || event.metaKey ? 60 : 1);\n                var val     = $(obj.el).val();\n                var time    = obj.toMin(val) || obj.toMin((new Date()).getHours() + ':' + ((new Date()).getMinutes() - 1));\n                switch (key) {\n                    case 38: // up\n                        if (event.shiftKey) break; // no action if shift key is pressed\n                        time += inc;\n                        cancel = true;\n                        break;\n                    case 40: // down\n                        if (event.shiftKey) break; // no action if shift key is pressed\n                        time -= inc;\n                        cancel = true;\n                        break;\n                }\n                if (cancel) {\n                    $(obj.el).val(obj.fromMin(time)).change();\n                    event.preventDefault();\n                    setTimeout(function () {\n                        // set cursor to the end\n                        obj.el.setSelectionRange(obj.el.value.length, obj.el.value.length);\n                    }, 0);\n                }\n            }\n            // color\n            if (obj.type == 'color') {\n                if ($(obj.el).attr('readonly')) return;\n                // paste\n                if (event.keyCode == 86 && (event.ctrlKey || event.metaKey)) {\n                    $(obj.el).prop('maxlength', 7);\n                    setTimeout(function () {\n                        var val = $(obj).val();\n                        if (val.substr(0, 1) == '#') val = val.substr(1);\n                        if (!w2utils.isHex(val)) val = '';\n                        $(obj).val(val).prop('maxlength', 6).change();\n                    }, 20);\n                }\n                if ((event.ctrlKey || event.metaKey) && !event.shiftKey) {\n                    if (typeof obj.tmp.cind1 == 'undefined') {\n                        obj.tmp.cind1 = -1;\n                        obj.tmp.cind2 = -1;\n                    } else {\n                        switch (key) {\n                            case 38: // up\n                                obj.tmp.cind1--;\n                                break;\n                            case 40: // down\n                                obj.tmp.cind1++;\n                                break;\n                            case 39: // right\n                                obj.tmp.cind2++;\n                                break;\n                            case 37: // left\n                                obj.tmp.cind2--;\n                                break;\n                        }\n                        if (obj.tmp.cind1 < 0) obj.tmp.cind1 = 0;\n                        if (obj.tmp.cind1 > this.pallete.length - 1) obj.tmp.cind1 = this.pallete.length - 1;\n                        if (obj.tmp.cind2 < 0) obj.tmp.cind2 = 0;\n                        if (obj.tmp.cind2 > this.pallete[0].length - 1) obj.tmp.cind2 = this.pallete[0].length - 1;\n                    }\n                    if ([37, 38, 39, 40].indexOf(key) != -1) {\n                        $(obj.el).val(this.pallete[obj.tmp.cind1][obj.tmp.cind2]).change();\n                        event.preventDefault();\n                    }\n                }\n            }\n            // list/select/combo\n            if (['list', 'combo', 'enum'].indexOf(obj.type) != -1) {\n                if ($(obj.el).attr('readonly')) return;\n                var cancel    = false;\n                var selected  = $(obj.el).data('selected');\n                var focus     = $(obj.helpers.focus).find('input');\n                if (obj.type == 'list') {\n                    if ([37, 38, 39, 40].indexOf(key) == -1) obj.refresh(); // arrows\n                }\n                // apply arrows\n                switch (key) {\n                    case 27: // escape\n                        if (obj.type == 'list') {\n                            if ($(focus).val() != '') $(focus).val('');\n                            event.stopPropagation(); // escape in field should not close popup\n                        }\n                        break;\n                    case 37: // left\n                    case 39: // right\n                        // cancel = true;\n                        break;\n                    case 13: // enter\n                        if ($('#w2ui-overlay').length == 0) break; // no action if overlay not open\n                        var item  = options.items[options.index];\n                        var multi = $(obj.helpers.multi).find('input');\n                        if (obj.type == 'enum') {\n                            if (item != null) {\n                                // trigger event\n                                var eventData = obj.trigger({ phase: 'before', type: 'add', target: obj.el, originalEvent: event.originalEvent, item: item });\n                                if (eventData.isCancelled === true) return;\n                                item = eventData.item; // need to reassign because it could be recreated by user\n                                // default behavior\n                                if (selected.length >= options.max && options.max > 0) selected.pop();\n                                delete item.hidden;\n                                delete obj.tmp.force_open;\n                                selected.push(item);\n                                $(obj.el).change();\n                                multi.val('').width(20);\n                                obj.refresh();\n                                // event after\n                                obj.trigger($.extend(eventData, { phase: 'after' }));\n                            } else {\n                                // trigger event\n                                item = { id: multi.val(), text: multi.val() }\n                                var eventData = obj.trigger({ phase: 'before', type: 'new', target: obj.el, originalEvent: event.originalEvent, item: item });\n                                if (eventData.isCancelled === true) return;\n                                item = eventData.item; // need to reassign because it could be recreated by user\n                                // default behavior\n                                if (typeof obj.onNew == 'function') {\n                                    if (selected.length >= options.max && options.max > 0) selected.pop();\n                                    delete obj.tmp.force_open;\n                                    selected.push(item);\n                                    $(obj.el).change();\n                                    multi.val('').width(20);\n                                    obj.refresh();\n                                }\n                                // event after\n                                obj.trigger($.extend(eventData, { phase: 'after' }));\n                            }\n                        } else {\n                            if (item) $(obj.el).data('selected', item).val(item.text).change();\n                            if ($(obj.el).val() == '' && $(obj.el).data('selected')) $(obj.el).removeData('selected').val('').change();\n                            if (obj.type == 'list') {\n                                focus.val('');\n                                obj.refresh();\n                            }\n                            // hide overlay\n                            obj.tmp.force_hide = true;\n                        }\n                        break;\n                    case 8:  // backspace\n                    case 46: // delete\n                        if (obj.type == 'enum' && key == 8) {\n                            if ($(obj.helpers.multi).find('input').val() == '' && selected.length > 0) {\n                                var item = selected[selected.length - 1];\n                                // trigger event\n                                var eventData = obj.trigger({ phase: 'before', type: 'remove', target: obj.el, originalEvent: event.originalEvent, item: item });\n                                if (eventData.isCancelled === true) return;\n                                // default behavior\n                                selected.pop();\n                                $(obj.el).trigger('change');\n                                obj.refresh();\n                                // event after\n                                obj.trigger($.extend(eventData, { phase: 'after' }));\n                            }\n                        }\n                        if (obj.type == 'list' && $(focus).val() == '') {\n                            $(obj.el).data('selected', {}).change();\n                            obj.refresh();\n                        }\n                        break;\n                    case 38: // up\n                        options.index = w2utils.isInt(options.index) ? parseInt(options.index) : 0;\n                        options.index--;\n                        while (options.index > 0 && options.items[options.index].hidden) options.index--;\n                        if (options.index == 0 && options.items[options.index].hidden) {\n                            while (options.items[options.index] && options.items[options.index].hidden) options.index++;\n                        }\n                        cancel = true;\n                        break;\n                    case 40: // down\n                        options.index = w2utils.isInt(options.index) ? parseInt(options.index) : -1;\n                        options.index++;\n                        while (options.index < options.items.length-1 && options.items[options.index].hidden) options.index++;\n                        if (options.index == options.items.length-1 && options.items[options.index].hidden) {\n                            while (options.items[options.index] && options.items[options.index].hidden) options.index--;\n                        }\n                        // show overlay if not shown\n                        var input = obj.el;\n                        if (['enum'].indexOf(obj.type) != -1) input = obj.helpers.multi.find('input');\n                        if ($(input).val() == '' && $('#w2ui-overlay').length == 0) {\n                            obj.tmp.force_open = true;\n                        } else {\n                            cancel = true;\n                        }\n                        break;\n                }\n                if (cancel) {\n                    if (options.index < 0) options.index = 0;\n                    if (options.index >= options.items.length) options.index = options.items.length -1;\n                    obj.updateOverlay();\n                    // cancel event\n                    event.preventDefault();\n                    setTimeout(function () {\n                        // set cursor to the end\n                        if (obj.type == 'enum') {\n                            var tmp = obj.helpers.multi.find('input').get(0);\n                            tmp.setSelectionRange(tmp.value.length, tmp.value.length);\n                        } else if (obj.type == 'list') {\n                            var tmp = obj.helpers.focus.find('input').get(0);\n                            tmp.setSelectionRange(tmp.value.length, tmp.value.length);\n                        } else {\n                            obj.el.setSelectionRange(obj.el.value.length, obj.el.value.length);\n                        }\n                    }, 0);\n                    return;\n                }\n                // expand input\n                if (obj.type == 'enum') {\n                    var input  = obj.helpers.multi.find('input');\n                    var search = input.val();\n                    input.width(((search.length + 2) * 8) + 'px');\n                }\n                // run search\n                if ([16, 17, 18, 20, 37, 39, 91].indexOf(key) == -1) { // no refreah on crtl, shift, left/right arrows, etc\n                    setTimeout(function () {\n                        if (!obj.tmp.force_hide) obj.request();\n                        obj.search();\n                    }, 1);\n                }\n            }\n        },\n\n        keyUp: function (event) {\n            if (this.type == 'color') {\n                if (event.keyCode == 86 && (event.ctrlKey || event.metaKey)) $(this).prop('maxlength', 6);\n            }\n        },\n\n        clearCache: function () {\n            var options          = this.options;\n            options.items        = [];\n            this.tmp.xhr_loading = false;\n            this.tmp.xhr_search  = '';\n            this.tmp.xhr_total   = -1;\n            this.search();\n        },\n\n        request: function (interval) {\n            var obj      = this;\n            var options  = this.options;\n            var search   = $(obj.el).val() || '';\n            // if no url - do nothing\n            if (!options.url) return;\n            // --\n            if (obj.type == 'enum') {\n                var tmp = $(obj.helpers.multi).find('input');\n                if (tmp.length == 0) search = ''; else search = tmp.val();\n            }\n            if (obj.type == 'list') {\n                var tmp = $(obj.helpers.focus).find('input');\n                if (tmp.length == 0) search = ''; else search = tmp.val();\n            }\n            if (options.minLength != 0 && search.length < options.minLength) {\n                options.items = []; // need to empty the list\n                this.updateOverlay();\n                return;\n            }\n            if (typeof interval == 'undefined') interval = 350;\n            if (typeof obj.tmp.xhr_search == 'undefined') obj.tmp.xhr_search = '';\n            if (typeof obj.tmp.xhr_total == 'undefined') obj.tmp.xhr_total = -1;\n            // check if need to search\n            if (options.url && $(obj.el).prop('readonly') != true && (\n                    (options.items.length === 0 && obj.tmp.xhr_total !== 0) ||\n                    (obj.tmp.xhr_total == options.cacheMax && search.length > obj.tmp.xhr_search.length) ||\n                    (search.length >= obj.tmp.xhr_search.length && search.substr(0, obj.tmp.xhr_search.length) != obj.tmp.xhr_search) ||\n                    (search.length < obj.tmp.xhr_search.length)\n                )) {\n                // empty list\n                obj.tmp.xhr_loading = true;\n                obj.search();\n                // timeout\n                clearTimeout(obj.tmp.timeout);\n                obj.tmp.timeout = setTimeout(function () {\n                    // trigger event\n                    var url      = options.url;\n                    var postData = {\n                        search : search,\n                        max    : options.cacheMax\n                    };\n                    $.extend(postData, options.postData);\n                    var eventData = obj.trigger({ phase: 'before', type: 'request', target: obj.el, url: url, postData: postData });\n                    if (eventData.isCancelled === true) return;\n                    url      = eventData.url;\n                    postData = eventData.postData;\n                    // console.log('REMOTE SEARCH:', search);\n                    if (obj.tmp.xhr) obj.tmp.xhr.abort();\n                    var ajaxOptions = {\n                        type     : 'GET',\n                        url      : url,\n                        data     : postData,\n                        dataType : 'JSON' // expected from server\n                    };\n                    if (w2utils.settings.dataType == 'JSON') {\n                        ajaxOptions.type        = 'POST';\n                        ajaxOptions.data        = JSON.stringify(ajaxOptions.data);\n                        ajaxOptions.contentType = 'application/json';\n                    }\n                    obj.tmp.xhr = $.ajax(ajaxOptions)\n                        .done(function (data, status, xhr) {\n                            // trigger event\n                            var eventData2 = obj.trigger({ phase: 'before', type: 'load', target: obj.el, search: postData.search, data: data, xhr: xhr });\n                            if (eventData2.isCancelled === true) return;\n                            // default behavior\n                            data = eventData2.data;\n                            if (typeof data == 'string') data = JSON.parse(data);\n                            if (data.status != 'success') {\n                                console.log('ERROR: server did not return proper structure. It should return', { status: 'success', items: [{ id: 1, text: 'item' }] });\n                                return;\n                            }\n                            // remove all extra items if more then needed for cache\n                            if (data.items.length > options.cacheMax) data.items.splice(options.cacheMax, 100000);\n                            // remember stats\n                            obj.tmp.xhr_loading = false;\n                            obj.tmp.xhr_search  = search;\n                            obj.tmp.xhr_total   = data.items.length;\n                            options.items       = obj.normMenu(data.items);\n                            if (search == '' && data.items.length == 0) obj.tmp.emptySet = true; else obj.tmp.emptySet = false;\n                            obj.search();\n                            // console.log('-->', 'retrieved:', obj.tmp.xhr_total);\n                            // event after\n                            obj.trigger($.extend(eventData2, { phase: 'after' }));\n                        })\n                        .fail(function (xhr, status, error) {\n                            // trigger event\n                            var errorObj = { status: status, error: error, rawResponseText: xhr.responseText };\n                            var eventData2 = obj.trigger({ phase: 'before', type: 'error', target: obj.el, search: search, error: errorObj, xhr: xhr });\n                            if (eventData2.isCancelled === true) return;\n                            // default behavior\n                            if (status != 'abort') {\n                                var data;\n                                try { data = $.parseJSON(xhr.responseText) } catch (e) {}\n                                console.log('ERROR: Server communication failed.', \n                                    '\\n   EXPECTED:', { status: 'success', items: [{ id: 1, text: 'item' }] }, \n                                    '\\n         OR:', { status: 'error', message: 'error message' },\n                                    '\\n   RECEIVED:', typeof data == 'object' ? data : xhr.responseText);\n                            }\n                            // reset stats\n                            obj.clearCache();\n                            // event after\n                            obj.trigger($.extend(eventData2, { phase: 'after' }));\n                        });\n                    // event after\n                    obj.trigger($.extend(eventData, { phase: 'after' }));\n                }, interval);\n            }\n        },\n\n        search: function () {\n            var obj     = this;\n            var options = this.options;\n            var search  = $(obj.el).val();\n            var target  = obj.el;\n            var ids     = [];\n            var selected= $(obj.el).data('selected');\n            if (obj.type == 'enum') {\n                target = $(obj.helpers.multi).find('input');\n                search = target.val();\n                for (var s in selected) { if (selected[s]) ids.push(selected[s].id); }\n            }\n            if (obj.type == 'list') {\n                target = $(obj.helpers.focus).find('input');\n                search = target.val();\n                for (var s in selected) { if (selected[s]) ids.push(selected[s].id); }\n            }\n            // trigger event\n            var eventData = obj.trigger({ phase: 'before', type: 'search', target: target, search: search });\n            if (eventData.isCancelled === true) return;\n            if (obj.tmp.xhr_loading !== true) {\n                var shown = 0;\n                for (var i in options.items) {\n                    var item = options.items[i];\n                    var prefix = '';\n                    var suffix = '';\n                    if (['is', 'begins'].indexOf(options.match) != -1) prefix = '^';\n                    if (['is', 'ends'].indexOf(options.match) != -1) suffix = '$';\n                    try {\n                        var re = new RegExp(prefix + search + suffix, 'i');\n                        if (re.test(item.text) || item.text == '...') item.hidden = false; else item.hidden = true;\n                    } catch (e) {}\n                    // do not show selected items\n                    if (obj.type == 'enum' && $.inArray(item.id, ids) != -1) item.hidden = true;\n                    if (item.hidden !== true) shown++;\n                }\n                if (obj.type != 'combo') { // don't preselect first for combo\n                    options.index = 0;\n                    while (options.items[options.index] && options.items[options.index].hidden) options.index++;\n                } else {\n                    options.index = -1;\n                }\n                if (shown <= 0) options.index = -1;\n                options.spinner = false;\n                obj.updateOverlay();\n                setTimeout(function () { \n                    var html = $('#w2ui-overlay').html() || '';\n                    if (options.markSearch && html.indexOf('$.fn.w2menuHandler') != -1) { // do not highlight when no items\n                        $('#w2ui-overlay').w2marker(search); \n                    }\n                }, 1);\n            } else {\n                options.items.splice(0, options.cacheMax);\n                options.spinner = true;\n                obj.updateOverlay();\n            }\n            // event after\n            obj.trigger($.extend(eventData, { phase: 'after' }));\n        },\n\n        updateOverlay: function () {\n            var obj     = this;\n            var options = this.options;\n            // color\n            if (this.type == 'color') {\n                if ($(obj.el).attr('readonly')) return;\n                if ($('#w2ui-overlay').length == 0) {\n                    $(obj.el).w2overlay(obj.getColorHTML());\n                } else {\n                    $('#w2ui-overlay').html(obj.getColorHTML());\n                }\n                // bind events\n                $('#w2ui-overlay .color')\n                    .on('mousedown', function (event) {\n                        var color = $(event.originalEvent.target).attr('name');\n                        var index = $(event.originalEvent.target).attr('index').split(':');\n                        obj.tmp.cind1 = index[0];\n                        obj.tmp.cind2 = index[1];\n                        $(obj.el).val(color).change();\n                        $(this).html('&#149;');\n                    })\n                    .on('mouseup', function () {\n                        setTimeout(function () {\n                            if ($(\"#w2ui-overlay\").length > 0) $('#w2ui-overlay').removeData('keepOpen')[0].hide();\n                        }, 10);\n                    });\n            }\n            // date\n            if (this.type == 'date') {\n                if ($(obj.el).attr('readonly')) return;\n                if ($('#w2ui-overlay').length == 0) {\n                    $(obj.el).w2overlay('<div class=\"w2ui-reset w2ui-calendar\" onclick=\"event.stopPropagation();\"></div>', {\n                        css: { \"background-color\": \"#f5f5f5\" }\n                    });\n                }\n                var month, year;\n                var dt = w2utils.isDate($(obj.el).val(), obj.options.format, true);\n                if (dt) { month = dt.getMonth() + 1; year = dt.getFullYear(); }\n                (function refreshCalendar(month, year) {\n                    $('#w2ui-overlay > div > div').html(obj.getMonthHTML(month, year));\n                    $('#w2ui-overlay .w2ui-calendar-title')\n                        .on('mousedown', function () {\n                            if ($(this).next().hasClass('w2ui-calendar-jump')) {\n                                $(this).next().remove();\n                            } else {\n                                var selYear, selMonth;\n                                $(this).after('<div class=\"w2ui-calendar-jump\" style=\"\"></div>');\n                                $(this).next().hide().html(obj.getYearHTML()).fadeIn(200);\n                                setTimeout(function () {\n                                    $('#w2ui-overlay .w2ui-calendar-jump')\n                                        .find('.w2ui-jump-month, .w2ui-jump-year')\n                                        .on('click', function () {\n                                            if ($(this).hasClass('w2ui-jump-month')) {\n                                                $(this).parent().find('.w2ui-jump-month').removeClass('selected');\n                                                $(this).addClass('selected');\n                                                selMonth = $(this).attr('name');\n                                            }\n                                            if ($(this).hasClass('w2ui-jump-year')) {\n                                                $(this).parent().find('.w2ui-jump-year').removeClass('selected');\n                                                $(this).addClass('selected');\n                                                selYear = $(this).attr('name');\n                                            }\n                                            if (selYear != null && selMonth != null) {\n                                                $('#w2ui-overlay .w2ui-calendar-jump').fadeOut(100);\n                                                setTimeout(function () { refreshCalendar(parseInt(selMonth)+1, selYear); }, 100);\n                                            }\n                                        });\n                                    $('#w2ui-overlay .w2ui-calendar-jump >:last-child').prop('scrollTop', 2000);\n                                }, 1);\n                            }\n                        });\n                    $('#w2ui-overlay .w2ui-date')\n                        .on('mousedown', function () {\n                            var day = $(this).attr('date');\n                            $(obj.el).val(day).change();\n                            $(this).css({ 'background-color': '#B6D5FB', 'border-color': '#aaa' });\n                        })\n                        .on('mouseup', function () {\n                            setTimeout(function () {\n                                if ($(\"#w2ui-overlay\").length > 0) $('#w2ui-overlay').removeData('keepOpen')[0].hide();\n                            }, 10);\n                        });\n                    $('#w2ui-overlay .previous').on('mousedown', function () {\n                        var tmp = obj.options.current.split('/');\n                        tmp[0]  = parseInt(tmp[0]) - 1;\n                        refreshCalendar(tmp[0], tmp[1]);\n                    });\n                    $('#w2ui-overlay .next').on('mousedown', function () {\n                        var tmp = obj.options.current.split('/');\n                        tmp[0]  = parseInt(tmp[0]) + 1;\n                        refreshCalendar(tmp[0], tmp[1]);\n                    });\n                }) (month, year);\n            }\n            // date\n            if (this.type == 'time') {\n                if ($(obj.el).attr('readonly')) return;\n                if ($('#w2ui-overlay').length == 0) {\n                    $(obj.el).w2overlay('<div class=\"w2ui-reset w2ui-calendar-time\" onclick=\"event.stopPropagation();\"></div>', {\n                        css: { \"background-color\": \"#fff\" }\n                    });\n                }\n                var h24 = (this.options.format == 'h24' ? true : false);\n                $('#w2ui-overlay > div').html(obj.getHourHTML());\n                $('#w2ui-overlay .w2ui-time')\n                    .on('mousedown', function (event) {\n                        $(this).css({ 'background-color': '#B6D5FB', 'border-color': '#aaa' });\n                        var hour = $(this).attr('hour');\n                        $(obj.el).val((hour > 12 && !h24 ? hour - 12 : hour) + ':00' + (!h24 ? (hour < 12 ? ' am' : ' pm') : '')).change();\n                    })\n                    .on('mouseup', function () {\n                        var hour = $(this).attr('hour');\n                        if ($(\"#w2ui-overlay\").length > 0) $('#w2ui-overlay')[0].hide();\n                        $(obj.el).w2overlay('<div class=\"w2ui-reset w2ui-calendar-time\"></div>', { css: { \"background-color\": \"#fff\" } });\n                        $('#w2ui-overlay > div').html(obj.getMinHTML(hour));\n                        $('#w2ui-overlay .w2ui-time')\n                            .on('mousedown', function () {\n                                $(this).css({ 'background-color': '#B6D5FB', 'border-color': '#aaa' });\n                                var min = $(this).attr('min');\n                                $(obj.el).val((hour > 12 && !h24 ? hour - 12 : hour) + ':' + (min < 10 ? 0 : '') + min + (!h24 ? (hour < 12 ? ' am' : ' pm') : '')).change();\n                            })\n                            .on('mouseup', function () {\n                                setTimeout(function () { if ($(\"#w2ui-overlay\").length > 0) $('#w2ui-overlay').removeData('keepOpen')[0].hide(); }, 10);\n                            });\n                    });\n            }\n            // list\n            if (['list', 'combo', 'enum'].indexOf(this.type) != -1) {\n                var el    = this.el;\n                var input = this.el;\n                if (this.type == 'enum') {\n                    el    = $(this.helpers.multi);\n                    input = $(el).find('input');\n                }\n                if (this.type == 'list') {\n                    input = $(this.helpers.focus).find('input');\n                }\n                if ($(input).is(':focus')) {\n                    if (options.openOnFocus === false && $(input).val() == '' && obj.tmp.force_open !== true) {\n                        $().w2overlay();\n                        return;\n                    }\n                    if (obj.tmp.force_hide) {\n                        $().w2overlay();\n                        setTimeout(function () {\n                            delete obj.tmp.force_hide;\n                        }, 1);                        \n                        return;\n                    }\n                    if ($(input).val() != '') delete obj.tmp.force_open;\n                    if ($('#w2ui-overlay').length == 0) options.index = 0;\n                    var msgNoItems = w2utils.lang('No matches');\n                    if (options.url != null && $(input).val().length < options.minLength && obj.tmp.emptySet !== true) msgNoItems = options.minLength + ' ' + w2utils.lang('letters or more...');\n                    if (options.url != null && $(input).val() == '' && obj.tmp.emptySet !== true) msgNoItems = w2utils.lang('Type to search....');\n                    $(el).w2menu('refresh', $.extend(true, {}, options, {\n                        search     : false,\n                        render     : options.renderDrop,\n                        maxHeight  : options.maxDropHeight,\n                        msgNoItems : msgNoItems,\n                        // selected with mouse\n                        onSelect: function (event) {\n                            if (obj.type == 'enum') {\n                                var selected = $(obj.el).data('selected');\n                                if (event.item) {\n                                    // trigger event\n                                    var eventData = obj.trigger({ phase: 'before', type: 'add', target: obj.el, originalEvent: event.originalEvent, item: event.item });\n                                    if (eventData.isCancelled === true) return;\n                                    // default behavior\n                                    if (selected.length >= options.max && options.max > 0) selected.pop();\n                                    delete event.item.hidden;\n                                    selected.push(event.item);\n                                    $(obj.el).data('selected', selected).change();\n                                    $(obj.helpers.multi).find('input').val('').width(20);\n                                    obj.refresh();\n                                    if ($(\"#w2ui-overlay\").length > 0) $('#w2ui-overlay')[0].hide();\n                                    // event after\n                                    obj.trigger($.extend(eventData, { phase: 'after' }));\n                                }\n                            } else {\n                                $(obj.el).data('selected', event.item).val(event.item.text).change();\n                                if (obj.helpers.focus) obj.helpers.focus.find('input').val('');\n                            }\n                        }\n                    }));\n                }\n            }\n        },\n\n        inRange: function (str) {\n            var inRange = false;\n            if (this.type == 'date') {\n                var dt = w2utils.isDate(str, this.options.format, true);\n                if (dt) {\n                    // enable range\n                    if (this.options.start || this.options.end) {\n                        var st = (typeof this.options.start == 'string' ? this.options.start : $(this.options.start).val());\n                        var en = (typeof this.options.end == 'string' ? this.options.end : $(this.options.end).val());\n                        var start   = w2utils.isDate(st, this.options.format, true);\n                        var end     = w2utils.isDate(en, this.options.format, true);\n                        var current = new Date(dt);\n                        if (!start) start = current;\n                        if (!end) end = current;\n                        if (current >= start && current <= end) inRange = true;\n                    } else {\n                        inRange = true;\n                    }\n                    // block predefined dates\n                    if (this.options.blocked && $.inArray(str, this.options.blocked) != -1) inRange = false;\n                }\n            }\n            if (this.type == 'time') {\n                if (this.options.start || this.options.end) {\n                    var tm  = this.toMin(str);\n                    var tm1 = this.toMin(this.options.start);\n                    var tm2 = this.toMin(this.options.end);\n                    if (!tm1) tm1 = tm;\n                    if (!tm2) tm2 = tm;\n                    if (tm >= tm1 && tm <= tm2) inRange = true;\n                } else {\n                    inRange = true;\n                }\n            }\n            return inRange;\n        },\n\n        /*\n        *  INTERNAL FUNCTIONS\n        */\n\n        checkType: function (ch, loose) {\n            var obj = this;\n            switch (obj.type) {\n                case 'int':\n                    if (loose && ['-', obj.options.groupSymbol].indexOf(ch) != -1) return true;\n                    return w2utils.isInt(ch.replace(obj.options.numberRE, ''));\n                case 'percent':\n                    ch = ch.replace(/%/g, '');\n                case 'float':\n                    if (loose && ['-', w2utils.settings.decimalSymbol, obj.options.groupSymbol].indexOf(ch) != -1) return true;\n                    return w2utils.isFloat(ch.replace(obj.options.numberRE, ''));\n                case 'money':\n                case 'currency':\n                    if (loose && ['-', obj.options.decimalSymbol, obj.options.groupSymbol, obj.options.currencyPrefix, obj.options.currencySuffix].indexOf(ch) != -1) return true;\n                    return w2utils.isFloat(ch.replace(obj.options.moneyRE, ''));\n                case 'hex':\n                case 'color':\n                    return w2utils.isHex(ch);\n                case 'alphanumeric':\n                    return w2utils.isAlphaNumeric(ch);\n            }\n            return true;\n        },\n\n        addPrefix: function () {\n            var obj = this;\n            setTimeout(function () {\n                if (obj.type === 'clear') return;\n                var helper;\n                var tmp = $(obj.el).data('tmp') || {};\n                if (tmp['old-padding-left']) $(obj.el).css('padding-left', tmp['old-padding-left']);\n                tmp['old-padding-left'] = $(obj.el).css('padding-left');\n                $(obj.el).data('tmp', tmp);\n                // remove if already displaed\n                if (obj.helpers.prefix) $(obj.helpers.prefix).remove();\n                if (obj.options.prefix !== '') {\n                    // add fresh\n                    $(obj.el).before(\n                        '<div class=\"w2ui-field-helper\">'+\n                            obj.options.prefix +\n                        '</div>'\n                    );\n                    helper = $(obj.el).prev();\n                    helper\n                        .css({\n                            'color'          : $(obj.el).css('color'),\n                            'font-family'    : $(obj.el).css('font-family'),\n                            'font-size'      : $(obj.el).css('font-size'),\n                            'padding-top'    : $(obj.el).css('padding-top'),\n                            'padding-bottom' : $(obj.el).css('padding-bottom'),\n                            'padding-left'   : $(obj.el).css('padding-left'),\n                            'padding-right'  : 0,\n                            'margin-top'     : (parseInt($(obj.el).css('margin-top'), 10) + 2) + 'px',\n                            'margin-bottom'  : (parseInt($(obj.el).css('margin-bottom'), 10) + 1) + 'px',\n                            'margin-left'    : $(obj.el).css('margin-left'),\n                            'margin-right'   : 0\n                        })\n                        .on('click', function (event) {\n                            if (obj.options.icon && typeof obj.onIconClick == 'function') {\n                                // event before\n                                var eventData = obj.trigger({ phase: 'before', type: 'iconClick', target: obj.el, el: $(this).find('span.w2ui-icon')[0] });\n                                if (eventData.isCancelled === true) return;\n                                \n                                // intentionally empty\n\n                                // event after\n                                obj.trigger($.extend(eventData, { phase: 'after' }));                                \n                            } else {\n                                if (obj.type == 'list') {\n                                    $(obj.helpers.focus).find('input').focus();\n                                } else {\n                                    $(obj.el).focus();\n                                }\n                            }\n                        });\n                    $(obj.el).css('padding-left', (helper.width() + parseInt($(obj.el).css('padding-left'), 10)) + 'px');\n                    // remember helper\n                    obj.helpers.prefix = helper;\n                }\n            }, 1);\n        },\n\n        addSuffix: function () {\n            var obj = this;\n            var helper, pr;\n            setTimeout(function () {\n                if (obj.type === 'clear') return;\n                var tmp = $(obj.el).data('tmp') || {};\n                if (tmp['old-padding-right']) $(obj.el).css('padding-right', tmp['old-padding-right']);\n                tmp['old-padding-right'] = $(obj.el).css('padding-right');\n                $(obj.el).data('tmp', tmp);\n                pr = parseInt($(obj.el).css('padding-right'), 10);\n                if (obj.options.arrows) {\n                    // remove if already displaed\n                    if (obj.helpers.arrows) $(obj.helpers.arrows).remove();\n                    // add fresh\n                    $(obj.el).after(\n                        '<div class=\"w2ui-field-helper\" style=\"border: 1px solid transparent\">&nbsp;'+\n                        '    <div class=\"w2ui-field-up\" type=\"up\">'+\n                        '        <div class=\"arrow-up\" type=\"up\"></div>'+\n                        '    </div>'+\n                        '    <div class=\"w2ui-field-down\" type=\"down\">'+\n                        '        <div class=\"arrow-down\" type=\"down\"></div>'+\n                        '    </div>'+\n                        '</div>');\n                    var height = w2utils.getSize(obj.el, 'height');\n                    helper = $(obj.el).next();\n                    helper.css({\n                            'color'         : $(obj.el).css('color'),\n                            'font-family'   : $(obj.el).css('font-family'),\n                            'font-size'     : $(obj.el).css('font-size'),\n                            'height'        : ($(obj.el).height() + parseInt($(obj.el).css('padding-top'), 10) + parseInt($(obj.el).css('padding-bottom'), 10) ) + 'px',\n                            'padding'       : 0,\n                            'margin-top'    : (parseInt($(obj.el).css('margin-top'), 10) + 1) + 'px',\n                            'margin-bottom' : 0,\n                            'border-left'   : '1px solid silver'\n                        })\n                        .css('margin-left', '-'+ (helper.width() + parseInt($(obj.el).css('margin-right'), 10) + 12) + 'px')\n                        .on('mousedown', function (event) {\n                            $('body').on('mouseup', tmp);\n                            $('body').data('_field_update_timer', setTimeout(update, 700));\n                            update(false);\n                            // timer function\n                            function tmp() {\n                                clearTimeout($('body').data('_field_update_timer'));\n                                $('body').off('mouseup', tmp);\n                            }\n                            // update function\n                            function update(notimer) {\n                                $(obj.el).focus();\n                                obj.keyDown($.Event(\"keydown\"), {\n                                    keyCode : ($(event.target).attr('type') == 'up' ? 38 : 40)\n                                });\n                                if (notimer !== false) $('body').data('_field_update_timer', setTimeout(update, 60));\n                            }\n                        });\n                    pr += helper.width() + 12;\n                    $(obj.el).css('padding-right', pr + 'px');\n                    // remember helper\n                    obj.helpers.arrows = helper;\n                }\n                if (obj.options.suffix !== '') {\n                    // remove if already displaed\n                    if (obj.helpers.suffix) $(obj.helpers.suffix).remove();\n                    // add fresh\n                    $(obj.el).after(\n                        '<div class=\"w2ui-field-helper\">'+\n                            obj.options.suffix +\n                        '</div>');\n                    helper = $(obj.el).next();\n                    helper\n                        .css({\n                            'color'          : $(obj.el).css('color'),\n                            'font-family'    : $(obj.el).css('font-family'),\n                            'font-size'      : $(obj.el).css('font-size'),\n                            'padding-top'    : $(obj.el).css('padding-top'),\n                            'padding-bottom' : $(obj.el).css('padding-bottom'),\n                            'padding-left'   : '3px',\n                            'padding-right'  : $(obj.el).css('padding-right'),\n                            'margin-top'     : (parseInt($(obj.el).css('margin-top'), 10) + 2) + 'px',\n                            'margin-bottom'  : (parseInt($(obj.el).css('margin-bottom'), 10) + 1) + 'px'\n                        })\n                        .on('click', function (event) {\n                            if (obj.type == 'list') {\n                                $(obj.helpers.focus).find('input').focus();\n                            } else {\n                                $(obj.el).focus();\n                            }\n                        });\n\n                    helper.css('margin-left', '-'+ (w2utils.getSize(helper, 'width') + parseInt($(obj.el).css('margin-right'), 10) + 2) + 'px');\n                    pr += helper.width() + 3;\n                    $(obj.el).css('padding-right', pr + 'px');\n                    // remember helper\n                    obj.helpers.suffix = helper;\n                }\n            }, 1);\n        },\n\n        addFocus: function () {\n            var obj      = this;\n            var options  = this.options;\n            var width    = 0; // 11 - show search icon, 0 do not show\n            // clean up & init\n            $(obj.helpers.focus).remove();\n            // remember original tabindex\n            var tabIndex = $(obj.el).attr('tabIndex');\n            if (tabIndex && tabIndex != -1) obj.el._tabIndex = tabIndex;\n            if (obj.el._tabIndex) tabIndex = obj.el._tabIndex;\n            // build helper\n            var html =\n                '<div class=\"w2ui-field-helper\">'+ \n                '    <div class=\"w2ui-icon icon-search\"></div>'+\n                '    <input type=\"text\" autocomplete=\"off\" tabindex=\"'+ tabIndex +'\">'+\n                '<div>';\n            $(obj.el).attr('tabindex', -1).before(html);\n            var helper = $(obj.el).prev();\n            obj.helpers.focus = helper;\n            helper.css({\n                    width           : $(obj.el).width(),\n                    \"margin-top\"    : $(obj.el).css('margin-top'),\n                    \"margin-left\"   : (parseInt($(obj.el).css('margin-left')) + parseInt($(obj.el).css('padding-left'))) + 'px',\n                    \"margin-bottom\" : $(obj.el).css('margin-bottom'),\n                    \"margin-right\"  : $(obj.el).css('margin-right')\n                })\n                .find('input')\n                .css({\n                    cursor   : 'default',\n                    width    : '100%',\n                    outline  : 'none',\n                    opacity  : 1,\n                    margin   : 0,\n                    border   : '1px solid transparent',\n                    padding  : $(obj.el).css('padding-top'),\n                    \"padding-left\"     : 0,\n                    \"margin-left\"      : (width > 0 ? width + 6 : 0),\n                    \"background-color\" : 'transparent'\n                });\n            // INPUT events\n            helper.find('input')\n                .on('click', function (event) {\n                    if ($('#w2ui-overlay').length == 0) obj.focus(event);\n                    event.stopPropagation();\n                })\n                .on('focus', function (event) {\n                    $(obj.el).css({ 'outline': 'auto 5px #7DB4F3', 'outline-offset': '-2px' });\n                    $(this).val('');\n                    $(obj.el).triggerHandler('focus');\n                    if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;\n                })\n                .on('blur', function (event) {\n                    $(obj.el).css('outline', 'none');\n                    $(this).val('');\n                    obj.refresh(); \n                    $(obj.el).triggerHandler('blur');\n                    if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;\n                })\n                .on('keyup',    function (event) { obj.keyUp(event) })\n                .on('keydown',  function (event) { obj.keyDown(event) })\n                .on('keypress', function (event) { obj.keyPress(event); });\n            // MAIN div\n            helper.on('click', function (event) { $(this).find('input').focus(); });\n            obj.refresh();\n        },    \n\n        addMulti: function () {\n            var obj         = this;\n            var options     = this.options;\n            // clean up & init\n            $(obj.helpers.multi).remove();\n            // build helper\n            var html   = '';\n            var margin =\n                'margin-top     : 0px; ' +\n                'margin-bottom  : 0px; ' +\n                'margin-left    : ' + $(obj.el).css('margin-left') + '; ' +\n                'margin-right   : ' + $(obj.el).css('margin-right') + '; '+\n                'width          : ' + (w2utils.getSize(obj.el, 'width')\n                                    - parseInt($(obj.el).css('margin-left'), 10)\n                                    - parseInt($(obj.el).css('margin-right'), 10))\n                                    + 'px;';\n            if (obj.type == 'enum') {\n                html =  '<div class=\"w2ui-field-helper w2ui-list\" style=\"'+ margin + '; box-sizing: border-box\">'+\n                        '    <div style=\"padding: 0px; margin: 0px; margin-right: 20px; display: inline-block\">'+\n                        '    <ul>'+\n                        '        <li style=\"padding-left: 0px; padding-right: 0px\" class=\"nomouse\">'+\n                        '            <input type=\"text\" style=\"width: 20px\" autocomplete=\"off\" '+ ($(obj.el).attr('readonly') ? 'readonly': '') + '>'+\n                        '        </li>'\n                        '    </ul>'+\n                        '    </div>'+\n                        '</div>';\n            }\n            if (obj.type == 'file') {\n                html =  '<div class=\"w2ui-field-helper w2ui-list\" style=\"'+ margin + '; box-sizing: border-box\">'+\n                        '    <div style=\"padding: 0px; margin: 0px; margin-right: 20px; display: inline-block\">'+\n                        '    <ul><li style=\"padding-left: 0px; padding-right: 0px\" class=\"nomouse\"></li></ul>'+\n                        '    <input class=\"file-input\" type=\"file\" name=\"attachment\" multiple style=\"display: none\" tabindex=\"-1\">'\n                        '    </div>'+\n                        '</div>';\n            }\n            $(obj.el)\n                .before(html)\n                .css({\n                    'background-color' : 'transparent',\n                    'border-color'     : 'transparent'\n                });\n\n            var div    = $(obj.el).prev();\n            obj.helpers.multi = div;\n            if (obj.type == 'enum') {\n                $(obj.el).attr('tabindex', -1);\n                // INPUT events\n                div.find('input')\n                    .on('click', function (event) {\n                        if ($('#w2ui-overlay').length == 0) obj.focus(event);\n                        $(obj.el).triggerHandler('click');\n                    })\n                    .on('focus', function (event) {\n                        $(div).css({ 'outline': 'auto 5px #7DB4F3', 'outline-offset': '-2px' });\n                        $(obj.el).triggerHandler('focus');\n                        if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;\n                    })\n                    .on('blur', function (event) {\n                        $(div).css('outline', 'none');\n                        $(obj.el).triggerHandler('blur');\n                        if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;\n                    })\n                    .on('keyup',    function (event) { obj.keyUp(event) })\n                    .on('keydown',  function (event) { obj.keyDown(event) })\n                    .on('keypress', function (event) { div.find('.w2ui-enum-placeholder').remove(); obj.keyPress(event); });\n                // MAIN div\n                div.on('click', function (event) { $(this).find('input').focus(); });\n            }\n            if (obj.type == 'file') {\n                $(obj.el).css('outline', 'none');\n                div.on('click', function (event) {\n                        $(obj.el).focus();\n                        if ($(obj.el).attr('readonly')) return;\n                        obj.blur(event);\n                        div.find('input').click();\n                    })\n                    .on('dragenter', function (event) {\n                        if ($(obj.el).attr('readonly')) return;\n                        $(div).addClass('w2ui-file-dragover');\n                    })\n                    .on('dragleave', function (event) {\n                        if ($(obj.el).attr('readonly')) return;\n                        var tmp = $(event.target).parents('.w2ui-field-helper');\n                        if (tmp.length == 0) $(div).removeClass('w2ui-file-dragover');\n                    })\n                    .on('drop', function (event) {\n                        if ($(obj.el).attr('readonly')) return;\n                        $(div).removeClass('w2ui-file-dragover');\n                        var files = event.originalEvent.dataTransfer.files;\n                        for (var i=0, l=files.length; i<l; i++) obj.addFile.call(obj, files[i]);\n                        // cancel to stop browser behaviour\n                        event.preventDefault();\n                        event.stopPropagation();\n                    })\n                    .on('dragover', function (event) {\n                        // cancel to stop browser behaviour\n                        event.preventDefault();\n                        event.stopPropagation();\n                    });\n                div.find('input')\n                    .on('click', function (event) {\n                        event.stopPropagation();\n                    })\n                    .on('change', function () {\n                        if (typeof this.files !== \"undefined\") {\n                            for (var i = 0, l = this.files.length; i < l; i++) {\n                                obj.addFile.call(obj, this.files[i]);\n                            }\n                        }\n                    });\n            }\n            obj.refresh();\n        },    \n\n        addFile: function (file) {\n            var obj      = this;\n            var options  = this.options;\n            var selected = $(obj.el).data('selected');\n            var newItem  = {\n                name     : file.name,\n                type     : file.type,\n                modified : file.lastModifiedDate,\n                size     : file.size,\n                content  : null\n            };\n            var size = 0;\n            var cnt  = 0;\n            var err;\n            for (var s in selected) { \n                // check for dups\n                if (selected[s].name == file.name && selected[s].size == file.size) return;\n                size += selected[s].size; cnt++; \n            }\n            // trigger event\n            var eventData = obj.trigger({ phase: 'before', type: 'add', target: obj.el, file: newItem, total: cnt, totalSize: size });\n            if (eventData.isCancelled === true) return;\n            // check params\n            if (options.maxFileSize !== 0 && newItem.size > options.maxFileSize) {\n                err = 'Maximum file size is '+ w2utils.size(options.maxFileSize);\n                if (options.silent === false) $(obj.el).w2tag(err);\n                console.log('ERROR: '+ err);\n                return;\n            }\n            if (options.maxSize !== 0 && size + newItem.size > options.maxSize) {\n                err = 'Maximum total size is '+ w2utils.size(options.maxSize);\n                if (options.silent === false) $(obj.el).w2tag(err);\n                console.log('ERROR: '+ err);\n                return;\n            }\n            if (options.max !== 0 && cnt >= options.max) {\n                err = 'Maximum number of files is '+ options.max;\n                if (options.silent === false) $(obj.el).w2tag(err);\n                console.log('ERROR: '+ err);\n                return;\n            }\n            selected.push(newItem);\n            // read file as base64\n            if (typeof FileReader !== \"undefined\") {\n                var reader = new FileReader();\n                // need a closure\n                reader.onload = (function () {\n                    return function (event) {\n                        var fl  = event.target.result;\n                        var ind = fl.indexOf(',');\n                        newItem.content = fl.substr(ind+1);\n                        obj.refresh();\n                        $(obj.el).trigger('change');\n                        // event after\n                        obj.trigger($.extend(eventData, { phase: 'after' }));\n                    };\n                })();\n                reader.readAsDataURL(file);\n            } else {\n                obj.refresh();\n                $(obj.el).trigger('change');\n            }\n        },\n\n        normMenu: function (menu) {\n            if ($.isArray(menu)) {\n                for (var m = 0; m < menu.length; m++) {\n                    if (typeof menu[m] == 'string') {\n                        menu[m] = { id: menu[m], text: menu[m] };\n                    } else {\n                        if (typeof menu[m].text != 'undefined' && typeof menu[m].id == 'undefined') menu[m].id = menu[m].text;\n                        if (typeof menu[m].text == 'undefined' && typeof menu[m].id != 'undefined') menu[m].text = menu[m].id;\n                        if (typeof menu[m].caption != 'undefined') menu[m].text = menu[m].caption;\n                    }\n                }\n                return menu;\n            } else if (typeof menu == 'object') {\n                var tmp = []\n                for (var m in menu) tmp.push({ id: m, text: menu[m] });\n                return tmp;\n            }\n        },\n\n        getColorHTML: function () {\n            var html =  '<div class=\"w2ui-color\">'+\n                        '<table cellspacing=\"5\">';\n            for (var i = 0; i < 8; i++) {\n                html += '<tr>';\n                for (var j = 0; j < 8; j++) {\n                    html += '<td>'+\n                            '    <div class=\"color\" style=\"background-color: #'+ this.pallete[i][j] +';\" name=\"'+ this.pallete[i][j] +'\" index=\"'+ i + ':' + j +'\">'+\n                            '        '+ ($(this.el).val() == this.pallete[i][j] ? '&#149;' : '&nbsp;')+\n                            '    </div>'+\n                            '</td>';\n                }\n                html += '</tr>';\n                if (i < 2) html += '<tr><td style=\"height: 8px\" colspan=\"8\"></td></tr>';\n            }\n            html += '</table></div>';\n            return html;\n        },\n\n        getMonthHTML: function (month, year) {\n            var td         = new Date();\n            var months     = w2utils.settings.fullmonths;\n            var days       = w2utils.settings.fulldays;\n            var daysCount  = ['31', '28', '31', '30', '31', '30', '31', '31', '30', '31', '30', '31'];\n            var today      = td.getFullYear() + '/' + (Number(td.getMonth()) + 1) + '/' + td.getDate();\n            // normalize date\n            year  = w2utils.isInt(year)  ? parseInt(year)  : td.getFullYear();\n            month = w2utils.isInt(month) ? parseInt(month) : td.getMonth() + 1;\n            if (month > 12) { month -= 12; year++; }\n            if (month < 1 || month === 0)  { month += 12; year--; }\n            if (year/4 == Math.floor(year/4)) { daysCount[1] = '29'; } else { daysCount[1] = '28'; }\n            this.options.current = month + '/' + year;\n\n            // start with the required date\n            td = new Date(year, month-1, 1);\n            var weekDay = td.getDay();\n            var tabDays = w2utils.settings.shortdays;\n            var dayTitle = '';\n            for ( var i = 0, len = tabDays.length; i < len; i++) {\n                dayTitle += '<td>' + tabDays[i] + '</td>';\n            }\n            var html  =\n                '<div class=\"w2ui-calendar-title title\">'+\n                '    <div class=\"w2ui-calendar-previous previous\"> <div></div> </div>'+\n                '    <div class=\"w2ui-calendar-next next\"> <div></div> </div> '+\n                        months[month-1] +', '+ year +\n                '</div>'+\n                '<table class=\"w2ui-calendar-days\" cellspacing=\"0\">'+\n                '    <tr class=\"w2ui-day-title\">' + dayTitle + '</tr>'+\n                '    <tr>';\n\n            var day = 1;\n            for (var ci=1; ci<43; ci++) {\n                if (weekDay === 0 && ci == 1) {\n                    for (var ti=0; ti<6; ti++) html += '<td class=\"w2ui-day-empty\">&nbsp;</td>';\n                    ci += 6;\n                } else {\n                    if (ci < weekDay || day > daysCount[month-1]) {\n                        html += '<td class=\"w2ui-day-empty\">&nbsp;</td>';\n                        if ((ci) % 7 === 0) html += '</tr><tr>';\n                        continue;\n                    }\n                }\n                var dt  = year + '/' + month + '/' + day;\n\n                var className = '';\n                if (ci % 7 == 6)  className  = ' w2ui-saturday';\n                if (ci % 7 === 0) className  = ' w2ui-sunday';\n                if (dt == today)  className += ' w2ui-today';\n\n                var dspDay  = day;\n                var col     = '';\n                var bgcol   = '';\n                var tmp_dt  = w2utils.formatDate(dt, this.options.format);\n                if (this.options.colored && this.options.colored[tmp_dt] !== undefined) { // if there is predefined colors for dates\n                    tmp   = this.options.colored[tmp_dt].split(':');\n                    bgcol = 'background-color: ' + tmp[0] + ';';\n                    col   = 'color: ' + tmp[1] + ';';\n                }\n                html += '<td class=\"'+ (this.inRange(tmp_dt) ? 'w2ui-date ' : 'w2ui-blocked') + className + '\" style=\"'+ col + bgcol + '\" date=\"'+ tmp_dt +'\">'+\n                            dspDay +\n                        '</td>';\n                if (ci % 7 === 0 || (weekDay === 0 && ci == 1)) html += '</tr><tr>';\n                day++;\n            }\n            html += '</tr></table>';\n            return html;\n        },\n\n        getYearHTML: function () {\n            var months = w2utils.settings.shortmonths;\n            var mhtml  = '';\n            var yhtml  = '';\n            for (var m in months) {\n                mhtml += '<div class=\"w2ui-jump-month\" name=\"'+ m +'\">'+ months[m] + '</div>';\n            }\n            for (var y = 1950; y <= 2020; y++) {\n                yhtml += '<div class=\"w2ui-jump-year\" name=\"'+ y +'\">'+ y + '</div>'\n            }\n            return '<div>'+ mhtml +'</div><div>'+ yhtml +'</div>';\n        },\n\n        getHourHTML: function () {\n            var tmp = [];\n            var h24 = (this.options.format == 'h24' ? true : false);\n            for (var a=0; a<24; a++) {\n                var time = (a >= 12 && !h24 ? a - 12 : a) + ':00' + (!h24 ? (a < 12 ? ' am' : ' pm') : '');\n                if (a == 12 && !h24) time = '12:00 pm';\n                if (!tmp[Math.floor(a/8)]) tmp[Math.floor(a/8)] = '';\n                var tm1 = this.fromMin(this.toMin(time));\n                var tm2 = this.fromMin(this.toMin(time) + 59);\n                tmp[Math.floor(a/8)] += '<div class=\"'+ (this.inRange(tm1) || this.inRange(tm2) ? 'w2ui-time ' : 'w2ui-blocked') + '\" hour=\"'+ a +'\">'+ time +'</div>';\n            }\n            var html =\n                '<div class=\"w2ui-calendar-time\"><table><tr>'+\n                '    <td>'+ tmp[0] +'</td>' +\n                '    <td>'+ tmp[1] +'</td>' +\n                '    <td>'+ tmp[2] +'</td>' +\n                '</tr></table></div>';\n            return html;\n        },\n\n        getMinHTML: function (hour) {\n            if (typeof hour == 'undefined') hour = 0;\n            var h24 = (this.options.format == 'h24' ? true : false);\n            var tmp = [];\n            for (var a=0; a<60; a+=5) {\n                var time = (hour > 12 && !h24 ? hour - 12 : hour) + ':' + (a < 10 ? 0 : '') + a + ' ' + (!h24 ? (hour < 12 ? 'am' : 'pm') : '');\n                var ind = a < 20 ? 0 : (a < 40 ? 1 : 2);\n                if (!tmp[ind]) tmp[ind] = '';\n                tmp[ind] += '<div class=\"'+ (this.inRange(time) ? 'w2ui-time ' : 'w2ui-blocked') + '\" min=\"'+ a +'\">'+ time +'</div>';\n            }\n            var html =\n                '<div class=\"w2ui-calendar-time\"><table><tr>'+\n                '    <td>'+ tmp[0] +'</td>' +\n                '    <td>'+ tmp[1] +'</td>' +\n                '    <td>'+ tmp[2] +'</td>' +\n                '</tr></table></div>';\n            return html;\n        },\n\n        toMin: function (str) {\n            if (typeof str != 'string') return null;\n            var tmp = str.split(':');\n            if (tmp.length == 2) {\n                tmp[0] = parseInt(tmp[0]);\n                tmp[1] = parseInt(tmp[1]);\n                if (str.indexOf('pm') != -1 && tmp[0] != 12) tmp[0] += 12;\n            } else {\n                return null;\n            }\n            return tmp[0] * 60 + tmp[1];\n        },\n\n        fromMin: function (time) {\n            var ret = '';\n            if (time >= 24 * 60) time = time % (24 * 60);\n            if (time < 0) time = 24 * 60 + time;\n            var hour = Math.floor(time/60);\n            var min  = ((time % 60) < 10 ? '0' : '') + (time % 60);\n            if (this.options.format.indexOf('h24') != -1) {\n                ret = hour + ':' + min;\n            } else {\n                ret = (hour <= 12 ? hour : hour - 12) + ':' + min + ' ' + (hour >= 12 ? 'pm' : 'am');\n            }\n            return ret;\n        }\n    }\n\n    $.extend(w2field.prototype, w2utils.event);\n    w2obj.field = w2field;\n\n}) (jQuery);\n\n/************************************************************************\n*   Library: Web 2.0 UI for jQuery (using prototypical inheritance)\n*   - Following objects defined\n*        - w2form      - form widget\n*        - $().w2form  - jQuery wrapper\n*   - Dependencies: jQuery, w2utils, w2fields, w2tabs, w2toolbar, w2alert\n*\n* == NICE TO HAVE ==\n*   - refresh(field) - would refresh only one field\n*   - include delta on save\n*   - create an example how to do cascadic dropdown\n*   - form should read <select> <options> into items\n*   - two way data bindings\n*   - verify validation of fields\n*   - when field is blank, set record.field = null\n*   - show/hide a field\n*   - added getChanges() - not complete\n*\n************************************************************************/\n\n\n(function () {\n    var w2form = function(options) {\n        // public properties\n        this.name      = null;\n        this.header    = '';\n        this.box       = null;     // HTML element that hold this element\n        this.url       = '';\n        this.routeData = {};       // data for dynamic routes\n        this.formURL   = '';       // url where to get form HTML\n        this.formHTML  = '';       // form HTML (might be loaded from the url)\n        this.page      = 0;        // current page\n        this.recid     = 0;        // can be null or 0\n        this.fields    = [];\n        this.actions   = {};\n        this.record    = {};\n        this.original  = {};\n        this.postData  = {};\n        this.toolbar   = {};       // if not empty, then it is toolbar\n        this.tabs      = {};       // if not empty, then it is tabs object\n\n        this.style         = '';\n        this.focus         = 0;    // focus first or other element\n        this.msgNotJSON    = w2utils.lang('Return data is not in JSON format.');\n        this.msgAJAXerror  = w2utils.lang('AJAX error. See console for more details.');\n        this.msgRefresh    = w2utils.lang('Refreshing...');\n        this.msgSaving     = w2utils.lang('Saving...');\n\n        // events\n        this.onRequest   = null;\n        this.onLoad      = null;\n        this.onValidate  = null;\n        this.onSubmit    = null;\n        this.onSave      = null;\n        this.onChange    = null;\n        this.onRender    = null;\n        this.onRefresh   = null;\n        this.onResize    = null;\n        this.onDestroy   = null;\n        this.onAction    = null;\n        this.onToolbar   = null;\n        this.onError     = null;\n\n        // internal\n        this.isGenerated = false;\n        this.last = {\n            xhr: null        // jquery xhr requests\n        }\n\n        $.extend(true, this, w2obj.form, options);\n    };\n\n    // ====================================================\n    // -- Registers as a jQuery plugin\n\n    $.fn.w2form = function(method) {\n        if (typeof method === 'object' || !method ) {\n            var obj = this;\n            // check name parameter\n            if (!w2utils.checkName(method, 'w2form')) return;\n            // remember items\n            var record   = method.record;\n            var original = method.original;\n            var fields   = method.fields;\n            var toolbar  = method.toolbar;\n            var tabs     = method.tabs;\n            // extend items\n            var object = new w2form(method);\n            $.extend(object, { record: {}, original: {}, fields: [], tabs: {}, toolbar: {}, handlers: [] });\n            if ($.isArray(tabs)) {\n                $.extend(true, object.tabs, { tabs: [] });\n                for (var t in tabs) {\n                    var tmp = tabs[t];\n                    if (typeof tmp === 'object') object.tabs.tabs.push(tmp); else object.tabs.tabs.push({ id: tmp, caption: tmp });\n                }\n            } else {\n                $.extend(true, object.tabs, tabs);\n            }\n            $.extend(true, object.toolbar, toolbar);\n            // reassign variables\n            for (var p in fields) {\n                var field = $.extend(true, {}, fields[p]);\n                if (typeof field.name == 'undefined' && typeof field.field != 'undefined') field.name = field.field;\n                if (typeof field.field == 'undefined' && typeof field.name != 'undefined') field.field = field.name;\n                object.fields[p] = field;\n            }\n            for (var p in record) {\n                if ($.isPlainObject(record[p])) {\n                    object.record[p] = $.extend(true, {}, record[p]);\n                } else {\n                    object.record[p] = record[p];\n                }\n            }\n            for (var p in original) {\n                if ($.isPlainObject(original[p])) {\n                    object.original[p] = $.extend(true, {}, original[p]);\n                } else {\n                    object.original[p] = original[p];\n                }\n            }\n            if (obj.length > 0) object.box = obj[0];\n            // render if necessary\n            if (object.formURL != '') {\n                $.get(object.formURL, function (data) { // should always be $.get as it is template\n                    object.formHTML = data;\n                    object.isGenerated = true;\n                    if ($(object.box).length != 0 || data.length != 0) {\n                        $(object.box).html(data);\n                        object.render(object.box);\n                    }\n                });\n            } else if (object.formHTML != '') {\n                // it is already loaded into formHTML\n            } else if ($(this).length != 0 && $.trim($(this).html()) != '') {\n                object.formHTML = $(this).html();\n            }  else { // try to generate it\n                object.formHTML = object.generateHTML();\n            }\n            // register new object\n            w2ui[object.name] = object;\n            // render if not loaded from url\n            if (object.formURL == '') {\n                if (String(object.formHTML).indexOf('w2ui-page') == -1) {\n                    object.formHTML = '<div class=\"w2ui-page page-0\">'+ object.formHTML +'</div>';\n                }\n                $(object.box).html(object.formHTML);\n                object.isGenerated = true;\n                object.render(object.box);\n            }\n            return object;\n\n        } else if (w2ui[$(this).attr('name')]) {\n            var obj = w2ui[$(this).attr('name')];\n            obj[method].apply(obj, Array.prototype.slice.call(arguments, 1));\n            return this;\n        } else {\n            console.log('ERROR: Method ' +  method + ' does not exist on jQuery.w2form');\n        }\n    };\n\n    // ====================================================\n    // -- Implementation of core functionality\n\n    w2form.prototype = {\n\n        get: function (field, returnIndex) {\n            if (arguments.length === 0) {\n                var all = [];\n                for (var f1 in this.fields) {\n                    if (this.fields[f1].name != null) all.push(this.fields[f1].name);\n                }\n                return all;\n            } else {\n                for (var f2 in this.fields) {\n                    if (this.fields[f2].name == field) {\n                        if (returnIndex === true) return f2; else return this.fields[f2];\n                    }\n                }\n                return null;\n            }\n        },\n\n        set: function (field, obj) {\n            for (var f in this.fields) {\n                if (this.fields[f].name == field) {\n                    $.extend(this.fields[f] , obj);\n                    this.refresh();\n                    return true;\n                }\n            }\n            return false;\n        },\n\n        reload: function (callBack) {\n            var url = (typeof this.url != 'object' ? this.url : this.url.get);\n            if (url && this.recid != 0) {\n                // this.clear();\n                this.request(callBack);\n            } else {\n                // this.refresh(); // no need to refresh\n                if (typeof callBack == 'function') callBack();\n            }\n        },\n\n        clear: function () {\n            this.recid  = 0;\n            this.record = {};\n            $().w2tag();\n            this.refresh();\n        },\n\n        error: function (msg) {\n            var obj = this;\n            // let the management of the error outside of the grid\n            var eventData = this.trigger({ target: this.name, type: 'error', message: msg , xhr: this.last.xhr });\n            if (eventData.isCancelled === true) {\n                if (typeof callBack == 'function') callBack();\n                return;\n            }\n            // need a time out because message might be already up)\n            setTimeout(function () { w2alert(msg, 'Error');    }, 1);\n            // event after\n            this.trigger($.extend(eventData, { phase: 'after' }));\n        },\n\n        validate: function (showErrors) {\n            if (typeof showErrors == 'undefined') showErrors = true;\n            $().w2tag(); // hide all tags before validating\n            // validate before saving\n            var errors = [];\n            for (var f in this.fields) {\n                var field = this.fields[f];\n                if (this.record[field.name] == null) this.record[field.name] = '';\n                switch (field.type) {\n                    case 'int':\n                        if (this.record[field.name] && !w2utils.isInt(this.record[field.name])) {\n                            errors.push({ field: field, error: w2utils.lang('Not an integer') });\n                        }\n                        break;\n                    case 'float':\n                        if (this.record[field.name] && !w2utils.isFloat(this.record[field.name])) {\n                            errors.push({ field: field, error: w2utils.lang('Not a float') });\n                        }\n                        break;\n                    case 'money':\n                        if (this.record[field.name] && !w2utils.isMoney(this.record[field.name])) {\n                            errors.push({ field: field, error: w2utils.lang('Not in money format') });\n                        }\n                        break;\n                    case 'color':\n                    case 'hex':\n                        if (this.record[field.name] && !w2utils.isHex(this.record[field.name])) {\n                            errors.push({ field: field, error: w2utils.lang('Not a hex number') });\n                        }\n                        break;\n                    case 'email':\n                        if (this.record[field.name] && !w2utils.isEmail(this.record[field.name])) {\n                            errors.push({ field: field, error: w2utils.lang('Not a valid email') });\n                        }\n                        break;\n                    case 'checkbox':\n                        // convert true/false\n                        if (this.record[field.name] == true) this.record[field.name] = 1; else this.record[field.name] = 0;\n                        break;\n                    case 'date':\n                        // format date before submit\n                        if (!field.options.format) field.options.format = w2utils.settings.date_format;\n                        if (this.record[field.name] && !w2utils.isDate(this.record[field.name], field.options.format)) {\n                            errors.push({ field: field, error: w2utils.lang('Not a valid date') + ': ' + field.options.format });\n                        } else {\n                        }\n                        break;\n                    case 'list':\n                    case 'combo':\n                        break;\n                    case 'enum':\n                        break;\n                }\n                // === check required - if field is '0' it should be considered not empty\n                var val = this.record[field.name];\n                if (field.required && (val === '' || ($.isArray(val) && val.length == 0) || ($.isPlainObject(val) && $.isEmptyObject(val)))) {\n                    errors.push({ field: field, error: w2utils.lang('Required field') });\n                }\n                if (field.equalto && this.record[field.name] != this.record[field.equalto]) {\n                    errors.push({ field: field, error: w2utils.lang('Field should be equal to ') + field.equalto });\n                }\n            }\n            // event before\n            var eventData = this.trigger({ phase: 'before', target: this.name, type: 'validate', errors: errors });\n            if (eventData.isCancelled === true) return;\n            // show error\n            if (showErrors) for (var e in eventData.errors) {\n                var err = eventData.errors[e];\n                if (err.field.type == 'radio') { // for radio and checkboxes\n                    $($(err.field.el).parents('div')[0]).w2tag(err.error, { \"class\": 'w2ui-error' });\n                } else if (['enum', 'file'].indexOf(err.field.type) != -1) {\n                    (function (err) {\n                        setTimeout(function () {\n                            var fld = $(err.field.el).data('w2field').helpers.multi;\n                            $(err.field.el).w2tag(err.error);\n                            $(fld).addClass('w2ui-error');\n                        }, 1);\n                    })(err);\n                } else {\n                    $(err.field.el).w2tag(err.error, { \"class\": 'w2ui-error' });\n                }\n                this.goto(errors[0].field.page);                \n            }\n            // event after\n            this.trigger($.extend(eventData, { phase: 'after' }));\n            return errors;\n        },\n\n        getChanges: function () {\n            var differ = function(record, original, result) {\n                for (var i in record) {\n                    if (typeof record[i] == \"object\") {\n                        result[i] = differ(record[i], original[i] || {}, {});\n                        if (!result[i] || $.isEmptyObject(result[i])) delete result[i];\n                    } else if (record[i] != original[i]) {\n                        result[i] = record[i];\n                    }\n                }\n                return result;\n            }\n            return differ(this.record, this.original, {});\n        },\n\n        request: function (postData, callBack) { // if (1) param then it is call back if (2) then postData and callBack\n            var obj = this;\n            // check for multiple params\n            if (typeof postData == 'function') {\n                callBack = postData;\n                postData = null;\n            }\n            if (typeof postData == 'undefined' || postData == null) postData = {};\n            if (!this.url || (typeof this.url == 'object' && !this.url.get)) return;\n            if (this.recid == null || typeof this.recid == 'undefined') this.recid = 0;\n            // build parameters list\n            var params = {};\n            // add list params\n            params['cmd']   = 'get-record';\n            params['recid'] = this.recid;\n            // append other params\n            $.extend(params, this.postData);\n            $.extend(params, postData);\n            // event before\n            var eventData = this.trigger({ phase: 'before', type: 'request', target: this.name, url: this.url, postData: params });\n            if (eventData.isCancelled === true) { if (typeof callBack == 'function') callBack({ status: 'error', message: 'Request aborted.' }); return; }\n            // default action\n            this.record   = {};\n            this.original = {};\n            // call server to get data\n            this.lock(this.msgRefresh);\n            var url = eventData.url;\n            if (typeof eventData.url == 'object' && eventData.url.get) url = eventData.url.get;\n            if (this.last.xhr) try { this.last.xhr.abort(); } catch (e) {};\n            // process url with routeData\n            if (!$.isEmptyObject(obj.routeData)) {\n                var info  = w2utils.parseRoute(url);\n                if (info.keys.length > 0) {\n                    for (var k = 0; k < info.keys.length; k++) {\n                        if (obj.routeData[info.keys[k].name] == null) continue;\n                        url = url.replace((new RegExp(':'+ info.keys[k].name, 'g')), obj.routeData[info.keys[k].name]);\n                    }\n                }\n            }\n            var ajaxOptions = {\n                type     : 'POST',\n                url      : url,\n                data     : eventData.postData, \n                dataType : 'text'   // expected from server\n            };\n            if (w2utils.settings.dataType == 'HTTP') {\n                ajaxOptions.data = String($.param(ajaxOptions.data, false)).replace(/%5B/g, '[').replace(/%5D/g, ']');\n            }\n            if (w2utils.settings.dataType == 'RESTFULL') {\n                ajaxOptions.type = 'GET';\n                ajaxOptions.data = String($.param(ajaxOptions.data, false)).replace(/%5B/g, '[').replace(/%5D/g, ']');\n            }\n            if (w2utils.settings.dataType == 'JSON') {\n                ajaxOptions.type        = 'POST';\n                ajaxOptions.data        = JSON.stringify(ajaxOptions.data);\n                ajaxOptions.contentType = 'application/json';\n            }\n            this.last.xhr = $.ajax(ajaxOptions)\n                .done(function (data, status, xhr) {\n                    obj.unlock();\n                    // event before\n                    var eventData = obj.trigger({ phase: 'before', target: obj.name, type: 'load', xhr: xhr });\n                    if (eventData.isCancelled === true) {\n                        if (typeof callBack == 'function') callBack({ status: 'error', message: 'Request aborted.' });\n                        return;\n                    }\n                    // parse server response\n                    var data;\n                    var responseText = obj.last.xhr.responseText;\n                    if (status != 'error') {\n                        // default action\n                        if (typeof responseText != 'undefined' && responseText != '') {\n                            // check if the onLoad handler has not already parsed the data\n                            if (typeof responseText == \"object\") {\n                                data = responseText;\n                            } else {\n                                // $.parseJSON or $.getJSON did not work because those expect perfect JSON data - where everything is in double quotes\n                                //\n                                // TODO: avoid (potentially malicious) code injection from the response.\n                                try { eval('data = '+ responseText); } catch (e) { }\n                            }\n                            if (typeof data == 'undefined') {\n                                data = {\n                                    status       : 'error',\n                                    message      : obj.msgNotJSON,\n                                    responseText : responseText\n                                }\n                            }\n                            if (data['status'] == 'error') {\n                                obj.error(data['message']);\n                            } else {\n                                obj.record   = $.extend({}, data.record);\n                                obj.original = $.extend({}, data.record);\n                            }\n                        }\n                    } else {\n                        obj.error('AJAX Error ' + xhr.status + ': '+ xhr.statusText);\n                        data = {\n                            status       : 'error',\n                            message      : obj.msgAJAXerror,\n                            responseText : responseText\n                        };\n                    }\n                    // event after\n                    obj.trigger($.extend(eventData, { phase: 'after' }));\n                    obj.refresh();\n                    // call back\n                    if (typeof callBack == 'function') callBack(data);\n                })\n                .fail(function (xhr, status, error) {\n                    // trigger event\n                    var errorObj = { status: status, error: error, rawResponseText: xhr.responseText };\n                    var eventData2 = obj.trigger({ phase: 'before', type: 'error', error: errorObj, xhr: xhr });\n                    if (eventData2.isCancelled === true) return;\n                    // default behavior\n                    if (status != 'abort') {\n                        var data;\n                        try { data = $.parseJSON(xhr.responseText) } catch (e) {}\n                        console.log('ERROR: Server communication failed.', \n                            '\\n   EXPECTED:', { status: 'success', items: [{ id: 1, text: 'item' }] }, \n                            '\\n         OR:', { status: 'error', message: 'error message' },\n                            '\\n   RECEIVED:', typeof data == 'object' ? data : xhr.responseText);\n                    }\n                    // event after\n                    obj.trigger($.extend(eventData2, { phase: 'after' }));\n                });\n            // event after\n            this.trigger($.extend(eventData, { phase: 'after' }));\n        },\n\n        submit: function (postData, callBack) {\n            return this.save(postData, callBack);\n        },\n\n        save: function (postData, callBack) {\n            var obj = this;\n            $(this.box).find(':focus').change(); // trigger onchange\n            // check for multiple params\n            if (typeof postData == 'function') {\n                callBack = postData;\n                postData = null;\n            }\n            // validation\n            var errors = obj.validate(true);\n            if (errors.length !== 0) return;\n            // submit save\n            if (typeof postData == 'undefined' || postData == null) postData = {};\n            if (!obj.url || (typeof obj.url == 'object' && !obj.url.save)) {\n                console.log(\"ERROR: Form cannot be saved because no url is defined.\");\n                return;\n            }\n            obj.lock(obj.msgSaving + ' <span id=\"'+ obj.name +'_progress\"></span>');\n            // need timer to allow to lock\n            setTimeout(function () {\n                // build parameters list\n                var params = {};\n                // add list params\n                params['cmd']   = 'save-record';\n                params['recid'] = obj.recid;\n                // append other params\n                $.extend(params, obj.postData);\n                $.extend(params, postData);\n                params.record = $.extend(true, {}, obj.record);\n                // event before\n                var eventData = obj.trigger({ phase: 'before', type: 'submit', target: obj.name, url: obj.url, postData: params });\n                if (eventData.isCancelled === true) return;\n                // default action\n                var url = eventData.url;\n                if (typeof eventData.url == 'object' && eventData.url.save) url = eventData.url.save;\n                if (obj.last.xhr) try { obj.last.xhr.abort(); } catch (e) {};\n                // process url with routeData\n                if (!$.isEmptyObject(obj.routeData)) {\n                    var info  = w2utils.parseRoute(url);\n                    if (info.keys.length > 0) {\n                        for (var k = 0; k < info.keys.length; k++) {\n                            if (obj.routeData[info.keys[k].name] == null) continue;\n                            url = url.replace((new RegExp(':'+ info.keys[k].name, 'g')), obj.routeData[info.keys[k].name]);\n                        }\n                    }\n                }\n                var ajaxOptions = {\n                    type     : 'POST',\n                    url      : url,\n                    data     : eventData.postData, \n                    dataType : 'text',   // expected from server\n                    xhr : function() {\n                        var xhr = new window.XMLHttpRequest();\n                        // upload\n                        xhr.upload.addEventListener(\"progress\", function(evt) {\n                            if (evt.lengthComputable) {\n                                var percent = Math.round(evt.loaded / evt.total * 100);\n                                $('#'+ obj.name + '_progress').text(''+ percent + '%');\n                            }\n                        }, false);\n                        return xhr;\n                    }\n                };\n                if (w2utils.settings.dataType == 'HTTP') {\n                    ajaxOptions.data = String($.param(ajaxOptions.data, false)).replace(/%5B/g, '[').replace(/%5D/g, ']');\n                }\n                if (w2utils.settings.dataType == 'RESTFULL') {\n                    if (obj.recid != 0) ajaxOptions.type = 'PUT';\n                    ajaxOptions.data = String($.param(ajaxOptions.data, false)).replace(/%5B/g, '[').replace(/%5D/g, ']');\n                }\n                if (w2utils.settings.dataType == 'JSON') {\n                    ajaxOptions.type        = 'POST';\n                    ajaxOptions.data        = JSON.stringify(ajaxOptions.data);\n                    ajaxOptions.contentType = 'application/json';\n                }\n\n                obj.last.xhr = $.ajax(ajaxOptions)\n                    .done(function (data, status, xhr) {\n                        obj.unlock();\n                        // event before\n                        var eventData = obj.trigger({ phase: 'before', target: obj.name, type: 'save', xhr: xhr, status: status });\n                        if (eventData.isCancelled === true) return;\n                        // parse server response\n                        var data;\n                        var responseText = xhr.responseText;\n                        if (status != 'error') {\n                            // default action\n                            if (typeof responseText != 'undefined' && responseText != '') {\n                                // check if the onLoad handler has not already parsed the data\n                                if (typeof responseText == \"object\") {\n                                    data = responseText;\n                                } else {\n                                    // $.parseJSON or $.getJSON did not work because those expect perfect JSON data - where everything is in double quotes\n                                    //\n                                    // TODO: avoid (potentially malicious) code injection from the response.\n                                    try { eval('data = '+ responseText); } catch (e) { }\n                                }\n                                if (typeof data == 'undefined') {\n                                    data = {\n                                        status       : 'error',\n                                        message      : obj.msgNotJSON,\n                                        responseText : responseText\n                                    }\n                                }\n                                if (data['status'] == 'error') {\n                                    obj.error(data['message']);\n                                } else {\n                                    obj.original = $.extend({}, obj.record);\n                                }\n                            }\n                        } else {\n                            obj.error('AJAX Error ' + xhr.status + ': '+ xhr.statusText);\n                            data = {\n                                status       : 'error',\n                                message      : obj.msgAJAXerror,\n                                responseText : responseText\n                            };\n                        }\n                        // event after\n                        obj.trigger($.extend(eventData, { phase: 'after' }));\n                        obj.refresh();\n                        // call back\n                        if (data.status == 'success' && typeof callBack == 'function') callBack(data);\n                    })\n                    .fail(function (xhr, status, error) {\n                        // trigger event\n                        var errorObj = { status: status, error: error, rawResponseText: xhr.responseText };\n                        var eventData2 = obj.trigger({ phase: 'before', type: 'error', error: errorObj, xhr: xhr });\n                        if (eventData2.isCancelled === true) return;\n                        // default behavior\n                        console.log('ERROR: server communication failed. The server should return', \n                            { status: 'success' }, 'OR', { status: 'error', message: 'error message' }, \n                            ', instead the AJAX request produced this: ', errorObj);\n                        // event after\n                        obj.trigger($.extend(eventData2, { phase: 'after' }));\n                    });\n                // event after\n                obj.trigger($.extend(eventData, { phase: 'after' }));\n            }, 50);\n        },\n\n        lock: function (msg, showSpinner) {\n            var box = $(this.box).find('> div:first-child');\n            var args = Array.prototype.slice.call(arguments, 0);\n            args.unshift(box);\n            w2utils.lock.apply(window, args);\n        },\n\n        unlock: function () {\n            var obj = this;\n            setTimeout(function () { w2utils.unlock(obj.box); }, 25); // needed timer so if server fast, it will not flash\n        },\n\n        goto: function (page) {\n            if (typeof page != 'undefined') this.page = page;\n            // if it was auto size, resize it\n            if ($(this.box).data('auto-size') === true) $(this.box).height(0);\n            this.refresh();\n        },\n\n        generateHTML: function () {\n            var pages = []; // array for each page\n            var group = '';\n            var page;\n            for (var f in this.fields) {\n                var html = '';\n                var field = this.fields[f];\n                if (typeof field.html == 'undefined') field.html = {};\n                field.html = $.extend(true, { caption: '', span: 6, attr: '', text: '', page: 0 }, field.html);\n                if (typeof page == 'undefined') page = field.html.page;\n                if (field.html.caption == '') field.html.caption = field.name;\n                var input = '<input name=\"'+ field.name +'\" type=\"text\" '+ field.html.attr +'/>';\n                if ((field.type === 'pass') || (field.type === 'password')){\n                    input = '<input name=\"' + field.name + '\" type = \"password\" ' + field.html.attr + '/>';\n                }\n                if (field.type == 'checkbox') input = '<input name=\"'+ field.name +'\" type=\"checkbox\" '+ field.html.attr +'/>';\n                if (field.type == 'textarea') input = '<textarea name=\"'+ field.name +'\" '+ field.html.attr +'></textarea>';\n                if (field.type == 'toggle')   input = '<input name=\"'+ field.name +'\" type=\"checkbox\" '+ field.html.attr +' class=\"w2ui-toggle\"/><div><div></div></div>';\n                if (field.html.group) {\n                    if (group != '') html += '\\n   </div>';\n                    html += '\\n   <div class=\"w2ui-group-title\">'+ field.html.group + '</div>\\n   <div class=\"w2ui-group\">';\n                    group = field.html.group;\n                }\n                if (field.html.page != page && group != '') {\n                    pages[pages.length-1] += '\\n   </div>';\n                    group = '';\n                }\n                html += '\\n      <div class=\"w2ui-field '+ (typeof field.html.span != 'undefined' ? 'w2ui-span'+ field.html.span : '') +'\">'+ \n                        '\\n         <label>' + w2utils.lang(field.html.caption) +'</label>'+\n                        '\\n         <div>'+ input + w2utils.lang(field.html.text) + '</div>'+\n                        '\\n      </div>';\n                if (typeof pages[field.html.page] == 'undefined') pages[field.html.page] = '';\n                pages[field.html.page] += html;\n                page = field.html.page;\n            }\n            if (group != '') pages[pages.length-1] += '\\n   </div>';\n            if (this.tabs.tabs) {\n                for (var i = 0; i < this.tabs.tabs.length; i++) if (typeof pages[i] == 'undefined') pages[i] = '';\n            }\n            for (var p in pages) pages[p] = '<div class=\"w2ui-page page-'+ p +'\">' + pages[p] + '\\n</div>';\n            // buttons if any\n            var buttons = '';\n            if (!$.isEmptyObject(this.actions)) {\n                var addClass = '';\n                buttons += '\\n<div class=\"w2ui-buttons\">';\n                for (var a in this.actions) {\n                    if (['save', 'update', 'create'].indexOf(a.toLowerCase()) != -1) addClass = 'btn-green'; else addClass = '';\n                    buttons += '\\n    <button name=\"'+ a +'\" class=\"btn '+ addClass +'\">'+ w2utils.lang(a) +'</button>';\n                }\n                buttons += '\\n</div>';\n            }\n            return pages.join('') + buttons;\n        },\n\n        action: function (action, event) {\n            // event before\n            var eventData = this.trigger({ phase: 'before', target: action, type: 'action', originalEvent: event });\n            if (eventData.isCancelled === true) return;\n            // default actions\n            if (typeof (this.actions[action]) == 'function') {\n                this.actions[action].call(this, event);\n            }\n            // event after\n            this.trigger($.extend(eventData, { phase: 'after' }));\n        },\n\n        resize: function () {\n            var obj = this;\n            // event before\n            var eventData = this.trigger({ phase: 'before', target: this.name, type: 'resize' });\n            if (eventData.isCancelled === true) return;\n            // default behaviour\n            var main    = $(this.box).find('> div');\n            var header  = $(this.box).find('> div .w2ui-form-header');\n            var toolbar = $(this.box).find('> div .w2ui-form-toolbar');\n            var tabs    = $(this.box).find('> div .w2ui-form-tabs');\n            var page    = $(this.box).find('> div .w2ui-page');\n            var cpage   = $(this.box).find('> div .w2ui-page.page-'+ this.page);\n            var dpage   = $(this.box).find('> div .w2ui-page.page-'+ this.page + ' > div');\n            var buttons = $(this.box).find('> div .w2ui-buttons');\n            // if no height, calculate it\n            resizeElements();\n            if (parseInt($(this.box).height()) == 0 || $(this.box).data('auto-size') === true) {\n                $(this.box).height(\n                    (header.length > 0 ? w2utils.getSize(header, 'height') : 0) +\n                    ((typeof this.tabs === 'object' && $.isArray(this.tabs.tabs) && this.tabs.tabs.length > 0) ? w2utils.getSize(tabs, 'height') : 0) +\n                    ((typeof this.toolbar == 'object' && $.isArray(this.toolbar.items) && this.toolbar.items.length > 0) ? w2utils.getSize(toolbar, 'height') : 0) +\n                    (page.length > 0 ? w2utils.getSize(dpage, 'height') + w2utils.getSize(cpage, '+height') + 12 : 0) +  // why 12 ???\n                    (buttons.length > 0 ? w2utils.getSize(buttons, 'height') : 0)\n                );\n                $(this.box).data('auto-size', true);\n            }\n            resizeElements();\n            // event after\n            obj.trigger($.extend(eventData, { phase: 'after' }));\n\n            function resizeElements() {\n                // resize elements\n                main.width($(obj.box).width()).height($(obj.box).height());\n                toolbar.css('top', (obj.header != '' ? w2utils.getSize(header, 'height') : 0));\n                tabs.css('top', (obj.header != '' ? w2utils.getSize(header, 'height') : 0)\n                              + ((typeof obj.toolbar == 'object' && $.isArray(obj.toolbar.items) && obj.toolbar.items.length > 0) ? w2utils.getSize(toolbar, 'height') : 0));\n                page.css('top', (obj.header != '' ? w2utils.getSize(header, 'height') : 0)\n                              + ((typeof obj.toolbar == 'object' && $.isArray(obj.toolbar.items) && obj.toolbar.items.length > 0) ? w2utils.getSize(toolbar, 'height') + 5 : 0)\n                              + ((typeof obj.tabs === 'object' && $.isArray(obj.tabs.tabs) && obj.tabs.tabs.length > 0) ? w2utils.getSize(tabs, 'height') + 5 : 0));\n                page.css('bottom', (buttons.length > 0 ? w2utils.getSize(buttons, 'height') : 0));\n            }\n        },\n\n        refresh: function () {\n            var time = (new Date()).getTime();\n            var obj = this;\n            if (!this.box) return;\n            if (!this.isGenerated || typeof $(this.box).html() == 'undefined') return;\n            // update what page field belongs\n            $(this.box).find('input, textarea, select').each(function (index, el) {\n                var name  = (typeof $(el).attr('name') != 'undefined' ? $(el).attr('name') : $(el).attr('id'));\n                var field = obj.get(name);\n                if (field) {\n                    // find page\n                    var div = $(el).parents('.w2ui-page');\n                    if (div.length > 0) {\n                        for (var i = 0; i < 100; i++) {\n                            if (div.hasClass('page-'+i)) { field.page = i; break; }\n                        }\n                    }\n                }\n            });\n            // event before\n            var eventData = this.trigger({ phase: 'before', target: this.name, type: 'refresh', page: this.page })\n            if (eventData.isCancelled === true) return;\n            // default action\n            $(this.box).find('.w2ui-page').hide();\n            $(this.box).find('.w2ui-page.page-' + this.page).show();\n            $(this.box).find('.w2ui-form-header').html(this.header);\n            // refresh tabs if needed\n            if (typeof this.tabs === 'object' && $.isArray(this.tabs.tabs) && this.tabs.tabs.length > 0) {\n                $('#form_'+ this.name +'_tabs').show();\n                this.tabs.active = this.tabs.tabs[this.page].id;\n                this.tabs.refresh();\n            } else {\n                $('#form_'+ this.name +'_tabs').hide();\n            }\n            // refresh tabs if needed\n            if (typeof this.toolbar == 'object' && $.isArray(this.toolbar.items) && this.toolbar.items.length > 0) {\n                $('#form_'+ this.name +'_toolbar').show();\n                this.toolbar.refresh();\n            } else {\n                $('#form_'+ this.name +'_toolbar').hide();\n            }\n            // refresh values of all fields\n            for (var f in this.fields) {\n                var field = this.fields[f];\n                if (typeof field.name == 'undefined' && typeof field.field != 'undefined') field.name = field.field;\n                if (typeof field.field == 'undefined' && typeof field.name != 'undefined') field.field = field.name;\n                field.$el = $(this.box).find('[name=\"'+ String(field.name).replace(/\\\\/g, '\\\\\\\\') +'\"]');\n                field.el  = field.$el[0];\n                if (typeof field.el == 'undefined') {\n                    console.log('ERROR: Cannot associate field \"'+ field.name + '\" with html control. Make sure html control exists with the same name.');\n                    //return;\n                }\n                if (field.el) field.el.id = field.name;\n                var tmp = $(field).data('w2field');\n                if (tmp) tmp.clear();\n                $(field.$el).off('change').on('change', function () {\n                    var value_new      = this.value;\n                    var value_previous = obj.record[this.name] ? obj.record[this.name] : '';\n                    var field          = obj.get(this.name);\n                    if (['list', 'enum', 'file'].indexOf(field.type) != -1 && $(this).data('selected')) {\n                        var nv = $(this).data('selected');\n                        var cv = obj.record[this.name];\n                        if ($.isArray(nv)) {\n                            value_new = [];\n                            for (var i in nv) value_new[i] = $.extend(true, {}, nv[i]); // clone array\n                        }\n                        if ($.isPlainObject(nv)) {\n                            value_new = $.extend(true, {}, nv); // clone object\n                        }\n                        if ($.isArray(cv)) {\n                            value_previous = [];\n                            for (var i in cv) value_previous[i] = $.extend(true, {}, cv[i]); // clone array\n                        }\n                        if ($.isPlainObject(cv)) {\n                            value_previous = $.extend(true, {}, cv); // clone object\n                        }\n                    }\n                    if (['toggle', 'checkbox'].indexOf(field.type) != -1) {\n                        value_new = ($(this).prop('checked') ? true : false);\n                    }\n                    // clean extra chars\n                    if (['int', 'float', 'percent', 'money', 'currency'].indexOf(field.type) != -1) {\n                        value_new = $(this).data('w2field').clean(value_new);\n                    }\n                    if (value_new === value_previous) return;\n                    // event before\n                    var eventData = obj.trigger({ phase: 'before', target: this.name, type: 'change', value_new: value_new, value_previous: value_previous });\n                    if (eventData.isCancelled === true) {\n                        $(this).val(obj.record[this.name]); // return previous value\n                        return;\n                    }\n                    // default action\n                    var val = this.value;\n                    if (this.type == 'select')   val = this.value;\n                    if (this.type == 'checkbox') val = this.checked ? true : false;\n                    if (this.type == 'radio') {\n                        field.$el.each(function (index, el) {\n                            if (el.checked) val = el.value;\n                        });\n                    }\n                    if (['int', 'float', 'percent', 'money', 'currency', 'list', 'combo', 'enum', 'file', 'toggle'].indexOf(field.type) != -1) {\n                        val = value_new;\n                    }\n                    if (['enum', 'file'].indexOf(field.type) != -1) {\n                        if (val.length > 0) {\n                            var fld = $(field.el).data('w2field').helpers.multi;\n                            $(fld).removeClass('w2ui-error');\n                        }\n                    }\n                    obj.record[this.name] = val;\n                    // event after\n                    obj.trigger($.extend(eventData, { phase: 'after' }));\n                });\n                if (field.required) {\n                    $(field.el).parent().parent().addClass('w2ui-required');\n                } else {\n                    $(field.el).parent().parent().removeClass('w2ui-required');\n                }\n            }\n            // attach actions on buttons\n            $(this.box).find('button, input[type=button]').each(function (index, el) {\n                $(el).off('click').on('click', function (event) {\n                    var action = this.value;\n                    if (this.id)   action = this.id;\n                    if (this.name) action = this.name;\n                    obj.action(action, event);\n                });\n            });\n            // init controls with record\n            for (var f in this.fields) {\n                var field = this.fields[f];\n                var value = (typeof this.record[field.name] != 'undefined' ? this.record[field.name] : '');\n                if (!field.el) continue;\n                field.type = String(field.type).toLowerCase();\n                if (!field.options) field.options = {};\n                switch (field.type) {\n                    case 'text':\n                    case 'textarea':\n                    case 'email':\n                    case 'pass':\n                    case 'password':\n                        field.el.value = value;\n                        break;\n                    case 'int':\n                    case 'float':\n                    case 'money':\n                    case 'currency':\n                    case 'percent':\n                    case 'hex':\n                    case 'alphanumeric':\n                    case 'color':\n                    case 'date':\n                    case 'time':\n                        field.el.value = value;\n                        $(field.el).w2field($.extend({}, field.options, { type: field.type }));\n                        break;\n                    case 'toggle':\n                        if (w2utils.isFloat(value)) value = parseFloat(value);\n                        $(field.el).prop('checked', (value ? true : false));\n                        this.record[field.name] = (value ? 1 : 0);\n                        break;\n                    // enums\n                    case 'list':\n                    case 'combo':\n                        if (field.type == 'list') {\n                            var tmp_value = ($.isPlainObject(value) ? value.id : value);\n                            // normalized options\n                            var items = field.options.items;\n                            if ($.isArray(items) && items.length > 0 && !$.isPlainObject(items[0])) {\n                                field.options.items = w2obj.field.prototype.normMenu(items);\n                            }\n                            // find value from items \n                            for (var i in field.options.items) {\n                                var item = field.options.items[i];\n                                if (item.id == tmp_value) {\n                                    value = $.extend(true, {}, item);\n                                    obj.record[field.name] = value;\n                                    break;\n                                }\n                            }\n                        } else if (field.type == 'combo' && !$.isPlainObject(value)) {\n                            field.el.value = value;\n                        } else if ($.isPlainObject(value) && typeof value.text != 'undefined') {\n                            field.el.value = value.text;\n                        } else {\n                            field.el.value = '';\n                        }\n                        if (!$.isPlainObject(value)) value = {};\n                        $(field.el).w2field($.extend({}, field.options, { type: field.type, selected: value }));\n                        break;\n                    case 'enum':\n                    case 'file':\n                        if (!$.isArray(value)) value = [];\n                        $(field.el).w2field($.extend({}, field.options, { type: field.type, selected: value }));\n                        break;\n\n                    // standard HTML\n                    case 'select':\n                        // generate options\n                        var items = field.options.items;\n                        if (typeof items != 'undefined' && items.length > 0) {\n                            items = w2obj.field.prototype.normMenu(items);\n                            $(field.el).html('');\n                            for (var it in items) {\n                                $(field.el).append('<option value=\"'+ items[it].id +'\">' + items[it].text + '</option');\n                            }\n                        }\n                        $(field.el).val(value);\n                        break;\n                    case 'radio':\n                        $(field.$el).prop('checked', false).each(function (index, el) {\n                            if ($(el).val() == value) $(el).prop('checked', true);\n                        });\n                        break;\n                    case 'checkbox':\n                        $(field.el).prop('checked', value ? true : false);\n                        break;\n                    default:\n                        $(field.el).w2field($.extend({}, field.options, { type: field.type }));\n                        break;\n                }\n            }\n            // wrap pages in div\n            var tmp = $(this.box).find('.w2ui-page');\n            for (var i = 0; i < tmp.length; i++) {\n                if ($(tmp[i]).find('> *').length > 1) $(tmp[i]).wrapInner('<div></div>');\n            }\n            // event after\n            this.trigger($.extend(eventData, { phase: 'after' }));\n            this.resize();\n            return (new Date()).getTime() - time;\n        },\n\n        render: function (box) {\n            var time = (new Date()).getTime();\n            var obj = this;\n            if (typeof box == 'object') {\n                // remove from previous box\n                if ($(this.box).find('#form_'+ this.name +'_tabs').length > 0) {\n                    $(this.box).removeAttr('name')\n                        .removeClass('w2ui-reset w2ui-form')\n                        .html('');\n                }\n                this.box = box;\n            }\n            if (!this.isGenerated) return;\n            if (!this.box) return;\n            // event before\n            var eventData = this.trigger({ phase: 'before', target: this.name, type: 'render', box: (typeof box != 'undefined' ? box : this.box) });\n            if (eventData.isCancelled === true) return;\n            // default actions\n            if ($.isEmptyObject(this.original) && !$.isEmptyObject(this.record)) {\n                this.original = $.extend(true, {}, this.record);\n            }\n            var html =  '<div>' +\n                        (this.header != '' ? '<div class=\"w2ui-form-header\">' + this.header + '</div>' : '') +\n                        '    <div id=\"form_'+ this.name +'_toolbar\" class=\"w2ui-form-toolbar\"></div>' +\n                        '    <div id=\"form_'+ this.name +'_tabs\" class=\"w2ui-form-tabs\"></div>' +\n                            this.formHTML +\n                        '</div>';\n            $(this.box).attr('name', this.name)\n                .addClass('w2ui-reset w2ui-form')\n                .html(html);\n            if ($(this.box).length > 0) $(this.box)[0].style.cssText += this.style;\n\n            // init toolbar regardless it is defined or not\n            if (typeof this.toolbar.render !== 'function') {\n                this.toolbar = $().w2toolbar($.extend({}, this.toolbar, { name: this.name +'_toolbar', owner: this }));\n                this.toolbar.on('click', function (event) {\n                    var eventData = obj.trigger({ phase: 'before', type: 'toolbar', target: event.target, originalEvent: event });\n                    if (eventData.isCancelled === true) return;\n                    // no default action\n                    obj.trigger($.extend(eventData, { phase: 'after' }));\n                });\n            }\n            if (typeof this.toolbar == 'object' && typeof this.toolbar.render == 'function') {\n                this.toolbar.render($('#form_'+ this.name +'_toolbar')[0]);\n            }\n            // init tabs regardless it is defined or not\n            if (typeof this.tabs.render !== 'function') {\n                this.tabs = $().w2tabs($.extend({}, this.tabs, { name: this.name +'_tabs', owner: this }));\n                this.tabs.on('click', function (event) {\n                    obj.goto(this.get(event.target, true));\n                });\n            }\n            if (typeof this.tabs == 'object' && typeof this.tabs.render == 'function') {\n                this.tabs.render($('#form_'+ this.name +'_tabs')[0]);\n            }\n            // event after\n            this.trigger($.extend(eventData, { phase: 'after' }));\n            // after render actions\n            this.resize();\n            var url = (typeof this.url != 'object' ? this.url : this.url.get);\n            if (url && this.recid != 0) {\n                this.request();\n            } else {\n                this.refresh();\n            }\n            // attach to resize event\n            if ($('.w2ui-layout').length == 0) { // if there is layout, it will send a resize event\n                this.tmp_resize = function (event) { w2ui[obj.name].resize(); }\n                $(window).off('resize', 'body').on('resize', 'body', this.tmp_resize);\n            }\n            setTimeout(function () { obj.resize(); obj.refresh(); }, 150); // need timer because resize is on timer\n            // focus on load\n            function focusEl() {\n                var inputs = $(obj.box).find('input, select, textarea');\n                if (inputs.length > obj.focus) inputs[obj.focus].focus();\n            }\n            if (this.focus >= 0) setTimeout(focusEl, 500); // need timeout to allow form to render\n            return (new Date()).getTime() - time;\n        },\n\n        destroy: function () {\n            // event before\n            var eventData = this.trigger({ phase: 'before', target: this.name, type: 'destroy' });\n            if (eventData.isCancelled === true) return;\n            // clean up\n            if (typeof this.toolbar == 'object' && this.toolbar.destroy) this.toolbar.destroy();\n            if (typeof this.tabs == 'object' && this.tabs.destroy) this.tabs.destroy();\n            if ($(this.box).find('#form_'+ this.name +'_tabs').length > 0) {\n                $(this.box)\n                    .removeAttr('name')\n                    .removeClass('w2ui-reset w2ui-form')\n                    .html('');\n            }\n            delete w2ui[this.name];\n            // event after\n            this.trigger($.extend(eventData, { phase: 'after' }));\n            $(window).off('resize', 'body')\n        }\n    };\n\n    $.extend(w2form.prototype, w2utils.event);\n    w2obj.form = w2form;\n})();\n"],"sourceRoot":""}